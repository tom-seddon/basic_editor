$START.Quote=&AD.Channel=&AC.Length=&AB \ *********************** \ * BLIST for ROM       * \ * LISTS BASIC FILES   * \ * DIRECT FROM STORE   * \ * *BLIST <fsp>        * \ ***********************.'BLIST TYA CLC ADC &F2 TAX \lsb of fsp address LDY &F3 BCC A1 INY.A1 LDA #&40 JSR OSFIND \OPENIN TAY \Channel# BNE Open JSR Errorexit $EQUB &D6 $EQUS "File not found" BRK.Open STA Channel JSR Byte.CR1 CMP #&D BNE Bad.CR JSR OSASCI JSR Byte TAY BMI done \Line#msb -ve =TOP STA &AF STA Quote \Reset off, +ve JSR Byte STA &AE JSR LINIAC2 \Print AE/F in 5 field JSR Space1 JSR Byte \Line length SBC #2 \C=0 STA Length.Next JSR Byte BEQ CR1 \Length=0 CMP #&22 \Quote? BNE La LDA #&FF EOR Quote STA Quote LDA #&22.Lout JSR Printasci \Ctrls=| JMP Next.La BIT Quote BMI Lout \Within quotes CMP #&8D \Line#? BEQ Line_no TAX BPL Lout \Not token JSR DECRUNCH JMP Next.Byte BIT &FF BMI Out LDY Channel JSR OSBGET BCS Out2 \EOF DEC Length RTS.Out LDA #126 JSR OSBYTE \Ack escape.Out2 PLA PLA \Drop rtn address.done LDY Channel LDA #0 JSR OSFIND JSR OSNEWL JMP Alldone.Bad JSR Errorexit $EQUB 214 $EQUS "Bad program" BRK.Line_no JSR Byte ASL A ASL A STA &AF AND #&C0 STA &AE JSR Byte EOR &AE STA &AE LDA &AF ASL A ASL A STA &AF JSR Byte EOR &AF STA &AF JSR OUTIAC2 JMP Next$END