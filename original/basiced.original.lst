------- FILE basiced.s65 LEVEL 1 PASS 2
      1  c000					      processor	6502
      2  c000 ????
      3  c000 ????	       ff e7	   OSNEWL     equ	$ffe7
      4  c000 ????	       ff e0	   OSRDCH     equ	$ffe0
      5  c000 ????	       ff f7	   OSCLI      equ	$fff7
      6  c000 ????	       ff ee	   OSWRCH     equ	$ffee
      7  c000 ????	       ff f4	   OSBYTE     equ	$fff4
      8  c000 ????	       ff f1	   OSWORD     equ	$fff1
      9  c000 ????	       ff dd	   OSFILE     equ	$ffdd
     10  c000 ????
     11 U0100 ????				      seg.u	bss
------- FILE zp.s65 LEVEL 2 PASS 2
      0 U0100 ????				      include	"zp.s65"
      1 U0000					      org	0
      2 U0000
      3 U0000				   byte_0
      4 U0000		       00		      ds	1
      5 U0001				   unk_1
      6 U0001		       00		      ds	1
      7 U0002		       00		      ds	1
      8 U0003		       00		      ds	1
      9 U0004		       00		      ds	1
     10 U0005		       00		      ds	1
     11 U0006				   HIMEM
     12 U0006		       00		      ds	1
     13 U0007		       00		      ds	1
     14 U0008				   unk_8
     15 U0008		       00		      ds	1
     16 U0009				   unk_9
     17 U0009		       00		      ds	1
     18 U000a				   background_colour
     19 U000a		       00		      ds	1
     20 U000b				   foreground_colour
     21 U000b		       00		      ds	1
     22 U000c				   byte_C
     23 U000c		       00		      ds	1
     24 U000d				   byte_D
     25 U000d		       00		      ds	1
     26 U000e				   byte_E
     27 U000e		       00		      ds	1
     28 U000f				   byte_F
     29 U000f		       00		      ds	1
     30 U0010				   cursor_offset
     31 U0010		       00		      ds	1
     32 U0011				   unk_11
     33 U0011		       00		      ds	1
     34 U0012				   TOP
     35 U0012		       00		      ds	1
     36 U0013		       00		      ds	1
     37 U0014				   screen_mode
     38 U0014		       00		      ds	1
     39 U0015				   byte_15
     40 U0015		       00		      ds	1
     41 U0016				   unk_16
     42 U0016		       00		      ds	1
     43 U0017				   oshwm
     44 U0017		       00		      ds	1
     45 U0018		       00		      ds	1
     46 U0019				   readline_ptr_lsb
     47 U0019		       00		      ds	1
     48 U001a				   readline_ptr_msb
     49 U001a		       00		      ds	1
     50 U001b				   unk_1B
     51 U001b		       00		      ds	1
     52 U001c				   unk_1C
     53 U001c		       00		      ds	1
     54 U001d				   unk_1D
     55 U001d		       00		      ds	1
     56 U001e				   unk_1E
     57 U001e		       00		      ds	1
     58 U001f				   unk_1F
     59 U001f		       00		      ds	1
     60 U0020				   byte_20
     61 U0020		       00		      ds	1
     62 U0021				   byte_21
     63 U0021		       00		      ds	1
     64 U0022				   byte_22
     65 U0022		       00		      ds	1
     66 U0023				   byte_23
     67 U0023		       00		      ds	1
     68 U0024				   byte_24
     69 U0024		       00		      ds	1
     70 U0025				   byte_25
     71 U0025		       00		      ds	1
     72 U0026				   byte_26
     73 U0026		       00		      ds	1
     74 U0027				   byte_27
     75 U0027		       00		      ds	1
     76 U0028				   byte_28
     77 U0028		       00		      ds	1
     78 U0029				   unk_29
     79 U0029		       00		      ds	1
     80 U002a				   unk_2A
     81 U002a		       00		      ds	1
     82 U002b				   byte_2B
     83 U002b		       00		      ds	1
     84 U002c				   byte_2C
     85 U002c		       00		      ds	1
     86 U002d				   byte_2D
     87 U002d		       00		      ds	1
     88 U002e				   unk_2E
     89 U002e		       00		      ds	1
     90 U002f				   unk_2F
     91 U002f		       00		      ds	1
     92 U0030				   unk_30
     93 U0030		       00		      ds	1
     94 U0031				   unk_31
     95 U0031		       00		      ds	1
     96 U0032				   unk_32
     97 U0032		       00		      ds	1
     98 U0033				   unk_33
     99 U0033		       00		      ds	1
    100 U0034				   unk_34
    101 U0034		       00		      ds	1
    102 U0035				   byte_35
    103 U0035		       00		      ds	1
    104 U0036				   byte_36
    105 U0036		       00		      ds	1
    106 U0037				   unk_37
    107 U0037		       00		      ds	1
    108 U0038				   byte_38
    109 U0038		       00		      ds	1
    110 U0039				   byte_39
    111 U0039		       00		      ds	1
    112 U003a				   byte_3A
    113 U003a		       00		      ds	1
    114 U003b				   byte_3B
    115 U003b		       00		      ds	1
    116 U003c				   is_insert_mode
    117 U003c		       00		      ds	1
    118 U003d				   scroll_status
    119 U003d		       00		      ds	1
    120 U003e				   byte_3E
    121 U003e		       00		      ds	1
    122 U003f				   byte_3F
    123 U003f		       00		      ds	1
    124 U0040				   byte_40
    125 U0040		       00		      ds	1
    126 U0041				   byte_41
    127 U0041		       00		      ds	1
    128 U0042				   byte_42
    129 U0042		       00		      ds	1
    130 U0043				   byte_43
    131 U0043		       00		      ds	1
    132 U0044				   byte_44
    133 U0044		       00		      ds	1
    134 U0045				   byte_45
    135 U0045		       00		      ds	1
    136 U0046				   byte_46
    137 U0046		       00		      ds	1
    138 U0047				   byte_47
    139 U0047		       00		      ds	1
    140 U0048				   byte_48
    141 U0048		       00		      ds	1
    142 U0049				   byte_49
    143 U0049		       00		      ds	1
    144 U004a				   current_line_no_lsb
    145 U004a		       00		      ds	1
    146 U004b				   current_line_no_msb
    147 U004b		       00		      ds	1
    148 U004c		       00		      ds	1
    149 U004d				   unk_4D
    150 U004d		       00		      ds	1
    151 U004e				   unk_4E
    152 U004e		       00		      ds	1
    153 U004f		       00		      ds	1
    154 U0050				   byte_50
    155 U0050		       00		      ds	1
    156 U0051				   byte_51
    157 U0051		       00		      ds	1
    158 U0052				   program_name
    159 U0052		       00		      ds	1
    160 U0053		       00		      ds	1
    161 U0054		       00		      ds	1
    162 U0055		       00		      ds	1
    163 U0056		       00		      ds	1
    164 U0057		       00		      ds	1
    165 U0058				   unk_58
    166 U0058		       00		      ds	1
    167 U0059		       00		      ds	1
    168 U005a		       00		      ds	1
    169 U005b				   unk_5B
    170 U005b		       00		      ds	1
    171 U005c		       00		      ds	1
    172 U005d		       00		      ds	1
    173 U005e		       00		      ds	1
    174 U005f				   unk_5F
    175 U005f		       00		      ds	1
    176 U0060		       00		      ds	1
    177 U0061				   unk_61
    178 U0061		       00		      ds	1
    179 U0062				   byte_62
    180 U0062		       00		      ds	1
    181 U0063				   unk_63
    182 U0063		       00		      ds	1
    183 U0064				   unk_64
    184 U0064		       00		      ds	1
    185 U0065		       00		      ds	1
    186 U0066		       00		      ds	1
    187 U0067		       00		      ds	1
    188 U0068		       00		      ds	1
    189 U0069		       00		      ds	1
    190 U006a		       00		      ds	1
    191 U006b		       00		      ds	1
    192 U006c		       00		      ds	1
    193 U006d		       00		      ds	1
    194 U006e		       00		      ds	1
    195 U006f		       00		      ds	1
    196 U0070				   unk_70
    197 U0070		       00		      ds	1
    198 U0071		       00		      ds	1
    199 U0072		       00		      ds	1
    200 U0073		       00		      ds	1
    201 U0074		       00		      ds	1
    202 U0075		       00		      ds	1
    203 U0076		       00		      ds	1
    204 U0077		       00		      ds	1
    205 U0078		       00		      ds	1
    206 U0079		       00		      ds	1
    207 U007a		       00		      ds	1
    208 U007b				   unk_7B
    209 U007b		       00		      ds	1
    210 U007c		       00		      ds	1
    211 U007d		       00		      ds	1
    212 U007e		       00		      ds	1
    213 U007f		       00		      ds	1
    214 U0080		       00		      ds	1
    215 U0081		       00		      ds	1
    216 U0082		       00		      ds	1
    217 U0083		       00		      ds	1
    218 U0084		       00		      ds	1
    219 U0085		       00		      ds	1
    220 U0086		       00		      ds	1
    221 U0087				   unk_87
    222 U0087		       00		      ds	1
    223 U0088		       00		      ds	1
    224 U0089		       00		      ds	1
    225 U008a				   unk_8A
    226 U008a		       00		      ds	1
    227 U008b		       00		      ds	1
    228 U008c		       00		      ds	1
    229 U008d				   unk_8D
    230 U008d		       00		      ds	1
    231 U008e		       00		      ds	1
    232 U008f		       00		      ds	1
    233 U0090		       00		      ds	1
    234 U0091		       00		      ds	1
    235 U0092		       00		      ds	1
    236 U0093		       00		      ds	1
    237 U0094		       00		      ds	1
    238 U0095		       00		      ds	1
    239 U0096		       00		      ds	1
    240 U0097				   unk_97
    241 U0097		       00		      ds	1
    242 U0098		       00		      ds	1
    243 U0099		       00		      ds	1
    244 U009a				   unk_9A
    245 U009a		       00		      ds	1
    246 U009b		       00		      ds	1
    247 U009c		       00		      ds	1
    248 U009d		       00		      ds	1
    249 U009e		       00		      ds	1
    250 U009f		       00		      ds	1
    251 U00a0				   unk_A0
    252 U00a0		       00		      ds	1
    253 U00a1		       00		      ds	1
    254 U00a2		       00		      ds	1
    255 U00a3		       00		      ds	1
    256 U00a4		       00		      ds	1
    257 U00a5		       00		      ds	1
    258 U00a6		       00		      ds	1
    259 U00a7		       00		      ds	1
    260 U00a8				   byte_A8
    261 U00a8		       00		      ds	1
    262 U00a9				   byte_A9
    263 U00a9		       00		      ds	1
    264 U00aa		       00		      ds	1
    265 U00ab		       00		      ds	1
    266 U00ac		       00		      ds	1
    267 U00ad		       00		      ds	1
    268 U00ae		       00		      ds	1
    269 U00af		       00		      ds	1
    270 U00b0		       00		      ds	1
    271 U00b1		       00		      ds	1
    272 U00b2		       00		      ds	1
    273 U00b3		       00		      ds	1
    274 U00b4		       00		      ds	1
    275 U00b5		       00		      ds	1
    276 U00b6		       00		      ds	1
    277 U00b7		       00		      ds	1
    278 U00b8		       00		      ds	1
    279 U00b9		       00		      ds	1
    280 U00ba		       00		      ds	1
    281 U00bb		       00		      ds	1
    282 U00bc		       00		      ds	1
    283 U00bd		       00		      ds	1
    284 U00be		       00		      ds	1
    285 U00bf		       00		      ds	1
    286 U00c0				   unk_C0
    287 U00c0		       00		      ds	1
    288 U00c1		       00		      ds	1
    289 U00c2		       00		      ds	1
    290 U00c3		       00		      ds	1
    291 U00c4		       00		      ds	1
    292 U00c5		       00		      ds	1
    293 U00c6		       00		      ds	1
    294 U00c7		       00		      ds	1
    295 U00c8				   unk_C8
    296 U00c8		       00		      ds	1
    297 U00c9		       00		      ds	1
    298 U00ca		       00		      ds	1
    299 U00cb		       00		      ds	1
    300 U00cc		       00		      ds	1
    301 U00cd		       00		      ds	1
    302 U00ce		       00		      ds	1
    303 U00cf		       00		      ds	1
    304 U00d0				   unk_D0
    305 U00d0		       00		      ds	1
    306 U00d1		       00		      ds	1
    307 U00d2		       00		      ds	1
    308 U00d3		       00		      ds	1
    309 U00d4		       00		      ds	1
    310 U00d5		       00		      ds	1
    311 U00d6		       00		      ds	1
    312 U00d7		       00		      ds	1
    313 U00d8		       00		      ds	1
    314 U00d9		       00		      ds	1
    315 U00da				   unk_DA
    316 U00da		       00		      ds	1
    317 U00db				   unk_DB
    318 U00db		       00		      ds	1
    319 U00dc				   unk_DC
    320 U00dc		       00		      ds	1
    321 U00dd		       00		      ds	1
    322 U00de		       00		      ds	1
    323 U00df		       00		      ds	1
    324 U00e0		       00		      ds	1
    325 U00e1				   unk_E1
    326 U00e1		       00		      ds	1
    327 U00e2				   unk_E2
    328 U00e2		       00		      ds	1
    329 U00e3				   unk_E3
    330 U00e3		       00		      ds	1
    331 U00e4				   unk_E4
    332 U00e4		       00		      ds	1
    333 U00e5				   unk_E5
    334 U00e5		       00		      ds	1
    335 U00e6				   unk_E6
    336 U00e6		       00		      ds	1
    337 U00e7				   unk_E7
    338 U00e7		       00		      ds	1
    339 U00e8		       00		      ds	1
    340 U00e9		       00		      ds	1
    341 U00ea		       00		      ds	1
    342 U00eb		       00		      ds	1
    343 U00ec				   unk_EC
    344 U00ec		       00		      ds	1
    345 U00ed		       00		      ds	1
    346 U00ee		       00		      ds	1
    347 U00ef		       00		      ds	1
    348 U00f0		       00		      ds	1
    349 U00f1		       00		      ds	1
    350 U00f2				   byte_F2
    351 U00f2		       00		      ds	1
    352 U00f3				   byte_F3
    353 U00f3		       00		      ds	1
    354 U00f4		       00		      ds	1
    355 U00f5		       00		      ds	1
    356 U00f6		       00		      ds	1
    357 U00f7		       00		      ds	1
    358 U00f8		       00		      ds	1
    359 U00f9		       00		      ds	1
    360 U00fa		       00		      ds	1
    361 U00fb		       00		      ds	1
    362 U00fc		       00		      ds	1
    363 U00fd				   unk_FD
    364 U00fd		       00		      ds	1
    365 U00fe				   unk_FE
    366 U00fe		       00		      ds	1
    367 U00ff		       00		      ds	1
    368 U0100
------- FILE basiced.s65
------- FILE workspace.s65 LEVEL 2 PASS 2
      0 U0100					      include	"workspace.s65"
      1 U0100		       04 00	   byte_400   equ	$400
      2 U0100		       04 01	   unk_401    equ	$401
      3 U0100		       05 00	   unk_500    equ	$500
      4 U0100		       05 01	   unk_501    equ	$501
      5 U0100		       05 02	   unk_502    equ	$502
      6 U0100		       05 03	   unk_503    equ	$503
      7 U0100		       05 b1	   unk_5B1    equ	$5B1
      8 U0100		       06 43	   unk_643    equ	$643
      9 U0100		       06 a7	   byte_6A7   equ	$6A7
     10 U0100		       06 a8	   byte_6A8   equ	$6A8
     11 U0100		       06 a9	   old_stack_ptr equ	$6A9
     12 U0100		       06 aa	   unk_6AA    equ	$6AA
     13 U0100		       06 ab	   byte_6AB   equ	$6Ab
     14 U0100		       06 ad	   unk_6AD    equ	$6AD
     15 U0100		       06 ae	   unk_6AE    equ	$6AE
     16 U0100		       06 af	   byte_6AF   equ	$6AF
     17 U0100		       06 b0	   unk_6B0    equ	$6B0
     18 U0100		       06 b1	   unk_6B1    equ	$6B1
     19 U0100		       06 b2	   unk_6B2    equ	$6B2
     20 U0100		       06 b3	   byte_6B3   equ	$6B3
     21 U0100		       06 b4	   higher_order_address equ	$6B4
     22 U0100		       06 b6	   code_area_width equ	$6B6
     23 U0100		       06 b7	   editor_mode_id equ	$6B7
     24 U0100		       06 b8	   unk_6B8    equ	$6B8
     25 U0100		       06 b9	   unk_6B9    equ	$6B9
     26 U0100		       06 ba	   unk_6BA    equ	$6BA
     27 U0100		       06 bb	   unk_6BB    equ	$6BB
     28 U0100		       06 bc	   unk_6BC    equ	$6BC
     29 U0100		       06 bd	   current_command_id equ	$6BD
     30 U0100		       06 be	   byte_6BE   equ	$6BE
     31 U0100		       06 bf	   screen_height equ	$6BF
     32 U0100		       06 c0	   byte_6C0   equ	$6C0
     33 U0100		       06 c1	   byte_6C1   equ	$6C1
     34 U0100		       07 00	   unk_700    equ	$700
------- FILE basiced.s65
------- FILE cmds.s65 LEVEL 2 PASS 2
      0 U0100					      include	"cmds.s65"
      1 U0100		       00 a1	   CMD_toggle_insert_overtype equ	$A1
      2 U0100		       00 a3	   CMD_f2_key equ	$A3
      3 U0100		       00 a4	   CMD_f4_key equ	$A4
      4 U0100		       00 a8	   CMD_IE     equ	$A8
      5 U0100		       00 a9	   CMD_EXIT   equ	$A9
      6 U0100		       00 b0	   CMD_NEW    equ	$B0
      7 U0100		       00 b1	   CMD_OLD    equ	$B1
      8 U0100		       00 b2	   CMD_shift_f2_key equ	$B2
      9 U0100		       00 b3	   CMD_shift_f3_key equ	$B3
     10 U0100		       00 b4	   CMD_shift_f4_key equ	$B4
     11 U0100		       00 b5	   CMD_shift_f5_key equ	$B5
     12 U0100		       00 b6	   CMD_shift_f6_key equ	$B6
     13 U0100		       00 b7	   CMD_shift_f7_key equ	$B7
     14 U0100		       00 b8	   CMD_IT     equ	$B8
     15 U0100		       00 b9	   CMD_shift_f9_key equ	$B9
     16 U0100		       00 c5	   CMD_SCROLL equ	$C5
     17 U0100		       00 c6	   CMD_NOSCROLL equ	$C6
     18 U0100		       00 d0	   CMD_RUN    equ	$D0
     19 U0100		       00 d1	   CMD_MODE   equ	$D1
     20 U0100		       00 d2	   CMD_NUMBER equ	$D2
     21 U0100		       00 d3	   CMD_LABEL  equ	$D3
     22 U0100		       00 d4	   CMD_HELP   equ	$D4
     23 U0100		       00 d5	   CMD_BACK   equ	$D5
     24 U0100		       00 d6	   CMD_FORE   equ	$D6
     25 U0100		       00 d7	   CMD_INSERT equ	$D7
     26 U0100		       00 d8	   CMD_OVERTYPE equ	$D8
     27 U0100		       00 d9	   CMD_INFO   equ	$D9
     28 U0100		       00 da	   CMD_goto_line equ	$DA
     29 U0100		       00 db	   CMD_tab_key equ	$DB
     30 U0100		       00 dc	   CMD_RENUMBER equ	$DC
     31 U0100		       00 dd	   CMD_LOAD   equ	$DD
     32 U0100		       00 de	   CMD_APPEND equ	$DE
     33 U0100		       00 df	   CMD_SAVE   equ	$DF
     34 U0100		       00 e0	   CMD_FIND   equ	$E0
     35 U0100		       00 e1	   CMD_CHANGE equ	$E1
     36 U0100		       00 e2	   CMD_QCHANGE equ	$E2
     37 U0100		       00 e3	   CMD_star   equ	$E3
     38 U0100		       00 e4	   CMD_TAB    equ	$E4
     39 U0100		       00 e5	   CMD_return_key equ	$E5
     40 U0100		       00 e6	   CMD_delete_key equ	$E6
     41 U0100		       00 e7	   CMD_shift_delete_key equ	$E7
     42 U0100		       00 e8	   CMD_GOTO   equ	$E8
     43 U0100		       00 e9	   CMD_EDIT   equ	$E9
     44 U0100		       00 ea	   CMD_TOP    equ	$EA
     45 U0100		       00 eb	   CMD_END    equ	$EB
     46 U0100		       00 ec	   CMD_shift_tab_key equ	$EC
------- FILE basiced.s65
     15 U0100
     16  c000 ????				      seg	code
     17  8000					      org	$8000
------- FILE mainpart.s65 LEVEL 2 PASS 2
      0  8000					      include	"mainpart.s65"
      1  8000		       4c c7 80 	      JMP	language_entry
      2  8003		       4c 33 80 	      JMP	service_entry
      3  8006		       c2		      dc.b	$C2	; Â
      4  8007		       1f		      dc.b	$1F	;
      5  8008		       05		      dc.b	5	;
      6  8009		       54 68 65 20*aTheBasicEditor_0 dc.b	"The BASIC Editor",0
      7  801a		       20 31 2e 33*version_number_string dc.b	" 1.32",0
      8  8020		       28 43 29 20*aC1984Acornsoft dc.b	"(C) 1984 Acornsoft",0
      9  8033							; A = code, X = ROM number, Y = parameter.
     10  8033
     11  8033
     12  8033
     13  8033				   service_entry
     14  8033		       08		      PHP
     15  8034		       48		      PHA
     16  8035		       98		      TYA
     17  8036		       48		      PHA
     18  8037		       a5 a8		      LDA	byte_A8
     19  8039		       48		      PHA
     20  803a		       a5 a9		      LDA	byte_A9
     21  803c		       48		      PHA
     22  803d		       8a		      TXA
     23  803e		       48		      PHA
     24  803f		       d8		      CLD
     25  8040		       ba		      TSX
     26  8041		       bd 05 01 	      LDA	$105,X	; get request type
     27  8044		       c9 04		      CMP	#4	; unknown * command?
     28  8046		       f0 41		      BEQ	star_command
     29  8048		       c9 09		      CMP	#9	; *HELP?
     30  804a		       f0 0d		      BEQ	help
     31  804c
     32  804c				   service_entry_exit
     33  804c		       68		      PLA
     34  804d		       aa		      TAX
     35  804e		       68		      PLA
     36  804f		       85 a9		      STA	byte_A9
     37  8051		       68		      PLA
     38  8052		       85 a8		      STA	byte_A8
     39  8054		       68		      PLA
     40  8055		       a8		      TAY
     41  8056		       68		      PLA
     42  8057		       28		      PLP
     43  8058		       60		      RTS
     44  8059							; End of function service_entry
     45  8059
     46  8059							; Search for first non-space char on command line
     47  8059
     48  8059
     49  8059
     50  8059				   help
     51  8059		       b1 f2		      LDA	($F2),Y
     52  805b		       c9 20		      CMP	#$20	; ' '
     53  805d		       d0 03		      BNE	loc_8062	; empty	command	line?
     54  805f		       c8		      INY
     55  8060		       d0 f7		      BNE	help
     56  8062
     57  8062				   loc_8062
     58  8062		       c9 0d		      CMP	#$D	; empty	command	line?
     59  8064		       d0 e6		      BNE	service_entry_exit
     60  8066		       20 e7 ff 	      JSR	OSNEWL
     61  8069		       a0 00		      LDY	#0
     62  806b
     63  806b				   print_ROM_name_loop
     64  806b		       b9 6c 89 	      LDA	aTheBasicEditor,Y	; "The BASIC Editor"
     65  806e		       f0 06		      BEQ	print_version_number
     66  8070		       20 ee ff 	      JSR	OSWRCH
     67  8073		       c8		      INY
     68  8074		       d0 f5		      BNE	print_ROM_name_loop
     69  8076
     70  8076				   print_version_number
     71  8076		       a0 00		      LDY	#0
     72  8078
     73  8078				   print_version_number_loop
     74  8078		       b9 1a 80 	      LDA	version_number_string,Y	; " 1.32"
     75  807b		       20 ee ff 	      JSR	OSWRCH
     76  807e		       c8		      INY
     77  807f		       c0 05		      CPY	#5
     78  8081		       90 f5		      BCC	print_version_number_loop
     79  8083		       20 e7 ff 	      JSR	OSNEWL
     80  8086		       4c 4c 80 	      JMP	service_entry_exit
     81  8089							; End of function help
     82  8089
     83  8089
     84  8089
     85  8089
     86  8089				   star_command
     87  8089		       18		      CLC
     88  808a							; Point ($A8) where ($F2),Y points
     89  808a		       98		      TYA
     90  808b		       65 f2		      ADC	byte_F2
     91  808d		       85 a8		      STA	byte_A8
     92  808f		       a9 00		      LDA	#0
     93  8091		       65 f3		      ADC	byte_F3
     94  8093		       85 a9		      STA	byte_A9
     95  8095		       a0 00		      LDY	#0
     96  8097
     97  8097				   loc_8097
     98  8097		       b9 53 8b 	      LDA	be_cmd,Y	; get next cmd name char
     99  809a		       aa		      TAX
    100  809b		       b1 a8		      LDA	($A8),Y	; get char from	command	line
    101  809d		       c9 2e		      CMP	#$2E	; '.'	    ; abbreviated?
    102  809f		       d0 0f		      BNE	loc_80B0	; end of line?
    103  80a1		       c0 00		      CPY	#0
    104  80a3		       f0 a7		      BEQ	service_entry_exit
    105  80a5		       e0 00		      CPX	#0
    106  80a7		       f0 a3		      BEQ	service_entry_exit
    107  80a9
    108  80a9				   loc_80A9
    109  80a9		       68		      PLA
    110  80aa		       aa		      TAX
    111  80ab		       a9 8e		      LDA	#$8E
    112  80ad		       4c f4 ff 	      JMP	OSBYTE
    113  80b0
    114  80b0				   loc_80B0
    115  80b0		       c9 0d		      CMP	#$D	; end of line?
    116  80b2		       f0 04		      BEQ	end_of_line
    117  80b4		       c9 20		      CMP	#$20	; ' '
    118  80b6		       d0 05		      BNE	check_char	; toupper
    119  80b8
    120  80b8				   end_of_line
    121  80b8		       8a		      TXA
    122  80b9		       f0 ee		      BEQ	loc_80A9
    123  80bb		       d0 8f		      BNE	service_entry_exit
    124  80bd
    125  80bd				   check_char
    126  80bd		       29 df		      AND	#$DF	; toupper
    127  80bf		       d9 53 8b 	      CMP	be_cmd,Y	; "BE"
    128  80c2		       d0 88		      BNE	service_entry_exit
    129  80c4		       c8		      INY
    130  80c5		       d0 d0		      BNE	loc_8097	; get next cmd name char
    131  80c7							; End of function star_command
    132  80c7
    133  80c7							; fall through to language entry
    134  80c7
    135  80c7
    136  80c7
    137  80c7				   language_entry
    138  80c7		       c9 01		      CMP	#1	; normal language entry?
    139  80c9		       f0 01		      BEQ	language_start
    140  80cb		       60		      RTS
    141  80cc
    142  80cc				   language_start
    143  80cc		       20 7f 81 	      JSR	init_brkv_and_oshwm
    144  80cf		       20 e4 a1 	      JSR	clear_line_commands
    145  80d2		       20 58 b3 	      JSR	sub_B358
    146  80d5		       20 c9 a6 	      JSR	reset_program_name
    147  80d8		       a2 05		      LDX	#5
    148  80da		       86 61		      STX	unk_61
    149  80dc		       a2 00		      LDX	#0
    150  80de		       a9 d2		      LDA	#$D2
    151  80e0		       20 91 8e 	      JSR	osbyte_with_y0
    152  80e3		       a2 60		      LDX	#$60	; '`'
    153  80e5		       86 31		      STX	unk_31
    154  80e7		       a2 00		      LDX	#0
    155  80e9		       86 3c		      STX	is_insert_mode	; 0=overtype 1=insert
    156  80eb		       86 62		      STX	byte_62
    157  80ed		       e8		      INX
    158  80ee		       86 3d		      STX	scroll_status	; 1=scroll, 0=noscroll
    159  80f0		       a9 e4		      LDA	#$E4
    160  80f2		       20 91 8e 	      JSR	osbyte_with_y0
    161  80f5		       20 91 90 	      JSR	clear_5B1_to_600
    162  80f8		       a9 87		      LDA	#$87	; get MODE in Y	(and char under	cursor in X)
    163  80fa		       20 f4 ff 	      JSR	OSBYTE
    164  80fd		       20 af 81 	      JSR	validate_mode
    165  8100		       a9 04		      LDA	#4
    166  8102		       85 0a		      STA	background_colour
    167  8104		       a9 07		      LDA	#7
    168  8106		       85 0b		      STA	foreground_colour
    169  8108		       a9 16		      LDA	#$16	; MODE
    170  810a		       20 ee ff 	      JSR	OSWRCH
    171  810d		       a9 07		      LDA	#7	; MODE 7
    172  810f		       20 ee ff 	      JSR	OSWRCH
    173  8112		       20 14 83 	      JSR	sub_8314
    174  8115		       20 1f 83 	      JSR	find_program
    175  8118		       90 06		      BCC	language_start_good_program
    176  811a		       20 f8 82 	      JSR	clear_program
    177  811d		       20 91 90 	      JSR	clear_5B1_to_600
    178  8120
    179  8120				   language_start_good_program
    180  8120
    181  8120		       a2 ff		      LDX	#$FF
    182  8122		       9a		      TXS
    183  8123		       20 bf 83 	      JSR	initialise
    184  8126		       20 1f 83 	      JSR	find_program
    185  8129		       b0 1c		      BCS	loc_8147
    186  812b		       20 e9 9f 	      JSR	is_program_empty	; sets	C if no	program
    187  812e		       b0 17		      BCS	loc_8147
    188  8130		       a5 4a		      LDA	current_line_no_lsb
    189  8132		       85 2b		      STA	byte_2B
    190  8134		       a5 4b		      LDA	current_line_no_msb
    191  8136		       85 2c		      STA	byte_2C
    192  8138		       20 8f 9e 	      JSR	find_line_by_number	; finds a line, given a line number
    193  813b							;
    194  813b							; Entry:
    195  813b							; byte_2B: line	number MSB
    196  813b							; byte_2C: line	number LSB
    197  813b							;
    198  813b							; Exit:
    199  813b							; (byte_2B) points to most suitable line
    200  813b		       a0 01		      LDY	#1
    201  813d		       b1 2b		      LDA	($2B),Y
    202  813f		       10 03		      BPL	loc_8144
    203  8141		       20 77 aa 	      JSR	sub_AA77	; swap byte_2B with unk_2F, swap byte_2C with unk_30
    204  8144
    205  8144				   loc_8144
    206  8144		       20 39 a0 	      JSR	save_line_number	; saves line number from program.
    207  8147							;
    208  8147							; Entry:
    209  8147							; (byte_2b) points to current line
    210  8147							;
    211  8147							; Exit:
    212  8147							; current_line_no_lsb, current_line_no_msb = the line number
    213  8147
    214  8147				   loc_8147
    215  8147
    216  8147		       20 e0 81 	      JSR	print_command_screen
    217  814a		       20 99 8b 	      JSR	do_command_line
    218  814d
    219  814d				   loc_814D
    220  814d
    221  814d		       ad b7 06 	      LDA	editor_mode_id	; 1=command mode, 2=edit mode
    222  8150		       c9 02		      CMP	#2	; edit mode?
    223  8152		       d0 cc		      BNE	language_start_good_program	; branch taken if not edit mode
    224  8154							; edit mode
    225  8154		       a5 15		      LDA	byte_15
    226  8156		       f0 0b		      BEQ	loc_8163
    227  8158		       a5 4a		      LDA	current_line_no_lsb
    228  815a		       85 50		      STA	byte_50
    229  815c		       a5 4b		      LDA	current_line_no_msb
    230  815e		       85 51		      STA	byte_51
    231  8160		       4c 20 81 	      JMP	language_start_good_program
    232  8163
    233  8163				   loc_8163
    234  8163		       ad c1 06 	      LDA	byte_6C1
    235  8166		       c9 ff		      CMP	#-1
    236  8168		       f0 b6		      BEQ	language_start_good_program
    237  816a		       85 3a		      STA	byte_3A
    238  816c		       ad c0 06 	      LDA	byte_6C0
    239  816f		       85 39		      STA	byte_39
    240  8171		       a0 01		      LDY	#1
    241  8173		       b1 39		      LDA	($39),Y
    242  8175		       85 50		      STA	byte_50
    243  8177		       c8		      INY
    244  8178		       b1 39		      LDA	($39),Y
    245  817a		       85 51		      STA	byte_51
    246  817c		       4c 20 81 	      JMP	language_start_good_program
    247  817f							; End of function language_entry
    248  817f
    249  817f
    250  817f
    251  817f
    252  817f				   init_brkv_and_oshwm
    253  817f
    254  817f		       58		      CLI
    255  8180		       d8		      CLD
    256  8181		       a9 53		      LDA	#$53	; 'S'
    257  8183		       8d 02 02 	      STA	$202	; BRKV+0
    258  8186		       a9 84		      LDA	#$84
    259  8188		       8d 03 02 	      STA	$203	; BRKV+1
    260  818b		       a9 00		      LDA	#0
    261  818d		       85 17		      STA	oshwm
    262  818f		       8d ad 06 	      STA	unk_6AD
    263  8192		       a9 83		      LDA	#$83
    264  8194		       20 f4 ff 	      JSR	OSBYTE	; Read OSHWM
    265  8197		       84 18		      STY	oshwm+1	; $18 =	MSB
    266  8199		       a9 82		      LDA	#$82
    267  819b		       20 f4 ff 	      JSR	OSBYTE	; Read machine higher order address
    268  819e		       8e b4 06 	      STX	higher_order_address
    269  81a1		       8c b5 06 	      STY	higher_order_address+1
    270  81a4		       a9 00		      LDA	#0
    271  81a6		       8d b8 06 	      STA	unk_6B8
    272  81a9		       a9 0a		      LDA	#$A
    273  81ab		       8d b9 06 	      STA	unk_6B9
    274  81ae		       60		      RTS
    275  81af							; End of function init_brkv_and_oshwm
    276  81af
    277  81af
    278  81af
    279  81af
    280  81af				   validate_mode
    281  81af
    282  81af		       c0 02		      CPY	#2
    283  81b1		       f0 08		      BEQ	invalid_mode	; MODE 2?
    284  81b3		       c0 05		      CPY	#5
    285  81b5		       f0 04		      BEQ	invalid_mode	; MODE 5?
    286  81b7		       c0 08		      CPY	#8
    287  81b9		       90 02		      BCC	loc_81BD	; MODE >=8?
    288  81bb
    289  81bb				   invalid_mode
    290  81bb
    291  81bb		       a0 07		      LDY	#7	; force	mode 7
    292  81bd
    293  81bd				   loc_81BD
    294  81bd		       84 14		      STY	screen_mode
    295  81bf		       a6 14		      LDX	screen_mode
    296  81c1
    297  81c1				   get_HIMEM_for_mode_X
    298  81c1		       ac b4 06 	      LDY	higher_order_address
    299  81c4		       c8		      INY
    300  81c5		       d0 06		      BNE	is_tube
    301  81c7		       ac b5 06 	      LDY	higher_order_address+1
    302  81ca		       c8		      INY
    303  81cb		       f0 09		      BEQ	is_not_tube
    304  81cd
    305  81cd				   is_tube
    306  81cd		       a9 00		      LDA	#0
    307  81cf		       85 06		      STA	HIMEM
    308  81d1		       a9 80		      LDA	#$80	; '€'
    309  81d3		       85 07		      STA	HIMEM+1
    310  81d5		       60		      RTS
    311  81d6
    312  81d6				   is_not_tube
    313  81d6		       a9 85		      LDA	#133
    314  81d8		       20 f4 ff 	      JSR	OSBYTE
    315  81db		       86 06		      STX	HIMEM
    316  81dd		       84 07		      STY	HIMEM+1
    317  81df		       60		      RTS
    318  81e0							; End of function validate_mode
    319  81e0
    320  81e0
    321  81e0
    322  81e0
    323  81e0				   print_command_screen
    324  81e0		       20 ab 9b 	      JSR	make_cursor_invisible
    325  81e3		       20 f1 82 	      JSR	get_text_window_left_bottom
    326  81e6		       86 25		      STX	byte_25
    327  81e8		       84 26		      STY	byte_26
    328  81ea		       a2 0a		      LDX	#$A
    329  81ec		       20 f4 ff 	      JSR	OSBYTE
    330  81ef		       86 27		      STX	byte_27
    331  81f1		       84 28		      STY	byte_28
    332  81f3		       a9 86		      LDA	#$86
    333  81f5		       20 f4 ff 	      JSR	OSBYTE
    334  81f8		       98		      TYA
    335  81f9		       48		      PHA
    336  81fa		       a9 1a		      LDA	#$1A
    337  81fc		       20 ee ff 	      JSR	OSWRCH
    338  81ff		       20 f1 82 	      JSR	get_text_window_left_bottom
    339  8202		       c4 26		      CPY	byte_26
    340  8204		       d0 12		      BNE	loc_8218
    341  8206		       a9 00		      LDA	#0
    342  8208		       c5 25		      CMP	byte_25
    343  820a		       d0 0c		      BNE	loc_8218
    344  820c		       a9 27		      LDA	#39
    345  820e		       c5 27		      CMP	byte_27
    346  8210		       d0 06		      BNE	loc_8218
    347  8212		       a9 07		      LDA	#7
    348  8214		       c5 28		      CMP	byte_28
    349  8216		       f0 23		      BEQ	loc_823B
    350  8218
    351  8218				   loc_8218
    352  8218
    353  8218		       a9 00		      LDA	#0
    354  821a		       85 25		      STA	byte_25	; text window left
    355  821c		       a9 27		      LDA	#39
    356  821e		       85 27		      STA	byte_27	; text window right
    357  8220		       a9 07		      LDA	#7
    358  8222		       85 28		      STA	byte_28	; text window top
    359  8224		       a9 13		      LDA	#$13	; wait for vsync
    360  8226		       20 f4 ff 	      JSR	OSBYTE
    361  8229							; print "The BASIC Editor", "Program size" (etc.)
    362  8229		       a2 69		      LDX	#$69	; #<mode_7_string
    363  822b		       a0 89		      LDY	#$89	; #>mode_7_string
    364  822d		       a9 45		      LDA	#$45
    365  822f		       20 0e 8f 	      JSR	print_n_chars
    366  8232		       20 f1 82 	      JSR	get_text_window_left_bottom
    367  8235		       84 26		      STY	byte_26
    368  8237		       68		      PLA
    369  8238		       a9 00		      LDA	#0
    370  823a		       48		      PHA
    371  823b
    372  823b				   loc_823B
    373  823b		       a9 1a		      LDA	#26	; restore default text window
    374  823d		       20 ee ff 	      JSR	OSWRCH
    375  8240							; print program size
    376  8240		       a2 0f		      LDX	#15
    377  8242		       a0 03		      LDY	#3
    378  8244		       20 01 8f 	      JSR	gotoxy
    379  8247		       a5 16		      LDA	unk_16
    380  8249		       d0 0e		      BNE	loc_8259
    381  824b		       a6 12		      LDX	TOP
    382  824d		       38		      SEC
    383  824e		       a5 13		      LDA	TOP+1
    384  8250		       e5 18		      SBC	oshwm+1
    385  8252		       a8		      TAY
    386  8253		       20 b6 8d 	      JSR	itoa	; Gets string representation of	16-bit number.
    387  8256							;
    388  8256							; Entry:
    389  8256							; Y,X =	value
    390  8256							;
    391  8256							; Exit:
    392  8256							; unk_0	holds digit count
    393  8256							; unk_1... filled with string
    394  8256		       20 97 8e 	      JSR	print_number	; print	number.
    395  8259							;
    396  8259							; Suitable for use with	the result of itoa.
    397  8259							;
    398  8259							; Entry:
    399  8259							; unk_0	= digit	count
    400  8259							; unk_1... = digits
    401  8259
    402  8259				   loc_8259
    403  8259		       20 e8 82 	      JSR	print_5_spaces
    404  825c							; print bytes free
    405  825c		       a2 0f		      LDX	#$F
    406  825e		       a0 04		      LDY	#4
    407  8260		       20 01 8f 	      JSR	gotoxy
    408  8263		       a5 16		      LDA	unk_16
    409  8265		       d0 11		      BNE	loc_8278
    410  8267		       38		      SEC
    411  8268		       a5 06		      LDA	HIMEM
    412  826a		       e5 12		      SBC	TOP
    413  826c		       aa		      TAX
    414  826d		       a5 07		      LDA	HIMEM+1
    415  826f		       e5 13		      SBC	TOP+1
    416  8271		       a8		      TAY
    417  8272		       20 b6 8d 	      JSR	itoa	; Gets string representation of	16-bit number.
    418  8275							;
    419  8275							; Entry:
    420  8275							; Y,X =	value
    421  8275							;
    422  8275							; Exit:
    423  8275							; unk_0	holds digit count
    424  8275							; unk_1... filled with string
    425  8275		       20 97 8e 	      JSR	print_number	; print	number.
    426  8278							;
    427  8278							; Suitable for use with	the result of itoa.
    428  8278							;
    429  8278							; Entry:
    430  8278							; unk_0	= digit	count
    431  8278							; unk_1... = digits
    432  8278
    433  8278				   loc_8278
    434  8278		       20 e8 82 	      JSR	print_5_spaces
    435  827b							; print screen mode
    436  827b		       a2 0f		      LDX	#$F
    437  827d		       a0 05		      LDY	#5
    438  827f		       20 01 8f 	      JSR	gotoxy
    439  8282		       a6 14		      LDX	screen_mode
    440  8284		       a0 00		      LDY	#0
    441  8286		       20 b6 8d 	      JSR	itoa	; Gets string representation of	16-bit number.
    442  8289							;
    443  8289							; Entry:
    444  8289							; Y,X =	value
    445  8289							;
    446  8289							; Exit:
    447  8289							; unk_0	holds digit count
    448  8289							; unk_1... filled with string
    449  8289		       20 97 8e 	      JSR	print_number	; print	number.
    450  828c							;
    451  828c							; Suitable for use with	the result of itoa.
    452  828c							;
    453  828c							; Entry:
    454  828c							; unk_0	= digit	count
    455  828c							; unk_1... = digits
    456  828c		       20 e8 82 	      JSR	print_5_spaces
    457  828f							; set screen window
    458  828f		       a9 1c		      LDA	#28
    459  8291		       85 24		      STA	byte_24
    460  8293		       a2 24		      LDX	#$24	; '$'
    461  8295		       a0 00		      LDY	#0
    462  8297		       a9 05		      LDA	#5
    463  8299		       20 0e 8f 	      JSR	print_n_chars
    464  829c		       68		      PLA
    465  829d		       a8		      TAY
    466  829e		       a2 00		      LDX	#0
    467  82a0		       20 01 8f 	      JSR	gotoxy
    468  82a3		       a5 15		      LDA	byte_15
    469  82a5		       f0 24		      BEQ	loc_82CB
    470  82a7		       20 e7 ff 	      JSR	OSNEWL
    471  82aa		       a2 4f		      LDX	#$4F	; 'O'
    472  82ac		       a0 28		      LDY	#$28	; '('
    473  82ae
    474  82ae				   loc_82AE
    475  82ae		       b9 d7 05 	      LDA	$5D7,Y
    476  82b1		       c9 20		      CMP	#$20	; ' '
    477  82b3		       d0 05		      BNE	loc_82BA
    478  82b5		       88		      DEY
    479  82b6		       d0 f6		      BNE	loc_82AE
    480  82b8		       a2 27		      LDX	#$27	; '''
    481  82ba
    482  82ba				   loc_82BA
    483  82ba		       8a		      TXA
    484  82bb		       a2 b1		      LDX	#$B1
    485  82bd		       a0 05		      LDY	#5
    486  82bf		       20 0e 8f 	      JSR	print_n_chars
    487  82c2		       20 e7 ff 	      JSR	OSNEWL
    488  82c5		       20 e7 ff 	      JSR	OSNEWL
    489  82c8		       20 69 9f 	      JSR	beep
    490  82cb
    491  82cb				   loc_82CB
    492  82cb		       a9 3e		      LDA	#'>
    493  82cd		       20 ee ff 	      JSR	OSWRCH
    494  82d0		       a5 3c		      LDA	is_insert_mode	; 0=overtype 1=insert
    495  82d2		       48		      PHA
    496  82d3		       a5 31		      LDA	unk_31
    497  82d5		       48		      PHA
    498  82d6		       a9 00		      LDA	#0
    499  82d8		       85 3c		      STA	is_insert_mode	; 0=overtype 1=insert
    500  82da		       a9 60		      LDA	#$60	; '`'
    501  82dc		       85 31		      STA	unk_31
    502  82de		       20 c6 9b 	      JSR	reset_cursor_shape
    503  82e1		       68		      PLA
    504  82e2		       85 31		      STA	unk_31
    505  82e4		       68		      PLA
    506  82e5		       85 3c		      STA	is_insert_mode	; 0=overtype 1=insert
    507  82e7		       60		      RTS
    508  82e8							; End of function print_command_screen
    509  82e8
    510  82e8
    511  82e8
    512  82e8
    513  82e8				   print_5_spaces
    514  82e8
    515  82e8		       a2 bb		      LDX	#$BB	; #<six_spaces_string
    516  82ea		       a0 89		      LDY	#$89	; #>six_spaces_string
    517  82ec		       a9 05		      LDA	#5
    518  82ee		       4c 0e 8f 	      JMP	print_n_chars
    519  82f1							; End of function print_5_spaces
    520  82f1
    521  82f1
    522  82f1
    523  82f1
    524  82f1				   get_text_window_left_bottom
    525  82f1
    526  82f1		       a2 08		      LDX	#8
    527  82f3		       a9 a0		      LDA	#$A0
    528  82f5		       4c f4 ff 	      JMP	OSBYTE
    529  82f8							; End of function get_text_window_left_bottom
    530  82f8
    531  82f8
    532  82f8
    533  82f8
    534  82f8				   clear_program
    535  82f8
    536  82f8		       a0 00		      LDY	#0
    537  82fa		       a9 0d		      LDA	#$D
    538  82fc		       91 17		      STA	($17),Y
    539  82fe		       c8		      INY
    540  82ff		       a9 ff		      LDA	#-1
    541  8301		       91 17		      STA	($17),Y
    542  8303		       20 1f 83 	      JSR	find_program
    543  8306		       a9 00		      LDA	#0
    544  8308		       85 4a		      STA	current_line_no_lsb
    545  830a		       a9 0a		      LDA	#$A
    546  830c		       85 4b		      STA	current_line_no_msb
    547  830e		       20 58 b3 	      JSR	sub_B358
    548  8311		       4c e4 a1 	      JMP	clear_line_commands
    549  8314							; End of function clear_program
    550  8314
    551  8314
    552  8314
    553  8314
    554  8314				   sub_8314
    555  8314
    556  8314		       a9 00		      LDA	#0
    557  8316		       85 4a		      STA	current_line_no_lsb
    558  8318		       85 4b		      STA	current_line_no_msb
    559  831a		       85 50		      STA	byte_50
    560  831c		       85 51		      STA	byte_51
    561  831e		       60		      RTS
    562  831f							; End of function sub_8314
    563  831f
    564  831f
    565  831f
    566  831f
    567  831f				   find_program
    568  831f
    569  831f		       a9 00		      LDA	#0
    570  8321		       85 16		      STA	unk_16
    571  8323		       85 38		      STA	byte_38
    572  8325		       85 0c		      STA	byte_C
    573  8327		       85 0d		      STA	byte_D
    574  8329		       48		      PHA
    575  832a		       a9 ff		      LDA	#$FF
    576  832c		       48		      PHA
    577  832d		       48		      PHA
    578  832e		       a5 18		      LDA	oshwm+1
    579  8330		       85 39		      STA	byte_39
    580  8332
    581  8332				   find_program_scan_line
    582  8332		       a0 00		      LDY	#0
    583  8334		       b1 38		      LDA	(byte_38),Y	; get first char in line
    584  8336		       c9 0d		      CMP	#$D	; is it	the required 13?
    585  8338		       f0 0c		      BEQ	line_start_ok
    586  833a
    587  833a				   bad_program
    588  833a		       68		      PLA
    589  833b		       68		      PLA
    590  833c		       68		      PLA
    591  833d		       e6 16		      INC	unk_16
    592  833f		       a9 01		      LDA	#1
    593  8341		       20 a7 90 	      JSR	get_error	; A = error code
    594  8344		       38		      SEC		; bad program
    595  8345		       60		      RTS
    596  8346
    597  8346				   line_start_ok
    598  8346		       c8		      INY
    599  8347		       b1 38		      LDA	(byte_38),Y	; line MSB
    600  8349		       10 2d		      BPL	scan_valid_line	; if +ve, not end
    601  834b							; reached end, so set TOP to just past the terminating $FF
    602  834b		       18		      CLC
    603  834c		       a5 38		      LDA	byte_38
    604  834e		       69 02		      ADC	#2
    605  8350		       85 12		      STA	TOP
    606  8352		       a9 00		      LDA	#0
    607  8354		       65 39		      ADC	byte_39
    608  8356							; gone past the relevant HIMEM?
    609  8356		       85 13		      STA	TOP+1
    610  8358		       c5 07		      CMP	HIMEM+1
    611  835a		       90 12		      BCC	TOP_in_bounds
    612  835c		       d0 06		      BNE	force_mode_7
    613  835e		       a5 06		      LDA	HIMEM
    614  8360		       c5 12		      CMP	TOP
    615  8362		       b0 0a		      BCS	TOP_in_bounds
    616  8364
    617  8364				   force_mode_7
    618  8364		       a0 07		      LDY	#7
    619  8366		       20 af 81 	      JSR	validate_mode
    620  8369		       a9 03		      LDA	#3
    621  836b		       20 a7 90 	      JSR	get_error	; A = error code
    622  836e
    623  836e				   TOP_in_bounds
    624  836e
    625  836e		       68		      PLA
    626  836f		       68		      PLA
    627  8370		       68		      PLA
    628  8371		       f0 03		      BEQ	find_program_good_program
    629  8373		       20 95 84 	      JSR	sub_8495
    630  8376
    631  8376				   find_program_good_program
    632  8376		       18		      CLC
    633  8377		       60		      RTS
    634  8378							; (seems to be maintaining its own notion of line numbering - not sure what for - it never does anything particular if it encounters a discrepancy)
    635  8378
    636  8378				   scan_valid_line
    637  8378		       a5 0c		      LDA	byte_C
    638  837a		       30 0b		      BMI	loc_8387
    639  837c		       18		      CLC
    640  837d		       a5 0d		      LDA	byte_D
    641  837f		       69 0a		      ADC	#10
    642  8381		       85 0d		      STA	byte_D
    643  8383		       90 02		      BCC	loc_8387
    644  8385		       e6 0c		      INC	byte_C
    645  8387
    646  8387				   loc_8387
    647  8387
    648  8387		       68		      PLA
    649  8388		       30 16		      BMI	loc_83A0
    650  838a		       d1 38		      CMP	(byte_38),Y
    651  838c		       f0 04		      BEQ	loc_8392
    652  838e		       90 10		      BCC	loc_83A0
    653  8390		       b0 08		      BCS	loc_839A
    654  8392
    655  8392				   loc_8392
    656  8392		       c8		      INY
    657  8393		       68		      PLA
    658  8394		       d1 38		      CMP	(byte_38),Y
    659  8396		       b0 03		      BCS	loc_839B
    660  8398		       90 07		      BCC	loc_83A1
    661  839a
    662  839a				   loc_839A
    663  839a		       68		      PLA
    664  839b
    665  839b				   loc_839B
    666  839b		       68		      PLA
    667  839c		       a9 01		      LDA	#1
    668  839e		       48		      PHA
    669  839f		       48		      PHA
    670  83a0
    671  83a0				   loc_83A0
    672  83a0
    673  83a0		       68		      PLA
    674  83a1
    675  83a1				   loc_83A1
    676  83a1		       a0 02		      LDY	#2
    677  83a3
    678  83a3				   loc_83A3
    679  83a3		       b1 38		      LDA	(byte_38),Y
    680  83a5		       48		      PHA
    681  83a6		       88		      DEY
    682  83a7		       d0 fa		      BNE	loc_83A3
    683  83a9		       a0 03		      LDY	#3
    684  83ab		       b1 38		      LDA	(byte_38),Y	; get line length
    685  83ad		       30 04		      BMI	next_line	; if >=128, it's fine
    686  83af		       c9 04		      CMP	#4
    687  83b1		       90 87		      BCC	bad_program	; if <4, bad program
    688  83b3
    689  83b3				   next_line
    690  83b3		       18		      CLC
    691  83b4		       65 38		      ADC	byte_38
    692  83b6		       85 38		      STA	byte_38
    693  83b8		       90 02		      BCC	scan_next_line
    694  83ba		       e6 39		      INC	byte_39
    695  83bc
    696  83bc				   scan_next_line
    697  83bc		       4c 32 83 	      JMP	find_program_scan_line
    698  83bf							; End of function find_program
    699  83bf
    700  83bf
    701  83bf
    702  83bf
    703  83bf				   initialise
    704  83bf		       20 7f 81 	      JSR	init_brkv_and_oshwm
    705  83c2		       a4 14		      LDY	screen_mode
    706  83c4		       20 af 81 	      JSR	validate_mode
    707  83c7		       a2 00		      LDX	#0	; default output streams
    708  83c9		       a9 03		      LDA	#3	; select output	streams	(AUG p119)
    709  83cb		       20 91 8e 	      JSR	osbyte_with_y0
    710  83ce		       a2 00		      LDX	#0	; keyboard on, rs423 off
    711  83d0		       a9 02		      LDA	#2	; select input stream (AUG p118)
    712  83d2		       20 f4 ff 	      JSR	OSBYTE
    713  83d5		       a2 00		      LDX	#0	; enable cursor	editing
    714  83d7		       a9 04		      LDA	#4	; enable/disable cursor	editing	(AUG p120)
    715  83d9		       20 f4 ff 	      JSR	OSBYTE
    716  83dc		       a9 0d		      LDA	#13	; Disable events (AUG p129)
    717  83de		       a2 09		      LDX	#9
    718  83e0		       86 3a		      STX	byte_3A
    719  83e2
    720  83e2				   disable_all_events_loop
    721  83e2		       a6 3a		      LDX	byte_3A
    722  83e4		       20 91 8e 	      JSR	osbyte_with_y0
    723  83e7							; X=0 now
    724  83e7		       c6 3a		      DEC	byte_3A
    725  83e9		       10 f7		      BPL	disable_all_events_loop
    726  83eb		       a9 c8		      LDA	#200	; set ESCAPE, BREAK effect (AUG	p205)
    727  83ed		       a0 fe		      LDY	#%11111110	; normal ESCAPE	action (bit 0 reset)
    728  83ef		       20 f4 ff 	      JSR	OSBYTE
    729  83f2		       a2 00		      LDX	#0	; TAB key produces CHR$0
    730  83f4		       a9 db		      LDA	#219	; read/write TAB key char (AUG p222)
    731  83f6		       20 91 8e 	      JSR	osbyte_with_y0
    732  83f9		       a2 1b		      LDX	#27	; ESCAPE key produces CHR$27
    733  83fb		       a9 dc		      LDA	#220	; read/write Escape char (AUG p223)
    734  83fd		       20 91 8e 	      JSR	osbyte_with_y0
    735  8400		       a2 00		      LDX	#0	; ignore key
    736  8402		       a9 e1		      LDA	#225	; read/write function key status (AUG p225)
    737  8404		       20 91 8e 	      JSR	osbyte_with_y0
    738  8407		       a2 00		      LDX	#0	; ignore key
    739  8409		       a9 e2		      LDA	#226	; read/write SHIFT+function key	status (AUG p225)
    740  840b		       20 91 8e 	      JSR	osbyte_with_y0
    741  840e		       a2 00		      LDX	#0	; ignore key
    742  8410		       a9 e3		      LDA	#227	; read/write CTRL+function key status (AUG p225)
    743  8412		       20 91 8e 	      JSR	osbyte_with_y0
    744  8415		       a2 00		      LDX	#0	; ESCAPE has normal action
    745  8417		       a9 e5		      LDA	#229	; read/write status of ESCAPE key (AUG p227)
    746  8419		       20 91 8e 	      JSR	osbyte_with_y0
    747  841c		       a2 00		      LDX	#0	; ESCAPE has normal effects
    748  841e		       a9 e6		      LDA	#230	; read/write flags determining ESCAPE effects (AUG p228)
    749  8420		       20 91 8e 	      JSR	osbyte_with_y0
    750  8423		       a9 03		      LDA	#3	; printer off
    751  8425		       20 ee ff 	      JSR	OSWRCH
    752  8428		       0a		      ASL		; VDU6 - enable	VDU drivers
    753  8429		       20 ee ff 	      JSR	OSWRCH
    754  842c		       a9 01		      LDA	#1
    755  842e		       8d b7 06 	      STA	editor_mode_id	; 1=command mode, 2=edit mode
    756  8431		       a9 00		      LDA	#0
    757  8433		       8d b3 06 	      STA	byte_6B3
    758  8436		       60		      RTS
    759  8437							; End of function initialise
    760  8437
    761  8437
    762  8437				   loc_8437
    763  8437		       a2 02		      LDX	#2
    764  8439		       a9 04		      LDA	#4
    765  843b		       20 f4 ff 	      JSR	OSBYTE
    766  843e							; Set function keys to produce ASCII $A0...$A9
    767  843e		       a2 a0		      LDX	#$A0
    768  8440		       a9 e1		      LDA	#225
    769  8442		       20 91 8e 	      JSR	osbyte_with_y0
    770  8445							; Set SHIFT+function keys to produce ASCII $B0...$B9
    771  8445		       a2 b0		      LDX	#$B0
    772  8447		       a9 e2		      LDA	#226
    773  8449		       20 91 8e 	      JSR	osbyte_with_y0
    774  844c							; Set Ctrl+function keys to produce ASCII $C0...$C9
    775  844c		       a2 c0		      LDX	#$C0	; 'À'
    776  844e		       a9 e3		      LDA	#227
    777  8450		       4c 91 8e 	      JMP	osbyte_with_y0
    778  8453		       20 91 90 	      JSR	clear_5B1_to_600
    779  8456		       ac b4 06 	      LDY	higher_order_address
    780  8459		       c8		      INY
    781  845a		       d0 10		      BNE	loc_846C
    782  845c		       ac b5 06 	      LDY	higher_order_address+1
    783  845f		       c8		      INY
    784  8460		       d0 0a		      BNE	loc_846C
    785  8462		       a5 fe		      LDA	unk_FE
    786  8464		       c9 01		      CMP	#1
    787  8466		       f0 04		      BEQ	loc_846C
    788  8468		       c9 c0		      CMP	#$C0
    789  846a		       90 1e		      BCC	loc_848A
    790  846c
    791  846c				   loc_846C
    792  846c		       78		      SEI
    793  846d		       e6 fd		      INC	unk_FD
    794  846f		       d0 02		      BNE	loc_8473
    795  8471		       e6 fe		      INC	unk_FE
    796  8473
    797  8473				   loc_8473
    798  8473		       a0 00		      LDY	#0
    799  8475
    800  8475				   loc_8475
    801  8475		       b1 fd		      LDA	($FD),Y
    802  8477		       c9 20		      CMP	#$20	; ' '
    803  8479		       90 08		      BCC	loc_8483
    804  847b		       99 b1 05 	      STA	$5B1,Y
    805  847e		       c8		      INY
    806  847f		       c0 4f		      CPY	#$4F	; 'O'
    807  8481		       90 f2		      BCC	loc_8475
    808  8483
    809  8483				   loc_8483
    810  8483		       58		      CLI
    811  8484		       a9 ff		      LDA	#-1
    812  8486		       85 15		      STA	byte_15
    813  8488		       d0 05		      BNE	loc_848F
    814  848a
    815  848a				   loc_848A
    816  848a		       a9 02		      LDA	#2
    817  848c		       20 a7 90 	      JSR	get_error	; A = error code
    818  848f
    819  848f				   loc_848F
    820  848f		       4c 4d 81 	      JMP	loc_814D
    821  8492
    822  8492
    823  8492
    824  8492				   sub_8492
    825  8492		       20 1f 83 	      JSR	find_program
    826  8495							; End of function sub_8492
    827  8495
    828  8495
    829  8495
    830  8495
    831  8495				   sub_8495
    832  8495		       ad b7 06 	      LDA	editor_mode_id	; 1=command mode, 2=edit mode
    833  8498		       c9 02		      CMP	#2
    834  849a		       d0 03		      BNE	loc_849F
    835  849c		       20 ab 9b 	      JSR	make_cursor_invisible
    836  849f
    837  849f				   loc_849F
    838  849f		       a2 0a		      LDX	#10
    839  84a1		       a5 0c		      LDA	byte_C
    840  84a3		       10 02		      BPL	loc_84A7
    841  84a5		       a2 03		      LDX	#3
    842  84a7
    843  84a7				   loc_84A7
    844  84a7		       86 3a		      STX	byte_3A
    845  84a9		       a5 17		      LDA	oshwm
    846  84ab		       85 33		      STA	unk_33
    847  84ad		       85 27		      STA	byte_27
    848  84af		       a5 18		      LDA	oshwm+1
    849  84b1		       85 28		      STA	byte_28
    850  84b3
    851  84b3				   loc_84B3
    852  84b3		       a0 01		      LDY	#1
    853  84b5		       b1 27		      LDA	(byte_27),Y
    854  84b7		       10 03		      BPL	loc_84BC
    855  84b9		       4c 4f 85 	      JMP	loc_854F
    856  84bc
    857  84bc				   loc_84BC
    858  84bc		       a0 03		      LDY	#3
    859  84be		       b1 27		      LDA	(byte_27),Y
    860  84c0		       85 37		      STA	unk_37
    861  84c2		       a9 00		      LDA	#0
    862  84c4		       85 38		      STA	byte_38
    863  84c6		       c8		      INY
    864  84c7		       84 34		      STY	unk_34
    865  84c9
    866  84c9				   loc_84C9
    867  84c9		       a4 34		      LDY	unk_34
    868  84cb		       18		      CLC
    869  84cc		       98		      TYA
    870  84cd		       69 03		      ADC	#3
    871  84cf		       b0 04		      BCS	loc_84D5
    872  84d1		       c5 37		      CMP	unk_37
    873  84d3		       90 03		      BCC	loc_84D8
    874  84d5
    875  84d5				   loc_84D5
    876  84d5		       4c 3f 85 	      JMP	loc_853F
    877  84d8
    878  84d8				   loc_84D8
    879  84d8		       a5 38		      LDA	byte_38
    880  84da		       f0 03		      BEQ	loc_84DF
    881  84dc
    882  84dc				   loc_84DC
    883  84dc		       4c 2e 85 	      JMP	loc_852E
    884  84df
    885  84df				   loc_84DF
    886  84df		       b1 27		      LDA	(byte_27),Y
    887  84e1		       c9 8d		      CMP	#$8D
    888  84e3		       d0 f7		      BNE	loc_84DC
    889  84e5		       20 12 9d 	      JSR	decode_line_number	; decode line number	from program.
    890  84e8							;
    891  84e8							; Entry:
    892  84e8							; (unk_27),Y points to 8D token
    893  84e8							;
    894  84e8							; Exit:
    895  84e8							; unk_21.w is line number.
    896  84e8		       20 ac 85 	      JSR	sub_85AC
    897  84eb
    898  84eb				   loc_84EB
    899  84eb		       a0 01		      LDY	#1
    900  84ed		       b1 25		      LDA	(byte_25),Y
    901  84ef		       10 14		      BPL	loc_8505
    902  84f1		       a2 04		      LDX	#4
    903  84f3		       86 33		      STX	unk_33
    904  84f5		       a4 34		      LDY	unk_34
    905  84f7		       a9 40		      LDA	#$40	; '@'
    906  84f9
    907  84f9				   loc_84F9
    908  84f9		       91 27		      STA	($27),Y
    909  84fb		       c8		      INY
    910  84fc		       ca		      DEX
    911  84fd		       d0 fa		      BNE	loc_84F9
    912  84ff		       88		      DEY
    913  8500
    914  8500				   loc_8500
    915  8500		       84 34		      STY	unk_34
    916  8502		       4c 2e 85 	      JMP	loc_852E
    917  8505
    918  8505				   loc_8505
    919  8505		       c5 21		      CMP	byte_21
    920  8507		       d0 20		      BNE	loc_8529
    921  8509		       c8		      INY
    922  850a		       b1 25		      LDA	($25),Y
    923  850c		       c5 22		      CMP	byte_22
    924  850e		       d0 19		      BNE	loc_8529
    925  8510		       a6 35		      LDX	byte_35
    926  8512		       a4 36		      LDY	byte_36
    927  8514		       20 d8 85 	      JSR	sub_85D8
    928  8517		       86 36		      STX	byte_36
    929  8519		       84 35		      STY	byte_35
    930  851b		       a4 34		      LDY	unk_34
    931  851d		       a2 02		      LDX	#2
    932  851f
    933  851f				   loc_851F
    934  851f		       c8		      INY
    935  8520		       91 27		      STA	($27),Y
    936  8522		       b5 34		      LDA	$34,X
    937  8524		       ca		      DEX
    938  8525		       10 f8		      BPL	loc_851F
    939  8527		       30 d7		      BMI	loc_8500
    940  8529
    941  8529				   loc_8529
    942  8529		       20 bf 85 	      JSR	sub_85BF
    943  852c		       d0 bd		      BNE	loc_84EB
    944  852e
    945  852e				   loc_852E
    946  852e		       b1 27		      LDA	($27),Y
    947  8530		       c9 22		      CMP	#$22	; '"'
    948  8532		       d0 06		      BNE	loc_853A
    949  8534		       a5 38		      LDA	byte_38
    950  8536		       49 01		      EOR	#1
    951  8538		       85 38		      STA	byte_38
    952  853a
    953  853a				   loc_853A
    954  853a		       e6 34		      INC	unk_34
    955  853c		       4c c9 84 	      JMP	loc_84C9
    956  853f
    957  853f				   loc_853F
    958  853f		       a0 03		      LDY	#3
    959  8541		       18		      CLC
    960  8542		       b1 27		      LDA	($27),Y
    961  8544		       65 27		      ADC	byte_27
    962  8546		       85 27		      STA	byte_27
    963  8548		       90 02		      BCC	loc_854C
    964  854a		       e6 28		      INC	byte_28
    965  854c
    966  854c				   loc_854C
    967  854c		       4c b3 84 	      JMP	loc_84B3
    968  854f
    969  854f				   loc_854F
    970  854f		       20 ac 85 	      JSR	sub_85AC
    971  8552
    972  8552				   loc_8552
    973  8552		       a0 01		      LDY	#1
    974  8554		       b1 25		      LDA	($25),Y
    975  8556		       30 32		      BMI	loc_858A
    976  8558		       a2 11		      LDX	#$11
    977  855a
    978  855a				   loc_855A
    979  855a		       a0 02		      LDY	#2
    980  855c		       b5 40		      LDA	$40,X
    981  855e		       d1 25		      CMP	($25),Y
    982  8560		       d0 13		      BNE	loc_8575
    983  8562		       ca		      DEX
    984  8563		       88		      DEY
    985  8564		       b5 40		      LDA	$40,X
    986  8566		       d1 25		      CMP	($25),Y
    987  8568		       d0 0c		      BNE	loc_8576
    988  856a		       a5 35		      LDA	byte_35
    989  856c		       09 80		      ORA	#$80	; '€'
    990  856e		       95 40		      STA	$40,X
    991  8570		       e8		      INX
    992  8571		       a5 36		      LDA	byte_36
    993  8573		       95 40		      STA	$40,X
    994  8575
    995  8575				   loc_8575
    996  8575		       ca		      DEX
    997  8576
    998  8576				   loc_8576
    999  8576		       ca		      DEX
   1000  8577		       ca		      DEX
   1001  8578		       10 e0		      BPL	loc_855A
   1002  857a		       a0 01		      LDY	#1
   1003  857c		       a5 35		      LDA	byte_35
   1004  857e		       91 25		      STA	($25),Y
   1005  8580		       c8		      INY
   1006  8581		       a5 36		      LDA	byte_36
   1007  8583		       91 25		      STA	($25),Y
   1008  8585		       20 bf 85 	      JSR	sub_85BF
   1009  8588		       d0 c8		      BNE	loc_8552
   1010  858a
   1011  858a				   loc_858A
   1012  858a		       a2 10		      LDX	#$10
   1013  858c
   1014  858c				   loc_858C
   1015  858c		       b5 40		      LDA	$40,X
   1016  858e		       29 7f		      AND	#$7F	; ''
   1017  8590		       95 40		      STA	$40,X
   1018  8592		       ca		      DEX
   1019  8593		       ca		      DEX
   1020  8594		       ca		      DEX
   1021  8595		       10 f5		      BPL	loc_858C
   1022  8597		       a5 33		      LDA	unk_33
   1023  8599		       f0 23		      BEQ	locret_85BE
   1024  859b		       a9 07		      LDA	#7
   1025  859d
   1026  859d				   loc_859D
   1027  859d
   1028  859d		       ae ad 06 	      LDX	unk_6AD
   1029  85a0		       f0 04		      BEQ	loc_85A6
   1030  85a2		       8d ad 06 	      STA	unk_6AD
   1031  85a5		       60		      RTS
   1032  85a6
   1033  85a6				   loc_85A6
   1034  85a6		       20 a7 90 	      JSR	get_error	; A = error code
   1035  85a9		       4c 4d 81 	      JMP	loc_814D
   1036  85ac							; End of function sub_8495
   1037  85ac
   1038  85ac
   1039  85ac
   1040  85ac
   1041  85ac				   sub_85AC
   1042  85ac		       a5 17		      LDA	oshwm
   1043  85ae		       85 25		      STA	byte_25
   1044  85b0		       a5 18		      LDA	oshwm+1
   1045  85b2		       85 26		      STA	byte_26
   1046  85b4		       ad b8 06 	      LDA	unk_6B8
   1047  85b7		       85 35		      STA	byte_35
   1048  85b9		       ad b9 06 	      LDA	unk_6B9
   1049  85bc		       85 36		      STA	byte_36
   1050  85be
   1051  85be				   locret_85BE
   1052  85be		       60		      RTS
   1053  85bf							; End of function sub_85AC
   1054  85bf
   1055  85bf
   1056  85bf
   1057  85bf
   1058  85bf				   sub_85BF
   1059  85bf		       a0 03		      LDY	#3
   1060  85c1		       18		      CLC
   1061  85c2		       b1 25		      LDA	($25),Y
   1062  85c4		       65 25		      ADC	byte_25
   1063  85c6		       85 25		      STA	byte_25
   1064  85c8		       90 02		      BCC	loc_85CC
   1065  85ca		       e6 26		      INC	byte_26
   1066  85cc
   1067  85cc				   loc_85CC
   1068  85cc		       18		      CLC
   1069  85cd		       a5 3a		      LDA	byte_3A
   1070  85cf		       65 36		      ADC	byte_36
   1071  85d1		       85 36		      STA	byte_36
   1072  85d3		       90 02		      BCC	locret_85D7
   1073  85d5		       e6 35		      INC	byte_35
   1074  85d7
   1075  85d7				   locret_85D7
   1076  85d7		       60		      RTS
   1077  85d8							; End of function sub_85BF
   1078  85d8
   1079  85d8
   1080  85d8
   1081  85d8
   1082  85d8				   sub_85D8
   1083  85d8		       86 0c		      STX	byte_C
   1084  85da		       84 0d		      STY	byte_D
   1085  85dc		       a2 01		      LDX	#1
   1086  85de		       86 0e		      STX	byte_E
   1087  85e0
   1088  85e0				   loc_85E0
   1089  85e0		       b5 0c		      LDA	$C,X
   1090  85e2		       0a		      ASL
   1091  85e3		       26 0e		      ROL	byte_E
   1092  85e5		       0a		      ASL
   1093  85e6		       26 0e		      ROL	byte_E
   1094  85e8		       38		      SEC
   1095  85e9		       6a		      ROR
   1096  85ea		       4a		      LSR
   1097  85eb		       95 0c		      STA	$C,X
   1098  85ed		       ca		      DEX
   1099  85ee		       10 f0		      BPL	loc_85E0
   1100  85f0		       a5 0e		      LDA	byte_E
   1101  85f2		       0a		      ASL
   1102  85f3		       0a		      ASL
   1103  85f4		       49 14		      EOR	#$14
   1104  85f6		       a6 0d		      LDX	byte_D
   1105  85f8		       a4 0c		      LDY	byte_C
   1106  85fa		       60		      RTS
   1107  85fb							; End of function sub_85D8
   1108  85fb
   1109  85fb		       c2	   error_messages_table dc.b	$C2	; Â
   1110  85fc		       61 64 20 70*aAdProgram dc.b	"ad program"
   1111  8606		       d5		      dc.b	$D5	; Õ
   1112  8607		       6e 6b 6e 6f*aNknownErrorMessage dc.b	"nknown error message"
   1113  861b		       ce		      dc.b	$CE	; Î
   1114  861c		       6f 20 72 6f*aORoomModeReset dc.b	"o room - Mode reset"
   1115  862f		       cc		      dc.b	$CC	; Ì
   1116  8630		       69 6e 65 20*aIneTooLong dc.b	"ine too long"
   1117  863c		       ce		      dc.b	$CE	; Î
   1118  863d		       6f 20 72 6f*aORoom     dc.b	"o room"
   1119  8643		       cd		      dc.b	$CD	; Í
   1120  8644		       69 73 73 69*aIssingLineCommand dc.b	"issing line command"
   1121  8657		       d4		      dc.b	$D4	; Ô
   1122  8658		       61 72 67 65*aArgetNotFound dc.b	"arget not found"
   1123  8667		       d3		      dc.b	$D3	; Ó
   1124  8668		       74 72 69 6e*aTringNotFound dc.b	"tring not found"
   1125  8677		       c9		      dc.b	$C9	; É
   1126  8678		       6e 76 61 6c*aNvalidCommand dc.b	"nvalid command"
   1127  8686		       c9		      dc.b	$C9	; É
   1128  8687		       6e 76 61 6c*aNvalidArgument dc.b	"nvalid argument"
   1129  8696		       c2		      dc.b	$C2	; Â
   1130  8697		       61 64 20 6e*aAdNumber  dc.b	"ad number"
   1131  86a0		       d4		      dc.b	$D4	; Ô
   1132  86a1		       6f 6f 20 6d*aOoManyArguments dc.b	"oo many arguments"
   1133  86b2		       cf		      dc.b	$CF	; Ï
   1134  86b3		       6e 6c 79 20*aNlyModes013467AreValid dc.b	"nly modes 0,1,3,4,6,7 are valid"
   1135  86d2		       ce		      dc.b	$CE	; Î
   1136  86d3		       6f 20 72 6f*aORoomForThisMode dc.b	"o room for this mode"
   1137  86e7		       ce		      dc.b	$CE	; Î
   1138  86e8		       6f 20 72 65*aOReferencesToLabelsWereFound dc.b	"o references to labels were found"
   1139  8709		       d5		      dc.b	$D5	; Õ
   1140  870a		       6e 72 65 73*aNresolvedLabelsPleaseCheck dc.b	"nresolved labels - please check"
   1141  8729		       cc		      dc.b	$CC	; Ì
   1142  872a		       69 6e 65 20*aIneTooLongToBeNumbered dc.b	"ine too long to be numbered"
   1143  8745		       cc		      dc.b	$CC	; Ì
   1144  8746		       69 6e 65 20*aIneTooLongToContainLabel dc.b	"ine too long to contain label"
   1145  8763		       ce		      dc.b	$CE	; Î
   1146  8764		       6f 20 6c 61*aOLabelsReinstated dc.b	"o labels reinstated"
   1147  8777		       cc		      dc.b	$CC	; Ì
   1148  8778		       69 6e 65 73*aInesTooLongToBeJoined dc.b	"ines too long to be joined"
   1149  8792		       cf		      dc.b	$CF	; Ï
   1150  8793		       6e 6c 79 20*aNlyColoursNRGYBMCWAreValid dc.b	"nly colours N,R,G,Y,B,M,C,W are valid"
   1151  87b8		       c9		      dc.b	$C9	; É
   1152  87b9		       6e 76 61 6c*aNvalidLineNumber dc.b	"nvalid line number"
   1153  87cb		       d2		      dc.b	$D2	; Ò
   1154  87cc		       65 70 6c 61*aEplaceStringMissing dc.b	"eplace string missing"
   1155  87e1		       cf		      dc.b	$CF	; Ï
   1156  87e2		       6e 6c 79 20*aNlyTwoStringsAllowed dc.b	"nly two strings allowed"
   1157  87f9		       d3		      dc.b	$D3	; Ó
   1158  87fa		       74 61 72 74*aTartLineIncrementTooBig dc.b	"tart line/Increment too big"
   1159  8815		       d4		      dc.b	$D4	; Ô
   1160  8816		       6f 6f 20 6d*aOoManyLineCommands dc.b	"oo many line commands"
   1161  882b		       c9		      dc.b	$C9	; É
   1162  882c		       6e 63 6f 6d*aNcompatibleLineCommands dc.b	"ncompatible line commands"
   1163  8845		       c9		      dc.b	$C9	; É
   1164  8846		       6e 76 61 6c*aNvalidDeleteCommand dc.b	"nvalid delete command"
   1165  885b		       c9		      dc.b	$C9	; É
   1166  885c		       6e 76 61 6c*aNvalidDestination dc.b	"nvalid destination"
   1167  886e		       c4		      dc.b	$C4	; Ä
   1168  886f		       65 73 74 69*aEstinationMissing dc.b	"estination missing"
   1169  8881		       c9		      dc.b	$C9	; É
   1170  8882		       6e 63 6f 6d*aNcompleteLineCommand dc.b	"ncomplete line command"
   1171  8898		       c1		      dc.b	$C1	; Á
   1172  8899		       72 67 75 6d*aRgumentMissing dc.b	"rgument missing"
   1173  88a8		       d4		      dc.b	$D4	; Ô
   1174  88a9		       61 62 20 73*aAbStopMustBeInRange080 dc.b	"ab stop must be in range 0-80"
   1175  88c6		       ce		      dc.b	$CE	; Î
   1176  88c7		       6f 20 6d 61*aOMarkedLine dc.b	"o marked line"
   1177  88d4		       ce		      dc.b	$CE	; Î
   1178  88d5		       6f 20 73 65*aOSearchStringSetUp dc.b	"o search string set up"
   1179  88eb		       cc		      dc.b	$CC	; Ì
   1180  88ec		       69 6e 65 20*aIneHasBeenTruncated dc.b	"ine has been truncated"
   1181  8902		       d5		      dc.b	$D5	; Õ
   1182  8903		       70 64 61 74*aPdatesWouldMakeLineTooLong dc.b	"pdates would make line too long"
   1183  8922		       c9		      dc.b	$C9	; É
   1184  8923		       6e 63 72 65*aNcrementMustBeInRange1255 dc.b	"ncrement must be in range 1-255"
   1185  8942		       ff		      dc.b	$FF	;
   1186  8943		       20 20 53 65*aSearchString dc.b	"  Search string  : "
   1187  8956		       20 20 52 65*aReplaceString dc.b	"  Replace string : "
   1188  8969		       16	   mode_7_string dc.b	$16	;
   1189  896a		       07		      dc.b	7	;
   1190  896b		       0a		      dc.b	$A	;
   1191  896c		       54 68 65 20*aTheBasicEditor dc.b	"The BASIC Editor",0
   1192  897d		       0d		      dc.b	$D	;
   1193  897e		       0a		      dc.b	$A	;
   1194  897f		       0a		      dc.b	$A	;
   1195  8980		       50		      dc.b	$50	; P
   1196  8981		       72		      dc.b	$72	; r
   1197  8982		       6f		      dc.b	$6F	; o
   1198  8983		       67		      dc.b	$67	; g
   1199  8984		       72		      dc.b	$72	; r
   1200  8985		       61		      dc.b	$61	; a
   1201  8986		       6d		      dc.b	$6D	; m
   1202  8987		       20		      dc.b	$20	;
   1203  8988		       73		      dc.b	$73	; s
   1204  8989		       69		      dc.b	$69	; i
   1205  898a		       7a		      dc.b	$7A	; z
   1206  898b		       65		      dc.b	$65	; e
   1207  898c		       20		      dc.b	$20	;
   1208  898d		       3a		      dc.b	$3A	; :
   1209  898e		       0d		      dc.b	$D	;
   1210  898f		       0a		      dc.b	$A	;
   1211  8990		       42		      dc.b	$42	; B
   1212  8991		       79		      dc.b	$79	; y
   1213  8992		       74		      dc.b	$74	; t
   1214  8993		       65		      dc.b	$65	; e
   1215  8994		       73		      dc.b	$73	; s
   1216  8995		       20		      dc.b	$20	;
   1217  8996		       66		      dc.b	$66	; f
   1218  8997		       72		      dc.b	$72	; r
   1219  8998		       65		      dc.b	$65	; e
   1220  8999		       65		      dc.b	$65	; e
   1221  899a		       20		      dc.b	$20	;
   1222  899b		       20		      dc.b	$20	;
   1223  899c		       20		      dc.b	$20	;
   1224  899d		       3a		      dc.b	$3A	; :
   1225  899e		       0d		      dc.b	$D	;
   1226  899f		       0a		      dc.b	$A	;
   1227  89a0		       53		      dc.b	$53	; S
   1228  89a1		       63		      dc.b	$63	; c
   1229  89a2		       72		      dc.b	$72	; r
   1230  89a3		       65		      dc.b	$65	; e
   1231  89a4		       65		      dc.b	$65	; e
   1232  89a5		       6e		      dc.b	$6E	; n
   1233  89a6		       20		      dc.b	$20	;
   1234  89a7		       6d		      dc.b	$6D	; m
   1235  89a8		       6f		      dc.b	$6F	; o
   1236  89a9		       64		      dc.b	$64	; d
   1237  89aa		       65		      dc.b	$65	; e
   1238  89ab		       20		      dc.b	$20	;
   1239  89ac		       20		      dc.b	$20	;
   1240  89ad		       3a		      dc.b	$3A	; :
   1241  89ae		       1f	   empty_program_string dc.b	$1F	;
   1242  89af		       03		      dc.b	3	;
   1243  89b0		       00		      dc.b	0	;
   1244  89b1		       31		      dc.b	$31	; 1
   1245  89b2		       30		      dc.b	$30	; 0
   1246  89b3		       0d	   nur_dlo_string dc.b	$D
   1247  89b4		       4e		      dc.b	$4E	; N
   1248  89b5		       55		      dc.b	$55	; U
   1249  89b6		       52		      dc.b	$52	; R
   1250  89b7		       0d		      dc.b	$D	;
   1251  89b8		       44		      dc.b	$44	; D
   1252  89b9		       4c		      dc.b	$4C	; L
   1253  89ba		       4f		      dc.b	$4F	; O
   1254  89bb		       20	   six_spaces_string dc.b	$20	;
   1255  89bc		       20		      dc.b	$20	;
   1256  89bd		       20		      dc.b	$20	;
   1257  89be		       20		      dc.b	$20	;
   1258  89bf		       20		      dc.b	$20	;
   1259  89c0		       20		      dc.b	$20	;
   1260  89c1		       07 07 07 07*byte_89C1  dc.b	7, 7, 7, 7, 7, 7, 7, $12
   1261  89c9		       07 07 07 09*byte_89C9  dc.b	7, 7, 7, 9, 7, 7, 9, $13
   1262  89d1		       07 07 07 07*byte_89D1  dc.b	7, 7, 7, 7, 7, 7, 7, $13
   1263  89d9		       4e 52 47 59*colour_chars dc.b	"NRGYBMCW"
   1264  89e1		       c2	   colour_names_table dc.b	$C2
   1265  89e2
   1266  89e2		       6c 61 63 6b aLack      dc.b	"lack"
   1267  89e6		       d2		      dc.b	$D2	; Ò
   1268  89e7		       65 64	   aEd	      dc.b	"ed"
   1269  89e9		       c7		      dc.b	$C7	; Ç
   1270  89ea		       72 65 65 6e aReen      dc.b	"reen"
   1271  89ee		       d9		      dc.b	$D9	; Ù
   1272  89ef		       65 6c 6c 6f*aEllow     dc.b	"ellow"
   1273  89f4		       c2		      dc.b	$C2	; Â
   1274  89f5		       6c 75 65    aLue       dc.b	"lue"
   1275  89f8		       cd		      dc.b	$CD	; Í
   1276  89f9		       61 67 65 6e*aAgenta    dc.b	"agenta"
   1277  89ff		       c3		      dc.b	$C3	; Ã
   1278  8a00		       79 61 6e    aYan       dc.b	"yan"
   1279  8a03		       d7		      dc.b	$D7	; ×
   1280  8a04		       68 69 74 65 aHite      dc.b	"hite"
   1281  8a08		       ff		      dc.b	$FF	;
   1282  8a09		       6e 0d 0a    aNWherePIsAProgramSS1S2AreStri dc.b	"n",$D,$A
   1283  8a0c		       0a		      dc.b	$A
   1284  8a0d		       57 68 65 72*	      dc.b	"Where: p is a program;",$D,$A
   1285  8a25		       20 20 20 20*	      dc.b	"	 s, s1, s2 are strings;",$D,$A
   1286  8a44		       20 20 20 20*	      dc.b	"	 n, n1, n2 are numbers;",$D,$A
   1287  8a63		       20 20 20 20*	      dc.b	"	 c is a colour (N,R,G,Y,B,M,C,W).",$D,$A
   1288  8a8c		       73 31 20 73*aS1S2      dc.b	"s1 s2"
   1289  8a91		       6e 31 20 6e*aN1N2      dc.b	"n1 n2"
   1290  8a96		       49 6e 73 65*aInsertMode dc.b	"Insert mode  "
   1291  8aa3		       4f 76 65 72*aOvertypeMode dc.b	"Overtype mode"
   1292  8ab0		       50 72 6f 67*aProgramName dc.b	"Program name: "
   1293  8abe		       53 63 72 6f*aScrollOn  dc.b	"Scroll on "
   1294  8ac8		       53 63 72 6f*aScrollOff dc.b	"Scroll off"
   1295  8ad2		       46 69 72 73*aFirstLine dc.b	"First line  : "
   1296  8ae0		       4c 61 73 74*aLastLine  dc.b	"Last line  : "
   1297  8aed		       43 75 72 72*aCurrentLine dc.b	"Current line: "
   1298  8afb		       4d 61 72 6b*aMarkedLine dc.b	"Marked line: "
   1299  8b08		       4e 6f 6e 65 aNone      dc.b	"None"
   1300  8b0c		       4e 6f 2e 6f*aNo_ofLines dc.b	"No.of lines: "
   1301  8b19		       50 65 6e 64*aPendingCommands dc.b	"Pending commands: "
   1302  8b2b		       4e 6f 6e 65 aNone_1    dc.b	"None"
   1303  8b2f		       20 6f 6e 20 aOn	      dc.b	" on "
   1304  8b33		       54 61 62 20*aTabValue  dc.b	"Tab value   : "
   1305  8b41		       4c 61 73 74*aLastSearch dc.b	"Last search : "
   1306  8b4f		       4e 6f 6e 65 aNone_0    dc.b	"None"
   1307  8b53		       42 45 00    be_cmd     dc.b	"BE",0
   1308  8b56
   1309  8b56		       20		      dc.b	$20	;
   1310  8b57		       46 72 6f 6d*aFromThePensOfPeteMorrisC dc.b	"From the pens of Pete Morris & Chris Gibson. P.S. many th"
   1311  8b90		       61 6e 6b 73*	      dc.b	"anks Pat!"
   1312  8b99
   1313  8b99
   1314  8b99
   1315  8b99				   do_command_line
   1316  8b99		       20 91 90 	      JSR	clear_5B1_to_600
   1317  8b9c		       a9 00		      LDA	#0
   1318  8b9e		       85 19		      STA	readline_ptr_lsb
   1319  8ba0		       a9 07		      LDA	#7
   1320  8ba2		       85 1a		      STA	readline_ptr_msb
   1321  8ba4		       a9 64		      LDA	#100
   1322  8ba6		       20 7b 94 	      JSR	read_line
   1323  8ba9		       90 07		      BCC	got_command_line
   1324  8bab							; ESCAPE was pressed
   1325  8bab		       a5 16		      LDA	unk_16
   1326  8bad		       d0 09		      BNE	do_command_line_done
   1327  8baf		       4c 67 9d 	      JMP	loc_9D67	; enter	editing	mode
   1328  8bb2
   1329  8bb2				   got_command_line
   1330  8bb2		       20 97 8c 	      JSR	parse_command_line
   1331  8bb5		       4c e7 8f 	      JMP	execute_command	; unk_6BD = command to run
   1332  8bb8
   1333  8bb8				   do_command_line_done
   1334  8bb8		       60		      RTS
   1335  8bb9							; End of function do_command_line
   1336  8bb9
   1337  8bb9		       41 50 50 45*command_table dc.b	"APPEND",0
   1338  8bc0		       09		      dc.b	9	;
   1339  8bc1		       de		      dc.b	CMD_APPEND
   1340  8bc2		       42 41 43 4b*aBack      dc.b	"BACK",0
   1341  8bc7		       21		      dc.b	$21	; !
   1342  8bc8		       d5		      dc.b	CMD_BACK
   1343  8bc9		       43 48 41 4e*aChange    dc.b	"CHANGE",0
   1344  8bd0		       15		      dc.b	$15	;
   1345  8bd1		       e1		      dc.b	CMD_CHANGE
   1346  8bd2		       45 4e 44 00 aEnd       dc.b	"END",0
   1347  8bd6		       00		      dc.b	0	;
   1348  8bd7		       eb		      dc.b	CMD_END
   1349  8bd8		       45 44 49 54*aEdit      dc.b	"EDIT",0
   1350  8bdd		       05		      dc.b	5	;
   1351  8bde		       e9		      dc.b	CMD_EDIT
   1352  8bdf		       45 58 49 54*aExit      dc.b	"EXIT",0
   1353  8be4		       00		      dc.b	0	;
   1354  8be5		       a9		      dc.b	CMD_EXIT
   1355  8be6		       46 49 4e 44*aFind      dc.b	"FIND",0
   1356  8beb		       05		      dc.b	5	;
   1357  8bec		       e0		      dc.b	CMD_FIND
   1358  8bed		       46 4f 52 45*aFore      dc.b	"FORE",0
   1359  8bf2		       21		      dc.b	$21	; !
   1360  8bf3		       d6		      dc.b	CMD_FORE
   1361  8bf4		       47 4f 54 4f*aGoto      dc.b	"GOTO",0
   1362  8bf9		       00		      dc.b	0	;
   1363  8bfa		       e8		      dc.b	CMD_GOTO
   1364  8bfb		       48 45 4c 50*aHelp      dc.b	"HELP",0
   1365  8c00		       00		      dc.b	0	;
   1366  8c01		       d4		      dc.b	CMD_HELP
   1367  8c02		       49 45 00    aIe	      dc.b	"IE",0
   1368  8c05		       00		      dc.b	0	;
   1369  8c06		       a8		      dc.b	CMD_IE
   1370  8c07		       49 4e 46 4f*aInfo      dc.b	"INFO",0
   1371  8c0c		       00		      dc.b	0	;
   1372  8c0d		       d9		      dc.b	CMD_INFO
   1373  8c0e		       49 4e 53 45*aInsert    dc.b	"INSERT",0
   1374  8c15		       00		      dc.b	0	;
   1375  8c16		       d7		      dc.b	CMD_INSERT
   1376  8c17		       49 54 00    aIt	      dc.b	"IT",0
   1377  8c1a		       00		      dc.b	0	;
   1378  8c1b		       b8		      dc.b	CMD_IT
   1379  8c1c		       4c 4f 41 44*aLoad      dc.b	"LOAD",0
   1380  8c21		       09		      dc.b	9	;
   1381  8c22		       dd		      dc.b	CMD_LOAD
   1382  8c23		       4c 41 42 45*aLabel     dc.b	"LABEL",0
   1383  8c29		       00		      dc.b	0	;
   1384  8c2a		       d3		      dc.b	CMD_LABEL
   1385  8c2b		       4d 4f 44 45*aMode      dc.b	"MODE",0
   1386  8c30		       03		      dc.b	3	;
   1387  8c31		       d1		      dc.b	CMD_MODE
   1388  8c32		       4e 45 57 00 aNew       dc.b	"NEW",0
   1389  8c36		       00		      dc.b	0	;
   1390  8c37		       b0		      dc.b	CMD_NEW
   1391  8c38		       4e 4f 53 43*aNoscroll  dc.b	"NOSCROLL",0
   1392  8c41		       00		      dc.b	0	;
   1393  8c42		       c6		      dc.b	CMD_NOSCROLL
   1394  8c43		       4e 55 4d 42*aNumber    dc.b	"NUMBER",0
   1395  8c4a		       00		      dc.b	0	;
   1396  8c4b		       d2		      dc.b	CMD_NUMBER
   1397  8c4c		       4f 4c 44 00 aOld       dc.b	"OLD",0
   1398  8c50		       00		      dc.b	0	;
   1399  8c51		       b1		      dc.b	CMD_OLD
   1400  8c52		       4f 56 45 52*aOvertype  dc.b	"OVERTYPE",0
   1401  8c5b		       00		      dc.b	0	;
   1402  8c5c		       d8		      dc.b	CMD_OVERTYPE
   1403  8c5d		       51 43 48 41*aQchange   dc.b	"QCHANGE",0
   1404  8c65		       15		      dc.b	$15	;
   1405  8c66		       e2		      dc.b	CMD_QCHANGE
   1406  8c67		       52 45 4e 55*aRenumber  dc.b	"RENUMBER",0
   1407  8c70		       45		      dc.b	$45	; E
   1408  8c71		       dc		      dc.b	CMD_RENUMBER
   1409  8c72		       52 55 4e 00 aRun       dc.b	"RUN",0
   1410  8c76		       00		      dc.b	0	;
   1411  8c77		       d0		      dc.b	CMD_RUN
   1412  8c78		       53 41 56 45*aSave      dc.b	"SAVE",0
   1413  8c7d		       09		      dc.b	9	;
   1414  8c7e		       df		      dc.b	CMD_SAVE
   1415  8c7f		       53 43 52 4f*aScroll    dc.b	"SCROLL",0
   1416  8c86		       00		      dc.b	0	;
   1417  8c87		       c5		      dc.b	CMD_SCROLL
   1418  8c88		       54 4f 50 00 aTop       dc.b	"TOP",0
   1419  8c8c		       00		      dc.b	0	;
   1420  8c8d		       ea		      dc.b	CMD_TOP
   1421  8c8e		       54 41 42 00 aTab       dc.b	"TAB",0
   1422  8c92		       03		      dc.b	3	;
   1423  8c93		       e4		      dc.b	CMD_TAB
   1424  8c94		       ff		      dc.b	$FF	;
   1425  8c95		       0a	   byte_8C95  dc.b	$A
   1426  8c96
   1427  8c96		       09	   byte_8C96  dc.b	9
   1428  8c97
   1429  8c97
   1430  8c97
   1431  8c97				   parse_command_line
   1432  8c97		       a0 00		      LDY	#0
   1433  8c99		       8c bd 06 	      STY	current_command_id
   1434  8c9c		       a9 00		      LDA	#0
   1435  8c9e		       85 0c		      STA	byte_C
   1436  8ca0		       a9 07		      LDA	#7
   1437  8ca2		       85 0d		      STA	byte_D
   1438  8ca4							; Skip spaces at the start of the command line
   1439  8ca4
   1440  8ca4				   skip_initial_spaces_loop
   1441  8ca4		       b1 0c		      LDA	(byte_C),Y
   1442  8ca6		       c9 20		      CMP	#32
   1443  8ca8		       d0 08		      BNE	found_non_space
   1444  8caa		       e6 0c		      INC	byte_C
   1445  8cac		       d0 02		      BNE	loc_8CB0
   1446  8cae		       e6 0d		      INC	byte_D
   1447  8cb0
   1448  8cb0				   loc_8CB0
   1449  8cb0		       d0 f2		      BNE	skip_initial_spaces_loop
   1450  8cb2
   1451  8cb2				   found_non_space
   1452  8cb2		       c9 0d		      CMP	#$D
   1453  8cb4		       f0 09		      BEQ	done2
   1454  8cb6
   1455  8cb6				   try_star		; is it	looking	like a * command?
   1456  8cb6		       c9 2a		      CMP	#'*
   1457  8cb8		       d0 06		      BNE	try_number	; branch taken if it's not a * command
   1458  8cba		       a9 e3		      LDA	#CMD_star	; ok, it IS a *	command
   1459  8cbc
   1460  8cbc				   store_current_command
   1461  8cbc
   1462  8cbc		       8d bd 06 	      STA	current_command_id
   1463  8cbf
   1464  8cbf				   done2
   1465  8cbf		       60		      RTS
   1466  8cc0
   1467  8cc0				   try_number
   1468  8cc0		       20 85 8f 	      JSR	atoi	; entry: (unk_C) points	to text;
   1469  8cc3							; exit:	C set if error,	or (byte_3E,byte_3F) holds value
   1470  8cc3		       b0 23		      BCS	try_command	; branch taken if it doesn't look like a number
   1471  8cc5		       a0 00		      LDY	#0
   1472  8cc7
   1473  8cc7				   skip_number_loop
   1474  8cc7		       b1 0c		      LDA	(byte_C),Y	; get number char
   1475  8cc9		       c9 0d		      CMP	#13
   1476  8ccb		       f0 17		      BEQ	is_line_number	; branch taken if end of command line
   1477  8ccd		       c9 20		      CMP	#32
   1478  8ccf		       f0 03		      BEQ	skip_post_number_spaces_loop	; branch taken if end of number
   1479  8cd1		       c8		      INY
   1480  8cd2		       d0 f3		      BNE	skip_number_loop
   1481  8cd4
   1482  8cd4				   skip_post_number_spaces_loop
   1483  8cd4
   1484  8cd4		       c8		      INY
   1485  8cd5		       b1 0c		      LDA	(byte_C),Y	; get whitespace char
   1486  8cd7		       c9 0d		      CMP	#13	; end of command line?
   1487  8cd9		       f0 09		      BEQ	is_line_number	; branch taken if end of command line
   1488  8cdb		       c9 20		      CMP	#32	; just a space?
   1489  8cdd		       f0 f5		      BEQ	skip_post_number_spaces_loop	; keep going if so
   1490  8cdf							; any non-space chars after the line number are invalid.
   1491  8cdf		       a9 16		      LDA	#$16	; "Invalid line	number"
   1492  8ce1		       4c 9d 85 	      JMP	loc_859D
   1493  8ce4
   1494  8ce4				   is_line_number
   1495  8ce4
   1496  8ce4		       a9 da		      LDA	#CMD_goto_line
   1497  8ce6		       d0 d4		      BNE	store_current_command	;	JMP, in	effect
   1498  8ce8
   1499  8ce8				   try_command
   1500  8ce8		       20 3e 8e 	      JSR	find_first_non_alpha_char
   1501  8ceb		       a9 b9		      LDA	#$B9	; #<command_table
   1502  8ced		       85 0e		      STA	byte_E
   1503  8cef		       a9 8b		      LDA	#$8B	; #>command_table
   1504  8cf1		       85 0f		      STA	byte_F
   1505  8cf3
   1506  8cf3				   try_this_command
   1507  8cf3		       a0 00		      LDY	#0
   1508  8cf5		       b1 0e		      LDA	(byte_E),Y	; get next char	from command table
   1509  8cf7		       30 1b		      BMI	invalid_command	; invalid, if reached end of table
   1510  8cf9		       20 19 8e 	      JSR	compare_cmd_char_to_input_char	; entry:	(unk_C)	points to input	char, (unk_E) points to	command	table char
   1511  8cfc							; exit:	C set if matched
   1512  8cfc		       b0 1b		      BCS	char_matched
   1513  8cfe							; advance to next command in table
   1514  8cfe
   1515  8cfe				   find_end_of_command_name_loop
   1516  8cfe		       b1 0e		      LDA	(byte_E),Y
   1517  8d00		       f0 03		      BEQ	found_end_of_command_name
   1518  8d02		       c8		      INY
   1519  8d03		       d0 f9		      BNE	find_end_of_command_name_loop
   1520  8d05
   1521  8d05				   found_end_of_command_name
   1522  8d05		       c8		      INY		; skip terminating 0
   1523  8d06		       c8		      INY		; skip args byte
   1524  8d07		       c8		      INY		; skip command ID
   1525  8d08							; add Y to table pointer
   1526  8d08		       18		      CLC
   1527  8d09		       98		      TYA
   1528  8d0a		       65 0e		      ADC	byte_E
   1529  8d0c		       85 0e		      STA	byte_E
   1530  8d0e		       90 02		      BCC	loc_8D12
   1531  8d10		       e6 0f		      INC	byte_F
   1532  8d12
   1533  8d12				   loc_8D12
   1534  8d12		       d0 df		      BNE	try_this_command	; JMP,	in effect
   1535  8d14
   1536  8d14				   invalid_command
   1537  8d14		       a9 09		      LDA	#9	; "Invalid command"
   1538  8d16		       4c 9d 85 	      JMP	loc_859D
   1539  8d19
   1540  8d19				   char_matched
   1541  8d19		       84 3a		      STY	byte_3A
   1542  8d1b
   1543  8d1b				   find_end_of_command_name_loop_2
   1544  8d1b		       b1 0e		      LDA	(byte_E),Y
   1545  8d1d		       f0 03		      BEQ	found_end_of_command_name_2
   1546  8d1f		       c8		      INY
   1547  8d20		       d0 f9		      BNE	find_end_of_command_name_loop_2
   1548  8d22
   1549  8d22				   found_end_of_command_name_2
   1550  8d22		       c8		      INY		; skip terminating 0
   1551  8d23		       84 39		      STY	byte_39	; $39 =	Y pointing into	data
   1552  8d25		       b1 0e		      LDA	($E),Y	; get first byte of command data
   1553  8d27		       85 49		      STA	byte_49	; $49 =	first byte of command data
   1554  8d29		       a4 3a		      LDY	byte_3A
   1555  8d2b		       b1 0c		      LDA	($C),Y	; get last matched input char
   1556  8d2d		       a2 00		      LDX	#0
   1557  8d2f		       c9 0d		      CMP	#13	; end of line there?
   1558  8d31		       f0 1f		      BEQ	loc_8D52
   1559  8d33		       c9 2e		      CMP	#'.	; abbreviated input?
   1560  8d35		       d0 01		      BNE	skip_spaces	; branch taken if not abbreviated
   1561  8d37		       c8		      INY		; just skip the	'.'
   1562  8d38							; Skip spaces after command
   1563  8d38
   1564  8d38				   skip_spaces
   1565  8d38
   1566  8d38		       b1 0c		      LDA	(byte_C),Y
   1567  8d3a		       c9 20		      CMP	#32
   1568  8d3c		       d0 03		      BNE	spaces_skipped
   1569  8d3e		       c8		      INY
   1570  8d3f		       d0 f7		      BNE	skip_spaces
   1571  8d41
   1572  8d41				   spaces_skipped
   1573  8d41		       c9 0d		      CMP	#13	; end of command line?
   1574  8d43		       f0 0d		      BEQ	loc_8D52
   1575  8d45		       e8		      INX		; X=1
   1576  8d46							; Set ($3E) to point to remainder of command line
   1577  8d46		       18		      CLC
   1578  8d47		       98		      TYA
   1579  8d48		       65 0c		      ADC	byte_C
   1580  8d4a		       85 3e		      STA	byte_3E
   1581  8d4c		       a5 0d		      LDA	byte_D
   1582  8d4e		       69 00		      ADC	#0
   1583  8d50		       85 3f		      STA	byte_3F
   1584  8d52
   1585  8d52				   loc_8D52
   1586  8d52
   1587  8d52		       8a		      TXA		; get 0	(no args entered) or 1 (args entered)
   1588  8d53		       45 49		      EOR	byte_49	; Set bit 0 if state differs from command's requirements
   1589  8d55		       29 01		      AND	#1	; Extract bit 0
   1590  8d57		       f0 10		      BEQ	loc_8D69	; Branch taken if command wants	args and some were entered/it doesn't and there weren't
   1591  8d59		       a5 49		      LDA	byte_49
   1592  8d5b		       29 04		      AND	#4	; String arg?
   1593  8d5d		       d0 0a		      BNE	loc_8D69	; branch taken if string arg wanted but	one wasn't supplied
   1594  8d5f							; "Invalid argument" if an unnecessary one was specified; "Argument missing" if a necessary one wasn't.
   1595  8d5f		       a9 0a		      LDA	#$A	; "Invalid argument"
   1596  8d61		       ca		      DEX
   1597  8d62		       f0 02		      BEQ	loc_8D66
   1598  8d64		       a9 20		      LDA	#$20	; ' '	    ; "Argument missing"
   1599  8d66
   1600  8d66				   loc_8D66
   1601  8d66		       4c 9d 85 	      JMP	loc_859D
   1602  8d69
   1603  8d69				   loc_8D69
   1604  8d69
   1605  8d69		       8a		      TXA		; get 0	(no args entered) or 1 (args entered)
   1606  8d6a		       f0 22		      BEQ	no_args_entered	; branch taken if no args entered
   1607  8d6c		       a5 49		      LDA	byte_49	; get args byte
   1608  8d6e		       29 02		      AND	#2	; test bit 1 (single numeric arg)
   1609  8d70		       f0 22		      BEQ	loc_8D94	; branch taken if command wants	something else
   1610  8d72							; command wants single numeric argument
   1611  8d72		       20 7d 8f 	      JSR	atoi_from_command_line	; entry:	(byte_3E) points to command line;
   1612  8d75							; exit:	C set if error,	or (byte_3E, byte_3F) holds result.
   1613  8d75		       90 05		      BCC	skip_post_number_spaces
   1614  8d77		       a9 0b		      LDA	#$B	; "Bad number"
   1615  8d79		       4c 9d 85 	      JMP	loc_859D
   1616  8d7c
   1617  8d7c				   skip_post_number_spaces
   1618  8d7c
   1619  8d7c		       b1 0c		      LDA	(byte_C),Y
   1620  8d7e		       c9 20		      CMP	#32
   1621  8d80		       d0 03		      BNE	skipped_post_number_spaces
   1622  8d82		       c8		      INY
   1623  8d83		       d0 f7		      BNE	skip_post_number_spaces
   1624  8d85
   1625  8d85				   skipped_post_number_spaces
   1626  8d85		       c9 0d		      CMP	#13	; end of command line after the	number?
   1627  8d87		       f0 0b		      BEQ	loc_8D94	; branch taken if so
   1628  8d89							;
   1629  8d89							; (This	branch is wrong, I think, as 8D94...
   1630  8d89							; keeps	scanning from (byte_3E), even
   1631  8d89							; though that now contains the number.
   1632  8d89							; It wants to go to got_command	instead.)
   1633  8d89		       a9 0c		      LDA	#$C	; "Too many arguments"
   1634  8d8b		       4c 9d 85 	      JMP	loc_859D
   1635  8d8e
   1636  8d8e				   no_args_entered
   1637  8d8e		       a9 ff		      LDA	#$FF	; mark lack of args ($FF isn't the MSB of any valid number)
   1638  8d90		       85 3f		      STA	byte_3F
   1639  8d92		       d0 1a		      BNE	got_command	; JMP, in effect
   1640  8d94
   1641  8d94				   loc_8D94
   1642  8d94
   1643  8d94		       a0 00		      LDY	#0
   1644  8d96
   1645  8d96				   find_end_of_command_line_loop
   1646  8d96		       b1 3e		      LDA	(byte_3E),Y
   1647  8d98		       c9 0d		      CMP	#$D
   1648  8d9a		       f0 03		      BEQ	found_end_of_command_line
   1649  8d9c		       c8		      INY
   1650  8d9d		       d0 f7		      BNE	find_end_of_command_line_loop
   1651  8d9f
   1652  8d9f				   found_end_of_command_line
   1653  8d9f		       88		      DEY
   1654  8da0
   1655  8da0				   find_end_of_last_argument_loop
   1656  8da0		       b1 3e		      LDA	(byte_3E),Y
   1657  8da2		       c9 20		      CMP	#$20	; ' '
   1658  8da4		       d0 04		      BNE	found_end_of_last_argument
   1659  8da6		       88		      DEY
   1660  8da7		       4c a0 8d 	      JMP	find_end_of_last_argument_loop
   1661  8daa
   1662  8daa				   found_end_of_last_argument
   1663  8daa		       c8		      INY
   1664  8dab		       8c be 06 	      STY	byte_6BE
   1665  8dae
   1666  8dae				   got_command
   1667  8dae		       a4 39		      LDY	byte_39	; get index into table (currently pointing at args byte)
   1668  8db0		       c8		      INY
   1669  8db1		       b1 0e		      LDA	($E),Y	; get command ID
   1670  8db3		       4c bc 8c 	      JMP	store_current_command
   1671  8db6							; End of function parse_command_line
   1672  8db6
   1673  8db6
   1674  8db6
   1675  8db6							; Gets string representation of	16-bit number.
   1676  8db6							;
   1677  8db6							; Entry:
   1678  8db6							; Y,X =	value
   1679  8db6							;
   1680  8db6							; Exit:
   1681  8db6							; unk_0	holds digit count
   1682  8db6							; unk_1... filled with string
   1683  8db6
   1684  8db6				   itoa
   1685  8db6
   1686  8db6		       a5 37		      LDA	unk_37
   1687  8db8		       48		      PHA
   1688  8db9		       a5 38		      LDA	byte_38
   1689  8dbb		       48		      PHA
   1690  8dbc		       a5 39		      LDA	byte_39
   1691  8dbe		       48		      PHA
   1692  8dbf		       a5 3a		      LDA	byte_3A
   1693  8dc1		       48		      PHA
   1694  8dc2		       86 37		      STX	unk_37
   1695  8dc4		       84 38		      STY	byte_38
   1696  8dc6		       a9 00		      LDA	#0
   1697  8dc8		       85 00		      STA	byte_0
   1698  8dca
   1699  8dca				   loc_8DCA
   1700  8dca		       a9 00		      LDA	#0
   1701  8dcc		       85 39		      STA	byte_39
   1702  8dce		       85 3a		      STA	byte_3A
   1703  8dd0		       a2 10		      LDX	#$10
   1704  8dd2		       18		      CLC
   1705  8dd3
   1706  8dd3				   loc_8DD3
   1707  8dd3		       26 37		      ROL	unk_37
   1708  8dd5		       26 38		      ROL	byte_38
   1709  8dd7		       26 39		      ROL	byte_39
   1710  8dd9		       26 3a		      ROL	byte_3A
   1711  8ddb		       38		      SEC
   1712  8ddc		       a5 39		      LDA	byte_39
   1713  8dde		       e9 0a		      SBC	#$A
   1714  8de0		       a8		      TAY
   1715  8de1		       a5 3a		      LDA	byte_3A
   1716  8de3		       e9 00		      SBC	#0
   1717  8de5		       90 04		      BCC	loc_8DEB
   1718  8de7		       84 39		      STY	byte_39
   1719  8de9		       85 3a		      STA	byte_3A
   1720  8deb
   1721  8deb				   loc_8DEB
   1722  8deb		       ca		      DEX
   1723  8dec		       d0 e5		      BNE	loc_8DD3
   1724  8dee		       26 37		      ROL	unk_37
   1725  8df0		       26 38		      ROL	byte_38
   1726  8df2		       a5 39		      LDA	byte_39
   1727  8df4		       18		      CLC
   1728  8df5		       69 30		      ADC	#$30	; '0'
   1729  8df7		       a4 00		      LDY	byte_0
   1730  8df9		       f0 07		      BEQ	loc_8E02
   1731  8dfb
   1732  8dfb				   loc_8DFB
   1733  8dfb		       b6 00		      LDX	byte_0,Y
   1734  8dfd		       96 01		      STX	unk_1,Y
   1735  8dff		       88		      DEY
   1736  8e00		       d0 f9		      BNE	loc_8DFB
   1737  8e02
   1738  8e02				   loc_8E02
   1739  8e02		       85 01		      STA	unk_1
   1740  8e04		       e6 00		      INC	byte_0
   1741  8e06		       a5 37		      LDA	unk_37
   1742  8e08		       05 38		      ORA	byte_38
   1743  8e0a		       d0 be		      BNE	loc_8DCA
   1744  8e0c		       68		      PLA
   1745  8e0d		       85 3a		      STA	byte_3A
   1746  8e0f		       68		      PLA
   1747  8e10		       85 39		      STA	byte_39
   1748  8e12		       68		      PLA
   1749  8e13		       85 38		      STA	byte_38
   1750  8e15		       68		      PLA
   1751  8e16		       85 37		      STA	unk_37
   1752  8e18		       60		      RTS
   1753  8e19							; End of function itoa
   1754  8e19
   1755  8e19
   1756  8e19
   1757  8e19							; entry: (unk_C) points	to input char, (unk_E) points to command table char
   1758  8e19							; exit:	C set if matched
   1759  8e19
   1760  8e19				   compare_cmd_char_to_input_char
   1761  8e19		       a0 00		      LDY	#0
   1762  8e1b
   1763  8e1b				   compare_cmd_char_to_input_char_loop
   1764  8e1b		       b1 0c		      LDA	(byte_C),Y	; input	char
   1765  8e1d		       c9 41		      CMP	#$41	; 'A'
   1766  8e1f		       90 0e		      BCC	not_alpha
   1767  8e21		       c9 5b		      CMP	#$5B	; '['
   1768  8e23		       b0 0a		      BCS	not_alpha
   1769  8e25		       b1 0e		      LDA	(byte_E),Y	; command table	char
   1770  8e27		       f0 13		      BEQ	didnt_match	; end of command?
   1771  8e29		       b1 0c		      LDA	(byte_C),Y	; input	char
   1772  8e2b		       c9 2e		      CMP	#$2E	; '.'	    ; abbreviated?
   1773  8e2d		       d0 06		      BNE	loc_8E35
   1774  8e2f
   1775  8e2f				   not_alpha
   1776  8e2f
   1777  8e2f		       c0 00		      CPY	#0	; non-alpha at start?
   1778  8e31		       f0 09		      BEQ	didnt_match	; if so, didn't match
   1779  8e33		       38		      SEC		; otherwise, did match (e.g., "MO6" = "MO.6" = "MODE 6")
   1780  8e34		       60		      RTS
   1781  8e35
   1782  8e35				   loc_8E35
   1783  8e35		       d1 0e		      CMP	(byte_E),Y
   1784  8e37		       d0 03		      BNE	didnt_match
   1785  8e39		       c8		      INY
   1786  8e3a		       d0 df		      BNE	compare_cmd_char_to_input_char_loop	; input	char
   1787  8e3c
   1788  8e3c				   didnt_match
   1789  8e3c
   1790  8e3c		       18		      CLC
   1791  8e3d		       60		      RTS
   1792  8e3e							; End of function compare_cmd_char_to_input_char
   1793  8e3e
   1794  8e3e
   1795  8e3e
   1796  8e3e
   1797  8e3e				   find_first_non_alpha_char
   1798  8e3e		       a0 00		      LDY	#0
   1799  8e40
   1800  8e40				   find_first_non_alpha_char_loop
   1801  8e40		       b1 0c		      LDA	($C),Y
   1802  8e42		       c9 41		      CMP	#$41	; 'A'
   1803  8e44		       90 25		      BCC	locret_8E6B
   1804  8e46		       c9 5b		      CMP	#$5B	; '['
   1805  8e48		       90 0c		      BCC	next_char
   1806  8e4a		       c9 61		      CMP	#$61	; 'a'
   1807  8e4c		       90 1d		      BCC	locret_8E6B
   1808  8e4e		       c9 7b		      CMP	#$7B	; '{'
   1809  8e50		       b0 19		      BCS	locret_8E6B
   1810  8e52		       49 20		      EOR	#$20	; ' '
   1811  8e54		       91 0c		      STA	($C),Y
   1812  8e56
   1813  8e56				   next_char
   1814  8e56		       c8		      INY
   1815  8e57		       d0 e7		      BNE	find_first_non_alpha_char_loop	; don't think Y is ever supposed to get to 0 again...
   1816  8e59							; End of function find_first_non_alpha_char
   1817  8e59
   1818  8e59
   1819  8e59
   1820  8e59
   1821  8e59				   toggle_case
   1822  8e59		       c9 41		      CMP	#$41	; 'A'
   1823  8e5b		       90 0e		      BCC	locret_8E6B
   1824  8e5d		       c9 5b		      CMP	#$5B	; '['
   1825  8e5f		       90 08		      BCC	loc_8E69
   1826  8e61		       c9 61		      CMP	#$61	; 'a'
   1827  8e63		       90 06		      BCC	locret_8E6B
   1828  8e65		       c9 7b		      CMP	#$7B	; '{'
   1829  8e67		       b0 02		      BCS	locret_8E6B
   1830  8e69
   1831  8e69				   loc_8E69
   1832  8e69		       49 20		      EOR	#$20	; ' '
   1833  8e6b
   1834  8e6b				   locret_8E6B
   1835  8e6b
   1836  8e6b		       60		      RTS
   1837  8e6c							; End of function toggle_case
   1838  8e6c
   1839  8e6c
   1840  8e6c
   1841  8e6c							; Set memory to	value.
   1842  8e6c							;
   1843  8e6c							; ($C) points to memory	to clear.
   1844  8e6c							; X holds number of pages to clear.
   1845  8e6c							; Y holds number of bytes to clear in Xth page.
   1846  8e6c							; A holds value	to write.
   1847  8e6c
   1848  8e6c				   memset
   1849  8e6c
   1850  8e6c		       85 3a		      STA	byte_3A
   1851  8e6e		       98		      TYA
   1852  8e6f		       48		      PHA		; save old Y
   1853  8e70		       a5 3a		      LDA	byte_3A
   1854  8e72		       a0 00		      LDY	#0
   1855  8e74		       e0 00		      CPX	#0
   1856  8e76		       f0 0a		      BEQ	fill_last_page
   1857  8e78
   1858  8e78				   fill_pages_loop
   1859  8e78		       91 0c		      STA	($C),Y	; write	byte
   1860  8e7a		       c8		      INY		; next byte...
   1861  8e7b		       d0 fb		      BNE	fill_pages_loop	; do a whole page
   1862  8e7d		       e6 0d		      INC	byte_D	; next page
   1863  8e7f		       ca		      DEX		; done all pages?
   1864  8e80		       d0 f6		      BNE	fill_pages_loop	; taken	if not all pages done yet
   1865  8e82
   1866  8e82				   fill_last_page
   1867  8e82		       a8		      TAY		; Y = value to store
   1868  8e83		       68		      PLA		; get original Y back
   1869  8e84		       f0 0a		      BEQ	memset_done	; if 0 bytes to	fill in	last page, done
   1870  8e86		       aa		      TAX		; X = #	bytes to fill in last page
   1871  8e87		       98		      TYA		; A = value to store
   1872  8e88		       a0 00		      LDY	#0
   1873  8e8a
   1874  8e8a				   fill_last_page_loop
   1875  8e8a		       91 0c		      STA	($C),Y	; write	byte
   1876  8e8c		       c8		      INY		; next byte...
   1877  8e8d		       ca		      DEX		; done all bytes?
   1878  8e8e		       d0 fa		      BNE	fill_last_page_loop	; taken if not all bytes done yet
   1879  8e90
   1880  8e90				   memset_done
   1881  8e90		       60		      RTS
   1882  8e91							; End of function memset
   1883  8e91
   1884  8e91
   1885  8e91
   1886  8e91
   1887  8e91				   osbyte_with_y0
   1888  8e91
   1889  8e91		       a0 00		      LDY	#0
   1890  8e93		       20 f4 ff 	      JSR	OSBYTE
   1891  8e96		       60		      RTS
   1892  8e97							; End of function osbyte_with_y0
   1893  8e97
   1894  8e97
   1895  8e97
   1896  8e97							; print	number.
   1897  8e97							;
   1898  8e97							; Suitable for use with	the result of itoa.
   1899  8e97							;
   1900  8e97							; Entry:
   1901  8e97							; unk_0	= digit	count
   1902  8e97							; unk_1... = digits
   1903  8e97
   1904  8e97				   print_number
   1905  8e97
   1906  8e97		       a2 01		      LDX	#1
   1907  8e99		       a0 00		      LDY	#0
   1908  8e9b		       a5 00		      LDA	byte_0
   1909  8e9d		       20 0e 8f 	      JSR	print_n_chars
   1910  8ea0		       60		      RTS
   1911  8ea1							; End of function print_number
   1912  8ea1
   1913  8ea1
   1914  8ea1
   1915  8ea1							; move (maybe overlapping) memory regions.
   1916  8ea1							;
   1917  8ea1							; Entry:
   1918  8ea1							; (byte_C) points to src
   1919  8ea1							; (byte_E) points to dest
   1920  8ea1							; X is MSB of size
   1921  8ea1							; Y is LSB of size
   1922  8ea1
   1923  8ea1				   memmove
   1924  8ea1		       a5 0d		      LDA	byte_D	; get src MSB
   1925  8ea3		       c5 0f		      CMP	byte_F	; compare to dest MSB
   1926  8ea5		       90 2c		      BCC	copy_down	; taken	if src<dest
   1927  8ea7		       f0 24		      BEQ	copying_same_page	; taken if src MSB==dest MSB
   1928  8ea9
   1929  8ea9				   copy_up
   1930  8ea9		       98		      TYA
   1931  8eaa		       48		      PHA		; save original	Y
   1932  8eab		       a0 00		      LDY	#0
   1933  8ead		       e0 00		      CPX	#0	; Any whole pages?
   1934  8eaf		       f0 0e		      BEQ	copy_up_last_page	; branch taken if no whole pages to copy
   1935  8eb1
   1936  8eb1				   copy_up_pages_loop
   1937  8eb1		       b1 0c		      LDA	(byte_C),Y	; load from src...
   1938  8eb3		       91 0e		      STA	(byte_E),Y	; store	to dest...
   1939  8eb5		       c8		      INY
   1940  8eb6		       d0 f9		      BNE	copy_up_pages_loop	; branch taken if not copied	whole page yet
   1941  8eb8		       e6 0d		      INC	byte_D	; next src page
   1942  8eba		       e6 0f		      INC	byte_F	; next dest page
   1943  8ebc		       ca		      DEX		; one more page	done
   1944  8ebd		       d0 f2		      BNE	copy_up_pages_loop	; branch taken if not done all pages	yet
   1945  8ebf
   1946  8ebf				   copy_up_last_page
   1947  8ebf		       68		      PLA
   1948  8ec0		       aa		      TAX		; get original Y in X
   1949  8ec1		       d0 01		      BNE	copy_up_last_page_loop	; branch	taken if any bytes to copy in last page
   1950  8ec3		       60		      RTS
   1951  8ec4
   1952  8ec4				   copy_up_last_page_loop
   1953  8ec4		       b1 0c		      LDA	(byte_C),Y	; load from src...
   1954  8ec6		       91 0e		      STA	(byte_E),Y	; store	to dest...
   1955  8ec8		       c8		      INY
   1956  8ec9		       ca		      DEX		; one more byte	done
   1957  8eca		       d0 f8		      BNE	copy_up_last_page_loop	; branch	taken if not done all bytes yet
   1958  8ecc		       60		      RTS
   1959  8ecd
   1960  8ecd				   copying_same_page
   1961  8ecd		       a5 0c		      LDA	byte_C	; get src LSB
   1962  8ecf		       c5 0e		      CMP	byte_E	; compare to dest LSB
   1963  8ed1		       b0 d6		      BCS	copy_up	; branch taken if src>=dest
   1964  8ed3
   1965  8ed3				   copy_down
   1966  8ed3		       8a		      TXA		; get page count
   1967  8ed4							; Point src and dest at last page of each
   1968  8ed4		       18		      CLC
   1969  8ed5		       65 0d		      ADC	byte_D
   1970  8ed7		       85 0d		      STA	byte_D
   1971  8ed9		       8a		      TXA
   1972  8eda		       18		      CLC
   1973  8edb		       65 0f		      ADC	byte_F
   1974  8edd		       85 0f		      STA	byte_F
   1975  8edf		       c0 00		      CPY	#0	; any bytes to copy at the end?
   1976  8ee1		       f0 09		      BEQ	copy_down_pages	; branch taken if no bytes to copy at the end
   1977  8ee3
   1978  8ee3				   copy_down_last_page_loop
   1979  8ee3		       88		      DEY
   1980  8ee4		       b1 0c		      LDA	(byte_C),Y	; load from src...
   1981  8ee6		       91 0e		      STA	(byte_E),Y	; store	to dest...
   1982  8ee8		       c0 00		      CPY	#0	; was that the last byte just copied?
   1983  8eea		       d0 f7		      BNE	copy_down_last_page_loop	; branch taken	if not on last byte
   1984  8eec
   1985  8eec				   copy_down_pages
   1986  8eec		       e0 00		      CPX	#0	; any pages to copy?
   1987  8eee		       f0 10		      BEQ	memmove_done	; branch taken if no pages to copy
   1988  8ef0
   1989  8ef0				   copy_down_pages_loop
   1990  8ef0		       c6 0d		      DEC	byte_D	; point	to last	whole page in src
   1991  8ef2		       c6 0f		      DEC	byte_F	; point	to last	whole page in dest
   1992  8ef4
   1993  8ef4				   copy_down_page_loop
   1994  8ef4		       88		      DEY
   1995  8ef5		       b1 0c		      LDA	(byte_C),Y	; load from src...
   1996  8ef7		       91 0e		      STA	(byte_E),Y	; store	to dest...
   1997  8ef9		       c0 00		      CPY	#0	; was that the last byte just copied?
   1998  8efb		       d0 f7		      BNE	copy_down_page_loop	; branch taken if not on last byte
   1999  8efd		       ca		      DEX		; one more page	done
   2000  8efe		       d0 f0		      BNE	copy_down_pages_loop	; branch taken if more pages to copy
   2001  8f00
   2002  8f00				   memmove_done
   2003  8f00		       60		      RTS
   2004  8f01							; End of function memmove
   2005  8f01
   2006  8f01
   2007  8f01
   2008  8f01
   2009  8f01				   gotoxy
   2010  8f01
   2011  8f01		       a9 1f		      LDA	#31	; set cursor location
   2012  8f03		       20 ee ff 	      JSR	OSWRCH
   2013  8f06		       8a		      TXA
   2014  8f07		       20 ee ff 	      JSR	OSWRCH
   2015  8f0a		       98		      TYA
   2016  8f0b		       4c ee ff 	      JMP	OSWRCH
   2017  8f0e							; End of function gotoxy
   2018  8f0e
   2019  8f0e
   2020  8f0e
   2021  8f0e
   2022  8f0e				   print_n_chars
   2023  8f0e
   2024  8f0e		       86 0c		      STX	byte_C
   2025  8f10		       84 0d		      STY	byte_D
   2026  8f12		       aa		      TAX
   2027  8f13		       f0 38		      BEQ	print_n_chars_done
   2028  8f15		       a0 00		      LDY	#0
   2029  8f17		       ad b7 06 	      LDA	editor_mode_id	; 1=command mode, 2=edit mode
   2030  8f1a		       f0 31		      BEQ	print_n_chars_done
   2031  8f1c		       c9 01		      CMP	#1
   2032  8f1e		       f0 02		      BEQ	loc_8F22
   2033  8f20		       a0 20		      LDY	#$20	; ' '
   2034  8f22
   2035  8f22				   loc_8F22
   2036  8f22		       84 3a		      STY	byte_3A
   2037  8f24		       a0 00		      LDY	#0
   2038  8f26
   2039  8f26				   loc_8F26
   2040  8f26		       b1 0c		      LDA	($C),Y
   2041  8f28		       c9 7f		      CMP	#$7F	; ''
   2042  8f2a		       f0 18		      BEQ	print_space
   2043  8f2c		       48		      PHA
   2044  8f2d		       a5 14		      LDA	screen_mode
   2045  8f2f		       c9 07		      CMP	#7
   2046  8f31		       f0 04		      BEQ	loc_8F37
   2047  8f33		       68		      PLA
   2048  8f34		       4c 40 8f 	      JMP	loc_8F40
   2049  8f37
   2050  8f37				   loc_8F37
   2051  8f37		       68		      PLA
   2052  8f38		       c9 8d		      CMP	#$8D
   2053  8f3a		       f0 08		      BEQ	print_space
   2054  8f3c		       c9 ff		      CMP	#$FF
   2055  8f3e		       f0 04		      BEQ	print_space
   2056  8f40
   2057  8f40				   loc_8F40
   2058  8f40		       c5 3a		      CMP	byte_3A
   2059  8f42		       b0 02		      BCS	print_n_chars_print_char
   2060  8f44
   2061  8f44				   print_space
   2062  8f44
   2063  8f44		       a9 20		      LDA	#$20	; ' '
   2064  8f46
   2065  8f46				   print_n_chars_print_char
   2066  8f46		       20 ee ff 	      JSR	OSWRCH
   2067  8f49		       c8		      INY
   2068  8f4a		       ca		      DEX
   2069  8f4b		       d0 d9		      BNE	loc_8F26
   2070  8f4d
   2071  8f4d				   print_n_chars_done
   2072  8f4d
   2073  8f4d		       60		      RTS
   2074  8f4e							; End of function print_n_chars
   2075  8f4e
   2076  8f4e
   2077  8f4e
   2078  8f4e							; work out dimensions of line.
   2079  8f4e							;
   2080  8f4e							; Entry:
   2081  8f4e							; X=line length
   2082  8f4e							; Y=starting Y
   2083  8f4e							;
   2084  8f4e							; Exit:
   2085  8f4e							; X=line length	MOD screen width
   2086  8f4e							; Y=ending Y
   2087  8f4e
   2088  8f4e				   get_line_dimensions
   2089  8f4e
   2090  8f4e		       a5 39		      LDA	byte_39
   2091  8f50		       48		      PHA
   2092  8f51		       a5 3a		      LDA	byte_3A
   2093  8f53		       48		      PHA
   2094  8f54		       86 39		      STX	byte_39
   2095  8f56		       84 3a		      STY	byte_3A
   2096  8f58		       a0 00		      LDY	#0
   2097  8f5a
   2098  8f5a				   loc_8F5A
   2099  8f5a		       a5 3a		      LDA	byte_3A	; get Y
   2100  8f5c		       d0 07		      BNE	loc_8F65	; taken	if Y not zero
   2101  8f5e		       a5 39		      LDA	byte_39	; get X
   2102  8f60		       cd b6 06 	      CMP	code_area_width	; reached effective screen width?
   2103  8f63		       90 0f		      BCC	loc_8F74	; taken	if effective screen width not yet reached.
   2104  8f65
   2105  8f65				   loc_8F65
   2106  8f65		       38		      SEC
   2107  8f66		       a5 39		      LDA	byte_39	; get X
   2108  8f68		       ed b6 06 	      SBC	code_area_width	; subtract effective screen width
   2109  8f6b		       85 39		      STA	byte_39	; save X
   2110  8f6d		       b0 02		      BCS	loc_8F71	; taken	if no borrow
   2111  8f6f		       c6 3a		      DEC	byte_3A	; borrow occurred, so decrement	Y
   2112  8f71
   2113  8f71				   loc_8F71
   2114  8f71		       c8		      INY
   2115  8f72		       d0 e6		      BNE	loc_8F5A
   2116  8f74
   2117  8f74				   loc_8F74
   2118  8f74		       a6 39		      LDX	byte_39
   2119  8f76		       68		      PLA
   2120  8f77		       85 3a		      STA	byte_3A
   2121  8f79		       68		      PLA
   2122  8f7a		       85 39		      STA	byte_39
   2123  8f7c		       60		      RTS
   2124  8f7d							; End of function get_line_dimensions
   2125  8f7d
   2126  8f7d
   2127  8f7d
   2128  8f7d							; entry: (byte_3E) points to command line;
   2129  8f7d							; exit:	C set if error,	or (byte_3E, byte_3F) holds result.
   2130  8f7d
   2131  8f7d				   atoi_from_command_line
   2132  8f7d
   2133  8f7d		       a5 3e		      LDA	byte_3E
   2134  8f7f		       85 0c		      STA	byte_C
   2135  8f81		       a5 3f		      LDA	byte_3F
   2136  8f83		       85 0d		      STA	byte_D
   2137  8f85							; End of function atoi_from_command_line
   2138  8f85
   2139  8f85
   2140  8f85
   2141  8f85							; entry: (unk_C) points	to text;
   2142  8f85							; exit:	C set if error,	or (byte_3E,byte_3F) holds value
   2143  8f85
   2144  8f85				   atoi
   2145  8f85		       a2 00		      LDX	#0
   2146  8f87		       86 3e		      STX	byte_3E
   2147  8f89		       86 3f		      STX	byte_3F
   2148  8f8b		       a0 00		      LDY	#0
   2149  8f8d		       b1 0c		      LDA	(byte_C),Y
   2150  8f8f		       48		      PHA
   2151  8f90
   2152  8f90				   atoi_loop
   2153  8f90		       b1 0c		      LDA	(byte_C),Y
   2154  8f92		       c9 20		      CMP	#32
   2155  8f94		       f0 4a		      BEQ	atoi_done	; branch taken if space	char
   2156  8f96		       c9 0d		      CMP	#13
   2157  8f98		       f0 46		      BEQ	atoi_done	; branch taken if CR
   2158  8f9a		       c9 30		      CMP	#'0
   2159  8f9c		       90 04		      BCC	atoi_error	; branch taken if definitely not digit
   2160  8f9e		       c9 3a		      CMP	#$3A	; ':'
   2161  8fa0		       90 03		      BCC	is_digit	; branch taken if digit
   2162  8fa2
   2163  8fa2				   atoi_error
   2164  8fa2		       68		      PLA
   2165  8fa3		       38		      SEC
   2166  8fa4		       60		      RTS
   2167  8fa5
   2168  8fa5				   is_digit
   2169  8fa5		       e8		      INX		; count	number of digits
   2170  8fa6		       e0 05		      CPX	#5	; 5 digits?
   2171  8fa8		       f0 04		      BEQ	check_most_significant_digit	; ==5 is OK
   2172  8faa		       90 08		      BCC	add_digit	; <5 is	OK
   2173  8fac		       b0 f4		      BCS	atoi_error	; >5 is	an error
   2174  8fae
   2175  8fae				   check_most_significant_digit
   2176  8fae		       68		      PLA
   2177  8faf		       48		      PHA
   2178  8fb0		       c9 34		      CMP	#$34	; '4'
   2179  8fb2		       b0 ee		      BCS	atoi_error	; error	if most	significant digit >'3' (since 32767 is the largest valid value)
   2180  8fb4
   2181  8fb4				   add_digit
   2182  8fb4		       06 3e		      ASL	byte_3E
   2183  8fb6		       26 3f		      ROL	byte_3F	; value*2
   2184  8fb8		       a5 3f		      LDA	byte_3F
   2185  8fba		       48		      PHA
   2186  8fbb		       a5 3e		      LDA	byte_3E
   2187  8fbd		       06 3e		      ASL	byte_3E
   2188  8fbf		       26 3f		      ROL	byte_3F	; value*4
   2189  8fc1		       06 3e		      ASL	byte_3E
   2190  8fc3		       26 3f		      ROL	byte_3F	; value*8
   2191  8fc5							; value*8 + value*2 (=value*10)
   2192  8fc5		       18		      CLC
   2193  8fc6		       65 3e		      ADC	byte_3E
   2194  8fc8		       85 3e		      STA	byte_3E
   2195  8fca		       68		      PLA
   2196  8fcb		       65 3f		      ADC	byte_3F
   2197  8fcd		       85 3f		      STA	byte_3F
   2198  8fcf		       b1 0c		      LDA	($C),Y	; get char (which is known to be a digit)
   2199  8fd1		       38		      SEC
   2200  8fd2		       e9 30		      SBC	#'0	; -'0' to make it a number
   2201  8fd4		       18		      CLC
   2202  8fd5		       65 3e		      ADC	byte_3E
   2203  8fd7		       85 3e		      STA	byte_3E	; add in to accumulator
   2204  8fd9		       90 02		      BCC	done_digit
   2205  8fdb		       e6 3f		      INC	byte_3F	; adjust high byte for carry
   2206  8fdd
   2207  8fdd				   done_digit
   2208  8fdd		       c8		      INY
   2209  8fde		       d0 b0		      BNE	atoi_loop
   2210  8fe0
   2211  8fe0				   atoi_done
   2212  8fe0		       a5 3f		      LDA	byte_3F
   2213  8fe2		       30 be		      BMI	atoi_error
   2214  8fe4		       68		      PLA
   2215  8fe5		       18		      CLC
   2216  8fe6		       60		      RTS
   2217  8fe7							; End of function atoi
   2218  8fe7
   2219  8fe7
   2220  8fe7
   2221  8fe7							; unk_6BD = command to run
   2222  8fe7
   2223  8fe7				   execute_command
   2224  8fe7
   2225  8fe7		       a9 31		      LDA	#$31	; #<command_jump_table
   2226  8fe9		       85 39		      STA	byte_39
   2227  8feb		       a9 95		      LDA	#$95	; #>command_jump_table
   2228  8fed		       85 3a		      STA	byte_3A
   2229  8fef
   2230  8fef				   loc_8FEF
   2231  8fef		       a0 00		      LDY	#0
   2232  8ff1		       b1 39		      LDA	(byte_39),Y	; get control byte
   2233  8ff3		       85 49		      STA	byte_49	; ?unk_49 = control byte
   2234  8ff5		       c9 ff		      CMP	#$FF	; end of table?
   2235  8ff7		       d0 01		      BNE	loc_8FFA	; branch taken if not end of table
   2236  8ff9
   2237  8ff9				   execute_command_done
   2238  8ff9		       60		      RTS
   2239  8ffa
   2240  8ffa				   loc_8FFA
   2241  8ffa		       c8		      INY
   2242  8ffb		       b1 39		      LDA	($39),Y	; get command ID
   2243  8ffd		       cd bd 06 	      CMP	current_command_id	; is	it the desired command?
   2244  9000		       f0 03		      BEQ	loc_9005	; branch taken if desired command found
   2245  9002		       4c 83 90 	      JMP	next_command
   2246  9005							; Create thunk at unk_6B0: JMP <command routine>
   2247  9005
   2248  9005				   loc_9005
   2249  9005		       a9 4c		      LDA	#$4C	; JMP absolute
   2250  9007		       8d b0 06 	      STA	unk_6B0
   2251  900a		       8d a7 06 	      STA	byte_6A7
   2252  900d		       c8		      INY
   2253  900e		       b1 39		      LDA	($39),Y	; get command routine ptr LSB
   2254  9010		       8d b1 06 	      STA	unk_6B1	; store	JMP target LSB
   2255  9013		       c8		      INY
   2256  9014		       b1 39		      LDA	($39),Y	; get command routine ptr MSB
   2257  9016		       8d b2 06 	      STA	unk_6B2	; store	JMP target MSB
   2258  9019		       a5 49		      LDA	byte_49	; get control byte
   2259  901b		       29 01		      AND	#1	; extract bit 0
   2260  901d		       8d ab 06 	      STA	byte_6AB	; ?unk_6AB = unknown byte bit 1
   2261  9020
   2262  9020				   check_bit_1		; get control byte
   2263  9020		       a5 49		      LDA	byte_49
   2264  9022		       29 02		      AND	#2	; extract bit 1
   2265  9024		       d0 04		      BNE	check_bit_2	; branch taken if bit 1	reset
   2266  9026							; bit 1 set
   2267  9026		       a5 16		      LDA	unk_16
   2268  9028		       d0 cf		      BNE	execute_command_done
   2269  902a
   2270  902a				   check_bit_2
   2271  902a		       a5 49		      LDA	byte_49	; get control byte
   2272  902c		       29 04		      AND	#4	; extract bit 2
   2273  902e		       f0 18		      BEQ	check_bit_3	; branch taken if bit 2	reset
   2274  9030							; bit 2 set
   2275  9030		       ad b7 06 	      LDA	editor_mode_id	; 1=command mode, 2=edit mode
   2276  9033		       c9 02		      CMP	#2	; edit mode?
   2277  9035		       f0 11		      BEQ	check_bit_3	; branch taken if edit mode
   2278  9037							; not in edit mode
   2279  9037		       20 28 9d 	      JSR	enter_edit_mode
   2280  903a		       a5 49		      LDA	byte_49	; get control byte
   2281  903c		       29 10		      AND	#$10	; extract bit 4
   2282  903e		       f0 37		      BEQ	check_bit_6	; branch taken if bit 4	reset
   2283  9040							; bit 4 set
   2284  9040		       20 e9 9f 	      JSR	is_program_empty	; sets	C if no	program
   2285  9043		       90 32		      BCC	check_bit_6	; branch taken if program is present
   2286  9045		       4c a8 9d 	      JMP	loc_9DA8
   2287  9048
   2288  9048				   check_bit_3
   2289  9048
   2290  9048		       ad b7 06 	      LDA	editor_mode_id	; 1=command mode, 2=edit mode
   2291  904b		       c9 02		      CMP	#2	; edit mode?
   2292  904d		       d0 28		      BNE	check_bit_6
   2293  904f		       a5 49		      LDA	byte_49
   2294  9051		       29 08		      AND	#8
   2295  9053		       f0 08		      BEQ	check_bit_4
   2296  9055		       20 51 a0 	      JSR	is_line_empty	; determines whether current line is empty.
   2297  9058							;
   2298  9058							; Entry:
   2299  9058							; detokenized line at $400...
   2300  9058							;
   2301  9058							; Exit:
   2302  9058							; C set	if line	empty.
   2303  9058		       b0 03		      BCS	check_bit_4
   2304  905a		       20 c0 a8 	      JSR	sub_A8C0
   2305  905d
   2306  905d				   check_bit_4
   2307  905d
   2308  905d		       a5 49		      LDA	byte_49
   2309  905f		       29 10		      AND	#$10
   2310  9061		       f0 08		      BEQ	check_bit_5
   2311  9063		       20 51 a0 	      JSR	is_line_empty	; determines whether current line is empty.
   2312  9066							;
   2313  9066							; Entry:
   2314  9066							; detokenized line at $400...
   2315  9066							;
   2316  9066							; Exit:
   2317  9066							; C set	if line	empty.
   2318  9066		       90 03		      BCC	check_bit_5
   2319  9068		       4c a8 9d 	      JMP	loc_9DA8
   2320  906b
   2321  906b				   check_bit_5
   2322  906b
   2323  906b		       a5 49		      LDA	byte_49
   2324  906d		       29 20		      AND	#$20	; ' '
   2325  906f		       f0 06		      BEQ	check_bit_6
   2326  9071		       8d b3 06 	      STA	byte_6B3
   2327  9074		       20 c0 a8 	      JSR	sub_A8C0
   2328  9077
   2329  9077				   check_bit_6
   2330  9077
   2331  9077		       a5 49		      LDA	byte_49
   2332  9079		       29 40		      AND	#$40	; '@'
   2333  907b		       49 40		      EOR	#$40	; '@'
   2334  907d		       8d a7 06 	      STA	byte_6A7
   2335  9080		       4c b0 06 	      JMP	unk_6B0
   2336  9083
   2337  9083				   next_command
   2338  9083		       18		      CLC
   2339  9084		       a5 39		      LDA	byte_39	; ptr LSB
   2340  9086		       69 04		      ADC	#4	; add 4	(size of each entry)
   2341  9088		       85 39		      STA	byte_39
   2342  908a		       90 02		      BCC	command_ptr_ok
   2343  908c		       e6 3a		      INC	byte_3A
   2344  908e
   2345  908e				   command_ptr_ok
   2346  908e		       4c ef 8f 	      JMP	loc_8FEF
   2347  9091							; End of function execute_command
   2348  9091
   2349  9091
   2350  9091
   2351  9091
   2352  9091				   clear_5B1_to_600
   2353  9091
   2354  9091		       a9 00		      LDA	#0
   2355  9093		       85 15		      STA	byte_15
   2356  9095		       a9 b1		      LDA	#$B1	; #<unk_5B1
   2357  9097		       85 0c		      STA	byte_C
   2358  9099		       a9 05		      LDA	#5	; #>unk_5B1
   2359  909b		       85 0d		      STA	byte_D
   2360  909d		       a2 00		      LDX	#0
   2361  909f		       a0 4f		      LDY	#$4F
   2362  90a1		       a9 20		      LDA	#$20
   2363  90a3		       20 6c 8e 	      JSR	memset	; Set memory to	value.
   2364  90a6							;
   2365  90a6							; ($C) points to memory	to clear.
   2366  90a6							; X holds number of pages to clear.
   2367  90a6							; Y holds number of bytes to clear in Xth page.
   2368  90a6							; A holds value	to write.
   2369  90a6		       60		      RTS
   2370  90a7							; End of function clear_5B1_to_600
   2371  90a7
   2372  90a7
   2373  90a7
   2374  90a7							; A = error code
   2375  90a7
   2376  90a7				   get_error
   2377  90a7
   2378  90a7		       48		      PHA
   2379  90a8		       a5 15		      LDA	byte_15	; already got an error?
   2380  90aa		       f0 02		      BEQ	copy_error	; taken	if no error yet
   2381  90ac		       68		      PLA
   2382  90ad		       60		      RTS
   2383  90ae
   2384  90ae				   copy_error
   2385  90ae		       20 91 90 	      JSR	clear_5B1_to_600
   2386  90b1		       68		      PLA
   2387  90b2		       85 15		      STA	byte_15	; store	error code
   2388  90b4		       a9 fb		      LDA	#$FB	; #<error_messages_table
   2389  90b6		       85 0c		      STA	byte_C
   2390  90b8		       a9 85		      LDA	#$85	; #>error_messages_table
   2391  90ba		       85 0d		      STA	byte_D
   2392  90bc		       a0 00		      LDY	#0	; offset into errors table
   2393  90be		       a2 00		      LDX	#0	; current error	index
   2394  90c0
   2395  90c0				   find_error_loop
   2396  90c0
   2397  90c0		       b1 0c		      LDA	($C),Y	; next byte from table
   2398  90c2		       10 01		      BPL	loc_90C5	; taken	if still looking at the	current	error
   2399  90c4							; hit a negative char, so this means it's looking at the next error, so bump the error index.
   2400  90c4		       e8		      INX
   2401  90c5
   2402  90c5				   loc_90C5
   2403  90c5		       e4 15		      CPX	byte_15	; reached the desired error?
   2404  90c7		       f0 08		      BEQ	found_error	; taken	if desired error reached
   2405  90c9		       e6 0c		      INC	byte_C
   2406  90cb		       d0 f3		      BNE	find_error_loop
   2407  90cd		       e6 0d		      INC	byte_D
   2408  90cf		       d0 ef		      BNE	find_error_loop
   2409  90d1
   2410  90d1				   found_error
   2411  90d1		       a2 00		      LDX	#0
   2412  90d3
   2413  90d3				   copy_error_loop
   2414  90d3		       29 7f		      AND	#$7F	; mask out top bit (in case)
   2415  90d5		       9d b1 05 	      STA	unk_5B1,X	; store	in error message buffer
   2416  90d8		       c8		      INY		; next source byte...
   2417  90d9		       e8		      INX		; next dest byte...
   2418  90da		       b1 0c		      LDA	($C),Y	; load next byte from error table
   2419  90dc		       10 f5		      BPL	copy_error_loop	; taken	if haven't ended up in the next error
   2420  90de		       60		      RTS
   2421  90df							; End of function get_error
   2422  90df
   2423  90df
   2424  90df
   2425  90df
   2426  90df				   find_command
   2427  90df		       a5 4a		      LDA	current_line_no_lsb
   2428  90e1		       48		      PHA
   2429  90e2		       a5 4b		      LDA	current_line_no_msb
   2430  90e4		       48		      PHA
   2431  90e5		       a5 50		      LDA	byte_50
   2432  90e7		       48		      PHA
   2433  90e8		       a5 51		      LDA	byte_51
   2434  90ea		       48		      PHA
   2435  90eb		       a6 3f		      LDX	byte_3F	; get MSB of pointer to	arg
   2436  90ed		       e8		      INX		; X=0 if it was	FF before
   2437  90ee		       d0 05		      BNE	got_search_string	; branch taken if pointer to arg appears valid
   2438  90f0		       20 c9 94 	      JSR	get_search_string	; gets search	string.
   2439  90f3							;
   2440  90f3							; Exit:
   2441  90f3							; (byte_3E) points to result
   2442  90f3							; byte_6BE is length of	input excluding	final CR.
   2443  90f3							; C set	if nothing entered.
   2444  90f3		       b0 37		      BCS	loc_912C
   2445  90f5
   2446  90f5				   got_search_string
   2447  90f5		       ac be 06 	      LDY	byte_6BE
   2448  90f8		       84 62		      STY	byte_62	; ?byte_62 = search string length
   2449  90fa
   2450  90fa				   copy_search_string_loop
   2451  90fa		       88		      DEY
   2452  90fb		       b1 3e		      LDA	(byte_3E),Y
   2453  90fd		       99 43 06 	      STA	unk_643,Y
   2454  9100		       c0 00		      CPY	#0
   2455  9102		       d0 f6		      BNE	copy_search_string_loop
   2456  9104		       a9 00		      LDA	#0
   2457  9106		       8d af 06 	      STA	byte_6AF
   2458  9109							; point (byte_2B) at OSHWM
   2459  9109		       85 2b		      STA	byte_2B
   2460  910b		       a5 18		      LDA	oshwm+1
   2461  910d		       85 2c		      STA	byte_2C
   2462  910f
   2463  910f				   loc_910F
   2464  910f		       a9 00		      LDA	#0
   2465  9111		       85 3b		      STA	byte_3B	; reset	"found anything" flag
   2466  9113
   2467  9113				   loc_9113
   2468  9113		       a0 01		      LDY	#1	; index	of MSB of line number
   2469  9115		       84 10		      STY	cursor_offset	; offset of cursor in detokenized buffer
   2470  9117		       b1 2b		      LDA	(byte_2B),Y	; fetch	MSB of line number
   2471  9119		       10 2d		      BPL	line_valid	; branch taken if line appears valid
   2472  911b							; reached end of program
   2473  911b		       a5 3b		      LDA	byte_3B	; was anything found?
   2474  911d		       f0 03		      BEQ	loc_9122	; branch taken if nothing was found
   2475  911f		       4c a6 91 	      JMP	loc_91A6
   2476  9122
   2477  9122				   loc_9122
   2478  9122		       ad af 06 	      LDA	byte_6AF
   2479  9125		       d0 05		      BNE	loc_912C
   2480  9127		       a9 08		      LDA	#8	; "String not found"
   2481  9129		       20 a7 90 	      JSR	get_error	; A = error code
   2482  912c
   2483  912c				   loc_912C
   2484  912c
   2485  912c		       68		      PLA
   2486  912d		       85 2c		      STA	byte_2C
   2487  912f		       68		      PLA
   2488  9130		       85 2b		      STA	byte_2B
   2489  9132		       20 8f 9e 	      JSR	find_line_by_number	; finds a line, given a line number
   2490  9135							;
   2491  9135							; Entry:
   2492  9135							; byte_2B: line	number MSB
   2493  9135							; byte_2C: line	number LSB
   2494  9135							;
   2495  9135							; Exit:
   2496  9135							; (byte_2B) points to most suitable line
   2497  9135		       a5 2b		      LDA	byte_2B
   2498  9137		       8d c0 06 	      STA	byte_6C0
   2499  913a		       a5 2c		      LDA	byte_2C
   2500  913c		       8d c1 06 	      STA	byte_6C1
   2501  913f		       68		      PLA
   2502  9140		       85 4b		      STA	current_line_no_msb
   2503  9142		       68		      PLA
   2504  9143		       85 4a		      STA	current_line_no_lsb
   2505  9145		       4c 4d 81 	      JMP	loc_814D
   2506  9148
   2507  9148				   line_valid
   2508  9148		       20 08 9c 	      JSR	detokenize_one_line
   2509  914b		       20 60 92 	      JSR	sub_9260
   2510  914e		       90 50		      BCC	loc_91A0
   2511  9150		       ac af 06 	      LDY	byte_6AF
   2512  9153		       d0 35		      BNE	loc_918A
   2513  9155		       c8		      INY
   2514  9156		       8c af 06 	      STY	byte_6AF
   2515  9159		       20 28 9d 	      JSR	enter_edit_mode
   2516  915c		       ad bd 06 	      LDA	current_command_id
   2517  915f		       c9 e9		      CMP	#-$17	;	'é'
   2518  9161		       d0 27		      BNE	loc_918A
   2519  9163
   2520  9163				   loc_9163
   2521  9163		       20 39 a0 	      JSR	save_line_number	; saves line number from program.
   2522  9166							;
   2523  9166							; Entry:
   2524  9166							; (byte_2b) points to current line
   2525  9166							;
   2526  9166							; Exit:
   2527  9166							; current_line_no_lsb, current_line_no_msb = the line number
   2528  9166		       20 0e a0 	      JSR	cls_and_reset_6c0_to_6ff
   2529  9169		       a5 4a		      LDA	current_line_no_lsb
   2530  916b		       85 2b		      STA	byte_2B
   2531  916d		       a5 4b		      LDA	current_line_no_msb
   2532  916f		       85 2c		      STA	byte_2C
   2533  9171		       a9 00		      LDA	#0
   2534  9173		       85 3b		      STA	byte_3B
   2535  9175		       18		      CLC
   2536  9176		       20 ea 9d 	      JSR	sub_9DEA
   2537  9179		       a2 01		      LDX	#1
   2538  917b		       20 45 a0 	      JSR	get_line_ptr	; gets pointer to line visible on screen.
   2539  917e							;
   2540  917e							; Entry:
   2541  917e							; X = screen line number * 2 + 1
   2542  917e							;
   2543  917e							; Exit:
   2544  917e							; (byte_2B) points to BASIC line
   2545  917e							; X decremented
   2546  917e		       20 39 a0 	      JSR	save_line_number	; saves line number from program.
   2547  9181							;
   2548  9181							; Entry:
   2549  9181							; (byte_2b) points to current line
   2550  9181							;
   2551  9181							; Exit:
   2552  9181							; current_line_no_lsb, current_line_no_msb = the line number
   2553  9181		       20 69 a0 	      JSR	sub_A069
   2554  9184		       20 a8 a8 	      JSR	position_edit_mode_cursor
   2555  9187		       4c d8 9a 	      JMP	edit_mode_loop
   2556  918a
   2557  918a				   loc_918A
   2558  918a
   2559  918a		       a5 3b		      LDA	byte_3B
   2560  918c		       d0 03		      BNE	loc_9191
   2561  918e		       20 0e a0 	      JSR	cls_and_reset_6c0_to_6ff
   2562  9191
   2563  9191				   loc_9191
   2564  9191		       20 5f 9e 	      JSR	sub_9E5F
   2565  9194		       90 10		      BCC	loc_91A6
   2566  9196		       20 82 9e 	      JSR	sub_9E82
   2567  9199		       18		      CLC
   2568  919a		       a5 3b		      LDA	byte_3B
   2569  919c		       65 2d		      ADC	byte_2D
   2570  919e		       85 3b		      STA	byte_3B
   2571  91a0
   2572  91a0				   loc_91A0
   2573  91a0		       20 52 92 	      JSR	advance_2b_to_next_line
   2574  91a3		       4c 13 91 	      JMP	loc_9113
   2575  91a6
   2576  91a6				   loc_91A6
   2577  91a6
   2578  91a6		       a9 00		      LDA	#0
   2579  91a8		       85 3b		      STA	byte_3B
   2580  91aa
   2581  91aa				   loc_91AA
   2582  91aa
   2583  91aa		       a2 00		      LDX	#0
   2584  91ac		       a4 3b		      LDY	byte_3B
   2585  91ae		       20 01 8f 	      JSR	gotoxy
   2586  91b1		       20 82 be 	      JSR	sub_BE82
   2587  91b4		       c9 1b		      CMP	#$1B
   2588  91b6		       d0 03		      BNE	loc_91BB
   2589  91b8		       4c 2c 91 	      JMP	loc_912C
   2590  91bb
   2591  91bb				   loc_91BB
   2592  91bb		       c9 a7		      CMP	#-$59	;	'§'
   2593  91bd		       d0 06		      BNE	loc_91C5
   2594  91bf		       20 47 92 	      JSR	sub_9247
   2595  91c2		       4c a8 9d 	      JMP	loc_9DA8
   2596  91c5
   2597  91c5				   loc_91C5
   2598  91c5		       c9 af		      CMP	#-$51	;	'¯'
   2599  91c7		       d0 1a		      BNE	loc_91E3
   2600  91c9		       a5 3b		      LDA	byte_3B
   2601  91cb		       d0 11		      BNE	loc_91DE
   2602  91cd		       20 77 aa 	      JSR	sub_AA77	; swap byte_2B with unk_2F, swap byte_2C with unk_30
   2603  91d0		       85 2b		      STA	byte_2B
   2604  91d2		       85 2c		      STA	byte_2C
   2605  91d4		       20 69 ba 	      JSR	sub_BA69
   2606  91d7		       8a		      TXA
   2607  91d8		       4a		      LSR
   2608  91d9		       85 3b		      STA	byte_3B
   2609  91db		       20 77 aa 	      JSR	sub_AA77	; swap byte_2B with unk_2F, swap byte_2C with unk_30
   2610  91de
   2611  91de				   loc_91DE
   2612  91de		       c6 3b		      DEC	byte_3B
   2613  91e0		       4c aa 91 	      JMP	loc_91AA
   2614  91e3
   2615  91e3				   loc_91E3
   2616  91e3		       c9 ae		      CMP	#$AE
   2617  91e5		       d0 1c		      BNE	loc_9203
   2618  91e7		       a6 3b		      LDX	byte_3B
   2619  91e9		       e8		      INX
   2620  91ea		       ec bf 06 	      CPX	screen_height
   2621  91ed		       f0 06		      BEQ	loc_91F5
   2622  91ef		       90 04		      BCC	loc_91F5
   2623  91f1		       a2 00		      LDX	#0
   2624  91f3		       f0 09		      BEQ	loc_91FE
   2625  91f5
   2626  91f5				   loc_91F5
   2627  91f5
   2628  91f5		       8a		      TXA
   2629  91f6		       0a		      ASL
   2630  91f7		       a8		      TAY
   2631  91f8		       b9 c1 06 	      LDA	$6C1,Y
   2632  91fb		       d0 01		      BNE	loc_91FE
   2633  91fd		       aa		      TAX
   2634  91fe
   2635  91fe				   loc_91FE
   2636  91fe
   2637  91fe		       86 3b		      STX	byte_3B
   2638  9200
   2639  9200				   loc_9200
   2640  9200		       4c aa 91 	      JMP	loc_91AA
   2641  9203
   2642  9203				   loc_9203
   2643  9203		       c9 a5		      CMP	#$A5
   2644  9205		       d0 03		      BNE	loc_920A
   2645  9207		       4c 0f 91 	      JMP	loc_910F
   2646  920a
   2647  920a				   loc_920A
   2648  920a		       c9 a2		      CMP	#$A2
   2649  920c		       d0 03		      BNE	loc_9211
   2650  920e		       4c 5b a6 	      JMP	top_edit_mode_command
   2651  9211
   2652  9211				   loc_9211
   2653  9211		       c9 a3		      CMP	#$A3
   2654  9213		       d0 03		      BNE	loc_9218
   2655  9215		       4c 7f a6 	      JMP	end_edit_mode_command
   2656  9218
   2657  9218				   loc_9218
   2658  9218		       c9 c1		      CMP	#$C1
   2659  921a		       d0 12		      BNE	loc_922E
   2660  921c		       a5 2b		      LDA	byte_2B
   2661  921e		       48		      PHA
   2662  921f		       a5 2c		      LDA	byte_2C
   2663  9221		       48		      PHA
   2664  9222		       20 68 b3 	      JSR	goto_edit_mode_command
   2665  9225		       68		      PLA
   2666  9226		       85 2c		      STA	byte_2C
   2667  9228		       68		      PLA
   2668  9229		       85 2b		      STA	byte_2B
   2669  922b		       4c aa 91 	      JMP	loc_91AA
   2670  922e
   2671  922e				   loc_922E
   2672  922e		       c9 c0		      CMP	#$C0
   2673  9230		       d0 ce		      BNE	loc_9200
   2674  9232		       a5 2b		      LDA	byte_2B
   2675  9234		       48		      PHA
   2676  9235		       a5 2c		      LDA	byte_2C
   2677  9237		       48		      PHA
   2678  9238		       20 47 92 	      JSR	sub_9247
   2679  923b		       20 5d b3 	      JSR	mark_edit_mode_command
   2680  923e		       68		      PLA
   2681  923f		       85 2c		      STA	byte_2C
   2682  9241		       68		      PLA
   2683  9242		       85 2b		      STA	byte_2B
   2684  9244		       4c aa 91 	      JMP	loc_91AA
   2685  9247							; End of function find_command
   2686  9247
   2687  9247
   2688  9247
   2689  9247
   2690  9247				   sub_9247
   2691  9247
   2692  9247		       a5 3b		      LDA	byte_3B
   2693  9249		       0a		      ASL
   2694  924a		       aa		      TAX
   2695  924b		       e8		      INX
   2696  924c		       20 45 a0 	      JSR	get_line_ptr	; gets pointer to line visible on screen.
   2697  924f							;
   2698  924f							; Entry:
   2699  924f							; X = screen line number * 2 + 1
   2700  924f							;
   2701  924f							; Exit:
   2702  924f							; (byte_2B) points to BASIC line
   2703  924f							; X decremented
   2704  924f		       4c 39 a0 	      JMP	save_line_number	; saves line number from program.
   2705  9252							; End of function sub_9247		;
   2706  9252							; Entry:
   2707  9252							; (byte_2b) points to current line
   2708  9252							;
   2709  9252							; Exit:
   2710  9252							; current_line_no_lsb, current_line_no_msb = the line number
   2711  9252
   2712  9252
   2713  9252
   2714  9252				   advance_2b_to_next_line
   2715  9252
   2716  9252		       a0 03		      LDY	#3	; offset of line length
   2717  9254		       18		      CLC
   2718  9255		       b1 2b		      LDA	($2B),Y	; get line length
   2719  9257		       65 2b		      ADC	byte_2B
   2720  9259		       85 2b		      STA	byte_2B
   2721  925b		       90 02		      BCC	advance_2b_to_next_line_done
   2722  925d		       e6 2c		      INC	byte_2C
   2723  925f
   2724  925f				   advance_2b_to_next_line_done
   2725  925f		       60		      RTS
   2726  9260							; End of function advance_2b_to_next_line
   2727  9260
   2728  9260
   2729  9260
   2730  9260
   2731  9260				   sub_9260
   2732  9260
   2733  9260		       a5 10		      LDA	cursor_offset	; offset of cursor in detokenized buffer
   2734  9262		       cd 00 04 	      CMP	byte_400
   2735  9265		       f0 04		      BEQ	loc_926B
   2736  9267		       90 02		      BCC	loc_926B
   2737  9269
   2738  9269				   loc_9269
   2739  9269		       18		      CLC
   2740  926a
   2741  926a				   locret_926A
   2742  926a		       60		      RTS
   2743  926b
   2744  926b				   loc_926B
   2745  926b		       18		      CLC
   2746  926c		       6d be 06 	      ADC	byte_6BE
   2747  926f		       90 04		      BCC	loc_9275
   2748  9271		       c9 26		      CMP	#$26	; '&'
   2749  9273		       b0 f4		      BCS	loc_9269
   2750  9275
   2751  9275				   loc_9275
   2752  9275		       a5 10		      LDA	cursor_offset	; offset of cursor in detokenized buffer
   2753  9277		       18		      CLC
   2754  9278		       69 00		      ADC	#0
   2755  927a		       85 0c		      STA	byte_C
   2756  927c		       a9 00		      LDA	#0
   2757  927e		       69 04		      ADC	#4
   2758  9280		       85 0d		      STA	byte_D
   2759  9282		       a2 00		      LDX	#0
   2760  9284		       a0 00		      LDY	#0
   2761  9286
   2762  9286				   loc_9286
   2763  9286		       a1 0c		      LDA	($C,X)
   2764  9288		       d1 3e		      CMP	($3E),Y
   2765  928a		       d0 0e		      BNE	loc_929A
   2766  928c		       c8		      INY
   2767  928d		       e6 0c		      INC	byte_C
   2768  928f		       d0 02		      BNE	loc_9293
   2769  9291		       e6 0d		      INC	byte_D
   2770  9293
   2771  9293				   loc_9293
   2772  9293		       cc be 06 	      CPY	byte_6BE
   2773  9296		       b0 d2		      BCS	locret_926A
   2774  9298		       90 ec		      BCC	loc_9286
   2775  929a
   2776  929a				   loc_929A
   2777  929a		       e6 10		      INC	cursor_offset	; offset of cursor in detokenized buffer
   2778  929c		       d0 c2		      BNE	sub_9260
   2779  929e
   2780  929e				   change_or_qchange_command
   2781  929e		       a5 4a		      LDA	current_line_no_lsb
   2782  92a0		       48		      PHA
   2783  92a1		       a5 4b		      LDA	current_line_no_msb
   2784  92a3		       48		      PHA
   2785  92a4		       a5 50		      LDA	byte_50
   2786  92a6		       48		      PHA
   2787  92a7		       a5 51		      LDA	byte_51
   2788  92a9		       48		      PHA
   2789  92aa		       a6 3f		      LDX	byte_3F
   2790  92ac		       e8		      INX
   2791  92ad		       f0 59		      BEQ	loc_9308
   2792  92af		       a0 00		      LDY	#0
   2793  92b1
   2794  92b1				   loc_92B1
   2795  92b1		       b1 3e		      LDA	($3E),Y
   2796  92b3		       c9 20		      CMP	#$20	; ' '
   2797  92b5		       f0 0c		      BEQ	loc_92C3
   2798  92b7		       c9 0d		      CMP	#$D
   2799  92b9		       f0 03		      BEQ	loc_92BE
   2800  92bb		       c8		      INY
   2801  92bc		       d0 f3		      BNE	loc_92B1
   2802  92be
   2803  92be				   loc_92BE
   2804  92be		       a9 17		      LDA	#$17
   2805  92c0
   2806  92c0				   loc_92C0
   2807  92c0		       4c 9d 85 	      JMP	loc_859D
   2808  92c3
   2809  92c3				   loc_92C3
   2810  92c3		       8c be 06 	      STY	byte_6BE
   2811  92c6
   2812  92c6				   loc_92C6
   2813  92c6		       b1 3e		      LDA	($3E),Y
   2814  92c8		       c9 0d		      CMP	#$D
   2815  92ca		       f0 f2		      BEQ	loc_92BE
   2816  92cc		       c9 20		      CMP	#$20	; ' '
   2817  92ce		       d0 03		      BNE	loc_92D3
   2818  92d0		       c8		      INY
   2819  92d1		       d0 f3		      BNE	loc_92C6
   2820  92d3
   2821  92d3				   loc_92D3
   2822  92d3		       18		      CLC
   2823  92d4		       98		      TYA
   2824  92d5		       65 3e		      ADC	byte_3E
   2825  92d7		       8d ba 06 	      STA	unk_6BA
   2826  92da		       a5 3f		      LDA	byte_3F
   2827  92dc		       69 00		      ADC	#0
   2828  92de		       8d bb 06 	      STA	unk_6BB
   2829  92e1		       a2 00		      LDX	#0
   2830  92e3
   2831  92e3				   loc_92E3
   2832  92e3		       b1 3e		      LDA	($3E),Y
   2833  92e5		       c9 20		      CMP	#$20	; ' '
   2834  92e7		       f0 08		      BEQ	loc_92F1
   2835  92e9		       c9 0d		      CMP	#$D
   2836  92eb		       f0 15		      BEQ	loc_9302
   2837  92ed		       e8		      INX
   2838  92ee		       c8		      INY
   2839  92ef		       d0 f2		      BNE	loc_92E3
   2840  92f1
   2841  92f1				   loc_92F1
   2842  92f1		       b1 3e		      LDA	($3E),Y
   2843  92f3		       c9 0d		      CMP	#$D
   2844  92f5		       f0 0b		      BEQ	loc_9302
   2845  92f7		       c9 20		      CMP	#$20	; ' '
   2846  92f9		       d0 03		      BNE	loc_92FE
   2847  92fb		       c8		      INY
   2848  92fc		       d0 f3		      BNE	loc_92F1
   2849  92fe
   2850  92fe				   loc_92FE
   2851  92fe		       a9 18		      LDA	#$18
   2852  9300		       d0 be		      BNE	loc_92C0
   2853  9302
   2854  9302				   loc_9302
   2855  9302		       8e bc 06 	      STX	unk_6BC
   2856  9305		       4c 2c 93 	      JMP	loc_932C
   2857  9308
   2858  9308				   loc_9308
   2859  9308		       20 c9 94 	      JSR	get_search_string	; gets search	string.
   2860  930b							;
   2861  930b							; Exit:
   2862  930b							; (byte_3E) points to result
   2863  930b							; byte_6BE is length of	input excluding	final CR.
   2864  930b							; C set	if nothing entered.
   2865  930b		       b0 05		      BCS	loc_9312
   2866  930d		       20 de 94 	      JSR	get_replace_string
   2867  9310		       90 1a		      BCC	loc_932C
   2868  9312
   2869  9312				   loc_9312
   2870  9312
   2871  9312		       68		      PLA
   2872  9313		       85 2c		      STA	byte_2C
   2873  9315		       68		      PLA
   2874  9316		       85 2b		      STA	byte_2B
   2875  9318		       20 8f 9e 	      JSR	find_line_by_number	; finds a line, given a line number
   2876  931b							;
   2877  931b							; Entry:
   2878  931b							; byte_2B: line	number MSB
   2879  931b							; byte_2C: line	number LSB
   2880  931b							;
   2881  931b							; Exit:
   2882  931b							; (byte_2B) points to most suitable line
   2883  931b		       a5 2b		      LDA	byte_2B
   2884  931d		       8d c0 06 	      STA	byte_6C0
   2885  9320		       a5 2c		      LDA	byte_2C
   2886  9322		       8d c1 06 	      STA	byte_6C1
   2887  9325		       68		      PLA
   2888  9326		       85 4b		      STA	current_line_no_msb
   2889  9328		       68		      PLA
   2890  9329		       85 4a		      STA	current_line_no_lsb
   2891  932b		       60		      RTS
   2892  932c
   2893  932c				   loc_932C
   2894  932c		       a9 00		      LDA	#0
   2895  932e		       8d af 06 	      STA	byte_6AF
   2896  9331		       85 2b		      STA	byte_2B
   2897  9333		       a5 18		      LDA	oshwm+1
   2898  9335		       85 2c		      STA	byte_2C
   2899  9337
   2900  9337				   loc_9337
   2901  9337		       a0 00		      LDY	#0
   2902  9339		       8c b3 06 	      STY	byte_6B3
   2903  933c		       84 11		      STY	unk_11
   2904  933e		       c8		      INY
   2905  933f		       84 10		      STY	cursor_offset	; offset of cursor in detokenized buffer
   2906  9341		       b1 2b		      LDA	($2B),Y
   2907  9343		       30 24		      BMI	loc_9369
   2908  9345		       20 39 a0 	      JSR	save_line_number	; saves line number from program.
   2909  9348							;
   2910  9348							; Entry:
   2911  9348							; (byte_2b) points to current line
   2912  9348							;
   2913  9348							; Exit:
   2914  9348							; current_line_no_lsb, current_line_no_msb = the line number
   2915  9348		       20 08 9c 	      JSR	detokenize_one_line
   2916  934b
   2917  934b				   loc_934B
   2918  934b
   2919  934b		       20 60 92 	      JSR	sub_9260
   2920  934e		       b0 09		      BCS	loc_9359
   2921  9350		       20 cf 93 	      JSR	sub_93CF
   2922  9353		       20 52 92 	      JSR	advance_2b_to_next_line
   2923  9356		       4c 37 93 	      JMP	loc_9337
   2924  9359
   2925  9359				   loc_9359
   2926  9359		       ad bd 06 	      LDA	current_command_id
   2927  935c		       8d af 06 	      STA	byte_6AF
   2928  935f		       c9 e2		      CMP	#$E2
   2929  9361		       f0 1b		      BEQ	loc_937E
   2930  9363		       20 d3 bd 	      JSR	sub_BDD3
   2931  9366		       4c 4b 93 	      JMP	loc_934B
   2932  9369
   2933  9369				   loc_9369
   2934  9369		       ad af 06 	      LDA	byte_6AF
   2935  936c		       d0 a4		      BNE	loc_9312
   2936  936e		       68		      PLA
   2937  936f		       68		      PLA
   2938  9370		       68		      PLA
   2939  9371		       85 4b		      STA	current_line_no_msb
   2940  9373		       68		      PLA
   2941  9374		       85 4a		      STA	current_line_no_lsb
   2942  9376		       a9 08		      LDA	#8
   2943  9378		       20 a7 90 	      JSR	get_error	; A = error code
   2944  937b
   2945  937b				   loc_937B
   2946  937b		       4c 4d 81 	      JMP	loc_814D
   2947  937e
   2948  937e				   loc_937E
   2949  937e		       ad b7 06 	      LDA	editor_mode_id	; 1=command mode, 2=edit mode
   2950  9381		       c9 02		      CMP	#2
   2951  9383		       f0 03		      BEQ	loc_9388
   2952  9385		       20 28 9d 	      JSR	enter_edit_mode
   2953  9388
   2954  9388				   loc_9388
   2955  9388		       20 0e a0 	      JSR	cls_and_reset_6c0_to_6ff
   2956  938b		       a5 4a		      LDA	current_line_no_lsb
   2957  938d		       85 2b		      STA	byte_2B
   2958  938f		       a5 4b		      LDA	current_line_no_msb
   2959  9391		       85 2c		      STA	byte_2C
   2960  9393		       a9 00		      LDA	#0
   2961  9395		       85 3b		      STA	byte_3B
   2962  9397		       18		      CLC
   2963  9398		       20 ea 9d 	      JSR	sub_9DEA
   2964  939b		       a2 01		      LDX	#1
   2965  939d		       20 45 a0 	      JSR	get_line_ptr	; gets pointer to line visible on screen.
   2966  93a0							;
   2967  93a0							; Entry:
   2968  93a0							; X = screen line number * 2 + 1
   2969  93a0							;
   2970  93a0							; Exit:
   2971  93a0							; (byte_2B) points to BASIC line
   2972  93a0							; X decremented
   2973  93a0		       20 39 a0 	      JSR	save_line_number	; saves line number from program.
   2974  93a3							;
   2975  93a3							; Entry:
   2976  93a3							; (byte_2b) points to current line
   2977  93a3							;
   2978  93a3							; Exit:
   2979  93a3							; current_line_no_lsb, current_line_no_msb = the line number
   2980  93a3		       20 69 a0 	      JSR	sub_A069
   2981  93a6		       20 a8 a8 	      JSR	position_edit_mode_cursor
   2982  93a9
   2983  93a9				   loc_93A9
   2984  93a9		       20 82 be 	      JSR	sub_BE82
   2985  93ac		       c9 1b		      CMP	#$1B
   2986  93ae		       f0 cb		      BEQ	loc_937B
   2987  93b0		       c9 a7		      CMP	#$A7
   2988  93b2		       d0 03		      BNE	loc_93B7
   2989  93b4		       4c d8 9a 	      JMP	edit_mode_loop
   2990  93b7
   2991  93b7				   loc_93B7
   2992  93b7		       29 df		      AND	#$DF
   2993  93b9		       c9 59		      CMP	#$59
   2994  93bb		       d0 09		      BNE	loc_93C6
   2995  93bd		       20 d3 bd 	      JSR	sub_BDD3
   2996  93c0		       20 cf 93 	      JSR	sub_93CF
   2997  93c3		       4c 4b 93 	      JMP	loc_934B
   2998  93c6
   2999  93c6				   loc_93C6
   3000  93c6		       c9 4e		      CMP	#'N
   3001  93c8		       d0 df		      BNE	loc_93A9
   3002  93ca		       e6 10		      INC	cursor_offset	; offset of cursor in detokenized buffer
   3003  93cc		       4c 4b 93 	      JMP	loc_934B
   3004  93cf							; End of function sub_9260
   3005  93cf
   3006  93cf
   3007  93cf
   3008  93cf
   3009  93cf				   sub_93CF
   3010  93cf
   3011  93cf		       a5 2b		      LDA	byte_2B
   3012  93d1		       48		      PHA
   3013  93d2		       a5 2c		      LDA	byte_2C
   3014  93d4		       48		      PHA
   3015  93d5		       20 c0 a8 	      JSR	sub_A8C0
   3016  93d8		       68		      PLA
   3017  93d9		       85 2c		      STA	byte_2C
   3018  93db		       68		      PLA
   3019  93dc		       85 2b		      STA	byte_2B
   3020  93de		       60		      RTS
   3021  93df							; End of function sub_93CF
   3022  93df
   3023  93df
   3024  93df
   3025  93df
   3026  93df				   load_command
   3027  93df
   3028  93df		       a9 ff		      LDA	#$FF
   3029  93e1		       20 2f 94 	      JSR	loc_942F
   3030  93e4		       20 e4 a1 	      JSR	clear_line_commands
   3031  93e7		       20 58 b3 	      JSR	sub_B358
   3032  93ea		       20 c9 a6 	      JSR	reset_program_name
   3033  93ed		       a0 00		      LDY	#0
   3034  93ef
   3035  93ef				   loc_93EF
   3036  93ef		       b1 3e		      LDA	($3E),Y
   3037  93f1		       c9 0d		      CMP	#$D
   3038  93f3		       f0 08		      BEQ	loc_93FD
   3039  93f5		       99 52 00 	      STA	$52,Y
   3040  93f8		       c8		      INY
   3041  93f9		       c0 0f		      CPY	#$F
   3042  93fb		       d0 f2		      BNE	loc_93EF
   3043  93fd
   3044  93fd				   loc_93FD
   3045  93fd		       4c 14 83 	      JMP	sub_8314
   3046  9400							; End of function load_command
   3047  9400
   3048  9400
   3049  9400				   append_command
   3050  9400		       20 e9 9f 	      JSR	is_program_empty	; sets	C if no	program
   3051  9403		       b0 da		      BCS	load_command
   3052  9405		       20 6f 94 	      JSR	loc_946F
   3053  9408		       a9 ff		      LDA	#$FF
   3054  940a		       20 36 94 	      JSR	do_osfile
   3055  940d		       20 1f 83 	      JSR	find_program
   3056  9410		       90 12		      BCC	locret_9424
   3057  9412		       20 6f 94 	      JSR	loc_946F
   3058  9415		       86 0c		      STX	byte_C
   3059  9417		       84 0d		      STY	byte_D
   3060  9419		       a0 00		      LDY	#0
   3061  941b		       a9 0d		      LDA	#$D
   3062  941d		       91 0c		      STA	($C),Y
   3063  941f		       c8		      INY
   3064  9420		       a9 ff		      LDA	#$FF
   3065  9422		       91 0c		      STA	($C),Y
   3066  9424
   3067  9424				   locret_9424
   3068  9424		       60		      RTS
   3069  9425
   3070  9425
   3071  9425
   3072  9425				   save_command
   3073  9425		       a5 12		      LDA	TOP
   3074  9427		       85 27		      STA	byte_27	; save end address LSB
   3075  9429		       a5 13		      LDA	TOP+1
   3076  942b		       85 28		      STA	byte_28	; save end address MSB
   3077  942d		       a9 00		      LDA	#0	; OSFILE save memory block
   3078  942f
   3079  942f				   loc_942F
   3080  942f		       a6 17		      LDX	oshwm
   3081  9431		       a4 18		      LDY	oshwm+1
   3082  9433		       4c 36 94 	      JMP	do_osfile
   3083  9436
   3084  9436				   do_osfile
   3085  9436		       48		      PHA		; save OSFILE code
   3086  9437		       a5 3e		      LDA	byte_3E
   3087  9439		       85 19		      STA	readline_ptr_lsb	; filename ptr	LSB
   3088  943b		       a5 3f		      LDA	byte_3F
   3089  943d		       85 1a		      STA	readline_ptr_msb	; filename ptr	MSB
   3090  943f		       86 1b		      STX	unk_1B	; load address LSB
   3091  9441		       86 1f		      STX	unk_1F	; exec address LSB
   3092  9443		       86 23		      STX	byte_23	; save start address LSB
   3093  9445		       84 1c		      STY	unk_1C	; load address MSB
   3094  9447		       84 20		      STY	byte_20	; exec address MSB
   3095  9449		       84 24		      STY	byte_24	; save start address MSB
   3096  944b		       ad b4 06 	      LDA	higher_order_address
   3097  944e		       85 1d		      STA	unk_1D	; load address bits 16...23
   3098  9450		       85 21		      STA	byte_21	; exec address bits 16...23
   3099  9452		       85 25		      STA	byte_25	; save start address bits 16...23
   3100  9454		       85 29		      STA	unk_29	; save end address bits	16...23
   3101  9456		       ad b5 06 	      LDA	higher_order_address+1
   3102  9459		       85 1e		      STA	unk_1E	; load address bits 24...31
   3103  945b		       85 22		      STA	byte_22	; exec address bits 24...31
   3104  945d		       85 26		      STA	byte_26	; save start address bits 24...31
   3105  945f		       85 2a		      STA	unk_2A	; save end address bits	24...31
   3106  9461		       68		      PLA		; get OSFILE code
   3107  9462		       aa		      TAX		; OSFILE code in X
   3108  9463		       e8		      INX		; 1 if load, 0 if save
   3109  9464		       d0 02		      BNE	call_osfile	; branch if not	save
   3110  9466		       86 1f		      STX	unk_1F	; when loading - use load address provided, not	file's default
   3111  9468
   3112  9468				   call_osfile
   3113  9468		       a2 19		      LDX	#$19
   3114  946a		       a0 00		      LDY	#0
   3115  946c		       4c dd ff 	      JMP	OSFILE	; OSFILE
   3116  946f							; End of function save_command
   3117  946f
   3118  946f
   3119  946f				   loc_946F
   3120  946f		       a4 13		      LDY	TOP+1
   3121  9471		       38		      SEC
   3122  9472		       a5 12		      LDA	TOP
   3123  9474		       e9 02		      SBC	#2
   3124  9476		       aa		      TAX
   3125  9477		       b0 01		      BCS	locret_947A
   3126  9479		       88		      DEY
   3127  947a
   3128  947a				   locret_947A
   3129  947a		       60		      RTS
   3130  947b
   3131  947b
   3132  947b							; entry: ($19) points to buffer
   3133  947b							;
   3134  947b							; exit:	C=0 if Return, C=1 if Escape
   3135  947b							; A is line length+1
   3136  947b
   3137  947b				   read_line
   3138  947b
   3139  947b		       85 1b		      STA	unk_1B	; maximum line length
   3140  947d		       a9 20		      LDA	#$20
   3141  947f		       85 1c		      STA	unk_1C	; min acceptable char
   3142  9481		       a9 ff		      LDA	#$FF
   3143  9483		       85 1d		      STA	unk_1D	; max acceptable char
   3144  9485		       a9 00		      LDA	#0	; read input line
   3145  9487		       a2 19		      LDX	#$19
   3146  9489		       a0 00		      LDY	#0
   3147  948b		       20 f1 ff 	      JSR	OSWORD
   3148  948e		       08		      PHP
   3149  948f		       c8		      INY
   3150  9490		       98		      TYA
   3151  9491		       48		      PHA
   3152  9492		       90 03		      BCC	loc_9497
   3153  9494		       20 e7 ff 	      JSR	OSNEWL
   3154  9497
   3155  9497				   loc_9497
   3156  9497		       20 29 95 	      JSR	clear_escape_condition
   3157  949a		       68		      PLA
   3158  949b		       28		      PLP
   3159  949c		       60		      RTS
   3160  949d							; End of function read_line
   3161  949d
   3162  949d
   3163  949d
   3164  949d							; read <100 chars to $700; points (byte_3E) at result, sets byte_6BE to	length.
   3165  949d
   3166  949d				   read_line_700
   3167  949d		       a9 00		      LDA	#0
   3168  949f		       85 19		      STA	readline_ptr_lsb
   3169  94a1		       85 3e		      STA	byte_3E
   3170  94a3		       a9 07		      LDA	#7
   3171  94a5		       85 1a		      STA	readline_ptr_msb
   3172  94a7		       85 3f		      STA	byte_3F
   3173  94a9		       a9 64		      LDA	#$64	; 'd'
   3174  94ab		       20 7b 94 	      JSR	read_line
   3175  94ae		       8d be 06 	      STA	byte_6BE
   3176  94b1		       60		      RTS
   3177  94b2							; End of function read_line_700
   3178  94b2
   3179  94b2
   3180  94b2
   3181  94b2
   3182  94b2				   read_line_780
   3183  94b2		       a9 80		      LDA	#$80
   3184  94b4		       85 19		      STA	readline_ptr_lsb
   3185  94b6		       8d ba 06 	      STA	unk_6BA
   3186  94b9		       a9 07		      LDA	#7
   3187  94bb		       85 1a		      STA	readline_ptr_msb
   3188  94bd		       8d bb 06 	      STA	unk_6BB
   3189  94c0		       a9 64		      LDA	#$64
   3190  94c2		       20 7b 94 	      JSR	read_line
   3191  94c5		       8d bc 06 	      STA	unk_6BC
   3192  94c8		       60		      RTS
   3193  94c9							; End of function read_line_780
   3194  94c9
   3195  94c9
   3196  94c9
   3197  94c9							; gets search string.
   3198  94c9							;
   3199  94c9							; Exit:
   3200  94c9							; (byte_3E) points to result
   3201  94c9							; byte_6BE is length of	input excluding	final CR.
   3202  94c9							; C set	if nothing entered.
   3203  94c9
   3204  94c9				   get_search_string
   3205  94c9
   3206  94c9		       a2 43		      LDX	#$43	; #<aSearchString
   3207  94cb		       a0 89		      LDY	#$89	; #>aSearchString
   3208  94cd		       a9 13		      LDA	#$13
   3209  94cf		       20 0e 8f 	      JSR	print_n_chars
   3210  94d2		       20 9d 94 	      JSR	read_line_700	; read <100 chars to $700; points (byte_3E) at result, sets byte_6BE to	length.
   3211  94d5		       b0 06		      BCS	locret_94DD
   3212  94d7		       ce be 06 	      DEC	byte_6BE	; ignore 13
   3213  94da		       d0 01		      BNE	locret_94DD
   3214  94dc		       38		      SEC		; set carry if empty
   3215  94dd
   3216  94dd				   locret_94DD
   3217  94dd
   3218  94dd		       60		      RTS
   3219  94de							; End of function get_search_string
   3220  94de
   3221  94de
   3222  94de
   3223  94de
   3224  94de				   get_replace_string
   3225  94de		       a2 56		      LDX	#$56	; #<aReplaceString
   3226  94e0		       a0 89		      LDY	#$89	; #>aReplaceString
   3227  94e2		       a9 13		      LDA	#$13
   3228  94e4		       20 0e 8f 	      JSR	print_n_chars
   3229  94e7		       20 b2 94 	      JSR	read_line_780
   3230  94ea		       ce bc 06 	      DEC	unk_6BC	; ignore 13
   3231  94ed		       60		      RTS
   3232  94ee							; End of function get_replace_string
   3233  94ee
   3234  94ee
   3235  94ee
   3236  94ee
   3237  94ee				   reset_keys_settings
   3238  94ee
   3239  94ee		       a2 00		      LDX	#0	; Enable cursor	editing	(default)
   3240  94f0		       a9 04		      LDA	#4	; Enable/disable cursor	editing	(AUG P120)
   3241  94f2		       20 f4 ff 	      JSR	OSBYTE
   3242  94f5		       a2 09		      LDX	#9
   3243  94f7		       a9 db		      LDA	#219	; set TAB key to 9
   3244  94f9		       20 91 8e 	      JSR	osbyte_with_y0
   3245  94fc		       20 f6 9b 	      JSR	kbflush
   3246  94ff		       a2 01		      LDX	#1
   3247  9501		       a9 e1		      LDA	#225	; reset	F key status?
   3248  9503		       20 91 8e 	      JSR	osbyte_with_y0
   3249  9506		       a2 80		      LDX	#128
   3250  9508		       a9 e2		      LDA	#226	; reset	Shift+F	key status?
   3251  950a		       20 91 8e 	      JSR	osbyte_with_y0
   3252  950d		       a2 00		      LDX	#0
   3253  950f		       a9 e3		      LDA	#227
   3254  9511		       4c 91 8e 	      JMP	osbyte_with_y0
   3255  9514							; End of function reset_keys_settings
   3256  9514
   3257  9514
   3258  9514
   3259  9514
   3260  9514				   run_star_command
   3261  9514		       a2 07		      LDX	#7
   3262  9516		       20 c1 81 	      JSR	get_HIMEM_for_mode_X
   3263  9519		       20 ee 94 	      JSR	reset_keys_settings
   3264  951c		       a2 00		      LDX	#0
   3265  951e		       a0 07		      LDY	#7
   3266  9520		       20 f7 ff 	      JSR	OSCLI
   3267  9523		       4c 91 90 	      JMP	clear_5B1_to_600
   3268  9526							; End of function run_star_command
   3269  9526
   3270  9526
   3271  9526
   3272  9526
   3273  9526				   getch
   3274  9526
   3275  9526		       20 e0 ff 	      JSR	OSRDCH
   3276  9529							; End of function getch
   3277  9529
   3278  9529
   3279  9529
   3280  9529
   3281  9529				   clear_escape_condition
   3282  9529		       48		      PHA
   3283  952a		       a9 7e		      LDA	#$7E	; '~'
   3284  952c		       20 f4 ff 	      JSR	OSBYTE
   3285  952f		       68		      PLA
   3286  9530							; End of function clear_escape_condition
   3287  9530
   3288  9530		       60		      RTS
   3289  9531		       20	   command_jump_table dc.b	$20	; unknown
   3290  9532		       e5		      dc.b	CMD_return_key	; command_id
   3291  9533		       51 af		      .WORD.w	return_key_command	; address
   3292  9535		       24		      dc.b	$24	; unknown
   3293  9536		       a8		      dc.b	CMD_IE	; command_id
   3294  9537		       8d b0		      .WORD.w	ie_cmd	; address
   3295  9539		       24		      dc.b	$24	; unknown
   3296  953a		       b8		      dc.b	CMD_IT	; command_id
   3297  953b		       6c b0		      .WORD.w	it_cmd	; address
   3298  953d		       08		      dc.b	8	; unknown
   3299  953e		       1b		      dc.b	$1B	; command_id
   3300  953f		       4d 81		      .WORD.w	loc_814D	; address
   3301  9541		       00		      dc.b	0	; unknown
   3302  9542		       a1		      dc.b	CMD_toggle_insert_overtype	; command_id
   3303  9543		       d1 a5		      .WORD.w	toggle_insert_overtype_command	; address
   3304  9545		       19		      dc.b	$19	; unknown
   3305  9546		       a2		      dc.b	$A2	; command_id
   3306  9547		       5b a6		      .WORD.w	top_edit_mode_command	; address
   3307  9549		       19		      dc.b	$19	; unknown
   3308  954a		       a3		      dc.b	CMD_f2_key	; command_id
   3309  954b		       7f a6		      .WORD.w	end_edit_mode_command	; address
   3310  954d		       19		      dc.b	$19	; unknown
   3311  954e		       a4		      dc.b	CMD_f4_key	; command_id
   3312  954f		       18 a7		      .WORD.w	renumber_edit_mode_command	; address
   3313  9551		       0a		      dc.b	$A	; unknown
   3314  9552		       a9		      dc.b	CMD_EXIT	; command_id
   3315  9553		       fe a5		      .WORD.w	run_or_exit_command	; address
   3316  9555		       02		      dc.b	2	; unknown
   3317  9556		       b0		      dc.b	CMD_NEW	; command_id
   3318  9557		       b8 a6		      .WORD.w	new_command	; address
   3319  9559		       01		      dc.b	1	; unknown
   3320  955a		       b1		      dc.b	CMD_OLD	; command_id
   3321  955b		       d3 a6		      .WORD.w	old_command	; address
   3322  955d		       00		      dc.b	0	; unknown
   3323  955e		       b2		      dc.b	CMD_shift_f2_key	; command_id
   3324  955f		       1e a7		      .WORD.w	undo_edit_mode_command	; address
   3325  9561		       00		      dc.b	0	; unknown
   3326  9562		       b4		      dc.b	CMD_shift_f4_key	; command_id
   3327  9563		       ec a6		      .WORD.w	extend_statement_edit_mode_command	; address
   3328  9565		       00		      dc.b	0	;
   3329  9566		       b3		      dc.b	CMD_shift_f3_key
   3330  9567		       fa a6		      .WORD.w	swap_case_edit_mode_command
   3331  9569		       19		      dc.b	$19	; unknown
   3332  956a		       a7		      dc.b	$A7	; command_id
   3333  956b		       4e a7		      .WORD.w	top_of_screen_edit_mode_command	; address
   3334  956d		       00		      dc.b	0	; unknown
   3335  956e		       a0		      dc.b	$A0	; command_id
   3336  956f		       6f ac		      .WORD.w	execute_edit_mode_command	; address
   3337  9571		       08		      dc.b	8	; unknown
   3338  9572		       b5		      dc.b	CMD_shift_f5_key	; command_id
   3339  9573		       2a b3		      .WORD.w	mode_edit_mode_command	; address
   3340  9575		       00		      dc.b	0	; unknown
   3341  9576		       c7		      dc.b	$C7	; command_id
   3342  9577		       e5 a5		      .WORD.w	background_edit_mode_command	; address
   3343  9579		       00		      dc.b	0	; unknown
   3344  957a		       c8		      dc.b	$C8	; command_id
   3345  957b		       e9 a5		      .WORD.w	foreground_edit_mode_command	; address
   3346  957d		       00		      dc.b	0	; unknown
   3347  957e		       a6		      dc.b	$A6	; command_id
   3348  957f		       eb aa		      .WORD.w	delete_to_end_of_line_edit_mode_command	; address
   3349  9581		       01		      dc.b	1	; unknown
   3350  9582		       e6		      dc.b	CMD_delete_key	; command_id
   3351  9583		       88 aa		      .WORD.w	delete_key_command	; address
   3352  9585		       01		      dc.b	1	; unknown
   3353  9586		       e7		      dc.b	CMD_shift_delete_key	; command_id
   3354  9587		       c8 aa		      .WORD.w	loc_AAC8	; address
   3355  9589		       00		      dc.b	0	; unknown
   3356  958a		       ac		      dc.b	$AC	; command_id
   3357  958b		       59 a7		      .WORD.w	cursor_left_edit_mode_command	; address
   3358  958d		       00		      dc.b	0	; unknown
   3359  958e		       ad		      dc.b	$AD	; command_id
   3360  958f		       84 a7		      .WORD.w	cursor_right_edit_mode_command	; address
   3361  9591		       00		      dc.b	0	; unknown
   3362  9592		       ae		      dc.b	$AE	; command_id
   3363  9593		       ca a7		      .WORD.w	cursor_down_edit_mode_command	; address
   3364  9595		       00		      dc.b	0	; unknown
   3365  9596		       af		      dc.b	$AF	; command_id
   3366  9597		       20 a8		      .WORD.w	cursor_up_edit_mode_command	; address
   3367  9599		       00		      dc.b	0	; unknown
   3368  959a		       bc		      dc.b	$BC	; command_id
   3369  959b		       a5 a7		      .WORD.w	shift_cursor_left_edit_mode_command	; address
   3370  959d		       00		      dc.b	0	; unknown
   3371  959e		       bd		      dc.b	$BD	; command_id
   3372  959f		       ab a7		      .WORD.w	shift_cursor_right_edit_mode_command	; address
   3373  95a1		       18		      dc.b	$18	; unknown
   3374  95a2		       be		      dc.b	$BE	; command_id
   3375  95a3		       95 a8		      .WORD.w	shift_cursor_down_edit_mode_command	; address
   3376  95a5		       18		      dc.b	$18	; unknown
   3377  95a6		       bf		      dc.b	$BF	; command_id
   3378  95a7		       7d a8		      .WORD.w	shift_cursor_up_edit_mode_command	; address
   3379  95a9		       00		      dc.b	0	; unknown
   3380  95aa		       cc		      dc.b	$CC	; command_id
   3381  95ab		       b1 a7		      .WORD.w	ctrl_cursor_left_edit_mode_command	; address
   3382  95ad		       00		      dc.b	0	; unknown
   3383  95ae		       cd		      dc.b	$CD	; command_id
   3384  95af		       b7 a7		      .WORD.w	ctrl_cursor_right_edit_mode_command	; address
   3385  95b1		       10		      dc.b	$10	; unknown
   3386  95b2		       ce		      dc.b	$CE	; command_id
   3387  95b3		       5a a8		      .WORD.w	ctrl_cursor_down_edit_mode_command	; address
   3388  95b5		       10		      dc.b	$10	; unknown
   3389  95b6		       cf		      dc.b	$CF	; command_id
   3390  95b7		       44 a8		      .WORD.w	ctrl_cursor_up_edit_mode_command	;	address
   3391  95b9		       02		      dc.b	2	; unknown
   3392  95ba		       dd		      dc.b	CMD_LOAD	; command_id
   3393  95bb		       df 93		      .WORD.w	load_command	; address
   3394  95bd		       00		      dc.b	0	; unknown
   3395  95be		       de		      dc.b	CMD_APPEND	; command_id
   3396  95bf		       00 94		      .WORD.w	append_command	; address
   3397  95c1		       00		      dc.b	0	; unknown
   3398  95c2		       df		      dc.b	CMD_SAVE	; command_id
   3399  95c3		       25 94		      .WORD.w	save_command	; address
   3400  95c5		       00		      dc.b	0	; unknown
   3401  95c6		       e0		      dc.b	CMD_FIND	; command_id
   3402  95c7		       df 90		      .WORD.w	find_command	; address
   3403  95c9		       40		      dc.b	$40	; unknown
   3404  95ca		       e1		      dc.b	CMD_CHANGE	; command_id
   3405  95cb		       9e 92		      .WORD.w	change_or_qchange_command	; address
   3406  95cd		       40		      dc.b	$40	; unknown
   3407  95ce		       e2		      dc.b	CMD_QCHANGE	; command_id
   3408  95cf		       9e 92		      .WORD.w	change_or_qchange_command	; address
   3409  95d1		       02		      dc.b	2	; unknown
   3410  95d2		       e3		      dc.b	CMD_star	; command_id
   3411  95d3		       14 95		      .WORD.w	run_star_command	; address
   3412  95d5		       00		      dc.b	0	; unknown
   3413  95d6		       03		      dc.b	3	; command_id
   3414  95d7		       ed a1		      .WORD.w	set_primary_line_command	;	address
   3415  95d9		       00		      dc.b	0	; unknown
   3416  95da		       04		      dc.b	4	; command_id
   3417  95db		       ed a1		      .WORD.w	set_primary_line_command	;	address
   3418  95dd		       00		      dc.b	0	; unknown
   3419  95de		       0d		      dc.b	$D	; command_id
   3420  95df		       ed a1		      .WORD.w	set_primary_line_command	;	address
   3421  95e1		       01		      dc.b	1	; unknown
   3422  95e2		       01		      dc.b	1	; command_id
   3423  95e3		       45 a2		      .WORD.w	loc_A245	; address
   3424  95e5		       01		      dc.b	1	; unknown
   3425  95e6		       02		      dc.b	2	; command_id
   3426  95e7		       45 a2		      .WORD.w	loc_A245	; address
   3427  95e9		       01		      dc.b	1	; unknown
   3428  95ea		       05		      dc.b	5	; command_id
   3429  95eb		       45 a2		      .WORD.w	loc_A245	; address
   3430  95ed		       01		      dc.b	1	; unknown
   3431  95ee		       14		      dc.b	$14	; command_id
   3432  95ef		       45 a2		      .WORD.w	loc_A245	; address
   3433  95f1		       01		      dc.b	1	; unknown
   3434  95f2		       12		      dc.b	$12	; command_id
   3435  95f3		       58 a2		      .WORD.w	loc_A258	; address
   3436  95f5		       00		      dc.b	0	; unknown
   3437  95f6		       63		      dc.b	$63	; command_id
   3438  95f7		       39 ad		      .WORD.w	loc_AD39	; address
   3439  95f9		       00		      dc.b	0	; unknown
   3440  95fa		       64		      dc.b	$64	; command_id
   3441  95fb		       b9 ae		      .WORD.w	loc_AEB9	; address
   3442  95fd		       00		      dc.b	0	; unknown
   3443  95fe		       6d		      dc.b	$6D	; command_id
   3444  95ff		       39 ad		      .WORD.w	loc_AD39	; address
   3445  9601		       00		      dc.b	0	; unknown
   3446  9602		       ab		      dc.b	$AB	; command_id
   3447  9603		       3b a7		      .WORD.w	copy_key_edit_mode_command	; address
   3448  9605		       00		      dc.b	0	; unknown
   3449  9606		       db		      dc.b	CMD_tab_key	; command_id
   3450  9607		       1b 97		      .WORD.w	tab_key_command	; address
   3451  9609		       00		      dc.b	0	; unknown
   3452  960a		       d0		      dc.b	CMD_RUN	; command_id
   3453  960b		       fe a5		      .WORD.w	run_or_exit_command	; address
   3454  960d		       00		      dc.b	0	; unknown
   3455  960e		       d1		      dc.b	CMD_MODE	; command_id
   3456  960f		       f8 b2		      .WORD.w	mode_command	; address
   3457  9611		       00		      dc.b	0	; unknown
   3458  9612		       c0		      dc.b	$C0	; command_id
   3459  9613		       5d b3		      .WORD.w	mark_edit_mode_command	; address
   3460  9615		       1d		      dc.b	$1D	; unknown
   3461  9616		       c1		      dc.b	$C1	; command_id
   3462  9617		       68 b3		      .WORD.w	goto_edit_mode_command	; address
   3463  9619		       40		      dc.b	$40	; unknown
   3464  961a		       d2		      dc.b	CMD_NUMBER	; command_id
   3465  961b		       ab b3		      .WORD.w	number_command	; address
   3466  961d		       40		      dc.b	$40	; unknown
   3467  961e		       d3		      dc.b	CMD_LABEL	; command_id
   3468  961f		       b3 b5		      .WORD.w	label_command	; address
   3469  9621		       00		      dc.b	0	; unknown
   3470  9622		       c2		      dc.b	$C2	; command_id
   3471  9623		       f6 97		      .WORD.w	split_statement_edit_mode_command	; address
   3472  9625		       01		      dc.b	1	; unknown
   3473  9626		       c3		      dc.b	$C3	; command_id
   3474  9627		       22 b9		      .WORD.w	join_statements_edit_mode_command	; address
   3475  9629		       21		      dc.b	$21	; unknown
   3476  962a		       c4		      dc.b	$C4	; command_id
   3477  962b		       4b 99		      .WORD.w	repeat_edit_mode_command	;	address
   3478  962d		       00		      dc.b	0	; unknown
   3479  962e		       c5		      dc.b	CMD_SCROLL	; command_id
   3480  962f		       dc a5		      .WORD.w	scroll_command	; address
   3481  9631		       00		      dc.b	0	; unknown
   3482  9632		       c6		      dc.b	CMD_NOSCROLL	; command_id
   3483  9633		       e1 a5		      .WORD.w	noscroll_command	; address
   3484  9635		       02		      dc.b	2	; unknown
   3485  9636		       d4		      dc.b	CMD_HELP	; command_id
   3486  9637		       b8 ba		      .WORD.w	help_command	; address
   3487  9639		       00		      dc.b	0	; unknown
   3488  963a		       d6		      dc.b	CMD_FORE	; command_id
   3489  963b		       ab ba		      .WORD.w	fore_command	; address
   3490  963d		       00		      dc.b	0	; unknown
   3491  963e		       d5		      dc.b	CMD_BACK	; command_id
   3492  963f		       8b ba		      .WORD.w	back_command	; address
   3493  9641		       00		      dc.b	0	; unknown
   3494  9642		       d7		      dc.b	CMD_INSERT	; command_id
   3495  9643		       af ba		      .WORD.w	insert_command	; address
   3496  9645		       00		      dc.b	0	; unknown
   3497  9646		       d8		      dc.b	CMD_OVERTYPE	; command_id
   3498  9647		       b4 ba		      .WORD.w	overtype_command	; address
   3499  9649		       02		      dc.b	2	; unknown
   3500  964a		       d9		      dc.b	CMD_INFO	; command_id
   3501  964b		       b3 bb		      .WORD.w	info_command	; address
   3502  964d		       49		      dc.b	$49	; unknown
   3503  964e		       b6		      dc.b	CMD_shift_f6_key	; command_id
   3504  964f		       fc b5		      .WORD.w	label_edit_mode_command	; address
   3505  9651		       49		      dc.b	$49	; unknown
   3506  9652		       b7		      dc.b	CMD_shift_f7_key	; command_id
   3507  9653		       0b b6		      .WORD.w	number_edit_mode_command	;	address
   3508  9655		       14		      dc.b	$14	; unknown
   3509  9656		       da		      dc.b	CMD_goto_line	; command_id
   3510  9657		       99 bb		      .WORD.w	loc_BB99	; address
   3511  9659		       00		      dc.b	0	; unknown
   3512  965a		       dc		      dc.b	CMD_RENUMBER	; command_id
   3513  965b		       d6 99		      .WORD.w	renumber_command	; address
   3514  965d		       00		      dc.b	0	; unknown
   3515  965e		       e4		      dc.b	CMD_TAB	; command_id
   3516  965f		       71 97		      .WORD.w	tab_command	; address
   3517  9661		       00		      dc.b	0	; unknown
   3518  9662		       e8		      dc.b	CMD_GOTO	; command_id
   3519  9663		       9b b3		      .WORD.w	goto_command	; address
   3520  9665		       08		      dc.b	8	; unknown
   3521  9666		       a5		      dc.b	$A5	; command_id
   3522  9667		       8b 97		      .WORD.w	continue_edit_mode_command	; address
   3523  9669		       00		      dc.b	0	; unknown
   3524  966a		       e9		      dc.b	CMD_EDIT	; command_id
   3525  966b		       df 90		      .WORD.w	find_command	; address
   3526  966d		       14		      dc.b	$14	; unknown
   3527  966e		       ea		      dc.b	CMD_TOP	; command_id
   3528  966f		       72 a6		      .WORD.w	top_command	; address
   3529  9671		       14		      dc.b	$14	; unknown
   3530  9672		       eb		      dc.b	CMD_END	; command_id
   3531  9673		       78 a6		      .WORD.w	end_command	; address
   3532  9675		       00		      dc.b	0	; unknown
   3533  9676		       ec		      dc.b	CMD_shift_tab_key	; command_id
   3534  9677		       83 97		      .WORD.w	loc_9783	; address
   3535  9679		       ff		      dc.b	$FF	;
   3536  967a
   3537  967a				   loc_967A
   3538  967a		       20 98 96 	      JSR	sub_9698
   3539  967d		       b0 16		      BCS	loc_9695
   3540  967f		       a5 4a		      LDA	current_line_no_lsb
   3541  9681		       48		      PHA
   3542  9682		       a5 4b		      LDA	current_line_no_msb
   3543  9684		       48		      PHA
   3544  9685		       20 06 97 	      JSR	sub_9706
   3545  9688		       38		      SEC
   3546  9689		       20 ea 9d 	      JSR	sub_9DEA
   3547  968c		       68		      PLA
   3548  968d		       85 4b		      STA	current_line_no_msb
   3549  968f		       68		      PLA
   3550  9690		       85 4a		      STA	current_line_no_lsb
   3551  9692		       4c d8 9f 	      JMP	sub_9FD8
   3552  9695
   3553  9695				   loc_9695
   3554  9695		       4c a8 9d 	      JMP	loc_9DA8
   3555  9698
   3556  9698
   3557  9698
   3558  9698				   sub_9698
   3559  9698		       ad c0 06 	      LDA	byte_6C0
   3560  969b		       85 27		      STA	byte_27
   3561  969d		       ad c1 06 	      LDA	byte_6C1
   3562  96a0		       85 28		      STA	byte_28
   3563  96a2		       c9 ff		      CMP	#-1
   3564  96a4		       f0 15		      BEQ	loc_96BB
   3565  96a6		       a0 01		      LDY	#1
   3566  96a8		       a5 4a		      LDA	current_line_no_lsb
   3567  96aa		       d1 27		      CMP	($27),Y
   3568  96ac		       b0 02		      BCS	loc_96B0
   3569  96ae
   3570  96ae				   loc_96AE
   3571  96ae		       38		      SEC
   3572  96af		       60		      RTS
   3573  96b0
   3574  96b0				   loc_96B0
   3575  96b0		       d0 0b		      BNE	loc_96BD
   3576  96b2		       c8		      INY
   3577  96b3		       a5 4b		      LDA	current_line_no_msb
   3578  96b5		       d1 27		      CMP	($27),Y
   3579  96b7		       90 f5		      BCC	loc_96AE
   3580  96b9		       d0 02		      BNE	loc_96BD
   3581  96bb
   3582  96bb				   loc_96BB
   3583  96bb		       18		      CLC
   3584  96bc		       60		      RTS
   3585  96bd
   3586  96bd				   loc_96BD
   3587  96bd		       a2 3f		      LDX	#$3F	; '?'
   3588  96bf
   3589  96bf				   loc_96BF
   3590  96bf		       bd c0 06 	      LDA	$6C0,X
   3591  96c2		       9d 00 07 	      STA	$700,X
   3592  96c5		       ca		      DEX
   3593  96c6		       10 f7		      BPL	loc_96BF
   3594  96c8		       a5 4a		      LDA	current_line_no_lsb
   3595  96ca		       48		      PHA
   3596  96cb		       a5 4b		      LDA	current_line_no_msb
   3597  96cd		       48		      PHA
   3598  96ce		       a9 00		      LDA	#0
   3599  96d0		       8d b7 06 	      STA	editor_mode_id	; 1=command mode, 2=edit mode
   3600  96d3		       20 06 97 	      JSR	sub_9706
   3601  96d6		       38		      SEC
   3602  96d7		       20 ea 9d 	      JSR	sub_9DEA
   3603  96da		       a9 02		      LDA	#2
   3604  96dc		       8d b7 06 	      STA	editor_mode_id	; 1=command mode, 2=edit mode
   3605  96df		       68		      PLA
   3606  96e0		       85 2c		      STA	byte_2C
   3607  96e2		       68		      PLA
   3608  96e3		       85 2b		      STA	byte_2B
   3609  96e5		       20 8f 9e 	      JSR	find_line_by_number	; finds a line, given a line number
   3610  96e8							;
   3611  96e8							; Entry:
   3612  96e8							; byte_2B: line	number MSB
   3613  96e8							; byte_2C: line	number LSB
   3614  96e8							;
   3615  96e8							; Exit:
   3616  96e8							; (byte_2B) points to most suitable line
   3617  96e8		       20 39 a0 	      JSR	save_line_number	; saves line number from program.
   3618  96eb							;
   3619  96eb							; Entry:
   3620  96eb							; (byte_2b) points to current line
   3621  96eb							;
   3622  96eb							; Exit:
   3623  96eb							; current_line_no_lsb, current_line_no_msb = the line number
   3624  96eb		       20 69 ba 	      JSR	sub_BA69
   3625  96ee		       8a		      TXA
   3626  96ef		       4a		      LSR
   3627  96f0		       cd bf 06 	      CMP	screen_height
   3628  96f3		       f0 02		      BEQ	loc_96F7
   3629  96f5		       b0 01		      BCS	loc_96F8
   3630  96f7
   3631  96f7				   loc_96F7
   3632  96f7		       18		      CLC
   3633  96f8
   3634  96f8				   loc_96F8
   3635  96f8		       08		      PHP
   3636  96f9		       a2 3f		      LDX	#$3F	; '?'
   3637  96fb
   3638  96fb				   loc_96FB
   3639  96fb		       bd 00 07 	      LDA	$700,X
   3640  96fe		       9d c0 06 	      STA	$6C0,X
   3641  9701		       ca		      DEX
   3642  9702		       10 f7		      BPL	loc_96FB
   3643  9704		       28		      PLP
   3644  9705		       60		      RTS
   3645  9706							; End of function sub_9698
   3646  9706
   3647  9706
   3648  9706
   3649  9706
   3650  9706				   sub_9706
   3651  9706		       a9 00		      LDA	#0
   3652  9708		       85 3b		      STA	byte_3B
   3653  970a		       a2 01		      LDX	#1
   3654  970c		       20 45 a0 	      JSR	get_line_ptr	; gets pointer to line visible on screen.
   3655  970f							;
   3656  970f							; Entry:
   3657  970f							; X = screen line number * 2 + 1
   3658  970f							;
   3659  970f							; Exit:
   3660  970f							; (byte_2B) points to BASIC line
   3661  970f							; X decremented
   3662  970f		       20 39 a0 	      JSR	save_line_number	; saves line number from program.
   3663  9712							;
   3664  9712							; Entry:
   3665  9712							; (byte_2b) points to current line
   3666  9712							;
   3667  9712							; Exit:
   3668  9712							; current_line_no_lsb, current_line_no_msb = the line number
   3669  9712		       a5 4a		      LDA	current_line_no_lsb
   3670  9714		       85 2b		      STA	byte_2B
   3671  9716		       a5 4b		      LDA	current_line_no_msb
   3672  9718		       85 2c		      STA	byte_2C
   3673  971a		       60		      RTS
   3674  971b							; End of function sub_9706
   3675  971b
   3676  971b
   3677  971b				   tab_key_command
   3678  971b		       a5 61		      LDA	unk_61
   3679  971d		       8d aa 06 	      STA	unk_6AA
   3680  9720
   3681  9720				   loc_9720
   3682  9720		       20 ab 9b 	      JSR	make_cursor_invisible
   3683  9723		       a5 39		      LDA	byte_39
   3684  9725		       48		      PHA
   3685  9726		       ae aa 06 	      LDX	unk_6AA
   3686  9729		       f0 42		      BEQ	loc_976D
   3687  972b		       e8		      INX
   3688  972c		       86 39		      STX	byte_39
   3689  972e		       a6 10		      LDX	cursor_offset	; offset of cursor in detokenized buffer
   3690  9730		       a4 11		      LDY	unk_11
   3691  9732		       20 4e 8f 	      JSR	get_line_dimensions	; work out dimensions of line.
   3692  9735							;
   3693  9735							; Entry:
   3694  9735							; X=line length
   3695  9735							; Y=starting Y
   3696  9735							;
   3697  9735							; Exit:
   3698  9735							; X=line length	MOD screen width
   3699  9735							; Y=ending Y
   3700  9735		       8a		      TXA
   3701  9736		       d0 04		      BNE	loc_973C
   3702  9738		       ad b6 06 	      LDA	code_area_width
   3703  973b		       aa		      TAX
   3704  973c
   3705  973c				   loc_973C
   3706  973c		       c5 39		      CMP	byte_39
   3707  973e		       90 05		      BCC	loc_9745
   3708  9740		       ed aa 06 	      SBC	unk_6AA
   3709  9743		       d0 f7		      BNE	loc_973C
   3710  9745
   3711  9745				   loc_9745
   3712  9745		       85 3a		      STA	byte_3A
   3713  9747		       38		      SEC
   3714  9748		       a5 39		      LDA	byte_39
   3715  974a		       e5 3a		      SBC	byte_3A
   3716  974c		       a8		      TAY
   3717  974d		       86 3a		      STX	byte_3A
   3718  974f		       18		      CLC
   3719  9750		       65 3a		      ADC	byte_3A
   3720  9752		       cd b6 06 	      CMP	code_area_width
   3721  9755		       f0 0b		      BEQ	loc_9762
   3722  9757		       90 09		      BCC	loc_9762
   3723  9759		       ad b6 06 	      LDA	code_area_width
   3724  975c		       e5 3a		      SBC	byte_3A
   3725  975e		       18		      CLC
   3726  975f		       69 01		      ADC	#1
   3727  9761		       a8		      TAY
   3728  9762
   3729  9762				   loc_9762
   3730  9762		       8c aa 06 	      STY	unk_6AA
   3731  9765
   3732  9765				   loc_9765
   3733  9765		       20 84 a7 	      JSR	cursor_right_edit_mode_command
   3734  9768		       ce aa 06 	      DEC	unk_6AA
   3735  976b		       d0 f8		      BNE	loc_9765
   3736  976d
   3737  976d				   loc_976D
   3738  976d		       68		      PLA
   3739  976e		       85 39		      STA	byte_39
   3740  9770		       60		      RTS
   3741  9771
   3742  9771				   tab_command
   3743  9771		       a5 3f		      LDA	byte_3F
   3744  9773		       f0 05		      BEQ	loc_977A
   3745  9775
   3746  9775				   loc_9775
   3747  9775		       a9 21		      LDA	#$21	; '!'
   3748  9777		       4c 9d 85 	      JMP	loc_859D
   3749  977a
   3750  977a				   loc_977A
   3751  977a		       a5 3e		      LDA	byte_3E
   3752  977c		       c9 51		      CMP	#$51	; 'Q'
   3753  977e		       b0 f5		      BCS	loc_9775
   3754  9780		       85 61		      STA	unk_61
   3755  9782		       60		      RTS
   3756  9783
   3757  9783				   loc_9783
   3758  9783		       a9 50		      LDA	#$50	; 'P'
   3759  9785		       8d aa 06 	      STA	unk_6AA
   3760  9788		       4c 20 97 	      JMP	loc_9720
   3761  978b
   3762  978b				   continue_edit_mode_command
   3763  978b		       a5 62		      LDA	byte_62
   3764  978d		       d0 05		      BNE	loc_9794
   3765  978f		       a9 23		      LDA	#$23	; '#'
   3766  9791
   3767  9791				   loc_9791
   3768  9791		       4c 9d 85 	      JMP	loc_859D
   3769  9794
   3770  9794				   loc_9794
   3771  9794		       20 e9 9f 	      JSR	is_program_empty	; sets	C if no	program
   3772  9797		       90 04		      BCC	loc_979D
   3773  9799
   3774  9799				   loc_9799
   3775  9799		       a9 08		      LDA	#8
   3776  979b		       d0 f4		      BNE	loc_9791
   3777  979d
   3778  979d				   loc_979D
   3779  979d		       a9 43		      LDA	#$43	; 'C'
   3780  979f		       85 3e		      STA	byte_3E
   3781  97a1		       a9 06		      LDA	#6
   3782  97a3		       85 3f		      STA	byte_3F
   3783  97a5		       a5 62		      LDA	byte_62
   3784  97a7		       8d be 06 	      STA	byte_6BE
   3785  97aa		       e6 10		      INC	cursor_offset	; offset of cursor in detokenized buffer
   3786  97ac		       d0 02		      BNE	loc_97B0
   3787  97ae		       e6 11		      INC	unk_11
   3788  97b0
   3789  97b0				   loc_97B0
   3790  97b0		       a5 11		      LDA	unk_11
   3791  97b2		       f0 10		      BEQ	loc_97C4
   3792  97b4		       d0 3a		      BNE	loc_97F0
   3793  97b6
   3794  97b6				   loc_97B6
   3795  97b6		       a0 00		      LDY	#0
   3796  97b8		       84 11		      STY	unk_11
   3797  97ba		       c8		      INY
   3798  97bb		       84 10		      STY	cursor_offset	; offset of cursor in detokenized buffer
   3799  97bd		       b1 2b		      LDA	($2B),Y
   3800  97bf		       30 d8		      BMI	loc_9799
   3801  97c1		       20 08 9c 	      JSR	detokenize_one_line
   3802  97c4
   3803  97c4				   loc_97C4
   3804  97c4		       20 60 92 	      JSR	sub_9260
   3805  97c7		       90 27		      BCC	loc_97F0
   3806  97c9		       a5 2b		      LDA	byte_2B
   3807  97cb		       cd c0 06 	      CMP	byte_6C0
   3808  97ce		       d0 1d		      BNE	loc_97ED
   3809  97d0		       a5 2c		      LDA	byte_2C
   3810  97d2		       cd c1 06 	      CMP	byte_6C1
   3811  97d5		       d0 16		      BNE	loc_97ED
   3812  97d7		       ad b3 06 	      LDA	byte_6B3
   3813  97da		       f0 0e		      BEQ	loc_97EA
   3814  97dc		       20 17 aa 	      JSR	sub_AA17
   3815  97df		       a2 01		      LDX	#1
   3816  97e1		       20 45 a0 	      JSR	get_line_ptr	; gets pointer to line visible on screen.
   3817  97e4							;
   3818  97e4							; Entry:
   3819  97e4							; X = screen line number * 2 + 1
   3820  97e4							;
   3821  97e4							; Exit:
   3822  97e4							; (byte_2B) points to BASIC line
   3823  97e4							; X decremented
   3824  97e4		       20 39 a0 	      JSR	save_line_number	; saves line number from program.
   3825  97e7							;
   3826  97e7							; Entry:
   3827  97e7							; (byte_2b) points to current line
   3828  97e7							;
   3829  97e7							; Exit:
   3830  97e7							; current_line_no_lsb, current_line_no_msb = the line number
   3831  97e7		       20 69 a0 	      JSR	sub_A069
   3832  97ea
   3833  97ea				   loc_97EA
   3834  97ea		       4c a8 a8 	      JMP	position_edit_mode_cursor
   3835  97ed
   3836  97ed				   loc_97ED
   3837  97ed		       4c 63 91 	      JMP	loc_9163
   3838  97f0
   3839  97f0				   loc_97F0
   3840  97f0		       20 52 92 	      JSR	advance_2b_to_next_line
   3841  97f3		       4c b6 97 	      JMP	loc_97B6
   3842  97f6
   3843  97f6				   split_statement_edit_mode_command
   3844  97f6		       20 56 ba 	      JSR	rstrip_detokenized_line
   3845  97f9		       c0 00		      CPY	#0
   3846  97fb		       f0 04		      BEQ	loc_9801
   3847  97fd		       a5 11		      LDA	unk_11
   3848  97ff		       f0 03		      BEQ	loc_9804
   3849  9801
   3850  9801				   loc_9801
   3851  9801		       4c 69 9f 	      JMP	beep
   3852  9804
   3853  9804				   loc_9804
   3854  9804		       a5 10		      LDA	cursor_offset	; offset of cursor in detokenized buffer
   3855  9806		       c9 01		      CMP	#1
   3856  9808		       f0 f7		      BEQ	loc_9801
   3857  980a		       cd 00 04 	      CMP	byte_400
   3858  980d		       f0 02		      BEQ	loc_9811
   3859  980f		       b0 f0		      BCS	loc_9801
   3860  9811
   3861  9811				   loc_9811
   3862  9811		       a0 00		      LDY	#0
   3863  9813
   3864  9813				   loc_9813
   3865  9813		       b9 00 04 	      LDA	$400,Y
   3866  9816		       99 00 07 	      STA	$700,Y
   3867  9819		       88		      DEY
   3868  981a		       d0 f7		      BNE	loc_9813
   3869  981c		       20 c0 a8 	      JSR	sub_A8C0
   3870  981f		       a0 00		      LDY	#0
   3871  9821
   3872  9821				   loc_9821
   3873  9821		       b9 00 07 	      LDA	$700,Y
   3874  9824		       99 00 04 	      STA	$400,Y
   3875  9827		       88		      DEY
   3876  9828		       d0 f7		      BNE	loc_9821
   3877  982a		       20 68 99 	      JSR	sub_9968
   3878  982d		       48		      PHA
   3879  982e		       c9 00		      CMP	#0
   3880  9830		       d0 03		      BNE	loc_9835
   3881  9832		       4c db 98 	      JMP	loc_98DB
   3882  9835
   3883  9835				   loc_9835
   3884  9835		       ad 00 04 	      LDA	byte_400
   3885  9838		       c9 fb		      CMP	#-5	; 'û'
   3886  983a		       d0 04		      BNE	loc_9840
   3887  983c
   3888  983c				   loc_983C
   3889  983c		       68		      PLA
   3890  983d		       4c 18 a7 	      JMP	renumber_edit_mode_command
   3891  9840
   3892  9840				   loc_9840
   3893  9840		       ac 00 04 	      LDY	byte_400
   3894  9843
   3895  9843				   loc_9843
   3896  9843		       b9 00 04 	      LDA	$400,Y
   3897  9846		       c9 07		      CMP	#7
   3898  9848		       f0 f2		      BEQ	loc_983C
   3899  984a		       88		      DEY
   3900  984b		       d0 f6		      BNE	loc_9843
   3901  984d		       ac 00 04 	      LDY	byte_400
   3902  9850
   3903  9850				   loc_9850
   3904  9850		       b9 00 04 	      LDA	$400,Y
   3905  9853		       99 01 04 	      STA	$401,Y
   3906  9856		       c4 10		      CPY	cursor_offset	; offset of cursor in detokenized buffer
   3907  9858		       f0 03		      BEQ	loc_985D
   3908  985a		       88		      DEY
   3909  985b		       d0 f3		      BNE	loc_9850
   3910  985d
   3911  985d				   loc_985D
   3912  985d		       a9 07		      LDA	#7
   3913  985f		       99 00 04 	      STA	$400,Y
   3914  9862		       ee 00 04 	      INC	byte_400
   3915  9865		       a9 01		      LDA	#1
   3916  9867		       8d b3 06 	      STA	byte_6B3
   3917  986a		       a9 00		      LDA	#0
   3918  986c		       8d a7 06 	      STA	byte_6A7
   3919  986f		       20 c0 a8 	      JSR	sub_A8C0
   3920  9872		       ee a7 06 	      INC	byte_6A7
   3921  9875		       a9 ff		      LDA	#-1
   3922  9877		       8d ad 06 	      STA	unk_6AD
   3923  987a		       20 92 84 	      JSR	sub_8492
   3924  987d		       ad ad 06 	      LDA	unk_6AD
   3925  9880		       c9 ff		      CMP	#-1
   3926  9882		       f0 0e		      BEQ	loc_9892
   3927  9884		       20 9a 99 	      JSR	sub_999A
   3928  9887
   3929  9887				   loc_9887
   3930  9887		       ad ad 06 	      LDA	unk_6AD
   3931  988a		       a2 00		      LDX	#0
   3932  988c		       8e ad 06 	      STX	unk_6AD
   3933  988f		       4c 9d 85 	      JMP	loc_859D
   3934  9892
   3935  9892				   loc_9892
   3936  9892		       20 08 9c 	      JSR	detokenize_one_line
   3937  9895		       ad ad 06 	      LDA	unk_6AD
   3938  9898		       c9 ff		      CMP	#-1
   3939  989a		       f0 19		      BEQ	loc_98B5
   3940  989c		       20 9a 99 	      JSR	sub_999A
   3941  989f		       a9 ff		      LDA	#-1
   3942  98a1		       8d ad 06 	      STA	unk_6AD
   3943  98a4		       20 08 9c 	      JSR	detokenize_one_line
   3944  98a7		       ad ad 06 	      LDA	unk_6AD
   3945  98aa		       c9 ff		      CMP	#-1
   3946  98ac		       d0 d9		      BNE	loc_9887
   3947  98ae		       ee ad 06 	      INC	unk_6AD
   3948  98b1		       68		      PLA
   3949  98b2		       4c 7a 96 	      JMP	loc_967A
   3950  98b5
   3951  98b5				   loc_98B5
   3952  98b5		       ee ad 06 	      INC	unk_6AD
   3953  98b8		       ac 00 04 	      LDY	byte_400
   3954  98bb
   3955  98bb				   loc_98BB
   3956  98bb		       b9 00 04 	      LDA	$400,Y
   3957  98be		       c9 07		      CMP	#7
   3958  98c0		       f0 03		      BEQ	loc_98C5
   3959  98c2		       88		      DEY
   3960  98c3		       d0 f6		      BNE	loc_98BB
   3961  98c5
   3962  98c5				   loc_98C5
   3963  98c5		       84 10		      STY	cursor_offset	; offset of cursor in detokenized buffer
   3964  98c7
   3965  98c7				   loc_98C7
   3966  98c7		       b9 01 04 	      LDA	$401,Y
   3967  98ca		       99 00 04 	      STA	$400,Y
   3968  98cd		       c8		      INY
   3969  98ce		       cc 00 04 	      CPY	byte_400
   3970  98d1		       d0 f4		      BNE	loc_98C7
   3971  98d3		       a9 20		      LDA	#$20	; ' '
   3972  98d5		       99 00 04 	      STA	$400,Y
   3973  98d8		       ce 00 04 	      DEC	byte_400
   3974  98db
   3975  98db				   loc_98DB
   3976  98db		       68		      PLA
   3977  98dc		       85 36		      STA	byte_36
   3978  98de		       18		      CLC
   3979  98df		       a9 00		      LDA	#0
   3980  98e1		       65 10		      ADC	cursor_offset	; offset of cursor in detokenized buffer
   3981  98e3		       85 0c		      STA	byte_C
   3982  98e5		       a9 04		      LDA	#4
   3983  98e7		       69 00		      ADC	#0
   3984  98e9		       85 0d		      STA	byte_D
   3985  98eb		       a9 01		      LDA	#1
   3986  98ed		       85 0e		      STA	byte_E
   3987  98ef		       a9 07		      LDA	#7
   3988  98f1		       85 0f		      STA	byte_F
   3989  98f3		       38		      SEC
   3990  98f4		       ad 00 04 	      LDA	byte_400
   3991  98f7		       e5 10		      SBC	cursor_offset	; offset of cursor in detokenized buffer
   3992  98f9		       a8		      TAY
   3993  98fa		       c8		      INY
   3994  98fb		       8c 00 07 	      STY	unk_700
   3995  98fe		       a2 00		      LDX	#0
   3996  9900		       20 a1 8e 	      JSR	memmove	; move (maybe overlapping) memory regions.
   3997  9903							;
   3998  9903							; Entry:
   3999  9903							; (byte_C) points to src
   4000  9903							; (byte_E) points to dest
   4001  9903							; X is MSB of size
   4002  9903							; Y is LSB of size
   4003  9903		       a6 10		      LDX	cursor_offset	; offset of cursor in detokenized buffer
   4004  9905		       ca		      DEX
   4005  9906		       8e 00 04 	      STX	byte_400
   4006  9909		       a9 01		      LDA	#1
   4007  990b		       8d b3 06 	      STA	byte_6B3
   4008  990e		       20 c0 a8 	      JSR	sub_A8C0
   4009  9911		       20 c3 9e 	      JSR	get_line_height	; get height of	current	line
   4010  9914							;
   4011  9914							; Entry:
   4012  9914							; ?byte_400 = line length
   4013  9914							;
   4014  9914							; Exit:
   4015  9914							; X = line height
   4016  9914		       86 35		      STX	byte_35
   4017  9916		       a9 00		      LDA	#0
   4018  9918		       85 0c		      STA	byte_C
   4019  991a		       a9 07		      LDA	#7
   4020  991c		       85 0d		      STA	byte_D
   4021  991e		       a9 00		      LDA	#0
   4022  9920		       85 0e		      STA	byte_E
   4023  9922		       a9 04		      LDA	#4
   4024  9924		       85 0f		      STA	byte_F
   4025  9926		       ac 00 07 	      LDY	unk_700
   4026  9929		       c8		      INY
   4027  992a		       a2 00		      LDX	#0
   4028  992c		       20 a1 8e 	      JSR	memmove	; move (maybe overlapping) memory regions.
   4029  992f							;
   4030  992f							; Entry:
   4031  992f							; (byte_C) points to src
   4032  992f							; (byte_E) points to dest
   4033  992f							; X is MSB of size
   4034  992f							; Y is LSB of size
   4035  992f
   4036  992f				   loc_992F
   4037  992f		       a6 4a		      LDX	current_line_no_lsb
   4038  9931		       a4 4b		      LDY	current_line_no_msb
   4039  9933		       e6 4b		      INC	current_line_no_msb
   4040  9935		       d0 02		      BNE	loc_9939
   4041  9937		       e6 4a		      INC	current_line_no_lsb
   4042  9939
   4043  9939				   loc_9939
   4044  9939		       a5 4a		      LDA	current_line_no_lsb
   4045  993b		       48		      PHA
   4046  993c		       a5 4b		      LDA	current_line_no_msb
   4047  993e		       48		      PHA
   4048  993f		       8a		      TXA
   4049  9940		       48		      PHA
   4050  9941		       98		      TYA
   4051  9942		       48		      PHA
   4052  9943		       a5 36		      LDA	byte_36
   4053  9945		       48		      PHA
   4054  9946		       a6 35		      LDX	byte_35
   4055  9948		       4c bb af 	      JMP	loc_AFBB
   4056  994b
   4057  994b
   4058  994b
   4059  994b				   repeat_edit_mode_command
   4060  994b		       20 5b 99 	      JSR	sub_995B
   4061  994e		       85 36		      STA	byte_36
   4062  9950		       20 08 9c 	      JSR	detokenize_one_line
   4063  9953		       20 c3 9e 	      JSR	get_line_height	; get height of	current	line
   4064  9956							;
   4065  9956							; Entry:
   4066  9956							; ?byte_400 = line length
   4067  9956							;
   4068  9956							; Exit:
   4069  9956							; X = line height
   4070  9956		       86 35		      STX	byte_35
   4071  9958		       4c 2f 99 	      JMP	loc_992F
   4072  995b							; End of function repeat_edit_mode_command
   4073  995b
   4074  995b
   4075  995b
   4076  995b
   4077  995b				   sub_995B
   4078  995b		       20 68 99 	      JSR	sub_9968
   4079  995e		       48		      PHA
   4080  995f		       c9 00		      CMP	#0
   4081  9961		       f0 03		      BEQ	loc_9966
   4082  9963		       20 92 84 	      JSR	sub_8492
   4083  9966
   4084  9966				   loc_9966
   4085  9966		       68		      PLA
   4086  9967		       60		      RTS
   4087  9968							; End of function sub_995B
   4088  9968
   4089  9968
   4090  9968
   4091  9968
   4092  9968				   sub_9968
   4093  9968		       20 e9 9f 	      JSR	is_program_empty	; sets	C if no	program
   4094  996b		       b0 2a		      BCS	loc_9997
   4095  996d		       a0 03		      LDY	#3
   4096  996f		       18		      CLC
   4097  9970		       b1 2b		      LDA	(byte_2B),Y
   4098  9972		       65 2b		      ADC	byte_2B
   4099  9974		       85 0c		      STA	byte_C
   4100  9976		       a5 2c		      LDA	byte_2C
   4101  9978		       69 00		      ADC	#0
   4102  997a		       85 0d		      STA	byte_D
   4103  997c		       a6 4a		      LDX	current_line_no_lsb
   4104  997e		       a4 4b		      LDY	current_line_no_msb
   4105  9980		       c8		      INY
   4106  9981		       d0 03		      BNE	loc_9986
   4107  9983		       e8		      INX
   4108  9984		       30 0d		      BMI	loc_9993
   4109  9986
   4110  9986				   loc_9986
   4111  9986		       98		      TYA
   4112  9987		       a0 02		      LDY	#2
   4113  9989		       d1 0c		      CMP	(byte_C),Y
   4114  998b		       d0 0a		      BNE	loc_9997
   4115  998d		       88		      DEY
   4116  998e		       8a		      TXA
   4117  998f		       d1 0c		      CMP	(byte_C),Y
   4118  9991		       d0 04		      BNE	loc_9997
   4119  9993
   4120  9993				   loc_9993
   4121  9993		       a9 01		      LDA	#1
   4122  9995		       d0 02		      BNE	locret_9999
   4123  9997
   4124  9997				   loc_9997
   4125  9997		       a9 00		      LDA	#0
   4126  9999
   4127  9999				   locret_9999
   4128  9999		       60		      RTS
   4129  999a							; End of function sub_9968
   4130  999a
   4131  999a
   4132  999a
   4133  999a
   4134  999a				   sub_999A
   4135  999a		       20 1f 83 	      JSR	find_program
   4136  999d		       a0 04		      LDY	#4
   4137  999f
   4138  999f				   loc_999F
   4139  999f		       b1 2b		      LDA	($2B),Y
   4140  99a1		       c9 07		      CMP	#7
   4141  99a3		       f0 03		      BEQ	loc_99A8
   4142  99a5		       c8		      INY
   4143  99a6		       d0 f7		      BNE	loc_999F
   4144  99a8
   4145  99a8				   loc_99A8
   4146  99a8		       98		      TYA
   4147  99a9		       18		      CLC
   4148  99aa		       65 2b		      ADC	byte_2B
   4149  99ac		       85 0c		      STA	byte_C
   4150  99ae		       85 0e		      STA	byte_E
   4151  99b0		       a5 2c		      LDA	byte_2C
   4152  99b2		       69 00		      ADC	#0
   4153  99b4		       85 0d		      STA	byte_D
   4154  99b6		       85 0f		      STA	byte_F
   4155  99b8		       e6 0c		      INC	byte_C
   4156  99ba		       d0 02		      BNE	loc_99BE
   4157  99bc		       e6 0d		      INC	byte_D
   4158  99be
   4159  99be				   loc_99BE
   4160  99be		       38		      SEC
   4161  99bf		       a5 12		      LDA	TOP
   4162  99c1		       e5 0c		      SBC	byte_C
   4163  99c3		       a8		      TAY
   4164  99c4		       a5 13		      LDA	TOP+1
   4165  99c6		       e5 0d		      SBC	byte_D
   4166  99c8		       aa		      TAX
   4167  99c9		       20 a1 8e 	      JSR	memmove	; move (maybe overlapping) memory regions.
   4168  99cc							;
   4169  99cc							; Entry:
   4170  99cc							; (byte_C) points to src
   4171  99cc							; (byte_E) points to dest
   4172  99cc							; X is MSB of size
   4173  99cc							; Y is LSB of size
   4174  99cc		       a0 03		      LDY	#3
   4175  99ce		       b1 2b		      LDA	($2B),Y
   4176  99d0		       38		      SEC
   4177  99d1		       e9 01		      SBC	#1
   4178  99d3		       91 2b		      STA	($2B),Y
   4179  99d5		       60		      RTS
   4180  99d6							; End of function sub_999A
   4181  99d6
   4182  99d6
   4183  99d6				   renumber_command
   4184  99d6		       a9 0a		      LDA	#$A
   4185  99d8		       8d b9 06 	      STA	unk_6B9
   4186  99db		       aa		      TAX
   4187  99dc		       a9 00		      LDA	#0
   4188  99de		       8d b8 06 	      STA	unk_6B8
   4189  99e1		       a5 3f		      LDA	byte_3F
   4190  99e3		       10 03		      BPL	loc_99E8
   4191  99e5		       4c 8b 9a 	      JMP	loc_9A8B
   4192  99e8
   4193  99e8				   loc_99E8
   4194  99e8		       a0 01		      LDY	#1
   4195  99ea
   4196  99ea				   loc_99EA
   4197  99ea		       b1 3e		      LDA	($3E),Y
   4198  99ec		       c9 0d		      CMP	#$D
   4199  99ee		       f0 0d		      BEQ	loc_99FD
   4200  99f0		       c9 2c		      CMP	#$2C	; ','
   4201  99f2		       d0 06		      BNE	loc_99FA
   4202  99f4		       a9 20		      LDA	#$20	; ' '
   4203  99f6		       91 3e		      STA	($3E),Y
   4204  99f8		       d0 03		      BNE	loc_99FD
   4205  99fa
   4206  99fa				   loc_99FA
   4207  99fa		       c8		      INY
   4208  99fb		       d0 ed		      BNE	loc_99EA
   4209  99fd
   4210  99fd				   loc_99FD
   4211  99fd		       a5 3e		      LDA	byte_3E
   4212  99ff		       48		      PHA
   4213  9a00		       a5 3f		      LDA	byte_3F
   4214  9a02		       48		      PHA
   4215  9a03		       20 7d 8f 	      JSR	atoi_from_command_line	; entry:	(byte_3E) points to command line;
   4216  9a06							; exit:	C set if error,	or (byte_3E, byte_3F) holds result.
   4217  9a06		       90 05		      BCC	loc_9A0D
   4218  9a08		       a9 0b		      LDA	#$B
   4219  9a0a		       4c 9d 85 	      JMP	loc_859D
   4220  9a0d
   4221  9a0d				   loc_9A0D
   4222  9a0d		       a5 3f		      LDA	byte_3F
   4223  9a0f		       8d b8 06 	      STA	unk_6B8
   4224  9a12		       a5 3e		      LDA	byte_3E
   4225  9a14		       8d b9 06 	      STA	unk_6B9
   4226  9a17		       68		      PLA
   4227  9a18		       85 3f		      STA	byte_3F
   4228  9a1a		       68		      PLA
   4229  9a1b		       85 3e		      STA	byte_3E
   4230  9a1d		       a0 00		      LDY	#0
   4231  9a1f
   4232  9a1f				   loc_9A1F
   4233  9a1f		       b1 3e		      LDA	($3E),Y
   4234  9a21		       c9 0d		      CMP	#$D
   4235  9a23		       f0 14		      BEQ	loc_9A39
   4236  9a25		       c9 20		      CMP	#$20	; ' '
   4237  9a27		       f0 03		      BEQ	loc_9A2C
   4238  9a29		       c8		      INY
   4239  9a2a		       d0 f3		      BNE	loc_9A1F
   4240  9a2c
   4241  9a2c				   loc_9A2C
   4242  9a2c		       b1 3e		      LDA	($3E),Y
   4243  9a2e		       c9 0d		      CMP	#$D
   4244  9a30		       f0 07		      BEQ	loc_9A39
   4245  9a32		       c9 20		      CMP	#$20	; ' '
   4246  9a34		       d0 08		      BNE	loc_9A3E
   4247  9a36		       c8		      INY
   4248  9a37		       d0 f3		      BNE	loc_9A2C
   4249  9a39
   4250  9a39				   loc_9A39
   4251  9a39		       a2 0a		      LDX	#$A
   4252  9a3b		       4c 99 9a 	      JMP	loc_9A99
   4253  9a3e
   4254  9a3e				   loc_9A3E
   4255  9a3e		       18		      CLC
   4256  9a3f		       98		      TYA
   4257  9a40		       65 3e		      ADC	byte_3E
   4258  9a42		       85 3e		      STA	byte_3E
   4259  9a44		       48		      PHA
   4260  9a45		       90 02		      BCC	loc_9A49
   4261  9a47		       e6 3f		      INC	byte_3F
   4262  9a49
   4263  9a49				   loc_9A49
   4264  9a49		       a5 3f		      LDA	byte_3F
   4265  9a4b		       48		      PHA
   4266  9a4c		       20 7d 8f 	      JSR	atoi_from_command_line	; entry:	(byte_3E) points to command line;
   4267  9a4f							; exit:	C set if error,	or (byte_3E, byte_3F) holds result.
   4268  9a4f		       90 05		      BCC	loc_9A56
   4269  9a51		       a9 0b		      LDA	#$B
   4270  9a53		       4c 9d 85 	      JMP	loc_859D
   4271  9a56
   4272  9a56				   loc_9A56
   4273  9a56		       a5 3f		      LDA	byte_3F
   4274  9a58		       f0 05		      BEQ	loc_9A5F
   4275  9a5a
   4276  9a5a				   loc_9A5A
   4277  9a5a		       a9 26		      LDA	#$26	; '&'
   4278  9a5c		       4c 9d 85 	      JMP	loc_859D
   4279  9a5f
   4280  9a5f				   loc_9A5F
   4281  9a5f		       a5 3e		      LDA	byte_3E
   4282  9a61		       f0 f7		      BEQ	loc_9A5A
   4283  9a63		       aa		      TAX
   4284  9a64		       68		      PLA
   4285  9a65		       85 3f		      STA	byte_3F
   4286  9a67		       68		      PLA
   4287  9a68		       85 3e		      STA	byte_3E
   4288  9a6a		       a0 00		      LDY	#0
   4289  9a6c
   4290  9a6c				   loc_9A6C
   4291  9a6c		       b1 3e		      LDA	($3E),Y
   4292  9a6e		       c9 0d		      CMP	#$D
   4293  9a70		       f0 27		      BEQ	loc_9A99
   4294  9a72		       c9 20		      CMP	#$20	; ' '
   4295  9a74		       f0 03		      BEQ	loc_9A79
   4296  9a76		       c8		      INY
   4297  9a77		       d0 f3		      BNE	loc_9A6C
   4298  9a79
   4299  9a79				   loc_9A79
   4300  9a79		       b1 3e		      LDA	($3E),Y
   4301  9a7b		       c9 0d		      CMP	#$D
   4302  9a7d		       f0 1a		      BEQ	loc_9A99
   4303  9a7f		       c9 20		      CMP	#$20	; ' '
   4304  9a81		       d0 03		      BNE	loc_9A86
   4305  9a83		       c8		      INY
   4306  9a84		       d0 f3		      BNE	loc_9A79
   4307  9a86
   4308  9a86				   loc_9A86
   4309  9a86		       a9 0c		      LDA	#$C
   4310  9a88		       4c 9d 85 	      JMP	loc_859D
   4311  9a8b
   4312  9a8b				   loc_9A8B
   4313  9a8b		       20 e9 9f 	      JSR	is_program_empty	; sets	C if no	program
   4314  9a8e		       b0 47		      BCS	locret_9AD7
   4315  9a90		       20 ad 9a 	      JSR	sub_9AAD
   4316  9a93		       a5 39		      LDA	byte_39
   4317  9a95		       10 13		      BPL	loc_9AAA
   4318  9a97		       a2 03		      LDX	#3
   4319  9a99
   4320  9a99				   loc_9A99
   4321  9a99		       20 e9 9f 	      JSR	is_program_empty	; sets	C if no	program
   4322  9a9c		       b0 39		      BCS	locret_9AD7
   4323  9a9e		       20 ad 9a 	      JSR	sub_9AAD
   4324  9aa1		       a5 39		      LDA	byte_39
   4325  9aa3		       10 05		      BPL	loc_9AAA
   4326  9aa5		       a9 19		      LDA	#$19
   4327  9aa7		       4c 9d 85 	      JMP	loc_859D
   4328  9aaa
   4329  9aaa				   loc_9AAA
   4330  9aaa		       4c a7 84 	      JMP	loc_84A7
   4331  9aad
   4332  9aad
   4333  9aad
   4334  9aad				   sub_9AAD
   4335  9aad		       ad b8 06 	      LDA	unk_6B8
   4336  9ab0		       85 39		      STA	byte_39
   4337  9ab2		       ad b9 06 	      LDA	unk_6B9
   4338  9ab5		       85 3a		      STA	byte_3A
   4339  9ab7		       a5 17		      LDA	oshwm
   4340  9ab9		       85 2b		      STA	byte_2B
   4341  9abb		       a5 18		      LDA	oshwm+1
   4342  9abd		       85 2c		      STA	byte_2C
   4343  9abf
   4344  9abf				   loc_9ABF
   4345  9abf		       20 52 92 	      JSR	advance_2b_to_next_line
   4346  9ac2		       a0 01		      LDY	#1
   4347  9ac4		       b1 2b		      LDA	($2B),Y
   4348  9ac6		       30 0f		      BMI	locret_9AD7
   4349  9ac8		       18		      CLC
   4350  9ac9		       8a		      TXA
   4351  9aca		       65 3a		      ADC	byte_3A
   4352  9acc		       85 3a		      STA	byte_3A
   4353  9ace		       90 04		      BCC	loc_9AD4
   4354  9ad0		       e6 39		      INC	byte_39
   4355  9ad2		       30 03		      BMI	locret_9AD7
   4356  9ad4
   4357  9ad4				   loc_9AD4
   4358  9ad4		       4c bf 9a 	      JMP	loc_9ABF
   4359  9ad7
   4360  9ad7				   locret_9AD7
   4361  9ad7		       60		      RTS
   4362  9ad8							; End of function sub_9AAD
   4363  9ad8
   4364  9ad8
   4365  9ad8
   4366  9ad8
   4367  9ad8				   edit_mode_loop
   4368  9ad8
   4369  9ad8		       a2 ff		      LDX	#$FF
   4370  9ada		       9a		      TXS
   4371  9adb		       8e a7 06 	      STX	byte_6A7
   4372  9ade		       ad ab 06 	      LDA	byte_6AB
   4373  9ae1		       f0 03		      BEQ	loc_9AE6
   4374  9ae3		       20 f6 9b 	      JSR	kbflush
   4375  9ae6
   4376  9ae6				   loc_9AE6
   4377  9ae6		       a2 00		      LDX	#0
   4378  9ae8		       a0 ff		      LDY	#$FF
   4379  9aea		       a9 d8		      LDA	#216	; read length of soft key string
   4380  9aec		       20 f4 ff 	      JSR	OSBYTE	; flush	pending	soft key expansion
   4381  9aef		       86 3a		      STX	byte_3A	; save old value (??)
   4382  9af1		       20 c6 9b 	      JSR	reset_cursor_shape
   4383  9af4		       20 26 95 	      JSR	getch
   4384  9af7
   4385  9af7				   check_return_key		; return?
   4386  9af7		       c9 0d		      CMP	#13
   4387  9af9		       d0 04		      BNE	check_tab_key
   4388  9afb		       a9 e5		      LDA	#CMD_return_key
   4389  9afd		       d0 0e		      BNE	run_command
   4390  9aff
   4391  9aff				   check_tab_key
   4392  9aff		       c9 09		      CMP	#9
   4393  9b01		       d0 04		      BNE	check_delete_key
   4394  9b03		       a9 db		      LDA	#CMD_tab_key
   4395  9b05		       d0 06		      BNE	run_command
   4396  9b07
   4397  9b07				   check_delete_key
   4398  9b07		       c9 7f		      CMP	#$7F	; ''
   4399  9b09		       d0 02		      BNE	run_command
   4400  9b0b		       a9 e6		      LDA	#CMD_delete_key
   4401  9b0d
   4402  9b0d				   run_command
   4403  9b0d
   4404  9b0d		       8d bd 06 	      STA	current_command_id
   4405  9b10		       a2 00		      LDX	#0
   4406  9b12		       a0 ff		      LDY	#$FF
   4407  9b14		       a9 d8		      LDA	#216
   4408  9b16		       20 f4 ff 	      JSR	OSBYTE
   4409  9b19		       8a		      TXA
   4410  9b1a		       05 3a		      ORA	byte_3A	; check	if both	soft key expansion states were 0
   4411  9b1c		       f0 0e		      BEQ	loc_9B2C	; branch taken if both were
   4412  9b1e		       ad bd 06 	      LDA	current_command_id
   4413  9b21		       c9 20		      CMP	#$20	; ' '
   4414  9b23		       90 03		      BCC	loc_9B28
   4415  9b25
   4416  9b25				   loc_9B25
   4417  9b25
   4418  9b25		       4c 8b 9b 	      JMP	dispatch_command
   4419  9b28
   4420  9b28				   loc_9B28
   4421  9b28		       a9 20		      LDA	#$20	; ' '
   4422  9b2a		       d0 1c		      BNE	set_command	; JMP, in effect
   4423  9b2c
   4424  9b2c				   loc_9B2C
   4425  9b2c		       a2 ff		      LDX	#$FF	; query	keyboard buffer
   4426  9b2e		       a0 ff		      LDY	#$FF
   4427  9b30		       a9 80		      LDA	#128
   4428  9b32		       20 f4 ff 	      JSR	OSBYTE	; get ADVAL/buffer status (AUG p151)
   4429  9b35		       8a		      TXA
   4430  9b36		       d0 ed		      BNE	loc_9B25	; branch taken if any keys in keyboard buffer
   4431  9b38		       ad bd 06 	      LDA	current_command_id
   4432  9b3b		       c9 e5		      CMP	#CMD_return_key
   4433  9b3d		       d0 0f		      BNE	loc_9B4E
   4434  9b3f		       a2 9a		      LDX	#$9A
   4435  9b41		       20 a2 9b 	      JSR	poll_key	; poll state of	key.
   4436  9b44							;
   4437  9b44							; Entry:
   4438  9b44							; X = -ve INKEY	value
   4439  9b44							;
   4440  9b44							; Exit:
   4441  9b44							; X = 0	and Z set if key pressed
   4442  9b44		       d0 df		      BNE	loc_9B25
   4443  9b46		       a9 0d		      LDA	#$D
   4444  9b48
   4445  9b48				   set_command
   4446  9b48
   4447  9b48		       8d bd 06 	      STA	current_command_id
   4448  9b4b		       4c 8b 9b 	      JMP	dispatch_command
   4449  9b4e
   4450  9b4e				   loc_9B4E
   4451  9b4e		       c9 db		      CMP	#CMD_tab_key
   4452  9b50		       d0 0b		      BNE	loc_9B5D
   4453  9b52		       a2 da		      LDX	#$DA	; I key
   4454  9b54		       20 a2 9b 	      JSR	poll_key	; poll state of	key.
   4455  9b57							;
   4456  9b57							; Entry:
   4457  9b57							; X = -ve INKEY	value
   4458  9b57							;
   4459  9b57							; Exit:
   4460  9b57							; X = 0	and Z set if key pressed
   4461  9b57		       d0 04		      BNE	loc_9B5D	; branch taken if I not	pressed
   4462  9b59		       a9 09		      LDA	#9	; set command 9	(think this is some kind of fudge to stop Ctrl+I doing anything)
   4463  9b5b		       d0 eb		      BNE	set_command
   4464  9b5d
   4465  9b5d				   loc_9B5D
   4466  9b5d
   4467  9b5d		       a2 00		      LDX	#0	; Don't change anything
   4468  9b5f		       a0 ff		      LDY	#$FF	; Read old value
   4469  9b61		       a9 ca		      LDA	#202
   4470  9b63		       20 f4 ff 	      JSR	OSBYTE	; Read keyboard	status byte (AUG p207)
   4471  9b66		       86 38		      STX	byte_38	; bit 3	- 1 if SHIFT pressed
   4472  9b68							; bit 4	- 0 if CAPS LOCK engaged
   4473  9b68							; bit 5	- 0 if SHIFT LOCK engaged
   4474  9b68							; bit 6	- 1 if CTRL pressed
   4475  9b68							; bit 7	- 1 if SHIFT is	to reverse CAPS	LOCK/SHIFT LOCK	status
   4476  9b68
   4477  9b68				   check_shift_delete_key
   4478  9b68		       ad bd 06 	      LDA	current_command_id
   4479  9b6b		       c9 e6		      CMP	#CMD_delete_key
   4480  9b6d		       d0 0d		      BNE	check_shift_tab_key
   4481  9b6f		       a9 08		      LDA	#8
   4482  9b71		       24 38		      BIT	byte_38	; Check	SHIFT state
   4483  9b73		       f0 16		      BEQ	dispatch_command	; Branch taken	if SHIFT not pressed
   4484  9b75		       a9 e7		      LDA	#CMD_shift_delete_key
   4485  9b77		       8d bd 06 	      STA	current_command_id
   4486  9b7a		       d0 0f		      BNE	dispatch_command	; JMP,	in effect
   4487  9b7c
   4488  9b7c				   check_shift_tab_key
   4489  9b7c		       c9 db		      CMP	#CMD_tab_key
   4490  9b7e		       d0 0b		      BNE	dispatch_command
   4491  9b80		       a9 08		      LDA	#8
   4492  9b82		       24 38		      BIT	byte_38	; Check	SHIFT state
   4493  9b84		       f0 05		      BEQ	dispatch_command	; Branch taken	if SHIFT not pressed
   4494  9b86		       a9 ec		      LDA	#CMD_shift_tab_key
   4495  9b88		       8d bd 06 	      STA	current_command_id
   4496  9b8b
   4497  9b8b				   dispatch_command
   4498  9b8b
   4499  9b8b		       ad bd 06 	      LDA	current_command_id
   4500  9b8e		       c9 20		      CMP	#$20	; ' '
   4501  9b90		       90 0a		      BCC	execute_non_key_command
   4502  9b92		       c9 a0		      CMP	#$A0
   4503  9b94		       b0 06		      BCS	execute_non_key_command
   4504  9b96		       20 31 9f 	      JSR	execute_key_command	; treats command ID	as ASCII char and puts that char into the current line as appropriate.
   4505  9b99		       4c d8 9a 	      JMP	edit_mode_loop
   4506  9b9c
   4507  9b9c				   execute_non_key_command
   4508  9b9c
   4509  9b9c		       20 e7 8f 	      JSR	execute_command	; unk_6BD = command to run
   4510  9b9f		       4c d8 9a 	      JMP	edit_mode_loop
   4511  9ba2							; End of function edit_mode_loop
   4512  9ba2
   4513  9ba2
   4514  9ba2
   4515  9ba2							; poll state of	key.
   4516  9ba2							;
   4517  9ba2							; Entry:
   4518  9ba2							; X = -ve INKEY	value
   4519  9ba2							;
   4520  9ba2							; Exit:
   4521  9ba2							; X = 0	and Z set if key pressed
   4522  9ba2
   4523  9ba2				   poll_key
   4524  9ba2
   4525  9ba2		       a0 ff		      LDY	#$FF
   4526  9ba4		       a9 81		      LDA	#129
   4527  9ba6		       20 f4 ff 	      JSR	OSBYTE
   4528  9ba9		       e8		      INX
   4529  9baa		       60		      RTS
   4530  9bab							; End of function poll_key
   4531  9bab
   4532  9bab
   4533  9bab
   4534  9bab
   4535  9bab				   make_cursor_invisible
   4536  9bab
   4537  9bab		       a2 0a		      LDX	#10
   4538  9bad		       a0 20		      LDY	#32
   4539  9baf							; End of function make_cursor_invisible
   4540  9baf
   4541  9baf
   4542  9baf
   4543  9baf							; X = CRTC register
   4544  9baf							; Y = value
   4545  9baf
   4546  9baf				   write_crtc
   4547  9baf
   4548  9baf		       48		      PHA		; save A
   4549  9bb0		       98		      TYA
   4550  9bb1		       48		      PHA		; save Y
   4551  9bb2		       8a		      TXA
   4552  9bb3		       a8		      TAY		; value	to write = original X
   4553  9bb4		       a2 00		      LDX	#0	; $FE00	(CRTC register select)
   4554  9bb6		       a9 97		      LDA	#151	; write	SHEILA
   4555  9bb8		       20 f4 ff 	      JSR	OSBYTE
   4556  9bbb		       68		      PLA
   4557  9bbc		       a8		      TAY		; value	to write = original Y
   4558  9bbd		       a2 01		      LDX	#1	; $FE01	(CRTC register value)
   4559  9bbf		       a9 97		      LDA	#151	; write	SHEILA
   4560  9bc1		       20 f4 ff 	      JSR	OSBYTE
   4561  9bc4		       68		      PLA
   4562  9bc5		       60		      RTS
   4563  9bc6							; End of function write_crtc
   4564  9bc6
   4565  9bc6
   4566  9bc6
   4567  9bc6
   4568  9bc6				   reset_cursor_shape
   4569  9bc6
   4570  9bc6		       20 ee 9b 	      JSR	get_current_mode_in_x
   4571  9bc9		       a9 00		      LDA	#0
   4572  9bcb		       a4 3c		      LDY	is_insert_mode	; 0=overtype 1=insert
   4573  9bcd		       d0 03		      BNE	loc_9BD2
   4574  9bcf		       bd c1 89 	      LDA	byte_89C1,X
   4575  9bd2
   4576  9bd2				   loc_9BD2
   4577  9bd2		       05 31		      ORA	unk_31
   4578  9bd4		       a8		      TAY
   4579  9bd5		       a2 0a		      LDX	#10
   4580  9bd7		       20 af 9b 	      JSR	write_crtc
   4581  9bda		       20 ee 9b 	      JSR	get_current_mode_in_x
   4582  9bdd		       a5 3c		      LDA	is_insert_mode	; 0=overtype 1=insert
   4583  9bdf		       d0 05		      BNE	loc_9BE6
   4584  9be1		       bc c9 89 	      LDY	byte_89C9,X
   4585  9be4		       d0 03		      BNE	loc_9BE9
   4586  9be6
   4587  9be6				   loc_9BE6
   4588  9be6		       bc d1 89 	      LDY	byte_89D1,X
   4589  9be9
   4590  9be9				   loc_9BE9
   4591  9be9		       a2 0b		      LDX	#11
   4592  9beb		       4c af 9b 	      JMP	write_crtc
   4593  9bee							; End of function reset_cursor_shape
   4594  9bee
   4595  9bee
   4596  9bee
   4597  9bee
   4598  9bee				   get_current_mode_in_x
   4599  9bee
   4600  9bee		       a9 87		      LDA	#135
   4601  9bf0		       20 f4 ff 	      JSR	OSBYTE
   4602  9bf3		       98		      TYA
   4603  9bf4		       aa		      TAX
   4604  9bf5		       60		      RTS
   4605  9bf6							; End of function get_current_mode_in_x
   4606  9bf6
   4607  9bf6
   4608  9bf6
   4609  9bf6
   4610  9bf6				   kbflush
   4611  9bf6
   4612  9bf6		       a2 00		      LDX	#0	; Flush	keyboard buffer
   4613  9bf8		       8e ab 06 	      STX	byte_6AB
   4614  9bfb		       a9 15		      LDA	#21	; Flush	specific buffer	(AUG p138)
   4615  9bfd		       20 f4 ff 	      JSR	OSBYTE
   4616  9c00		       a9 d8		      LDA	#216	; Read/write length of soft key	string
   4617  9c02		       20 91 8e 	      JSR	osbyte_with_y0	; Cancel any current soft key expansion
   4618  9c05		       4c 29 95 	      JMP	clear_escape_condition
   4619  9c08							; End of function kbflush
   4620  9c08
   4621  9c08
   4622  9c08
   4623  9c08
   4624  9c08				   detokenize_one_line
   4625  9c08
   4626  9c08		       a9 01		      LDA	#1
   4627  9c0a		       85 0c		      STA	byte_C
   4628  9c0c		       a9 04		      LDA	#4
   4629  9c0e		       85 0d		      STA	byte_D
   4630  9c10		       a2 00		      LDX	#0
   4631  9c12		       8e 00 04 	      STX	byte_400
   4632  9c15		       8e a8 06 	      STX	byte_6A8
   4633  9c18		       e8		      INX		; X=1
   4634  9c19		       a0 24		      LDY	#$24	; '$'
   4635  9c1b		       a9 20		      LDA	#$20	; ' '
   4636  9c1d		       20 6c 8e 	      JSR	memset	; Clear	$401 - $525
   4637  9c20		       a6 2c		      LDX	byte_2C	; get MSB of address
   4638  9c22		       e8		      INX
   4639  9c23		       d0 01		      BNE	loc_9C26	; branch taken if MSB of address wasn't $FF
   4640  9c25
   4641  9c25				   locret_9C25
   4642  9c25		       60		      RTS
   4643  9c26
   4644  9c26				   loc_9C26
   4645  9c26		       20 36 9c 	      JSR	detokenize_line	; detokenize line and store result.
   4646  9c29							;
   4647  9c29							; Entry:
   4648  9c29							; (byte_2B) points to line
   4649  9c29							;
   4650  9c29							; Exit:
   4651  9c29							; $400 = line length
   4652  9c29							; $401... = line text
   4653  9c29							; unk_6A8 incremented if line too long
   4654  9c29		       ad a8 06 	      LDA	byte_6A8	; line too long?
   4655  9c2c		       f0 f7		      BEQ	locret_9C25	; branch taken if line not too long
   4656  9c2e		       20 39 a0 	      JSR	save_line_number	; saves line number from program.
   4657  9c31							;
   4658  9c31							; Entry:
   4659  9c31							; (byte_2b) points to current line
   4660  9c31							;
   4661  9c31							; Exit:
   4662  9c31							; current_line_no_lsb, current_line_no_msb = the line number
   4663  9c31		       a9 04		      LDA	#4	; "Line	too long"
   4664  9c33		       4c 9d 85 	      JMP	loc_859D
   4665  9c36							; End of function detokenize_one_line
   4666  9c36
   4667  9c36
   4668  9c36
   4669  9c36							; detokenize line and store result.
   4670  9c36							;
   4671  9c36							; Entry:
   4672  9c36							; (byte_2B) points to line
   4673  9c36							;
   4674  9c36							; Exit:
   4675  9c36							; $400 = line length
   4676  9c36							; $401... = line text
   4677  9c36							; unk_6A8 incremented if line too long
   4678  9c36
   4679  9c36				   detokenize_line
   4680  9c36
   4681  9c36		       18		      CLC
   4682  9c37							; Point (unk_27) at start of data of current line
   4683  9c37		       a5 2b		      LDA	byte_2B
   4684  9c39		       69 04		      ADC	#4	; +4 - skip 13,	line MSB, line LSB, line length.
   4685  9c3b		       85 27		      STA	byte_27
   4686  9c3d		       a5 2c		      LDA	byte_2C
   4687  9c3f		       85 28		      STA	byte_28
   4688  9c41		       90 02		      BCC	loc_9C45
   4689  9c43		       e6 28		      INC	byte_28
   4690  9c45
   4691  9c45				   loc_9C45
   4692  9c45		       a9 00		      LDA	#0
   4693  9c47		       8d 00 04 	      STA	byte_400
   4694  9c4a		       85 23		      STA	byte_23	; index	in body	of line
   4695  9c4c		       85 25		      STA	byte_25	; not inside quotes
   4696  9c4e		       a0 03		      LDY	#3	; index	of line	length
   4697  9c50		       b1 2b		      LDA	(byte_2B),Y	; get total line length
   4698  9c52		       38		      SEC
   4699  9c53		       e9 04		      SBC	#4	; subtract 4 as	the metadata is	already	considered
   4700  9c55		       85 24		      STA	byte_24	; ?unk_24 = length of body of line
   4701  9c57		       f0 17		      BEQ	detokenize_line_done	; branch taken if line is empty
   4702  9c59
   4703  9c59				   loc_9C59
   4704  9c59		       a9 04		      LDA	#4
   4705  9c5b		       85 0f		      STA	byte_F
   4706  9c5d		       18		      CLC
   4707  9c5e		       a9 01		      LDA	#1
   4708  9c60		       6d 00 04 	      ADC	byte_400
   4709  9c63		       85 0e		      STA	byte_E
   4710  9c65		       90 02		      BCC	loc_9C69
   4711  9c67		       e6 0f		      INC	byte_F
   4712  9c69
   4713  9c69				   loc_9C69
   4714  9c69		       a6 24		      LDX	byte_24	; get line length
   4715  9c6b		       ca		      DEX		; -1 to	get index of last byte
   4716  9c6c		       e4 23		      CPX	byte_23	; compare to current index
   4717  9c6e		       b0 01		      BCS	loc_9C71	; branch taken if there's still more data to go
   4718  9c70
   4719  9c70				   detokenize_line_done
   4720  9c70		       60		      RTS
   4721  9c71
   4722  9c71				   loc_9C71
   4723  9c71		       a5 25		      LDA	byte_25	; in string?
   4724  9c73		       f0 21		      BEQ	copy_tokenized	; branch taken if not in string
   4725  9c75							; point (byte_C) at byte in program
   4726  9c75
   4727  9c75				   not_token
   4728  9c75
   4729  9c75		       a5 28		      LDA	byte_28
   4730  9c77		       85 0d		      STA	byte_D
   4731  9c79		       a5 23		      LDA	byte_23
   4732  9c7b		       18		      CLC
   4733  9c7c		       65 27		      ADC	byte_27
   4734  9c7e		       85 0c		      STA	byte_C
   4735  9c80		       90 02		      BCC	copy_whilst_checking_for_quotes
   4736  9c82		       e6 0d		      INC	byte_D
   4737  9c84
   4738  9c84				   copy_whilst_checking_for_quotes
   4739  9c84		       a4 23		      LDY	byte_23
   4740  9c86		       b1 27		      LDA	(byte_27),Y	; get next byte
   4741  9c88		       c9 22		      CMP	#34	; quotes?
   4742  9c8a		       d0 06		      BNE	read_byte
   4743  9c8c							; toggle 'in quotes' flag
   4744  9c8c		       a5 25		      LDA	byte_25
   4745  9c8e		       49 01		      EOR	#1
   4746  9c90		       85 25		      STA	byte_25
   4747  9c92
   4748  9c92				   read_byte
   4749  9c92		       a0 01		      LDY	#1
   4750  9c94		       d0 59		      BNE	advance
   4751  9c96
   4752  9c96				   copy_tokenized
   4753  9c96		       a4 23		      LDY	byte_23
   4754  9c98		       b1 27		      LDA	(byte_27),Y	; get next byte	from line
   4755  9c9a		       10 d9		      BPL	not_token	; if positive, not a taken
   4756  9c9c		       c9 8d		      CMP	#$8D	; is this a line number?
   4757  9c9e		       d0 26		      BNE	token	; branch taken if not a	line number
   4758  9ca0		       98		      TYA
   4759  9ca1		       18		      CLC
   4760  9ca2		       69 03		      ADC	#3	; +3 - skip line number	data
   4761  9ca4		       b0 cf		      BCS	not_token	; if carry set,	assume end of line
   4762  9ca6		       c5 24		      CMP	byte_24	; past end of line?
   4763  9ca8		       b0 cb		      BCS	not_token	; branch taken if past end of line
   4764  9caa		       20 12 9d 	      JSR	decode_line_number	; decode line number	from program.
   4765  9cad							;
   4766  9cad							; Entry:
   4767  9cad							; (unk_27),Y points to 8D token
   4768  9cad							;
   4769  9cad							; Exit:
   4770  9cad							; unk_21.w is line number.
   4771  9cad		       a6 22		      LDX	byte_22
   4772  9caf		       a4 21		      LDY	byte_21
   4773  9cb1		       20 b6 8d 	      JSR	itoa	; Gets string representation of	16-bit number.
   4774  9cb4							;
   4775  9cb4							; Entry:
   4776  9cb4							; Y,X =	value
   4777  9cb4							;
   4778  9cb4							; Exit:
   4779  9cb4							; unk_0	holds digit count
   4780  9cb4							; unk_1... filled with string
   4781  9cb4		       a9 01		      LDA	#1	; #<unk_1
   4782  9cb6		       85 0c		      STA	byte_C
   4783  9cb8		       a9 00		      LDA	#0	; #>unk_1
   4784  9cba		       85 0d		      STA	byte_D
   4785  9cbc							; Skip 3 bytes (line number data)
   4786  9cbc		       e6 23		      INC	byte_23
   4787  9cbe		       e6 23		      INC	byte_23
   4788  9cc0		       e6 23		      INC	byte_23
   4789  9cc2		       a4 00		      LDY	byte_0
   4790  9cc4		       d0 29		      BNE	advance	; JMP, in effect, I think...
   4791  9cc6
   4792  9cc6				   token
   4793  9cc6		       85 26		      STA	byte_26	; ?byte_26 = token being searched for
   4794  9cc8		       a9 ce		      LDA	#$CE	; #<token_table
   4795  9cca		       85 0c		      STA	byte_C
   4796  9ccc		       a9 a2		      LDA	#$A2	; #>token_table
   4797  9cce		       85 0d		      STA	byte_D
   4798  9cd0
   4799  9cd0				   loc_9CD0
   4800  9cd0		       a0 00		      LDY	#0
   4801  9cd2
   4802  9cd2				   find_token_value_loop
   4803  9cd2		       b1 0c		      LDA	(byte_C),Y	; get next byte	from token table
   4804  9cd4		       30 03		      BMI	found_token_value	; branch taken if it's a token value
   4805  9cd6		       c8		      INY
   4806  9cd7		       d0 f9		      BNE	find_token_value_loop
   4807  9cd9
   4808  9cd9				   found_token_value
   4809  9cd9		       c5 26		      CMP	byte_26	; is it	the desired token?
   4810  9cdb		       f0 12		      BEQ	advance	; branch taken if token	found
   4811  9cdd		       c9 d3		      CMP	#$D3	; HIMEM, statement version?
   4812  9cdf		       f0 94		      BEQ	not_token	; ??? -	branch taken if	so
   4813  9ce1		       c8		      INY		; skip token ID
   4814  9ce2		       c8		      INY		; skip other byte
   4815  9ce3							; advance (byte_C) to next entry in token table
   4816  9ce3		       98		      TYA
   4817  9ce4		       18		      CLC
   4818  9ce5		       65 0c		      ADC	byte_C
   4819  9ce7		       85 0c		      STA	byte_C
   4820  9ce9		       90 02		      BCC	loc_9CED
   4821  9ceb		       e6 0d		      INC	byte_D
   4822  9ced
   4823  9ced				   loc_9CED
   4824  9ced		       d0 e1		      BNE	loc_9CD0
   4825  9cef
   4826  9cef				   advance
   4827  9cef
   4828  9cef		       98		      TYA		; get length of	token
   4829  9cf0		       18		      CLC
   4830  9cf1		       6d 00 04 	      ADC	byte_400	; add to current length
   4831  9cf4		       b0 10		      BCS	overflow	; branch taken if line too long...
   4832  9cf6		       c9 fc		      CMP	#$FC
   4833  9cf8		       b0 0c		      BCS	overflow	; branch taken if line too long...
   4834  9cfa		       8d 00 04 	      STA	byte_400	; store	new current length
   4835  9cfd		       88		      DEY		; Y = index of last char of token
   4836  9cfe		       20 0a 9d 	      JSR	copy_detokenized_text	;	copy text whilst detokenizing.
   4837  9d01							;
   4838  9d01							; Entry:
   4839  9d01							; (byte_C) points to source text
   4840  9d01							; (byte_E) points to space in dest buffer
   4841  9d01							; Y is index of	last byte in each case (bytes are copied until Y<0)
   4842  9d01		       e6 23		      INC	byte_23	; next byte in line
   4843  9d03		       4c 59 9c 	      JMP	loc_9C59
   4844  9d06
   4845  9d06				   overflow
   4846  9d06
   4847  9d06		       ee a8 06 	      INC	byte_6A8
   4848  9d09		       60		      RTS
   4849  9d0a
   4850  9d0a				   copy_detokenized_text
   4851  9d0a
   4852  9d0a		       b1 0c		      LDA	(byte_C),Y	; copy text whilst detokenizing.
   4853  9d0c							;
   4854  9d0c							; Entry:
   4855  9d0c							; (byte_C) points to source text
   4856  9d0c							; (byte_E) points to space in dest buffer
   4857  9d0c							; Y is index of	last byte in each case (bytes are copied until Y<0)
   4858  9d0c		       91 0e		      STA	(byte_E),Y
   4859  9d0e		       88		      DEY
   4860  9d0f		       10 f9		      BPL	copy_detokenized_text	;	copy text whilst detokenizing.
   4861  9d11							;
   4862  9d11							; Entry:
   4863  9d11							; (byte_C) points to source text
   4864  9d11							; (byte_E) points to space in dest buffer
   4865  9d11							; Y is index of	last byte in each case (bytes are copied until Y<0)
   4866  9d11		       60		      RTS
   4867  9d12							; End of function detokenize_line
   4868  9d12
   4869  9d12
   4870  9d12
   4871  9d12							; decode line number from program.
   4872  9d12							;
   4873  9d12							; Entry:
   4874  9d12							; (unk_27),Y points to 8D token
   4875  9d12							;
   4876  9d12							; Exit:
   4877  9d12							; unk_21.w is line number.
   4878  9d12
   4879  9d12				   decode_line_number
   4880  9d12
   4881  9d12		       c8		      INY
   4882  9d13		       b1 27		      LDA	(byte_27),Y	; get first line number	byte
   4883  9d15		       48		      PHA		; store
   4884  9d16		       a2 01		      LDX	#1
   4885  9d18
   4886  9d18				   decode_line_number_loop
   4887  9d18		       68		      PLA		; get last byte
   4888  9d19		       2a		      ROL
   4889  9d1a		       2a		      ROL		; <<2
   4890  9d1b		       48		      PHA		; save
   4891  9d1c		       29 c0		      AND	#%11000000
   4892  9d1e		       c8		      INY
   4893  9d1f		       51 27		      EOR	(byte_27),Y
   4894  9d21		       95 21		      STA	byte_21,X
   4895  9d23		       ca		      DEX
   4896  9d24		       10 f2		      BPL	decode_line_number_loop
   4897  9d26		       68		      PLA
   4898  9d27		       60		      RTS
   4899  9d28							; End of function decode_line_number
   4900  9d28
   4901  9d28
   4902  9d28
   4903  9d28
   4904  9d28				   enter_edit_mode
   4905  9d28
   4906  9d28		       a9 01		      LDA	#1
   4907  9d2a		       8d ab 06 	      STA	byte_6AB
   4908  9d2d
   4909  9d2d				   loc_9D2D
   4910  9d2d		       a9 16		      LDA	#22
   4911  9d2f		       20 ee ff 	      JSR	OSWRCH
   4912  9d32		       a5 14		      LDA	screen_mode
   4913  9d34		       20 ee ff 	      JSR	OSWRCH
   4914  9d37		       20 1f 83 	      JSR	find_program
   4915  9d3a		       90 03		      BCC	loc_9D3F
   4916  9d3c		       4c 4d 81 	      JMP	loc_814D
   4917  9d3f
   4918  9d3f				   loc_9D3F
   4919  9d3f		       20 d5 9e 	      JSR	set_palette
   4920  9d42		       a9 02		      LDA	#2
   4921  9d44		       8d b7 06 	      STA	editor_mode_id	; 1=command mode, 2=edit mode
   4922  9d47		       a9 0d		      LDA	#13
   4923  9d49		       20 ee ff 	      JSR	OSWRCH
   4924  9d4c		       a2 09		      LDX	#9	; VDU variable 9 - text	window coordinates, bottom (X) + right (Y) (AUG	p275)
   4925  9d4e		       a9 a0		      LDA	#160	; read VDU variable value (AUG p179)
   4926  9d50		       20 f4 ff 	      JSR	OSBYTE
   4927  9d53		       8e bf 06 	      STX	screen_height	; store	screen height
   4928  9d56		       98		      TYA		; get screen width in A
   4929  9d57		       38		      SEC
   4930  9d58		       e9 06		      SBC	#6	; subtract 6 to	account	for line number	display
   4931  9d5a		       8d b6 06 	      STA	code_area_width	; store	usable screen width
   4932  9d5d		       a2 09		      LDX	#9	; set TAB key to produce CHR$9
   4933  9d5f		       a9 db		      LDA	#219	; Read/write character value returned by pressing TAB key (AUG p222)
   4934  9d61		       20 91 8e 	      JSR	osbyte_with_y0
   4935  9d64		       4c 37 84 	      JMP	loc_8437
   4936  9d67							; End of function enter_edit_mode
   4937  9d67
   4938  9d67
   4939  9d67				   loc_9D67
   4940  9d67		       20 28 9d 	      JSR	enter_edit_mode
   4941  9d6a		       20 e9 9f 	      JSR	is_program_empty	; sets	C if no	program
   4942  9d6d		       b0 39		      BCS	loc_9DA8
   4943  9d6f		       a5 50		      LDA	byte_50
   4944  9d71		       85 2b		      STA	byte_2B
   4945  9d73		       a5 51		      LDA	byte_51
   4946  9d75		       85 2c		      STA	byte_2C
   4947  9d77		       20 8f 9e 	      JSR	find_line_by_number	; finds a line, given a line number
   4948  9d7a							;
   4949  9d7a							; Entry:
   4950  9d7a							; byte_2B: line	number MSB
   4951  9d7a							; byte_2C: line	number LSB
   4952  9d7a							;
   4953  9d7a							; Exit:
   4954  9d7a							; (byte_2B) points to most suitable line
   4955  9d7a		       a0 01		      LDY	#1
   4956  9d7c		       b1 2b		      LDA	($2B),Y
   4957  9d7e		       30 28		      BMI	loc_9DA8
   4958  9d80		       a5 2b		      LDA	byte_2B
   4959  9d82		       8d c0 06 	      STA	byte_6C0
   4960  9d85		       a5 2c		      LDA	byte_2C
   4961  9d87		       8d c1 06 	      STA	byte_6C1
   4962  9d8a		       20 98 96 	      JSR	sub_9698
   4963  9d8d		       b0 19		      BCS	loc_9DA8
   4964  9d8f		       a5 4a		      LDA	current_line_no_lsb
   4965  9d91		       48		      PHA
   4966  9d92		       a5 4b		      LDA	current_line_no_msb
   4967  9d94		       48		      PHA
   4968  9d95		       20 06 97 	      JSR	sub_9706
   4969  9d98		       20 0e a0 	      JSR	cls_and_reset_6c0_to_6ff
   4970  9d9b		       18		      CLC
   4971  9d9c		       20 ea 9d 	      JSR	sub_9DEA
   4972  9d9f		       68		      PLA
   4973  9da0		       85 4b		      STA	current_line_no_msb
   4974  9da2		       68		      PLA
   4975  9da3		       85 4a		      STA	current_line_no_lsb
   4976  9da5		       4c e4 9d 	      JMP	loc_9DE4
   4977  9da8
   4978  9da8				   loc_9DA8
   4979  9da8
   4980  9da8		       20 e9 9f 	      JSR	is_program_empty	; sets	C if no	program
   4981  9dab		       90 1c		      BCC	loc_9DC9
   4982  9dad		       20 f8 82 	      JSR	clear_program
   4983  9db0		       20 0e a0 	      JSR	cls_and_reset_6c0_to_6ff
   4984  9db3		       a2 ae		      LDX	#$AE	; #<empty_program_string
   4985  9db5		       a0 89		      LDY	#$89	; #>empty_program_string
   4986  9db7		       a9 05		      LDA	#5
   4987  9db9		       20 0e 8f 	      JSR	print_n_chars
   4988  9dbc		       a2 ff		      LDX	#$FF
   4989  9dbe		       8e c0 06 	      STX	byte_6C0
   4990  9dc1		       8e c1 06 	      STX	byte_6C1
   4991  9dc4		       86 2c		      STX	byte_2C
   4992  9dc6		       4c e4 9d 	      JMP	loc_9DE4
   4993  9dc9
   4994  9dc9				   loc_9DC9
   4995  9dc9		       a5 4b		      LDA	current_line_no_msb
   4996  9dcb		       85 2c		      STA	byte_2C
   4997  9dcd		       a5 4a		      LDA	current_line_no_lsb
   4998  9dcf		       85 2b		      STA	byte_2B
   4999  9dd1		       20 0e a0 	      JSR	cls_and_reset_6c0_to_6ff
   5000  9dd4		       a9 00		      LDA	#0
   5001  9dd6		       85 3b		      STA	byte_3B
   5002  9dd8		       18		      CLC
   5003  9dd9		       20 ea 9d 	      JSR	sub_9DEA
   5004  9ddc		       a2 01		      LDX	#1
   5005  9dde		       20 45 a0 	      JSR	get_line_ptr	; gets pointer to line visible on screen.
   5006  9de1							;
   5007  9de1							; Entry:
   5008  9de1							; X = screen line number * 2 + 1
   5009  9de1							;
   5010  9de1							; Exit:
   5011  9de1							; (byte_2B) points to BASIC line
   5012  9de1							; X decremented
   5013  9de1		       20 39 a0 	      JSR	save_line_number	; saves line number from program.
   5014  9de4							;
   5015  9de4							; Entry:
   5016  9de4							; (byte_2b) points to current line
   5017  9de4							;
   5018  9de4							; Exit:
   5019  9de4							; current_line_no_lsb, current_line_no_msb = the line number
   5020  9de4
   5021  9de4				   loc_9DE4
   5022  9de4		       20 d8 9f 	      JSR	sub_9FD8
   5023  9de7		       4c d8 9a 	      JMP	edit_mode_loop
   5024  9dea
   5025  9dea
   5026  9dea
   5027  9dea				   sub_9DEA
   5028  9dea
   5029  9dea		       08		      PHP
   5030  9deb		       20 ab 9b 	      JSR	make_cursor_invisible
   5031  9dee		       20 8f 9e 	      JSR	find_line_by_number	; finds a line, given a line number
   5032  9df1							;
   5033  9df1							; Entry:
   5034  9df1							; byte_2B: line	number MSB
   5035  9df1							; byte_2C: line	number LSB
   5036  9df1							;
   5037  9df1							; Exit:
   5038  9df1							; (byte_2B) points to most suitable line
   5039  9df1
   5040  9df1				   loc_9DF1
   5041  9df1		       a0 01		      LDY	#1
   5042  9df3		       b1 2b		      LDA	($2B),Y
   5043  9df5		       30 22		      BMI	loc_9E19
   5044  9df7		       20 08 9c 	      JSR	detokenize_one_line
   5045  9dfa		       20 5f 9e 	      JSR	sub_9E5F
   5046  9dfd		       90 1a		      BCC	loc_9E19
   5047  9dff		       28		      PLP
   5048  9e00		       08		      PHP
   5049  9e01		       90 06		      BCC	loc_9E09
   5050  9e03		       20 00 9f 	      JSR	sub_9F00
   5051  9e06		       4c 0c 9e 	      JMP	loc_9E0C
   5052  9e09
   5053  9e09				   loc_9E09
   5054  9e09		       20 82 9e 	      JSR	sub_9E82
   5055  9e0c
   5056  9e0c				   loc_9E0C
   5057  9e0c		       18		      CLC
   5058  9e0d		       a5 3b		      LDA	byte_3B
   5059  9e0f		       65 2d		      ADC	byte_2D
   5060  9e11		       85 3b		      STA	byte_3B
   5061  9e13		       20 52 92 	      JSR	advance_2b_to_next_line
   5062  9e16		       4c f1 9d 	      JMP	loc_9DF1
   5063  9e19
   5064  9e19				   loc_9E19
   5065  9e19		       28		      PLP
   5066  9e1a		       08		      PHP
   5067  9e1b		       90 40		      BCC	loc_9E5D
   5068  9e1d		       a9 01		      LDA	#1
   5069  9e1f		       85 0c		      STA	byte_C
   5070  9e21		       a9 04		      LDA	#4
   5071  9e23		       85 0d		      STA	byte_D
   5072  9e25		       a2 00		      LDX	#0
   5073  9e27		       a0 4f		      LDY	#$4F	; 'O'
   5074  9e29		       a9 20		      LDA	#$20	; ' '
   5075  9e2b		       20 6c 8e 	      JSR	memset	; Set memory to	value.
   5076  9e2e							;
   5077  9e2e							; ($C) points to memory	to clear.
   5078  9e2e							; X holds number of pages to clear.
   5079  9e2e							; Y holds number of bytes to clear in Xth page.
   5080  9e2e							; A holds value	to write.
   5081  9e2e
   5082  9e2e				   loc_9E2E
   5083  9e2e		       a5 3b		      LDA	byte_3B
   5084  9e30		       cd bf 06 	      CMP	screen_height
   5085  9e33		       f0 02		      BEQ	loc_9E37
   5086  9e35		       b0 26		      BCS	loc_9E5D
   5087  9e37
   5088  9e37				   loc_9E37
   5089  9e37		       0a		      ASL
   5090  9e38		       a8		      TAY
   5091  9e39		       b9 c1 06 	      LDA	$6C1,Y
   5092  9e3c		       f0 1f		      BEQ	loc_9E5D
   5093  9e3e		       a2 00		      LDX	#0
   5094  9e40		       8a		      TXA
   5095  9e41		       99 c0 06 	      STA	$6C0,Y
   5096  9e44		       99 c1 06 	      STA	$6C1,Y
   5097  9e47		       a4 3b		      LDY	byte_3B
   5098  9e49		       20 01 8f 	      JSR	gotoxy
   5099  9e4c		       18		      CLC
   5100  9e4d		       ad b6 06 	      LDA	code_area_width
   5101  9e50		       69 06		      ADC	#6
   5102  9e52		       a2 01		      LDX	#1
   5103  9e54		       a0 04		      LDY	#4
   5104  9e56		       20 0e 8f 	      JSR	print_n_chars
   5105  9e59		       e6 3b		      INC	byte_3B
   5106  9e5b		       d0 d1		      BNE	loc_9E2E
   5107  9e5d
   5108  9e5d				   loc_9E5D
   5109  9e5d		       68		      PLA
   5110  9e5e		       60		      RTS
   5111  9e5f							; End of function sub_9DEA
   5112  9e5f
   5113  9e5f
   5114  9e5f
   5115  9e5f
   5116  9e5f				   sub_9E5F
   5117  9e5f
   5118  9e5f		       20 1e a0 	      JSR	sub_A01E
   5119  9e62		       20 39 a0 	      JSR	save_line_number	; saves line number from program.
   5120  9e65							;
   5121  9e65							; Entry:
   5122  9e65							; (byte_2b) points to current line
   5123  9e65							;
   5124  9e65							; Exit:
   5125  9e65							; current_line_no_lsb, current_line_no_msb = the line number
   5126  9e65		       ad bf 06 	      LDA	screen_height
   5127  9e68		       38		      SEC
   5128  9e69		       e5 3b		      SBC	byte_3B
   5129  9e6b		       18		      CLC
   5130  9e6c		       69 01		      ADC	#1
   5131  9e6e		       c5 2d		      CMP	byte_2D
   5132  9e70		       90 0f		      BCC	locret_9E81
   5133  9e72		       a5 3b		      LDA	byte_3B
   5134  9e74		       0a		      ASL
   5135  9e75		       a8		      TAY
   5136  9e76		       a5 2b		      LDA	byte_2B
   5137  9e78		       99 c0 06 	      STA	$6C0,Y
   5138  9e7b		       a5 2c		      LDA	byte_2C
   5139  9e7d		       99 c1 06 	      STA	$6C1,Y
   5140  9e80		       38		      SEC
   5141  9e81
   5142  9e81				   locret_9E81
   5143  9e81		       60		      RTS
   5144  9e82							; End of function sub_9E5F
   5145  9e82
   5146  9e82
   5147  9e82
   5148  9e82
   5149  9e82				   sub_9E82
   5150  9e82
   5151  9e82		       a9 01		      LDA	#1
   5152  9e84		       ae 00 04 	      LDX	byte_400
   5153  9e87		       a0 00		      LDY	#0
   5154  9e89		       20 b1 a0 	      JSR	sub_A0B1
   5155  9e8c		       4c 6d a1 	      JMP	redraw_line_number
   5156  9e8f							; End of function sub_9E82
   5157  9e8f
   5158  9e8f
   5159  9e8f
   5160  9e8f							; finds	a line,	given a	line number
   5161  9e8f							;
   5162  9e8f							; Entry:
   5163  9e8f							; byte_2B: line	number MSB
   5164  9e8f							; byte_2C: line	number LSB
   5165  9e8f							;
   5166  9e8f							; Exit:
   5167  9e8f							; (byte_2B) points to most suitable line
   5168  9e8f
   5169  9e8f				   find_line_by_number
   5170  9e8f
   5171  9e8f		       a5 2b		      LDA	byte_2B
   5172  9e91		       85 39		      STA	byte_39
   5173  9e93		       a5 2c		      LDA	byte_2C
   5174  9e95		       85 3a		      STA	byte_3A
   5175  9e97		       a5 17		      LDA	oshwm
   5176  9e99		       85 30		      STA	unk_30
   5177  9e9b		       85 2b		      STA	byte_2B
   5178  9e9d		       a5 18		      LDA	oshwm+1
   5179  9e9f		       85 2c		      STA	byte_2C
   5180  9ea1
   5181  9ea1				   loc_9EA1
   5182  9ea1		       a0 01		      LDY	#1
   5183  9ea3		       b1 2b		      LDA	(byte_2B),Y	; get line MSB
   5184  9ea5		       30 1b		      BMI	find_line_by_number_done	; -ve =	done
   5185  9ea7		       c5 39		      CMP	byte_39
   5186  9ea9		       90 09		      BCC	loc_9EB4	; MSB<?39 -> 9eb4
   5187  9eab		       d0 15		      BNE	find_line_by_number_done
   5188  9ead		       c8		      INY		; offset of line LSB
   5189  9eae		       b1 2b		      LDA	(byte_2B),Y	; get line LSB
   5190  9eb0		       c5 3a		      CMP	byte_3A
   5191  9eb2		       b0 0e		      BCS	find_line_by_number_done
   5192  9eb4							; MSB<?39 && LSB<=?3A
   5193  9eb4
   5194  9eb4				   loc_9EB4
   5195  9eb4		       a5 2b		      LDA	byte_2B
   5196  9eb6		       85 2f		      STA	unk_2F
   5197  9eb8		       a5 2c		      LDA	byte_2C
   5198  9eba		       85 30		      STA	unk_30
   5199  9ebc		       20 52 92 	      JSR	advance_2b_to_next_line
   5200  9ebf		       4c a1 9e 	      JMP	loc_9EA1
   5201  9ec2
   5202  9ec2				   find_line_by_number_done
   5203  9ec2
   5204  9ec2		       60		      RTS
   5205  9ec3							; End of function find_line_by_number
   5206  9ec3
   5207  9ec3
   5208  9ec3
   5209  9ec3							; get height of	current	line
   5210  9ec3							;
   5211  9ec3							; Entry:
   5212  9ec3							; ?byte_400 = line length
   5213  9ec3							;
   5214  9ec3							; Exit:
   5215  9ec3							; X = line height
   5216  9ec3
   5217  9ec3				   get_line_height
   5218  9ec3
   5219  9ec3		       a0 00		      LDY	#0
   5220  9ec5		       ae 00 04 	      LDX	byte_400	; get line length
   5221  9ec8		       20 4e 8f 	      JSR	get_line_dimensions	; work out dimensions of line.
   5222  9ecb							;
   5223  9ecb							; Entry:
   5224  9ecb							; X=line length
   5225  9ecb							; Y=starting Y
   5226  9ecb							;
   5227  9ecb							; Exit:
   5228  9ecb							; X=line length	MOD screen width
   5229  9ecb							; Y=ending Y
   5230  9ecb		       8a		      TXA		; get width
   5231  9ecc		       f0 01		      BEQ	loc_9ECF	; taken	if it fits exactly
   5232  9ece		       c8		      INY		; add an extra line, because it	needs it
   5233  9ecf
   5234  9ecf				   loc_9ECF
   5235  9ecf		       98		      TYA
   5236  9ed0		       aa		      TAX		; X = line height
   5237  9ed1		       d0 01		      BNE	locret_9ED4
   5238  9ed3		       e8		      INX		; set height to	1 if line is empty
   5239  9ed4
   5240  9ed4				   locret_9ED4
   5241  9ed4		       60		      RTS
   5242  9ed5							; End of function get_line_height
   5243  9ed5
   5244  9ed5
   5245  9ed5
   5246  9ed5
   5247  9ed5				   set_palette
   5248  9ed5
   5249  9ed5		       a2 00		      LDX	#0	; set colour 0
   5250  9ed7		       a4 0a		      LDY	background_colour	; get	BACK colour
   5251  9ed9		       20 e7 9e 	      JSR	set_palette_entry	; X=logical colour, Y=physical colour
   5252  9edc		       e8		      INX		; set colour 1
   5253  9edd		       a5 14		      LDA	screen_mode
   5254  9edf		       c9 01		      CMP	#1	; are we in MODE 1?
   5255  9ee1		       d0 02		      BNE	loc_9EE5	; branch taken if not in MODE 1
   5256  9ee3		       a2 03		      LDX	#3	; MODE 1's foreground colour is physical colour 3
   5257  9ee5
   5258  9ee5				   loc_9EE5
   5259  9ee5		       a4 0b		      LDY	foreground_colour	; get	FORE colour
   5260  9ee7
   5261  9ee7				   set_palette_entry
   5262  9ee7		       a9 13		      LDA	#19	; X=logical colour, Y=physical colour
   5263  9ee9		       20 ee ff 	      JSR	OSWRCH
   5264  9eec		       8a		      TXA
   5265  9eed		       20 ee ff 	      JSR	OSWRCH
   5266  9ef0		       98		      TYA
   5267  9ef1		       20 ee ff 	      JSR	OSWRCH
   5268  9ef4		       a9 00		      LDA	#0
   5269  9ef6		       20 ee ff 	      JSR	OSWRCH
   5270  9ef9		       20 ee ff 	      JSR	OSWRCH
   5271  9efc		       20 ee ff 	      JSR	OSWRCH
   5272  9eff		       60		      RTS
   5273  9f00							; End of function set_palette
   5274  9f00
   5275  9f00
   5276  9f00
   5277  9f00
   5278  9f00				   sub_9F00
   5279  9f00		       20 ab 9b 	      JSR	make_cursor_invisible
   5280  9f03		       a9 01		      LDA	#1
   5281  9f05		       a6 08		      LDX	unk_8
   5282  9f07		       a4 09		      LDY	unk_9
   5283  9f09		       20 b1 a0 	      JSR	sub_A0B1
   5284  9f0c		       a2 00		      LDX	#0
   5285  9f0e		       86 36		      STX	byte_36
   5286  9f10
   5287  9f10				   loc_9F10
   5288  9f10		       a2 00		      LDX	#0
   5289  9f12		       18		      CLC
   5290  9f13		       a5 36		      LDA	byte_36
   5291  9f15		       f0 0f		      BEQ	loc_9F26
   5292  9f17		       65 3b		      ADC	byte_3B
   5293  9f19		       a8		      TAY
   5294  9f1a		       20 01 8f 	      JSR	gotoxy
   5295  9f1d		       a2 bb		      LDX	#$BB	; #<six_spaces_string
   5296  9f1f		       a0 89		      LDY	#$89	; #>six_spaces_string
   5297  9f21		       a9 06		      LDA	#6
   5298  9f23		       20 0e 8f 	      JSR	print_n_chars
   5299  9f26
   5300  9f26				   loc_9F26
   5301  9f26		       e6 36		      INC	byte_36
   5302  9f28		       a5 36		      LDA	byte_36
   5303  9f2a		       c5 2d		      CMP	byte_2D
   5304  9f2c		       d0 e2		      BNE	loc_9F10
   5305  9f2e		       4c 6d a1 	      JMP	redraw_line_number
   5306  9f31							; End of function sub_9F00
   5307  9f31
   5308  9f31
   5309  9f31
   5310  9f31							; treats command ID as ASCII char and puts that	char into the current line as appropriate.
   5311  9f31
   5312  9f31				   execute_key_command
   5313  9f31		       a5 11		      LDA	unk_11
   5314  9f33		       d0 34		      BNE	beep
   5315  9f35		       20 1e ab 	      JSR	sub_AB1E
   5316  9f38		       ae 00 04 	      LDX	byte_400	; X = line length
   5317  9f3b		       a5 3c		      LDA	is_insert_mode	; 0=overtype 1=insert
   5318  9f3d		       f0 1d		      BEQ	loc_9F5C	; branch taken if overtype mode
   5319  9f3f		       a5 10		      LDA	cursor_offset	; get cursor offset (?)
   5320  9f41		       cd 00 04 	      CMP	byte_400	; compare to line length
   5321  9f44		       f0 02		      BEQ	loc_9F48
   5322  9f46		       b0 10		      BCS	loc_9F58	; branch taken if cursor offset	> line length
   5323  9f48
   5324  9f48				   loc_9F48
   5325  9f48		       ac 00 04 	      LDY	byte_400	; get line length
   5326  9f4b		       f0 08		      BEQ	loc_9F55
   5327  9f4d		       88		      DEY
   5328  9f4e		       b9 01 04 	      LDA	$401,Y
   5329  9f51		       c9 20		      CMP	#$20	; ' '
   5330  9f53		       f0 1a		      BEQ	sub_9F6F
   5331  9f55
   5332  9f55				   loc_9F55
   5333  9f55		       e8		      INX
   5334  9f56		       d0 0d		      BNE	loc_9F65
   5335  9f58
   5336  9f58				   loc_9F58
   5337  9f58
   5338  9f58		       a6 10		      LDX	cursor_offset	; offset of cursor in detokenized buffer
   5339  9f5a		       d0 09		      BNE	loc_9F65
   5340  9f5c
   5341  9f5c				   loc_9F5C
   5342  9f5c		       a5 10		      LDA	cursor_offset	; offset of cursor in detokenized buffer
   5343  9f5e		       cd 00 04 	      CMP	byte_400
   5344  9f61		       f0 0c		      BEQ	sub_9F6F
   5345  9f63		       b0 f3		      BCS	loc_9F58
   5346  9f65
   5347  9f65				   loc_9F65
   5348  9f65
   5349  9f65		       e0 fc		      CPX	#$FC
   5350  9f67		       90 06		      BCC	sub_9F6F
   5351  9f69							; End of function execute_key_command
   5352  9f69
   5353  9f69
   5354  9f69
   5355  9f69
   5356  9f69				   beep
   5357  9f69
   5358  9f69		       a9 07		      LDA	#7
   5359  9f6b		       20 ee ff 	      JSR	OSWRCH
   5360  9f6e		       60		      RTS
   5361  9f6f							; End of function beep
   5362  9f6f
   5363  9f6f
   5364  9f6f
   5365  9f6f
   5366  9f6f				   sub_9F6F
   5367  9f6f
   5368  9f6f		       8a		      TXA
   5369  9f70		       48		      PHA
   5370  9f71		       a5 10		      LDA	cursor_offset	; offset of cursor in detokenized buffer
   5371  9f73		       48		      PHA
   5372  9f74		       48		      PHA
   5373  9f75		       a5 3c		      LDA	is_insert_mode	; 0=overtype 1=insert
   5374  9f77		       f0 18		      BEQ	store_char	; branch taken if overtype
   5375  9f79		       a5 10		      LDA	cursor_offset	; offset of cursor in detokenized buffer
   5376  9f7b		       cd 00 04 	      CMP	byte_400
   5377  9f7e		       f0 02		      BEQ	insert	; branch taken if at end of line
   5378  9f80		       b0 0f		      BCS	store_char	; branch taken if past end of line
   5379  9f82
   5380  9f82				   insert
   5381  9f82		       68		      PLA
   5382  9f83		       8a		      TXA
   5383  9f84		       48		      PHA
   5384  9f85		       a2 ff		      LDX	#$FF
   5385  9f87		       86 0c		      STX	byte_C
   5386  9f89		       e8		      INX
   5387  9f8a		       86 0e		      STX	byte_E
   5388  9f8c		       e8		      INX
   5389  9f8d		       8a		      TXA
   5390  9f8e		       20 b2 9f 	      JSR	sub_9FB2
   5391  9f91
   5392  9f91				   store_char
   5393  9f91		       ad bd 06 	      LDA	current_command_id	; get char to write
   5394  9f94		       a4 10		      LDY	cursor_offset	; offset of cursor in detokenized buffer
   5395  9f96		       88		      DEY		; make relative	to tex
   5396  9f97		       99 01 04 	      STA	$401,Y	; store
   5397  9f9a		       a9 01		      LDA	#1
   5398  9f9c		       8d b3 06 	      STA	byte_6B3
   5399  9f9f		       68		      PLA
   5400  9fa0		       aa		      TAX
   5401  9fa1		       68		      PLA
   5402  9fa2		       a8		      TAY
   5403  9fa3		       68		      PLA
   5404  9fa4		       8d 00 04 	      STA	byte_400
   5405  9fa7		       98		      TYA
   5406  9fa8		       a0 00		      LDY	#0
   5407  9faa		       e6 10		      INC	cursor_offset	; advance to next char
   5408  9fac		       20 b1 a0 	      JSR	sub_A0B1
   5409  9faf		       4c a8 a8 	      JMP	position_edit_mode_cursor
   5410  9fb2							; End of function sub_9F6F
   5411  9fb2
   5412  9fb2
   5413  9fb2
   5414  9fb2
   5415  9fb2				   sub_9FB2
   5416  9fb2		       48		      PHA
   5417  9fb3		       a2 02		      LDX	#2
   5418  9fb5		       20 c9 9f 	      JSR	adjust_pointer
   5419  9fb8		       a2 00		      LDX	#0
   5420  9fba		       20 c9 9f 	      JSR	adjust_pointer
   5421  9fbd							; X=0
   5422  9fbd		       68		      PLA
   5423  9fbe		       18		      CLC
   5424  9fbf		       6d 00 04 	      ADC	byte_400	; add line length
   5425  9fc2		       38		      SEC
   5426  9fc3		       e5 10		      SBC	cursor_offset	; subtract cursor offset
   5427  9fc5		       a8		      TAY		; LSB of size
   5428  9fc6		       4c a1 8e 	      JMP	memmove	; move (maybe overlapping) memory regions.
   5429  9fc9							;
   5430  9fc9							; Entry:
   5431  9fc9							; (byte_C) points to src
   5432  9fc9							; (byte_E) points to dest
   5433  9fc9							; X is MSB of size
   5434  9fc9							; Y is LSB of size
   5435  9fc9
   5436  9fc9				   adjust_pointer
   5437  9fc9		       18		      CLC
   5438  9fca		       b5 0c		      LDA	byte_C,X	; get pointer LSB
   5439  9fcc		       69 01		      ADC	#1	; increment
   5440  9fce		       18		      CLC
   5441  9fcf		       65 10		      ADC	cursor_offset	; +?byte_10
   5442  9fd1		       95 0c		      STA	byte_C,X	; store
   5443  9fd3		       a9 04		      LDA	#4
   5444  9fd5		       95 0d		      STA	byte_D,X	; copying in page 4.
   5445  9fd7		       60		      RTS
   5446  9fd8							; End of function sub_9FB2
   5447  9fd8
   5448  9fd8
   5449  9fd8
   5450  9fd8
   5451  9fd8				   sub_9FD8
   5452  9fd8		       20 69 a0 	      JSR	sub_A069
   5453  9fdb		       a2 01		      LDX	#1
   5454  9fdd		       86 10		      STX	cursor_offset	; offset of cursor in detokenized buffer
   5455  9fdf		       ca		      DEX
   5456  9fe0		       86 11		      STX	unk_11
   5457  9fe2		       a2 06		      LDX	#6
   5458  9fe4		       a4 3b		      LDY	byte_3B
   5459  9fe6		       4c 01 8f 	      JMP	gotoxy
   5460  9fe9							; End of function sub_9FD8
   5461  9fe9
   5462  9fe9
   5463  9fe9
   5464  9fe9							; sets C if no program
   5465  9fe9
   5466  9fe9				   is_program_empty
   5467  9fe9
   5468  9fe9		       18		      CLC
   5469  9fea		       a0 01		      LDY	#1
   5470  9fec		       b1 17		      LDA	(oshwm),Y
   5471  9fee		       10 01		      BPL	locret_9FF1
   5472  9ff0		       38		      SEC
   5473  9ff1
   5474  9ff1				   locret_9FF1
   5475  9ff1		       60		      RTS
   5476  9ff2							; End of function is_program_empty
   5477  9ff2
   5478  9ff2
   5479  9ff2
   5480  9ff2
   5481  9ff2				   sub_9FF2
   5482  9ff2		       18		      CLC
   5483  9ff3		       a5 12		      LDA	TOP
   5484  9ff5		       65 27		      ADC	byte_27
   5485  9ff7		       aa		      TAX
   5486  9ff8		       a5 13		      LDA	TOP+1
   5487  9ffa		       65 28		      ADC	byte_28
   5488  9ffc		       c5 07		      CMP	HIMEM+1
   5489  9ffe		       90 0d		      BCC	locret_A00D
   5490  a000		       f0 05		      BEQ	loc_A007
   5491  a002
   5492  a002				   loc_A002
   5493  a002		       a9 05		      LDA	#5
   5494  a004		       4c 9d 85 	      JMP	loc_859D
   5495  a007
   5496  a007				   loc_A007
   5497  a007		       e4 06		      CPX	HIMEM
   5498  a009		       f0 02		      BEQ	locret_A00D
   5499  a00b		       b0 f5		      BCS	loc_A002
   5500  a00d
   5501  a00d				   locret_A00D
   5502  a00d		       60		      RTS
   5503  a00e							; End of function sub_9FF2
   5504  a00e
   5505  a00e
   5506  a00e
   5507  a00e
   5508  a00e				   cls_and_reset_6c0_to_6ff
   5509  a00e
   5510  a00e		       a9 0c		      LDA	#12
   5511  a010		       20 ee ff 	      JSR	OSWRCH
   5512  a013		       a9 00		      LDA	#0
   5513  a015		       a0 3f		      LDY	#$3F
   5514  a017
   5515  a017				   loc_A017
   5516  a017		       99 c0 06 	      STA	byte_6C0,Y
   5517  a01a		       88		      DEY
   5518  a01b		       10 fa		      BPL	loc_A017
   5519  a01d		       60		      RTS
   5520  a01e							; End of function cls_and_reset_6c0_to_6ff
   5521  a01e
   5522  a01e
   5523  a01e
   5524  a01e
   5525  a01e				   sub_A01E
   5526  a01e		       20 c3 9e 	      JSR	get_line_height	; get height of	current	line
   5527  a021							;
   5528  a021							; Entry:
   5529  a021							; ?byte_400 = line length
   5530  a021							;
   5531  a021							; Exit:
   5532  a021							; X = line height
   5533  a021
   5534  a021				   loc_A021
   5535  a021		       86 2d		      STX	byte_2D
   5536  a023		       a9 00		      LDA	#0
   5537  a025		       85 08		      STA	unk_8
   5538  a027		       85 09		      STA	unk_9
   5539  a029
   5540  a029				   loc_A029
   5541  a029		       ad b6 06 	      LDA	code_area_width
   5542  a02c		       18		      CLC
   5543  a02d		       65 08		      ADC	unk_8
   5544  a02f		       85 08		      STA	unk_8
   5545  a031		       90 02		      BCC	loc_A035
   5546  a033		       e6 09		      INC	unk_9
   5547  a035
   5548  a035				   loc_A035
   5549  a035		       ca		      DEX
   5550  a036		       d0 f1		      BNE	loc_A029
   5551  a038		       60		      RTS
   5552  a039							; End of function sub_A01E
   5553  a039
   5554  a039
   5555  a039
   5556  a039							; saves	line number from program.
   5557  a039							;
   5558  a039							; Entry:
   5559  a039							; (byte_2b) points to current line
   5560  a039							;
   5561  a039							; Exit:
   5562  a039							; current_line_no_lsb, current_line_no_msb = the line number
   5563  a039
   5564  a039				   save_line_number
   5565  a039
   5566  a039		       a0 01		      LDY	#1
   5567  a03b		       b1 2b		      LDA	(byte_2B),Y
   5568  a03d		       85 4a		      STA	current_line_no_lsb
   5569  a03f		       c8		      INY
   5570  a040		       b1 2b		      LDA	(byte_2B),Y
   5571  a042		       85 4b		      STA	current_line_no_msb
   5572  a044		       60		      RTS
   5573  a045							; End of function save_line_number
   5574  a045
   5575  a045
   5576  a045
   5577  a045							; gets pointer to line visible on screen.
   5578  a045							;
   5579  a045							; Entry:
   5580  a045							; X = screen line number * 2 + 1
   5581  a045							;
   5582  a045							; Exit:
   5583  a045							; (byte_2B) points to BASIC line
   5584  a045							; X decremented
   5585  a045
   5586  a045				   get_line_ptr
   5587  a045
   5588  a045		       bd c0 06 	      LDA	$6C0,X
   5589  a048		       85 2c		      STA	byte_2C
   5590  a04a		       ca		      DEX
   5591  a04b		       bd c0 06 	      LDA	$6C0,X
   5592  a04e		       85 2b		      STA	byte_2B
   5593  a050		       60		      RTS
   5594  a051							; End of function get_line_ptr
   5595  a051
   5596  a051
   5597  a051
   5598  a051							; determines whether current line is empty.
   5599  a051							;
   5600  a051							; Entry:
   5601  a051							; detokenized line at $400...
   5602  a051							;
   5603  a051							; Exit:
   5604  a051							; C set	if line	empty.
   5605  a051
   5606  a051				   is_line_empty
   5607  a051
   5608  a051		       20 e9 9f 	      JSR	is_program_empty	; sets	C if no	program
   5609  a054		       90 11		      BCC	is_not_empty
   5610  a056		       ac 00 04 	      LDY	byte_400
   5611  a059		       f0 0a		      BEQ	is_empty
   5612  a05b
   5613  a05b				   loc_A05B
   5614  a05b		       b9 00 04 	      LDA	$400,Y
   5615  a05e		       c9 20		      CMP	#$20	; ' '
   5616  a060		       d0 05		      BNE	is_not_empty
   5617  a062		       88		      DEY
   5618  a063		       d0 f6		      BNE	loc_A05B
   5619  a065
   5620  a065				   is_empty
   5621  a065		       38		      SEC
   5622  a066		       60		      RTS
   5623  a067
   5624  a067				   is_not_empty
   5625  a067
   5626  a067		       18		      CLC
   5627  a068		       60		      RTS
   5628  a069							; End of function is_line_empty
   5629  a069
   5630  a069
   5631  a069
   5632  a069
   5633  a069				   sub_A069
   5634  a069
   5635  a069		       a2 00		      LDX	#0	; first	line on	screen
   5636  a06b
   5637  a06b				   loc_A06B
   5638  a06b		       8a		      TXA
   5639  a06c		       4a		      LSR		; A = true screen line index
   5640  a06d		       cd bf 06 	      CMP	screen_height	; check	against	height of screen
   5641  a070		       f0 02		      BEQ	loc_A074
   5642  a072		       b0 1f		      BCS	loc_A093
   5643  a074
   5644  a074				   loc_A074
   5645  a074		       20 ab a0 	      JSR	get_line_ptr2	; gets pointer to line visible on screen.
   5646  a077							;
   5647  a077							; Entry:
   5648  a077							; X = screen line number * 2
   5649  a077							;
   5650  a077							; Exit:
   5651  a077							; (byte_2B) points to BASIC line
   5652  a077							;
   5653  a077		       bc c0 06 	      LDY	$6C0,X
   5654  a07a		       f0 17		      BEQ	loc_A093
   5655  a07c		       c8		      INY
   5656  a07d		       f0 1c		      BEQ	loc_A09B
   5657  a07f		       a0 01		      LDY	#1
   5658  a081		       b1 2b		      LDA	(byte_2B),Y
   5659  a083		       c5 4a		      CMP	current_line_no_lsb
   5660  a085		       90 09		      BCC	loc_A090
   5661  a087		       d0 0c		      BNE	loc_A095
   5662  a089		       c8		      INY
   5663  a08a		       b1 2b		      LDA	(byte_2B),Y
   5664  a08c		       c5 4b		      CMP	current_line_no_msb
   5665  a08e		       b0 05		      BCS	loc_A095
   5666  a090
   5667  a090				   loc_A090
   5668  a090		       e8		      INX
   5669  a091		       d0 d8		      BNE	loc_A06B
   5670  a093
   5671  a093				   loc_A093
   5672  a093		       a2 01		      LDX	#1
   5673  a095
   5674  a095				   loc_A095
   5675  a095		       20 ac a0 	      JSR	get_line_ptr_retainingX
   5676  a098		       20 39 a0 	      JSR	save_line_number	; saves line number from program.
   5677  a09b							;
   5678  a09b							; Entry:
   5679  a09b							; (byte_2b) points to current line
   5680  a09b							;
   5681  a09b							; Exit:
   5682  a09b							; current_line_no_lsb, current_line_no_msb = the line number
   5683  a09b
   5684  a09b				   loc_A09B
   5685  a09b		       8a		      TXA
   5686  a09c		       4a		      LSR
   5687  a09d		       85 3b		      STA	byte_3B
   5688  a09f		       20 08 9c 	      JSR	detokenize_one_line
   5689  a0a2		       a2 00		      LDX	#0
   5690  a0a4		       8e b3 06 	      STX	byte_6B3
   5691  a0a7		       20 1e a0 	      JSR	sub_A01E
   5692  a0aa		       60		      RTS
   5693  a0ab							; End of function sub_A069
   5694  a0ab
   5695  a0ab
   5696  a0ab
   5697  a0ab							; gets pointer to line visible on screen.
   5698  a0ab							;
   5699  a0ab							; Entry:
   5700  a0ab							; X = screen line number * 2
   5701  a0ab							;
   5702  a0ab							; Exit:
   5703  a0ab							; (byte_2B) points to BASIC line
   5704  a0ab							;
   5705  a0ab
   5706  a0ab				   get_line_ptr2
   5707  a0ab		       e8		      INX		; bump X because get_line_ptr is wierd
   5708  a0ac							; End of function get_line_ptr2
   5709  a0ac
   5710  a0ac
   5711  a0ac
   5712  a0ac
   5713  a0ac				   get_line_ptr_retainingX
   5714  a0ac		       20 45 a0 	      JSR	get_line_ptr	; gets pointer to line visible on screen.
   5715  a0af							;
   5716  a0af							; Entry:
   5717  a0af							; X = screen line number * 2 + 1
   5718  a0af							;
   5719  a0af							; Exit:
   5720  a0af							; (byte_2B) points to BASIC line
   5721  a0af							; X decremented
   5722  a0af		       e8		      INX		; restore original X
   5723  a0b0		       60		      RTS
   5724  a0b1							; End of function get_line_ptr_retainingX
   5725  a0b1
   5726  a0b1
   5727  a0b1
   5728  a0b1
   5729  a0b1				   sub_A0B1
   5730  a0b1		       e0 00		      CPX	#0
   5731  a0b3		       d0 01		      BNE	loc_A0B6
   5732  a0b5		       60		      RTS
   5733  a0b6
   5734  a0b6				   loc_A0B6
   5735  a0b6		       85 28		      STA	byte_28
   5736  a0b8		       c6 28		      DEC	byte_28
   5737  a0ba		       84 27		      STY	byte_27
   5738  a0bc		       ca		      DEX
   5739  a0bd		       86 26		      STX	byte_26
   5740  a0bf		       20 ab 9b 	      JSR	make_cursor_invisible
   5741  a0c2		       a9 ff		      LDA	#$FF
   5742  a0c4		       85 24		      STA	byte_24
   5743  a0c6		       85 23		      STA	byte_23
   5744  a0c8		       a9 00		      LDA	#0
   5745  a0ca		       38		      SEC
   5746  a0cb		       ed b6 06 	      SBC	code_area_width
   5747  a0ce		       85 25		      STA	byte_25
   5748  a0d0
   5749  a0d0				   loc_A0D0
   5750  a0d0		       18		      CLC
   5751  a0d1		       a5 25		      LDA	byte_25
   5752  a0d3		       6d b6 06 	      ADC	code_area_width
   5753  a0d6		       85 25		      STA	byte_25
   5754  a0d8		       18		      CLC
   5755  a0d9		       a5 23		      LDA	byte_23
   5756  a0db		       6d b6 06 	      ADC	code_area_width
   5757  a0de		       85 23		      STA	byte_23
   5758  a0e0		       90 02		      BCC	loc_A0E4
   5759  a0e2		       e6 24		      INC	byte_24
   5760  a0e4
   5761  a0e4				   loc_A0E4
   5762  a0e4		       a9 01		      LDA	#1
   5763  a0e6		       85 20		      STA	byte_20
   5764  a0e8		       a9 04		      LDA	#4
   5765  a0ea		       85 21		      STA	byte_21
   5766  a0ec							; (byte_20) points at detokenized line
   5767  a0ec		       a5 24		      LDA	byte_24
   5768  a0ee		       d0 08		      BNE	loc_A0F8
   5769  a0f0		       a5 28		      LDA	byte_28
   5770  a0f2		       c5 23		      CMP	byte_23
   5771  a0f4		       f0 02		      BEQ	loc_A0F8
   5772  a0f6		       b0 d8		      BCS	loc_A0D0
   5773  a0f8
   5774  a0f8				   loc_A0F8
   5775  a0f8		       a5 28		      LDA	byte_28
   5776  a0fa		       c5 25		      CMP	byte_25
   5777  a0fc		       b0 02		      BCS	loc_A100
   5778  a0fe		       a5 25		      LDA	byte_25
   5779  a100
   5780  a100				   loc_A100
   5781  a100		       85 22		      STA	byte_22
   5782  a102		       18		      CLC
   5783  a103		       65 20		      ADC	byte_20
   5784  a105		       85 20		      STA	byte_20
   5785  a107		       90 02		      BCC	loc_A10B
   5786  a109		       e6 21		      INC	byte_21
   5787  a10b
   5788  a10b				   loc_A10B
   5789  a10b		       a5 27		      LDA	byte_27
   5790  a10d		       d0 06		      BNE	loc_A115
   5791  a10f		       a5 26		      LDA	byte_26
   5792  a111		       c5 25		      CMP	byte_25
   5793  a113		       90 57		      BCC	locret_A16C
   5794  a115
   5795  a115				   loc_A115
   5796  a115		       a2 00		      LDX	#0
   5797  a117		       a5 27		      LDA	byte_27
   5798  a119		       c5 24		      CMP	byte_24
   5799  a11b		       f0 04		      BEQ	loc_A121
   5800  a11d		       b0 0a		      BCS	loc_A129
   5801  a11f		       90 06		      BCC	loc_A127
   5802  a121
   5803  a121				   loc_A121
   5804  a121		       a5 26		      LDA	byte_26
   5805  a123		       c5 23		      CMP	byte_23
   5806  a125		       b0 02		      BCS	loc_A129
   5807  a127
   5808  a127				   loc_A127
   5809  a127		       a2 03		      LDX	#3
   5810  a129
   5811  a129				   loc_A129
   5812  a129		       38		      SEC
   5813  a12a		       b5 23		      LDA	byte_23,X
   5814  a12c		       e5 22		      SBC	byte_22
   5815  a12e		       18		      CLC
   5816  a12f		       69 01		      ADC	#1
   5817  a131		       48		      PHA
   5818  a132		       a6 22		      LDX	byte_22
   5819  a134		       a0 00		      LDY	#0
   5820  a136		       20 4e 8f 	      JSR	get_line_dimensions	; work out dimensions of line.
   5821  a139							;
   5822  a139							; Entry:
   5823  a139							; X=line length
   5824  a139							; Y=starting Y
   5825  a139							;
   5826  a139							; Exit:
   5827  a139							; X=line length	MOD screen width
   5828  a139							; Y=ending Y
   5829  a139		       18		      CLC
   5830  a13a		       8a		      TXA		; get X	coordinate
   5831  a13b		       69 06		      ADC	#6	; offset by line numbers width
   5832  a13d		       aa		      TAX		; back in X
   5833  a13e		       18		      CLC
   5834  a13f		       98		      TYA		; get Y	coordinate
   5835  a140		       65 3b		      ADC	byte_3B	; add base Y
   5836  a142		       a8		      TAY		; back in Y
   5837  a143		       20 01 8f 	      JSR	gotoxy	; positino cursor
   5838  a146		       a5 3b		      LDA	byte_3B	; get screen Y
   5839  a148		       0a		      ASL
   5840  a149		       aa		      TAX
   5841  a14a		       bd c0 06 	      LDA	$6C0,X
   5842  a14d		       48		      PHA
   5843  a14e		       bd c1 06 	      LDA	$6C1,X
   5844  a151		       48		      PHA
   5845  a152		       98		      TYA
   5846  a153		       0a		      ASL
   5847  a154		       aa		      TAX
   5848  a155		       68		      PLA
   5849  a156		       9d c1 06 	      STA	$6C1,X
   5850  a159		       68		      PLA
   5851  a15a		       9d c0 06 	      STA	$6C0,X
   5852  a15d		       68		      PLA
   5853  a15e		       a6 20		      LDX	byte_20
   5854  a160		       a4 21		      LDY	byte_21
   5855  a162		       20 0e 8f 	      JSR	print_n_chars
   5856  a165		       a5 24		      LDA	byte_24
   5857  a167		       d0 03		      BNE	locret_A16C
   5858  a169		       4c d0 a0 	      JMP	loc_A0D0
   5859  a16c
   5860  a16c				   locret_A16C
   5861  a16c		       60		      RTS
   5862  a16d							; End of function sub_A0B1
   5863  a16d
   5864  a16d
   5865  a16d
   5866  a16d
   5867  a16d				   redraw_line_number
   5868  a16d		       ad b7 06 	      LDA	editor_mode_id	; 1=command mode, 2=edit mode
   5869  a170		       f0 66		      BEQ	locret_A1D8
   5870  a172		       20 ab 9b 	      JSR	make_cursor_invisible
   5871  a175		       20 ae a1 	      JSR	goto_start_of_line	; Entry:
   5872  a178							; byte_3B is Y coordinate.
   5873  a178		       a9 00		      LDA	#0
   5874  a17a		       85 1a		      STA	readline_ptr_msb
   5875  a17c							; Line command slot 0
   5876  a17c		       aa		      TAX
   5877  a17d		       20 bc a1 	      JSR	print_line_command_chars	; prints line command chars for the current line, if any.
   5878  a180							;
   5879  a180							; Entry:
   5880  a180							; current_line_no_lsb,
   5881  a180							; current_line_no_msb =	current	line
   5882  a180							; X = line command slot	ID
   5883  a180							;
   5884  a180							; Exit:
   5885  a180							; readline_ptr_msb bumped by number of chars printed.
   5886  a180							; Line command slot 3
   5887  a180		       a2 03		      LDX	#3
   5888  a182		       20 bc a1 	      JSR	print_line_command_chars	; prints line command chars for the current line, if any.
   5889  a185							;
   5890  a185							; Entry:
   5891  a185							; current_line_no_lsb,
   5892  a185							; current_line_no_msb =	current	line
   5893  a185							; X = line command slot	ID
   5894  a185							;
   5895  a185							; Exit:
   5896  a185							; readline_ptr_msb bumped by number of chars printed.
   5897  a185							; Line command slot 6
   5898  a185		       a2 06		      LDX	#6
   5899  a187		       20 bc a1 	      JSR	print_line_command_chars	; prints line command chars for the current line, if any.
   5900  a18a							;
   5901  a18a							; Entry:
   5902  a18a							; current_line_no_lsb,
   5903  a18a							; current_line_no_msb =	current	line
   5904  a18a							; X = line command slot	ID
   5905  a18a							;
   5906  a18a							; Exit:
   5907  a18a							; readline_ptr_msb bumped by number of chars printed.
   5908  a18a		       a5 1a		      LDA	readline_ptr_msb
   5909  a18c		       d0 4b		      BNE	print_post_line_command_padding	; branch taken if any line command chars printed
   5910  a18e		       a6 4b		      LDX	current_line_no_msb
   5911  a190		       a4 4a		      LDY	current_line_no_lsb
   5912  a192		       20 b6 8d 	      JSR	itoa	; Gets string representation of	16-bit number.
   5913  a195							;
   5914  a195							; Entry:
   5915  a195							; Y,X =	value
   5916  a195							;
   5917  a195							; Exit:
   5918  a195							; unk_0	holds digit count
   5919  a195							; unk_1... filled with string
   5920  a195		       38		      SEC
   5921  a196		       a9 05		      LDA	#5
   5922  a198		       e5 00		      SBC	byte_0
   5923  a19a							; Right-justify number
   5924  a19a		       20 b5 a1 	      JSR	print_n_spaces	; prints N spaces.
   5925  a19d							;
   5926  a19d							; Entry:
   5927  a19d							; A = number of	spaces to print	(max 6)
   5928  a19d		       20 97 8e 	      JSR	print_number	; print	number.
   5929  a1a0							;
   5930  a1a0							; Suitable for use with	the result of itoa.
   5931  a1a0							;
   5932  a1a0							; Entry:
   5933  a1a0							; unk_0	= digit	count
   5934  a1a0							; unk_1... = digits
   5935  a1a0
   5936  a1a0				   print_space_or_marker
   5937  a1a0		       a2 0c		      LDX	#12
   5938  a1a2		       20 1c a2 	      JSR	is_current_line	; checks if the	given line command is set on the current line.
   5939  a1a5							;
   5940  a1a5							; Entry:
   5941  a1a5							; current_line_no_lsb,
   5942  a1a5							; current_line_no_msb =	current	line
   5943  a1a5							; X = line command slot	ID
   5944  a1a5							;
   5945  a1a5							; Exit:
   5946  a1a5							; C set	if command is on current line.
   5947  a1a5		       a9 20		      LDA	#$20	; ' '
   5948  a1a7		       90 02		      BCC	redraw_line_number_print_char
   5949  a1a9		       a9 2e		      LDA	#$2E	; '.'
   5950  a1ab
   5951  a1ab				   redraw_line_number_print_char
   5952  a1ab		       4c ee ff 	      JMP	OSWRCH
   5953  a1ae							; End of function redraw_line_number
   5954  a1ae
   5955  a1ae
   5956  a1ae
   5957  a1ae							; Entry:
   5958  a1ae							; byte_3B is Y coordinate.
   5959  a1ae
   5960  a1ae				   goto_start_of_line
   5961  a1ae		       a2 00		      LDX	#0
   5962  a1b0		       a4 3b		      LDY	byte_3B
   5963  a1b2		       4c 01 8f 	      JMP	gotoxy
   5964  a1b5							; End of function goto_start_of_line
   5965  a1b5
   5966  a1b5
   5967  a1b5
   5968  a1b5							; prints N spaces.
   5969  a1b5							;
   5970  a1b5							; Entry:
   5971  a1b5							; A = number of	spaces to print	(max 6)
   5972  a1b5
   5973  a1b5				   print_n_spaces
   5974  a1b5
   5975  a1b5		       a2 bb		      LDX	#$BB	; #<six_spaces_string
   5976  a1b7		       a0 89		      LDY	#$89	; #>six_spaces_string
   5977  a1b9		       4c 0e 8f 	      JMP	print_n_chars
   5978  a1bc							; End of function print_n_spaces
   5979  a1bc
   5980  a1bc
   5981  a1bc
   5982  a1bc							; prints line command chars for	the current line, if any.
   5983  a1bc							;
   5984  a1bc							; Entry:
   5985  a1bc							; current_line_no_lsb,
   5986  a1bc							; current_line_no_msb =	current	line
   5987  a1bc							; X = line command slot	ID
   5988  a1bc							;
   5989  a1bc							; Exit:
   5990  a1bc							; readline_ptr_msb bumped by number of chars printed.
   5991  a1bc
   5992  a1bc				   print_line_command_chars
   5993  a1bc
   5994  a1bc		       b5 40		      LDA	$40,X	; fetch	control	byte
   5995  a1be		       c9 20		      CMP	#$20	; ' '
   5996  a1c0		       f0 16		      BEQ	locret_A1D8	; branch taken if no line command here
   5997  a1c2		       20 1c a2 	      JSR	is_current_line	; checks if the	given line command is set on the current line.
   5998  a1c5							;
   5999  a1c5							; Entry:
   6000  a1c5							; current_line_no_lsb,
   6001  a1c5							; current_line_no_msb =	current	line
   6002  a1c5							; X = line command slot	ID
   6003  a1c5							;
   6004  a1c5							; Exit:
   6005  a1c5							; C set	if command is on current line.
   6006  a1c5		       90 11		      BCC	locret_A1D8	; branch taken if no command here
   6007  a1c7							; If char stored is lower-case, print it in upper case, but twice.
   6008  a1c7		       c9 60		      CMP	#$60	; '`'
   6009  a1c9		       90 08		      BCC	loc_A1D3
   6010  a1cb		       38		      SEC
   6011  a1cc		       e9 20		      SBC	#$20	; ' '
   6012  a1ce		       20 ee ff 	      JSR	OSWRCH
   6013  a1d1		       e6 1a		      INC	readline_ptr_msb
   6014  a1d3
   6015  a1d3				   loc_A1D3
   6016  a1d3		       20 ee ff 	      JSR	OSWRCH
   6017  a1d6		       e6 1a		      INC	readline_ptr_msb
   6018  a1d8
   6019  a1d8				   locret_A1D8
   6020  a1d8
   6021  a1d8		       60		      RTS
   6022  a1d9							; End of function print_line_command_chars
   6023  a1d9
   6024  a1d9
   6025  a1d9				   print_post_line_command_padding
   6026  a1d9		       38		      SEC
   6027  a1da		       a9 05		      LDA	#5
   6028  a1dc		       e5 1a		      SBC	readline_ptr_msb
   6029  a1de		       20 b5 a1 	      JSR	print_n_spaces	; prints N spaces.
   6030  a1e1							;
   6031  a1e1							; Entry:
   6032  a1e1							; A = number of	spaces to print	(max 6)
   6033  a1e1		       4c a0 a1 	      JMP	print_space_or_marker
   6034  a1e4
   6035  a1e4
   6036  a1e4
   6037  a1e4				   clear_line_commands
   6038  a1e4
   6039  a1e4		       a9 20		      LDA	#$20	; ' '
   6040  a1e6		       85 40		      STA	byte_40
   6041  a1e8		       85 43		      STA	byte_43
   6042  a1ea		       85 46		      STA	byte_46
   6043  a1ec		       60		      RTS
   6044  a1ed							; End of function clear_line_commands
   6045  a1ed
   6046  a1ed
   6047  a1ed
   6048  a1ed
   6049  a1ed				   set_primary_line_command
   6050  a1ed		       a2 00		      LDX	#0
   6051  a1ef		       20 2f a2 	      JSR	is_line_command_slot_free	; check availability of line command slot.
   6052  a1f2							;
   6053  a1f2							; Entry:
   6054  a1f2							; X = slot ID
   6055  a1f2							;
   6056  a1f2							; Exit:
   6057  a1f2							; C set	if slot	is free.
   6058  a1f2		       b0 05		      BCS	use_slot
   6059  a1f4		       a2 03		      LDX	#3
   6060  a1f6		       20 2f a2 	      JSR	is_line_command_slot_free	; check availability of line command slot.
   6061  a1f9							;
   6062  a1f9							; Entry:
   6063  a1f9							; X = slot ID
   6064  a1f9							;
   6065  a1f9							; Exit:
   6066  a1f9							; C set	if slot	is free.
   6067  a1f9
   6068  a1f9				   use_slot
   6069  a1f9		       ad bd 06 	      LDA	current_command_id
   6070  a1fc		       18		      CLC
   6071  a1fd		       69 40		      ADC	#$40	; make letter from command ID -- 'C', 'D' or 'M'
   6072  a1ff		       b4 40		      LDY	$40,X	; get old command
   6073  a201		       c0 20		      CPY	#$20	; ' '	    ; no command?
   6074  a203		       f0 07		      BEQ	set_line_command	; branch taken	if no command.
   6075  a205							; just set command if taken.
   6076  a205		       d5 40		      CMP	$40,X	; is this the command that's there already?
   6077  a207		       d0 03		      BNE	set_line_command	; branch taken	if not same command.
   6078  a209							; overwrite old	command	with new one if	taken.
   6079  a209		       18		      CLC
   6080  a20a		       69 20		      ADC	#$20	; ' '	    ; +$20 to indicate doubling of command
   6081  a20c
   6082  a20c				   set_line_command
   6083  a20c
   6084  a20c		       95 40		      STA	$40,X	; store	command
   6085  a20e		       a5 4a		      LDA	current_line_no_lsb
   6086  a210		       95 41		      STA	$41,X	; store	line no	LSB
   6087  a212		       a5 4b		      LDA	current_line_no_msb
   6088  a214		       95 42		      STA	$42,X	; store	line no	MSB
   6089  a216
   6090  a216				   loc_A216
   6091  a216		       20 6d a1 	      JSR	redraw_line_number	; update line number	with new commands
   6092  a219		       4c a8 a8 	      JMP	position_edit_mode_cursor
   6093  a21c							; End of function set_primary_line_command
   6094  a21c
   6095  a21c
   6096  a21c
   6097  a21c							; checks if the	given line command is set on the current line.
   6098  a21c							;
   6099  a21c							; Entry:
   6100  a21c							; current_line_no_lsb,
   6101  a21c							; current_line_no_msb =	current	line
   6102  a21c							; X = line command slot	ID
   6103  a21c							;
   6104  a21c							; Exit:
   6105  a21c							; C set	if command is on current line.
   6106  a21c
   6107  a21c				   is_current_line
   6108  a21c
   6109  a21c		       48		      PHA
   6110  a21d		       a5 4a		      LDA	current_line_no_lsb
   6111  a21f		       d5 41		      CMP	$41,X
   6112  a221		       d0 09		      BNE	loc_A22C
   6113  a223		       a5 4b		      LDA	current_line_no_msb
   6114  a225		       d5 42		      CMP	$42,X
   6115  a227		       d0 03		      BNE	loc_A22C
   6116  a229		       38		      SEC
   6117  a22a		       b0 01		      BCS	loc_A22D
   6118  a22c
   6119  a22c				   loc_A22C
   6120  a22c
   6121  a22c		       18		      CLC
   6122  a22d
   6123  a22d				   loc_A22D
   6124  a22d		       68		      PLA
   6125  a22e
   6126  a22e				   locret_A22E
   6127  a22e
   6128  a22e		       60		      RTS
   6129  a22f							; End of function is_current_line
   6130  a22f
   6131  a22f
   6132  a22f
   6133  a22f							; check	availability of	line command slot.
   6134  a22f							;
   6135  a22f							; Entry:
   6136  a22f							; X = slot ID
   6137  a22f							;
   6138  a22f							; Exit:
   6139  a22f							; C set	if slot	is free.
   6140  a22f
   6141  a22f				   is_line_command_slot_free
   6142  a22f
   6143  a22f		       b5 40		      LDA	$40,X	; get line command flag
   6144  a231		       c9 20		      CMP	#$20	; ' '	    ; is it free?
   6145  a233		       f0 f9		      BEQ	locret_A22E	; branch taken if slot free.
   6146  a235							; return with C	set if taken.
   6147  a235		       20 1c a2 	      JSR	is_current_line	; checks if the	given line command is set on the current line.
   6148  a238							;
   6149  a238							; Entry:
   6150  a238							; current_line_no_lsb,
   6151  a238							; current_line_no_msb =	current	line
   6152  a238							; X = line command slot	ID
   6153  a238							;
   6154  a238							; Exit:
   6155  a238							; C set	if command is on current line.
   6156  a238		       b0 f4		      BCS	locret_A22E	; branch taken if this slot is on the current line.
   6157  a23a							; return with C	set if taken. (can change commands on current line.)
   6158  a23a							; slot is not free.
   6159  a23a		       e0 00		      CPX	#0	; was it slot ID 0 being checked?
   6160  a23c		       18		      CLC		; clear	carry to indicate it isn't free
   6161  a23d		       f0 ef		      BEQ	locret_A22E	; if it	was slot ID 0, just return with	carry clear
   6162  a23f		       20 69 9f 	      JSR	beep	; otherwise, beep
   6163  a242		       4c d8 9a 	      JMP	edit_mode_loop
   6164  a245							; End of function is_line_command_slot_free
   6165  a245
   6166  a245
   6167  a245				   loc_A245
   6168  a245		       18		      CLC
   6169  a246		       ad bd 06 	      LDA	current_command_id
   6170  a249		       69 40		      ADC	#$40	; '@'
   6171  a24b		       85 46		      STA	byte_46
   6172  a24d		       a5 4a		      LDA	current_line_no_lsb
   6173  a24f		       85 47		      STA	byte_47
   6174  a251		       a5 4b		      LDA	current_line_no_msb
   6175  a253		       85 48		      STA	byte_48
   6176  a255		       4c 08 ac 	      JMP	loc_AC08
   6177  a258
   6178  a258				   loc_A258
   6179  a258		       a2 00		      LDX	#0
   6180  a25a		       86 1a		      STX	readline_ptr_msb
   6181  a25c		       20 80 a2 	      JSR	sub_A280
   6182  a25f		       a2 03		      LDX	#3
   6183  a261		       20 80 a2 	      JSR	sub_A280
   6184  a264		       a2 06		      LDX	#6
   6185  a266		       20 80 a2 	      JSR	sub_A280
   6186  a269		       a2 0c		      LDX	#$C
   6187  a26b		       20 1c a2 	      JSR	is_current_line	; checks if the	given line command is set on the current line.
   6188  a26e							;
   6189  a26e							; Entry:
   6190  a26e							; current_line_no_lsb,
   6191  a26e							; current_line_no_msb =	current	line
   6192  a26e							; X = line command slot	ID
   6193  a26e							;
   6194  a26e							; Exit:
   6195  a26e							; C set	if command is on current line.
   6196  a26e		       90 06		      BCC	loc_A276
   6197  a270		       20 58 b3 	      JSR	sub_B358
   6198  a273		       4c 16 a2 	      JMP	loc_A216
   6199  a276
   6200  a276				   loc_A276
   6201  a276		       a5 1a		      LDA	readline_ptr_msb
   6202  a278		       d0 9c		      BNE	loc_A216
   6203  a27a		       20 e4 a1 	      JSR	clear_line_commands
   6204  a27d		       4c 08 ac 	      JMP	loc_AC08
   6205  a280
   6206  a280
   6207  a280
   6208  a280				   sub_A280
   6209  a280		       b5 40		      LDA	$40,X
   6210  a282		       c9 20		      CMP	#$20	; ' '
   6211  a284		       f0 1a		      BEQ	locret_A2A0
   6212  a286		       20 1c a2 	      JSR	is_current_line	; checks if the	given line command is set on the current line.
   6213  a289							;
   6214  a289							; Entry:
   6215  a289							; current_line_no_lsb,
   6216  a289							; current_line_no_msb =	current	line
   6217  a289							; X = line command slot	ID
   6218  a289							;
   6219  a289							; Exit:
   6220  a289							; C set	if command is on current line.
   6221  a289		       90 15		      BCC	locret_A2A0
   6222  a28b		       e0 00		      CPX	#0
   6223  a28d		       d0 0b		      BNE	loc_A29A
   6224  a28f		       a2 03		      LDX	#3
   6225  a291
   6226  a291				   loc_A291
   6227  a291		       b5 42		      LDA	$42,X
   6228  a293		       95 3f		      STA	$3F,X
   6229  a295		       ca		      DEX
   6230  a296		       d0 f9		      BNE	loc_A291
   6231  a298		       a2 03		      LDX	#3
   6232  a29a
   6233  a29a				   loc_A29A
   6234  a29a		       a9 20		      LDA	#$20	; ' '
   6235  a29c		       95 40		      STA	$40,X
   6236  a29e		       e6 1a		      INC	readline_ptr_msb
   6237  a2a0
   6238  a2a0				   locret_A2A0
   6239  a2a0		       60		      RTS
   6240  a2a1							; End of function sub_A280
   6241  a2a1
   6242  a2a1
   6243  a2a1
   6244  a2a1
   6245  a2a1				   sub_A2A1
   6246  a2a1
   6247  a2a1		       a5 46		      LDA	byte_46
   6248  a2a3		       c9 54		      CMP	#$54	; 'T'
   6249  a2a5		       d0 0a		      BNE	loc_A2B1
   6250  a2a7		       a0 01		      LDY	#1
   6251  a2a9		       b1 17		      LDA	($17),Y
   6252  a2ab		       aa		      TAX
   6253  a2ac		       c8		      INY
   6254  a2ad		       b1 17		      LDA	($17),Y
   6255  a2af		       a8		      TAY
   6256  a2b0		       60		      RTS
   6257  a2b1
   6258  a2b1				   loc_A2B1
   6259  a2b1		       a5 2b		      LDA	byte_2B
   6260  a2b3		       48		      PHA
   6261  a2b4		       a5 2c		      LDA	byte_2C
   6262  a2b6		       48		      PHA
   6263  a2b7		       a9 ff		      LDA	#-1
   6264  a2b9		       85 2b		      STA	byte_2B
   6265  a2bb		       20 8f 9e 	      JSR	find_line_by_number	; finds a line, given a line number
   6266  a2be							;
   6267  a2be							; Entry:
   6268  a2be							; byte_2B: line	number MSB
   6269  a2be							; byte_2C: line	number LSB
   6270  a2be							;
   6271  a2be							; Exit:
   6272  a2be							; (byte_2B) points to most suitable line
   6273  a2be		       a0 01		      LDY	#1
   6274  a2c0		       b1 2f		      LDA	($2F),Y
   6275  a2c2		       aa		      TAX
   6276  a2c3		       c8		      INY
   6277  a2c4		       b1 2f		      LDA	($2F),Y
   6278  a2c6		       a8		      TAY
   6279  a2c7		       68		      PLA
   6280  a2c8		       85 2c		      STA	byte_2C
   6281  a2ca		       68		      PLA
   6282  a2cb		       85 2b		      STA	byte_2B
   6283  a2cd		       60		      RTS
   6284  a2ce							; End of function sub_A2A1
   6285  a2ce
   6286  a2ce		       41 4e 44    token_table dc.b	"AND"
   6287  a2d1		       80		      dc.b	$80	; €
   6288  a2d2		       00		      dc.b	0	;
   6289  a2d3		       41 42 53    aAbs       dc.b	"ABS"
   6290  a2d6		       94		      dc.b	$94	; ”
   6291  a2d7		       00		      dc.b	0	;
   6292  a2d8		       41 43 53    aAcs       dc.b	"ACS"
   6293  a2db		       95		      dc.b	$95	; •
   6294  a2dc		       00		      dc.b	0	;
   6295  a2dd		       41 44 56 41*aAdval     dc.b	"ADVAL"
   6296  a2e2		       96		      dc.b	$96	; –
   6297  a2e3		       00		      dc.b	0	;
   6298  a2e4		       41 53 43    aAsc       dc.b	"ASC"
   6299  a2e7		       97		      dc.b	$97	; —
   6300  a2e8		       00		      dc.b	0	;
   6301  a2e9		       41 53 4e    aAsn       dc.b	"ASN"
   6302  a2ec		       98		      dc.b	$98	; ˜
   6303  a2ed		       00		      dc.b	0	;
   6304  a2ee		       41 54 4e    aAtn       dc.b	"ATN"
   6305  a2f1		       99		      dc.b	$99	; ™
   6306  a2f2		       00		      dc.b	0	;
   6307  a2f3		       41 55 54 4f aAuto      dc.b	"AUTO"
   6308  a2f7		       c6		      dc.b	$C6	; Æ
   6309  a2f8		       10		      dc.b	$10	;
   6310  a2f9		       42 47 45 54 aBget      dc.b	"BGET"
   6311  a2fd		       9a		      dc.b	$9A	; š
   6312  a2fe		       01		      dc.b	1	;
   6313  a2ff		       42 50 55 54 aBput      dc.b	"BPUT"
   6314  a303		       d5		      dc.b	$D5	; Õ
   6315  a304		       03		      dc.b	3	;
   6316  a305		       43 4f 4c 4f*aColour    dc.b	"COLOUR"
   6317  a30b		       fb		      dc.b	$FB	; û
   6318  a30c		       02		      dc.b	2	;
   6319  a30d		       43 4f 4c 4f*aColor     dc.b	"COLOR"
   6320  a312		       fb		      dc.b	$FB	; û
   6321  a313		       02		      dc.b	2	;
   6322  a314		       43 41 4c 4c aCall      dc.b	"CALL"
   6323  a318		       d6		      dc.b	$D6	; Ö
   6324  a319		       02		      dc.b	2	;
   6325  a31a		       43 48 41 49*aChain     dc.b	"CHAIN"
   6326  a31f		       d7		      dc.b	$D7	; ×
   6327  a320		       02		      dc.b	2	;
   6328  a321		       43 48 52 24 aChr       dc.b	"CHR$"
   6329  a325		       bd		      dc.b	$BD	; ½
   6330  a326		       00		      dc.b	0	;
   6331  a327		       43 4c 45 41*aClear     dc.b	"CLEAR"
   6332  a32c		       d8		      dc.b	$D8	; Ø
   6333  a32d		       01		      dc.b	1	;
   6334  a32e		       43 4c 4f 53*aClose     dc.b	"CLOSE"
   6335  a333		       d9		      dc.b	$D9	; Ù
   6336  a334		       03		      dc.b	3	;
   6337  a335		       43 4c 47    aClg       dc.b	"CLG"
   6338  a338		       da		      dc.b	$DA	; Ú
   6339  a339		       01		      dc.b	1	;
   6340  a33a		       43 4c 53    aCls       dc.b	"CLS"
   6341  a33d		       db		      dc.b	$DB	; Û
   6342  a33e		       01		      dc.b	1	;
   6343  a33f		       43 4f 53    aCos       dc.b	"COS"
   6344  a342		       9b		      dc.b	$9B	; ›
   6345  a343		       00		      dc.b	0	;
   6346  a344		       43 4f 55 4e*aCount     dc.b	"COUNT"
   6347  a349		       9c		      dc.b	$9C	; œ
   6348  a34a		       01		      dc.b	1	;
   6349  a34b		       44 41 54 41 aData      dc.b	"DATA"
   6350  a34f		       dc		      dc.b	$DC	; Ü
   6351  a350		       20		      dc.b	$20	;
   6352  a351		       44 45 47    aDeg       dc.b	"DEG"
   6353  a354		       9d		      dc.b	$9D	; 
   6354  a355		       00		      dc.b	0	;
   6355  a356		       44 45 46    aDef       dc.b	"DEF"
   6356  a359		       dd		      dc.b	$DD	; Ý
   6357  a35a		       00		      dc.b	0	;
   6358  a35b		       44 45 4c 45*aDelete    dc.b	"DELETE"
   6359  a361		       c7		      dc.b	$C7	; Ç
   6360  a362		       10		      dc.b	$10	;
   6361  a363		       44 49 56    aDiv       dc.b	"DIV"
   6362  a366		       81		      dc.b	$81	; 
   6363  a367		       00		      dc.b	0	;
   6364  a368		       44 49 4d    aDim       dc.b	"DIM"
   6365  a36b		       de		      dc.b	$DE	; Þ
   6366  a36c		       02		      dc.b	2	;
   6367  a36d		       44 52 41 57 aDraw      dc.b	"DRAW"
   6368  a371		       df		      dc.b	$DF	; ß
   6369  a372		       02		      dc.b	2	;
   6370  a373		       45 4e 44 50*aEndproc   dc.b	"ENDPROC"
   6371  a37a		       e1		      dc.b	$E1	; á
   6372  a37b		       01		      dc.b	1	;
   6373  a37c		       45 4e 44    aEnd_0     dc.b	"END"
   6374  a37f		       e0		      dc.b	$E0	; à
   6375  a380		       01		      dc.b	1	;
   6376  a381		       45 4e 56 45*aEnvelope  dc.b	"ENVELOPE"
   6377  a389		       e2		      dc.b	$E2	; â
   6378  a38a		       02		      dc.b	2	;
   6379  a38b		       45 4c 53 45 aElse      dc.b	"ELSE"
   6380  a38f		       8b		      dc.b	$8B	; ‹
   6381  a390		       14		      dc.b	$14	;
   6382  a391		       45 56 41 4c aEval      dc.b	"EVAL"
   6383  a395		       a0		      dc.b	$A0	;  
   6384  a396		       00		      dc.b	0	;
   6385  a397		       45 52 4c    aErl       dc.b	"ERL"
   6386  a39a		       9e		      dc.b	$9E	; ž
   6387  a39b		       01		      dc.b	1	;
   6388  a39c		       45 52 52 4f*aError     dc.b	"ERROR"
   6389  a3a1		       85		      dc.b	$85	; …
   6390  a3a2		       04		      dc.b	4	;
   6391  a3a3		       45 4f 46    aEof       dc.b	"EOF"
   6392  a3a6		       c5		      dc.b	$C5	; Å
   6393  a3a7		       01		      dc.b	1	;
   6394  a3a8		       45 4f 52    aEor       dc.b	"EOR"
   6395  a3ab		       82		      dc.b	$82	; ‚
   6396  a3ac		       00		      dc.b	0	;
   6397  a3ad		       45 52 52    aErr       dc.b	"ERR"
   6398  a3b0		       9f		      dc.b	$9F	; Ÿ
   6399  a3b1		       01		      dc.b	1	;
   6400  a3b2		       45 58 50    aExp       dc.b	"EXP"
   6401  a3b5		       a1		      dc.b	$A1	; ¡
   6402  a3b6		       00		      dc.b	0	;
   6403  a3b7		       45 58 54    aExt       dc.b	"EXT"
   6404  a3ba		       a2		      dc.b	$A2	; ¢
   6405  a3bb		       01		      dc.b	1	;
   6406  a3bc		       46 4f 52    aFor       dc.b	"FOR"
   6407  a3bf		       e3		      dc.b	$E3	; ã
   6408  a3c0		       02		      dc.b	2	;
   6409  a3c1		       46 41 4c 53*aFalse     dc.b	"FALSE"
   6410  a3c6		       a3		      dc.b	$A3	; £
   6411  a3c7		       01		      dc.b	1	;
   6412  a3c8		       46 4e	   aFn	      dc.b	"FN"
   6413  a3ca		       a4		      dc.b	$A4	; ¤
   6414  a3cb		       08		      dc.b	8	;
   6415  a3cc		       47 4f 54 4f aGoto_0    dc.b	"GOTO"
   6416  a3d0		       e5		      dc.b	$E5	; å
   6417  a3d1		       12		      dc.b	$12	;
   6418  a3d2		       47 45 54 24 aGet_0     dc.b	"GET$"
   6419  a3d6		       be		      dc.b	$BE	; ¾
   6420  a3d7		       00		      dc.b	0	;
   6421  a3d8		       47 45 54    aGet       dc.b	"GET"
   6422  a3db		       a5		      dc.b	$A5	; ¥
   6423  a3dc		       00		      dc.b	0	;
   6424  a3dd		       47 4f 53 55*aGosub     dc.b	"GOSUB"
   6425  a3e2		       e4		      dc.b	$E4	; ä
   6426  a3e3		       12		      dc.b	$12	;
   6427  a3e4		       47 43 4f 4c aGcol      dc.b	"GCOL"
   6428  a3e8		       e6		      dc.b	$E6	; æ
   6429  a3e9		       02		      dc.b	2	;
   6430  a3ea		       48 49 4d 45*aHimem_0   dc.b	"HIMEM"
   6431  a3ef		       93		      dc.b	$93	; “
   6432  a3f0		       43		      dc.b	$43	; C
   6433  a3f1		       49 4e 50 55*aInput     dc.b	"INPUT"
   6434  a3f6		       e8		      dc.b	$E8	; è
   6435  a3f7		       02		      dc.b	2	;
   6436  a3f8		       49 46	   aIf	      dc.b	"IF"
   6437  a3fa		       e7		      dc.b	$E7	; ç
   6438  a3fb		       02		      dc.b	2	;
   6439  a3fc		       49 4e 4b 45*aInkey_0   dc.b	"INKEY$"
   6440  a402		       bf		      dc.b	$BF	; ¿
   6441  a403		       00		      dc.b	0	;
   6442  a404		       49 4e 4b 45*aInkey     dc.b	"INKEY"
   6443  a409		       a6		      dc.b	$A6	; ¦
   6444  a40a		       00		      dc.b	0	;
   6445  a40b		       49 4e 54    aInt       dc.b	"INT"
   6446  a40e		       a8		      dc.b	$A8	; ¨
   6447  a40f		       00		      dc.b	0	;
   6448  a410		       49 4e 53 54*aInstr     dc.b	"INSTR("
   6449  a416		       a7		      dc.b	$A7	; §
   6450  a417		       00		      dc.b	0	;
   6451  a418		       4c 49 53 54 aList      dc.b	"LIST"
   6452  a41c		       c9		      dc.b	$C9	; É
   6453  a41d		       10		      dc.b	$10	;
   6454  a41e		       4c 49 4e 45 aLine      dc.b	"LINE"
   6455  a422		       86		      dc.b	$86	; †
   6456  a423		       00		      dc.b	0	;
   6457  a424		       4c 4f 41 44 aLoad_0    dc.b	"LOAD"
   6458  a428		       c8		      dc.b	$C8	; È
   6459  a429		       02		      dc.b	2	;
   6460  a42a		       4c 4f 4d 45*aLomem_0   dc.b	"LOMEM"
   6461  a42f		       92		      dc.b	$92	; ’
   6462  a430		       43		      dc.b	$43	; C
   6463  a431		       4c 4f 43 41*aLocal     dc.b	"LOCAL"
   6464  a436		       ea		      dc.b	$EA	; ê
   6465  a437		       02		      dc.b	2	;
   6466  a438		       4c 45 46 54*aLeft      dc.b	"LEFT$("
   6467  a43e		       c0		      dc.b	$C0	; À
   6468  a43f		       00		      dc.b	0	;
   6469  a440		       4c 45 4e    aLen       dc.b	"LEN"
   6470  a443		       a9		      dc.b	$A9	; ©
   6471  a444		       00		      dc.b	0	;
   6472  a445		       4c 45 54    aLet       dc.b	"LET"
   6473  a448		       e9		      dc.b	$E9	; é
   6474  a449		       04		      dc.b	4	;
   6475  a44a		       4c 4f 47    aLog       dc.b	"LOG"
   6476  a44d		       ab		      dc.b	$AB	; «
   6477  a44e		       00		      dc.b	0	;
   6478  a44f		       4c 4e	   aLn	      dc.b	"LN"
   6479  a451		       aa		      dc.b	$AA	; ª
   6480  a452		       00		      dc.b	0	;
   6481  a453		       4d 49 44 24*aMid       dc.b	"MID$("
   6482  a458		       c1		      dc.b	$C1	; Á
   6483  a459		       00		      dc.b	0	;
   6484  a45a		       4d 4f 44 45 aMode_0    dc.b	"MODE"
   6485  a45e		       eb		      dc.b	$EB	; ë
   6486  a45f		       02		      dc.b	2	;
   6487  a460		       4d 4f 44    aMod       dc.b	"MOD"
   6488  a463		       83		      dc.b	$83	; ƒ
   6489  a464		       00		      dc.b	0	;
   6490  a465		       4d 4f 56 45 aMove      dc.b	"MOVE"
   6491  a469		       ec		      dc.b	$EC	; ì
   6492  a46a		       02		      dc.b	2	;
   6493  a46b		       4e 45 58 54 aNext      dc.b	"NEXT"
   6494  a46f		       ed		      dc.b	$ED	; í
   6495  a470		       02		      dc.b	2	;
   6496  a471		       4e 45 57    aNew_0     dc.b	"NEW"
   6497  a474		       ca		      dc.b	$CA	; Ê
   6498  a475		       01		      dc.b	1	;
   6499  a476		       4e 4f 54    aNot       dc.b	"NOT"
   6500  a479		       ac		      dc.b	$AC	; ¬
   6501  a47a		       00		      dc.b	0	;
   6502  a47b		       4f 4c 44    aOld_0     dc.b	"OLD"
   6503  a47e		       cb		      dc.b	$CB	; Ë
   6504  a47f		       01		      dc.b	1	;
   6505  a480		       4f 4e	   aOn_0      dc.b	"ON"
   6506  a482		       ee		      dc.b	$EE	; î
   6507  a483		       02		      dc.b	2	;
   6508  a484		       4f 46 46    aOff       dc.b	"OFF"
   6509  a487		       87		      dc.b	$87	; ‡
   6510  a488		       00		      dc.b	0	;
   6511  a489		       4f 52	   aOr	      dc.b	"OR"
   6512  a48b		       84		      dc.b	$84	; „
   6513  a48c		       00		      dc.b	0	;
   6514  a48d		       4f 50 45 4e*aOpenin    dc.b	"OPENIN"
   6515  a493		       8e		      dc.b	$8E	; Ž
   6516  a494		       00		      dc.b	0	;
   6517  a495		       4f 50 45 4e*aOpenout   dc.b	"OPENOUT"
   6518  a49c		       ae		      dc.b	$AE	; ®
   6519  a49d		       00		      dc.b	0	;
   6520  a49e		       4f 50 45 4e*aOpenup    dc.b	"OPENUP"
   6521  a4a4		       ad		      dc.b	$AD	; ­
   6522  a4a5		       00		      dc.b	0	;
   6523  a4a6		       4f 53 43 4c*aOscli     dc.b	"OSCLI"
   6524  a4ab		       ff		      dc.b	$FF	;
   6525  a4ac		       02		      dc.b	2	;
   6526  a4ad		       50 52 49 4e*aPrint     dc.b	"PRINT"
   6527  a4b2		       f1		      dc.b	$F1	; ñ
   6528  a4b3		       02		      dc.b	2	;
   6529  a4b4		       50 41 47 45 aPage_0    dc.b	"PAGE"
   6530  a4b8		       90		      dc.b	$90	; 
   6531  a4b9		       43		      dc.b	$43	; C
   6532  a4ba		       50 54 52    aPtr_0     dc.b	"PTR"
   6533  a4bd		       8f		      dc.b	$8F	; 
   6534  a4be		       43		      dc.b	$43	; C
   6535  a4bf		       50 49	   aPi	      dc.b	"PI"
   6536  a4c1		       af		      dc.b	$AF	; ¯
   6537  a4c2		       01		      dc.b	1	;
   6538  a4c3		       50 4c 4f 54 aPlot      dc.b	"PLOT"
   6539  a4c7		       f0		      dc.b	$F0	; ð
   6540  a4c8		       02		      dc.b	2	;
   6541  a4c9		       50 4f 49 4e*aPoint     dc.b	"POINT("
   6542  a4cf		       b0		      dc.b	$B0	; °
   6543  a4d0		       00		      dc.b	0	;
   6544  a4d1		       50 52 4f 43 aProc      dc.b	"PROC"
   6545  a4d5		       f2		      dc.b	$F2	; ò
   6546  a4d6		       0a		      dc.b	$A	;
   6547  a4d7		       50 4f 53    aPos       dc.b	"POS"
   6548  a4da		       b1		      dc.b	$B1	; ±
   6549  a4db		       01		      dc.b	1	;
   6550  a4dc		       52 45 54 55*aReturn    dc.b	"RETURN"
   6551  a4e2		       f8		      dc.b	$F8	; ø
   6552  a4e3		       01		      dc.b	1	;
   6553  a4e4		       52 45 50 45*aRepeat    dc.b	"REPEAT"
   6554  a4ea		       f5		      dc.b	$F5	; õ
   6555  a4eb		       00		      dc.b	0	;
   6556  a4ec		       52 45 50 4f*aReport    dc.b	"REPORT"
   6557  a4f2		       f6		      dc.b	$F6	; ö
   6558  a4f3		       01		      dc.b	1	;
   6559  a4f4		       52 45 41 44 aRead      dc.b	"READ"
   6560  a4f8		       f3		      dc.b	$F3	; ó
   6561  a4f9		       02		      dc.b	2	;
   6562  a4fa		       52 45 4d    aRem       dc.b	"REM"
   6563  a4fd		       f4		      dc.b	$F4	; ô
   6564  a4fe		       20		      dc.b	$20	;
   6565  a4ff		       52 55 4e    aRun_0     dc.b	"RUN"
   6566  a502		       f9		      dc.b	$F9	; ù
   6567  a503		       01		      dc.b	1	;
   6568  a504		       52 41 44    aRad       dc.b	"RAD"
   6569  a507		       b2		      dc.b	$B2	; ²
   6570  a508		       00		      dc.b	0	;
   6571  a509		       52 45 53 54*aRestore   dc.b	"RESTORE"
   6572  a510		       f7		      dc.b	$F7	; ÷
   6573  a511		       12		      dc.b	$12	;
   6574  a512		       52 49 47 48*aRight     dc.b	"RIGHT$("
   6575  a519		       c2		      dc.b	$C2	; Â
   6576  a51a		       00		      dc.b	0	;
   6577  a51b		       52 4e 44    aRnd       dc.b	"RND"
   6578  a51e		       b3		      dc.b	$B3	; ³
   6579  a51f		       01		      dc.b	1	;
   6580  a520		       52 45 4e 55*aRenumber_0 dc.b	"RENUMBER"
   6581  a528		       cc		      dc.b	$CC	; Ì
   6582  a529		       10		      dc.b	$10	;
   6583  a52a		       53 54 45 50 aStep      dc.b	"STEP"
   6584  a52e		       88		      dc.b	$88	; ˆ
   6585  a52f		       00		      dc.b	0	;
   6586  a530		       53 41 56 45 aSave_0    dc.b	"SAVE"
   6587  a534		       cd		      dc.b	$CD	; Í
   6588  a535		       02		      dc.b	2	;
   6589  a536		       53 47 4e    aSgn       dc.b	"SGN"
   6590  a539		       b4		      dc.b	$B4	; ´
   6591  a53a		       00		      dc.b	0	;
   6592  a53b		       53 49 4e    aSin       dc.b	"SIN"
   6593  a53e		       b5		      dc.b	$B5	; µ
   6594  a53f		       00		      dc.b	0	;
   6595  a540		       53 51 52    aSqr       dc.b	"SQR"
   6596  a543		       b6		      dc.b	$B6	; ¶
   6597  a544		       00		      dc.b	0	;
   6598  a545		       53 50 43    aSpc       dc.b	"SPC"
   6599  a548		       89		      dc.b	$89	; ‰
   6600  a549		       00		      dc.b	0	;
   6601  a54a		       53 54 52 24 aStr       dc.b	"STR$"
   6602  a54e		       c3		      dc.b	$C3	; Ã
   6603  a54f		       00		      dc.b	0	;
   6604  a550		       53 54 52 49*aString    dc.b	"STRING$("
   6605  a558		       c4		      dc.b	$C4	; Ä
   6606  a559		       00		      dc.b	0	;
   6607  a55a		       53 4f 55 4e*aSound     dc.b	"SOUND"
   6608  a55f		       d4		      dc.b	$D4	; Ô
   6609  a560		       02		      dc.b	2	;
   6610  a561		       53 54 4f 50 aStop      dc.b	"STOP"
   6611  a565		       fa		      dc.b	$FA	; ú
   6612  a566		       01		      dc.b	1	;
   6613  a567		       54 41 4e    aTan       dc.b	"TAN"
   6614  a56a		       b7		      dc.b	$B7	; ·
   6615  a56b		       00		      dc.b	0	;
   6616  a56c		       54 48 45 4e aThen      dc.b	"THEN"
   6617  a570		       8c		      dc.b	$8C	; Œ
   6618  a571		       14		      dc.b	$14	;
   6619  a572		       54 4f	   aTo	      dc.b	"TO"
   6620  a574		       b8		      dc.b	$B8	; ¸
   6621  a575		       00		      dc.b	0	;
   6622  a576		       54 41 42 28 aTab_0     dc.b	"TAB("
   6623  a57a		       8a		      dc.b	$8A	; Š
   6624  a57b		       00		      dc.b	0	;
   6625  a57c		       54 52 41 43*aTrace     dc.b	"TRACE"
   6626  a581		       fc		      dc.b	$FC	; ü
   6627  a582		       12		      dc.b	$12	;
   6628  a583		       54 49 4d 45 aTime_0    dc.b	"TIME"
   6629  a587		       91		      dc.b	$91	; ‘
   6630  a588		       43		      dc.b	$43	; C
   6631  a589		       54 52 55 45 aTrue      dc.b	"TRUE"
   6632  a58d		       b9		      dc.b	$B9	; ¹
   6633  a58e		       01		      dc.b	1	;
   6634  a58f		       55 4e 54 49*aUntil     dc.b	"UNTIL"
   6635  a594		       fd		      dc.b	$FD	; ý
   6636  a595		       02		      dc.b	2	;
   6637  a596		       55 53 52    aUsr       dc.b	"USR"
   6638  a599		       ba		      dc.b	$BA	; º
   6639  a59a		       00		      dc.b	0	;
   6640  a59b		       56 44 55    aVdu       dc.b	"VDU"
   6641  a59e		       ef		      dc.b	$EF	; ï
   6642  a59f		       02		      dc.b	2	;
   6643  a5a0		       56 41 4c    aVal       dc.b	"VAL"
   6644  a5a3		       bb		      dc.b	$BB	; »
   6645  a5a4		       00		      dc.b	0	;
   6646  a5a5		       56 50 4f 53 aVpos      dc.b	"VPOS"
   6647  a5a9		       bc		      dc.b	$BC	; ¼
   6648  a5aa		       01		      dc.b	1	;
   6649  a5ab		       57 49 44 54*aWidth     dc.b	"WIDTH"
   6650  a5b0		       fe		      dc.b	$FE	; þ
   6651  a5b1		       02		      dc.b	2	;
   6652  a5b2		       50 41 47 45 aPage      dc.b	"PAGE"
   6653  a5b6		       d0		      dc.b	$D0	; Ð
   6654  a5b7		       00		      dc.b	0	;
   6655  a5b8		       50 54 52    aPtr       dc.b	"PTR"
   6656  a5bb		       cf		      dc.b	$CF	; Ï
   6657  a5bc		       00		      dc.b	0	;
   6658  a5bd		       54 49 4d 45 aTime      dc.b	"TIME"
   6659  a5c1		       d1		      dc.b	$D1	; Ñ
   6660  a5c2		       00		      dc.b	0	;
   6661  a5c3		       4c 4f 4d 45*aLomem     dc.b	"LOMEM"
   6662  a5c8		       d2		      dc.b	$D2	; Ò
   6663  a5c9		       00		      dc.b	0	;
   6664  a5ca		       48 49 4d 45*aHimem     dc.b	"HIMEM"
   6665  a5cf		       d3		      dc.b	$D3	; Ó
   6666  a5d0		       00		      dc.b	0	;
   6667  a5d1
   6668  a5d1
   6669  a5d1
   6670  a5d1				   toggle_insert_overtype_command
   6671  a5d1		       a2 00		      LDX	#0
   6672  a5d3		       a5 3c		      LDA	is_insert_mode	; 0=overtype 1=insert
   6673  a5d5		       d0 02		      BNE	loc_A5D9
   6674  a5d7		       a2 01		      LDX	#1
   6675  a5d9
   6676  a5d9				   loc_A5D9
   6677  a5d9		       86 3c		      STX	is_insert_mode	; 0=overtype 1=insert
   6678  a5db		       60		      RTS
   6679  a5dc							; End of function toggle_insert_overtype_command
   6680  a5dc
   6681  a5dc
   6682  a5dc
   6683  a5dc
   6684  a5dc				   scroll_command
   6685  a5dc		       a2 01		      LDX	#1
   6686  a5de
   6687  a5de				   loc_A5DE
   6688  a5de		       86 3d		      STX	scroll_status	; 1=scroll, 0=noscroll
   6689  a5e0		       60		      RTS
   6690  a5e1							; End of function scroll_command
   6691  a5e1
   6692  a5e1
   6693  a5e1				   noscroll_command
   6694  a5e1		       a2 00		      LDX	#0
   6695  a5e3		       f0 f9		      BEQ	loc_A5DE
   6696  a5e5
   6697  a5e5				   background_edit_mode_command
   6698  a5e5		       a0 00		      LDY	#0
   6699  a5e7		       f0 02		      BEQ	loc_A5EB
   6700  a5e9
   6701  a5e9				   foreground_edit_mode_command
   6702  a5e9		       a0 01		      LDY	#1
   6703  a5eb
   6704  a5eb				   loc_A5EB
   6705  a5eb		       b9 0a 00 	      LDA	$A,Y
   6706  a5ee		       18		      CLC
   6707  a5ef		       69 01		      ADC	#1
   6708  a5f1		       c9 08		      CMP	#8
   6709  a5f3		       90 02		      BCC	loc_A5F7
   6710  a5f5		       a9 00		      LDA	#0
   6711  a5f7
   6712  a5f7				   loc_A5F7
   6713  a5f7		       99 0a 00 	      STA	$A,Y
   6714  a5fa		       20 d5 9e 	      JSR	set_palette
   6715  a5fd		       60		      RTS
   6716  a5fe
   6717  a5fe				   run_or_exit_command
   6718  a5fe		       a9 00		      LDA	#0
   6719  a600		       85 3c		      STA	is_insert_mode	; 0=overtype 1=insert
   6720  a602		       a9 60		      LDA	#$60	; '`'
   6721  a604		       85 31		      STA	unk_31
   6722  a606		       20 c6 9b 	      JSR	reset_cursor_shape
   6723  a609		       a9 1a		      LDA	#26	; reset	text and graphics windows
   6724  a60b		       20 ee ff 	      JSR	OSWRCH
   6725  a60e		       a9 0c		      LDA	#12	; clear	screen
   6726  a610		       20 ee ff 	      JSR	OSWRCH
   6727  a613		       20 ee 94 	      JSR	reset_keys_settings
   6728  a616		       a2 00		      LDX	#0
   6729  a618		       a9 e4		      LDA	#228
   6730  a61a		       20 91 8e 	      JSR	osbyte_with_y0
   6731  a61d		       a5 16		      LDA	unk_16
   6732  a61f		       d0 2c		      BNE	loc_A64D
   6733  a621		       20 e9 9f 	      JSR	is_program_empty	; sets	C if no	program
   6734  a624		       b0 27		      BCS	loc_A64D
   6735  a626		       a9 08		      LDA	#8
   6736  a628		       85 3a		      STA	byte_3A	; position in "OLD|MRUN|M" string
   6737  a62a		       a2 04		      LDX	#4	; ending position is by	default	after "OLD|M" part
   6738  a62c		       ad bd 06 	      LDA	current_command_id
   6739  a62f		       c9 d0		      CMP	#CMD_RUN	; is the command RUN?
   6740  a631		       d0 02		      BNE	type_commands	; if not, just typing "OLD|M" is fine
   6741  a633		       a2 00		      LDX	#0	; if RUN, type "OLD|MRUN|M"
   6742  a635
   6743  a635				   type_commands
   6744  a635		       86 39		      STX	byte_39	; ending position in string
   6745  a637
   6746  a637				   type_commands_loop
   6747  a637		       a6 3a		      LDX	byte_3A
   6748  a639		       ca		      DEX
   6749  a63a		       bd b3 89 	      LDA	nur_dlo_string,X	; get next character
   6750  a63d		       a8		      TAY		; put char into	Y for OSBYTE
   6751  a63e		       a2 00		      LDX	#0	; 0 = keyboard buffer
   6752  a640		       a9 8a		      LDA	#138	; insert into keyboard buffer
   6753  a642		       20 f4 ff 	      JSR	OSBYTE
   6754  a645		       c6 3a		      DEC	byte_3A	; next char in string
   6755  a647		       a5 3a		      LDA	byte_3A
   6756  a649		       c5 39		      CMP	byte_39	; reached the end?
   6757  a64b		       d0 ea		      BNE	type_commands_loop
   6758  a64d
   6759  a64d				   loc_A64D
   6760  a64d		       a2 00		      LDX	#0
   6761  a64f		       a0 ff		      LDY	#255
   6762  a651		       a9 bb		      LDA	#187	; get ROM containing BASIC
   6763  a653		       20 f4 ff 	      JSR	OSBYTE
   6764  a656		       a9 8e		      LDA	#142	; enter	language ROM
   6765  a658		       20 f4 ff 	      JSR	OSBYTE
   6766  a65b
   6767  a65b				   top_edit_mode_command
   6768  a65b
   6769  a65b		       a9 00		      LDA	#0
   6770  a65d		       85 2b		      STA	byte_2B
   6771  a65f		       85 2c		      STA	byte_2C
   6772  a661
   6773  a661				   loc_A661
   6774  a661		       a9 00		      LDA	#0
   6775  a663		       85 3b		      STA	byte_3B
   6776  a665		       38		      SEC
   6777  a666		       20 ea 9d 	      JSR	sub_9DEA
   6778  a669		       20 14 83 	      JSR	sub_8314
   6779  a66c		       20 d8 9f 	      JSR	sub_9FD8
   6780  a66f		       4c d8 9a 	      JMP	edit_mode_loop
   6781  a672
   6782  a672				   top_command
   6783  a672		       20 14 83 	      JSR	sub_8314
   6784  a675		       4c a8 9d 	      JMP	loc_9DA8
   6785  a678
   6786  a678				   end_command
   6787  a678		       20 0e a0 	      JSR	cls_and_reset_6c0_to_6ff
   6788  a67b		       a9 00		      LDA	#0
   6789  a67d		       f0 02		      BEQ	loc_A681
   6790  a67f
   6791  a67f				   end_edit_mode_command
   6792  a67f
   6793  a67f		       a9 01		      LDA	#1
   6794  a681
   6795  a681				   loc_A681
   6796  a681		       48		      PHA
   6797  a682		       a9 ff		      LDA	#$FF
   6798  a684		       85 2b		      STA	byte_2B
   6799  a686		       20 8f 9e 	      JSR	find_line_by_number	; finds a line, given a line number
   6800  a689							;
   6801  a689							; Entry:
   6802  a689							; byte_2B: line	number MSB
   6803  a689							; byte_2C: line	number LSB
   6804  a689							;
   6805  a689							; Exit:
   6806  a689							; (byte_2B) points to most suitable line
   6807  a689		       20 77 aa 	      JSR	sub_AA77	; swap byte_2B with unk_2F, swap byte_2C with unk_30
   6808  a68c		       20 39 a0 	      JSR	save_line_number	; saves line number from program.
   6809  a68f							;
   6810  a68f							; Entry:
   6811  a68f							; (byte_2b) points to current line
   6812  a68f							;
   6813  a68f							; Exit:
   6814  a68f							; current_line_no_lsb, current_line_no_msb = the line number
   6815  a68f		       68		      PLA
   6816  a690		       aa		      TAX
   6817  a691		       a5 4a		      LDA	current_line_no_lsb
   6818  a693		       48		      PHA
   6819  a694		       a5 4b		      LDA	current_line_no_msb
   6820  a696		       48		      PHA
   6821  a697		       8a		      TXA
   6822  a698		       48		      PHA
   6823  a699		       20 47 aa 	      JSR	sub_AA47
   6824  a69c		       a9 00		      LDA	#0
   6825  a69e		       85 3b		      STA	byte_3B
   6826  a6a0		       a5 4a		      LDA	current_line_no_lsb
   6827  a6a2		       85 2b		      STA	byte_2B
   6828  a6a4		       a5 4b		      LDA	current_line_no_msb
   6829  a6a6		       85 2c		      STA	byte_2C
   6830  a6a8		       28		      PLP
   6831  a6a9		       20 ea 9d 	      JSR	sub_9DEA
   6832  a6ac		       68		      PLA
   6833  a6ad		       85 4b		      STA	current_line_no_msb
   6834  a6af		       68		      PLA
   6835  a6b0		       85 4a		      STA	current_line_no_lsb
   6836  a6b2		       20 d8 9f 	      JSR	sub_9FD8
   6837  a6b5		       4c d8 9a 	      JMP	edit_mode_loop
   6838  a6b8
   6839  a6b8				   new_command
   6840  a6b8		       20 f8 82 	      JSR	clear_program
   6841  a6bb		       20 c9 a6 	      JSR	reset_program_name
   6842  a6be
   6843  a6be				   loc_A6BE
   6844  a6be		       ad b7 06 	      LDA	editor_mode_id	; 1=command mode, 2=edit mode
   6845  a6c1		       c9 01		      CMP	#1
   6846  a6c3		       f0 03		      BEQ	locret_A6C8
   6847  a6c5		       4c a8 9d 	      JMP	loc_9DA8
   6848  a6c8
   6849  a6c8				   locret_A6C8
   6850  a6c8		       60		      RTS
   6851  a6c9
   6852  a6c9
   6853  a6c9
   6854  a6c9				   reset_program_name
   6855  a6c9
   6856  a6c9		       a2 0e		      LDX	#$E
   6857  a6cb		       a9 20		      LDA	#$20	; ' '
   6858  a6cd
   6859  a6cd				   loc_A6CD
   6860  a6cd		       95 52		      STA	program_name,X
   6861  a6cf		       ca		      DEX
   6862  a6d0		       10 fb		      BPL	loc_A6CD
   6863  a6d2		       60		      RTS
   6864  a6d3							; End of function reset_program_name
   6865  a6d3
   6866  a6d3
   6867  a6d3
   6868  a6d3
   6869  a6d3				   old_command
   6870  a6d3		       20 e9 9f 	      JSR	is_program_empty	; sets	C if no	program
   6871  a6d6		       90 0e		      BCC	old_command_good_program
   6872  a6d8		       a0 01		      LDY	#1
   6873  a6da		       a9 00		      LDA	#0
   6874  a6dc		       91 17		      STA	($17),Y
   6875  a6de		       20 1f 83 	      JSR	find_program
   6876  a6e1		       90 03		      BCC	old_command_good_program
   6877  a6e3		       4c 4d 81 	      JMP	loc_814D
   6878  a6e6
   6879  a6e6				   old_command_good_program
   6880  a6e6
   6881  a6e6		       20 14 83 	      JSR	sub_8314
   6882  a6e9		       4c be a6 	      JMP	loc_A6BE
   6883  a6ec							; End of function old_command
   6884  a6ec
   6885  a6ec
   6886  a6ec				   extend_statement_edit_mode_command
   6887  a6ec		       a6 09		      LDX	unk_9
   6888  a6ee		       ca		      DEX
   6889  a6ef		       d0 03		      BNE	loc_A6F4
   6890  a6f1		       4c 69 9f 	      JMP	beep
   6891  a6f4
   6892  a6f4				   loc_A6F4
   6893  a6f4		       20 3c ab 	      JSR	loc_AB3C
   6894  a6f7		       4c a8 a8 	      JMP	position_edit_mode_cursor
   6895  a6fa
   6896  a6fa				   swap_case_edit_mode_command
   6897  a6fa		       a6 11		      LDX	unk_11
   6898  a6fc		       ca		      DEX
   6899  a6fd		       f0 16		      BEQ	loc_A715
   6900  a6ff		       a6 10		      LDX	cursor_offset	; offset of cursor in detokenized buffer
   6901  a701		       bd 00 04 	      LDA	$400,X
   6902  a704		       20 59 8e 	      JSR	toggle_case
   6903  a707		       9d 00 04 	      STA	$400,X
   6904  a70a		       a9 01		      LDA	#1
   6905  a70c		       8d b3 06 	      STA	byte_6B3
   6906  a70f		       8a		      TXA
   6907  a710		       a0 00		      LDY	#0
   6908  a712		       20 b1 a0 	      JSR	sub_A0B1
   6909  a715
   6910  a715				   loc_A715
   6911  a715		       4c 84 a7 	      JMP	cursor_right_edit_mode_command
   6912  a718
   6913  a718				   renumber_edit_mode_command
   6914  a718
   6915  a718		       20 92 84 	      JSR	sub_8492
   6916  a71b		       4c 7a 96 	      JMP	loc_967A
   6917  a71e
   6918  a71e				   undo_edit_mode_command
   6919  a71e		       20 e9 9f 	      JSR	is_program_empty	; sets	C if no	program
   6920  a721		       90 03		      BCC	loc_A726
   6921  a723		       4c a8 9d 	      JMP	loc_9DA8
   6922  a726
   6923  a726				   loc_A726
   6924  a726		       a5 4a		      LDA	current_line_no_lsb
   6925  a728		       48		      PHA
   6926  a729		       a5 4b		      LDA	current_line_no_msb
   6927  a72b		       48		      PHA
   6928  a72c		       20 17 aa 	      JSR	sub_AA17
   6929  a72f		       68		      PLA
   6930  a730		       85 4b		      STA	current_line_no_msb
   6931  a732		       68		      PLA
   6932  a733		       85 4a		      STA	current_line_no_lsb
   6933  a735		       20 d8 9f 	      JSR	sub_9FD8
   6934  a738		       4c a8 a8 	      JMP	position_edit_mode_cursor
   6935  a73b
   6936  a73b				   copy_key_edit_mode_command
   6937  a73b		       a2 00		      LDX	#0
   6938  a73d		       a5 31		      LDA	unk_31
   6939  a73f		       d0 04		      BNE	loc_A745
   6940  a741		       a2 40		      LDX	#$40	; '@'
   6941  a743		       d0 06		      BNE	loc_A74B
   6942  a745
   6943  a745				   loc_A745
   6944  a745		       c9 60		      CMP	#$60	; '`'
   6945  a747		       f0 02		      BEQ	loc_A74B
   6946  a749		       a2 60		      LDX	#$60	; '`'
   6947  a74b
   6948  a74b				   loc_A74B
   6949  a74b		       86 31		      STX	unk_31
   6950  a74d		       60		      RTS
   6951  a74e
   6952  a74e				   top_of_screen_edit_mode_command
   6953  a74e		       a5 4a		      LDA	current_line_no_lsb
   6954  a750		       85 2b		      STA	byte_2B
   6955  a752		       a5 4b		      LDA	current_line_no_msb
   6956  a754		       85 2c		      STA	byte_2C
   6957  a756		       4c 61 a6 	      JMP	loc_A661
   6958  a759
   6959  a759
   6960  a759
   6961  a759				   cursor_left_edit_mode_command
   6962  a759		       20 75 a7 	      JSR	sub_A775
   6963  a75c		       90 0a		      BCC	loc_A768
   6964  a75e		       a5 09		      LDA	unk_9
   6965  a760		       85 11		      STA	unk_11
   6966  a762		       a5 08		      LDA	unk_8
   6967  a764		       85 10		      STA	cursor_offset	; offset of cursor in detokenized buffer
   6968  a766		       d0 3a		      BNE	loc_A7A2
   6969  a768
   6970  a768				   loc_A768
   6971  a768		       38		      SEC
   6972  a769		       a5 10		      LDA	cursor_offset	; offset of cursor in detokenized buffer
   6973  a76b		       e9 01		      SBC	#1
   6974  a76d		       85 10		      STA	cursor_offset	; offset of cursor in detokenized buffer
   6975  a76f		       b0 31		      BCS	loc_A7A2
   6976  a771		       c6 11		      DEC	unk_11
   6977  a773		       f0 2d		      BEQ	loc_A7A2
   6978  a775							; End of function cursor_left_edit_mode_command
   6979  a775
   6980  a775
   6981  a775
   6982  a775
   6983  a775				   sub_A775
   6984  a775
   6985  a775		       18		      CLC
   6986  a776		       a6 10		      LDX	cursor_offset	; offset of cursor in detokenized buffer
   6987  a778		       ca		      DEX
   6988  a779		       d0 08		      BNE	locret_A783
   6989  a77b		       a5 11		      LDA	unk_11
   6990  a77d		       d0 04		      BNE	locret_A783
   6991  a77f		       20 98 be 	      JSR	sub_BE98
   6992  a782		       38		      SEC
   6993  a783
   6994  a783				   locret_A783
   6995  a783		       60		      RTS
   6996  a784							; End of function sub_A775
   6997  a784
   6998  a784
   6999  a784
   7000  a784
   7001  a784				   cursor_right_edit_mode_command
   7002  a784		       a5 10		      LDA	cursor_offset	; offset of cursor in detokenized buffer
   7003  a786		       c5 08		      CMP	unk_8
   7004  a788		       d0 12		      BNE	loc_A79C
   7005  a78a		       a5 11		      LDA	unk_11
   7006  a78c		       c5 09		      CMP	unk_9
   7007  a78e		       d0 0c		      BNE	loc_A79C
   7008  a790		       20 a1 b7 	      JSR	sub_B7A1
   7009  a793
   7010  a793				   loc_A793
   7011  a793
   7012  a793		       a2 00		      LDX	#0
   7013  a795		       86 11		      STX	unk_11
   7014  a797		       e8		      INX
   7015  a798		       86 10		      STX	cursor_offset	; offset of cursor in detokenized buffer
   7016  a79a		       d0 06		      BNE	loc_A7A2
   7017  a79c
   7018  a79c				   loc_A79C
   7019  a79c
   7020  a79c		       e6 10		      INC	cursor_offset	; offset of cursor in detokenized buffer
   7021  a79e		       d0 02		      BNE	loc_A7A2
   7022  a7a0		       e6 11		      INC	unk_11
   7023  a7a2
   7024  a7a2				   loc_A7A2
   7025  a7a2
   7026  a7a2		       4c a8 a8 	      JMP	position_edit_mode_cursor
   7027  a7a5							; End of function cursor_right_edit_mode_command
   7028  a7a5
   7029  a7a5
   7030  a7a5				   shift_cursor_left_edit_mode_command
   7031  a7a5		       20 59 a7 	      JSR	cursor_left_edit_mode_command
   7032  a7a8		       4c 59 a7 	      JMP	cursor_left_edit_mode_command
   7033  a7ab
   7034  a7ab				   shift_cursor_right_edit_mode_command
   7035  a7ab		       20 84 a7 	      JSR	cursor_right_edit_mode_command
   7036  a7ae		       4c 84 a7 	      JMP	cursor_right_edit_mode_command
   7037  a7b1
   7038  a7b1				   ctrl_cursor_left_edit_mode_command
   7039  a7b1		       20 75 a7 	      JSR	sub_A775
   7040  a7b4		       4c 93 a7 	      JMP	loc_A793
   7041  a7b7
   7042  a7b7
   7043  a7b7
   7044  a7b7				   ctrl_cursor_right_edit_mode_command
   7045  a7b7
   7046  a7b7		       20 a1 b7 	      JSR	sub_B7A1
   7047  a7ba		       4c 93 a7 	      JMP	loc_A793
   7048  a7bd							; End of function ctrl_cursor_right_edit_mode_command
   7049  a7bd
   7050  a7bd
   7051  a7bd
   7052  a7bd
   7053  a7bd				   sub_A7BD
   7054  a7bd		       18		      CLC
   7055  a7be		       a5 10		      LDA	cursor_offset	; offset of cursor in detokenized buffer
   7056  a7c0		       6d b6 06 	      ADC	code_area_width
   7057  a7c3		       85 10		      STA	cursor_offset	; offset of cursor in detokenized buffer
   7058  a7c5		       90 02		      BCC	locret_A7C9
   7059  a7c7		       e6 11		      INC	unk_11
   7060  a7c9
   7061  a7c9				   locret_A7C9
   7062  a7c9		       60		      RTS
   7063  a7ca							; End of function sub_A7BD
   7064  a7ca
   7065  a7ca
   7066  a7ca				   cursor_down_edit_mode_command
   7067  a7ca		       a5 10		      LDA	cursor_offset	; offset of cursor in detokenized buffer
   7068  a7cc		       48		      PHA
   7069  a7cd		       a5 11		      LDA	unk_11
   7070  a7cf		       48		      PHA
   7071  a7d0		       20 bd a7 	      JSR	sub_A7BD
   7072  a7d3		       38		      SEC
   7073  a7d4		       a5 10		      LDA	cursor_offset	; offset of cursor in detokenized buffer
   7074  a7d6		       e5 08		      SBC	unk_8
   7075  a7d8		       85 10		      STA	cursor_offset	; offset of cursor in detokenized buffer
   7076  a7da		       a5 11		      LDA	unk_11
   7077  a7dc		       e5 09		      SBC	unk_9
   7078  a7de		       85 11		      STA	unk_11
   7079  a7e0		       20 04 a8 	      JSR	sub_A804
   7080  a7e3		       90 05		      BCC	loc_A7EA
   7081  a7e5		       68		      PLA
   7082  a7e6		       68		      PLA
   7083  a7e7		       4c 34 a8 	      JMP	loc_A834
   7084  a7ea
   7085  a7ea				   loc_A7EA
   7086  a7ea		       68		      PLA
   7087  a7eb		       aa		      TAX
   7088  a7ec		       68		      PLA
   7089  a7ed		       a8		      TAY
   7090  a7ee		       a5 10		      LDA	cursor_offset	; offset of cursor in detokenized buffer
   7091  a7f0		       48		      PHA
   7092  a7f1		       a5 11		      LDA	unk_11
   7093  a7f3		       48		      PHA
   7094  a7f4		       86 11		      STX	unk_11
   7095  a7f6		       84 10		      STY	cursor_offset	; offset of cursor in detokenized buffer
   7096  a7f8		       20 a1 b7 	      JSR	sub_B7A1
   7097  a7fb		       68		      PLA
   7098  a7fc		       85 11		      STA	unk_11
   7099  a7fe		       68		      PLA
   7100  a7ff		       85 10		      STA	cursor_offset	; offset of cursor in detokenized buffer
   7101  a801		       4c a8 a8 	      JMP	position_edit_mode_cursor
   7102  a804
   7103  a804
   7104  a804
   7105  a804				   sub_A804
   7106  a804		       38		      SEC
   7107  a805		       a5 11		      LDA	unk_11
   7108  a807		       30 09		      BMI	locret_A812
   7109  a809		       f0 02		      BEQ	loc_A80D
   7110  a80b		       d0 04		      BNE	loc_A811
   7111  a80d
   7112  a80d				   loc_A80D
   7113  a80d		       a5 10		      LDA	cursor_offset	; offset of cursor in detokenized buffer
   7114  a80f		       f0 01		      BEQ	locret_A812
   7115  a811
   7116  a811				   loc_A811
   7117  a811		       18		      CLC
   7118  a812
   7119  a812				   locret_A812
   7120  a812		       60		      RTS
   7121  a813							; End of function sub_A804
   7122  a813
   7123  a813
   7124  a813
   7125  a813
   7126  a813				   sub_A813
   7127  a813		       38		      SEC
   7128  a814		       a5 10		      LDA	cursor_offset	; offset of cursor in detokenized buffer
   7129  a816		       ed b6 06 	      SBC	code_area_width
   7130  a819		       85 10		      STA	cursor_offset	; offset of cursor in detokenized buffer
   7131  a81b		       b0 02		      BCS	locret_A81F
   7132  a81d		       c6 11		      DEC	unk_11
   7133  a81f
   7134  a81f				   locret_A81F
   7135  a81f		       60		      RTS
   7136  a820							; End of function sub_A813
   7137  a820
   7138  a820
   7139  a820				   cursor_up_edit_mode_command
   7140  a820		       20 13 a8 	      JSR	sub_A813
   7141  a823
   7142  a823				   loc_A823
   7143  a823		       20 04 a8 	      JSR	sub_A804
   7144  a826		       b0 03		      BCS	loc_A82B
   7145  a828		       4c a2 a7 	      JMP	loc_A7A2
   7146  a82b
   7147  a82b				   loc_A82B
   7148  a82b		       20 bd a7 	      JSR	sub_A7BD
   7149  a82e		       20 98 be 	      JSR	sub_BE98
   7150  a831		       20 13 a8 	      JSR	sub_A813
   7151  a834
   7152  a834				   loc_A834
   7153  a834		       18		      CLC
   7154  a835		       a5 10		      LDA	cursor_offset	; offset of cursor in detokenized buffer
   7155  a837		       65 08		      ADC	unk_8
   7156  a839		       85 10		      STA	cursor_offset	; offset of cursor in detokenized buffer
   7157  a83b		       a5 11		      LDA	unk_11
   7158  a83d		       65 09		      ADC	unk_9
   7159  a83f		       85 11		      STA	unk_11
   7160  a841		       4c a8 a8 	      JMP	position_edit_mode_cursor
   7161  a844
   7162  a844				   ctrl_cursor_up_edit_mode_command
   7163  a844		       20 06 aa 	      JSR	sub_AA06
   7164  a847		       ad c0 06 	      LDA	byte_6C0
   7165  a84a		       85 2b		      STA	byte_2B
   7166  a84c		       ad c1 06 	      LDA	byte_6C1
   7167  a84f		       85 2c		      STA	byte_2C
   7168  a851		       20 39 a0 	      JSR	save_line_number	; saves line number from program.
   7169  a854							;
   7170  a854							; Entry:
   7171  a854							; (byte_2b) points to current line
   7172  a854							;
   7173  a854							; Exit:
   7174  a854							; current_line_no_lsb, current_line_no_msb = the line number
   7175  a854		       20 69 a0 	      JSR	sub_A069
   7176  a857		       4c 93 a7 	      JMP	loc_A793
   7177  a85a
   7178  a85a				   ctrl_cursor_down_edit_mode_command
   7179  a85a		       20 06 aa 	      JSR	sub_AA06
   7180  a85d		       a9 00		      LDA	#0
   7181  a85f		       85 2b		      STA	byte_2B
   7182  a861		       85 2c		      STA	byte_2C
   7183  a863		       20 69 ba 	      JSR	sub_BA69
   7184  a866		       bd bf 06 	      LDA	$6BF,X
   7185  a869		       85 2c		      STA	byte_2C
   7186  a86b		       bd be 06 	      LDA	$6BE,X
   7187  a86e		       85 2b		      STA	byte_2B
   7188  a870		       20 69 ba 	      JSR	sub_BA69
   7189  a873		       e8		      INX
   7190  a874		       20 45 a0 	      JSR	get_line_ptr	; gets pointer to line visible on screen.
   7191  a877							;
   7192  a877							; Entry:
   7193  a877							; X = screen line number * 2 + 1
   7194  a877							;
   7195  a877							; Exit:
   7196  a877							; (byte_2B) points to BASIC line
   7197  a877							; X decremented
   7198  a877		       20 39 a0 	      JSR	save_line_number	; saves line number from program.
   7199  a87a							;
   7200  a87a							; Entry:
   7201  a87a							; (byte_2b) points to current line
   7202  a87a							;
   7203  a87a							; Exit:
   7204  a87a							; current_line_no_lsb, current_line_no_msb = the line number
   7205  a87a		       4c d8 9f 	      JMP	sub_9FD8
   7206  a87d
   7207  a87d				   shift_cursor_up_edit_mode_command
   7208  a87d		       ae c0 06 	      LDX	byte_6C0
   7209  a880		       ac c1 06 	      LDY	byte_6C1
   7210  a883		       e0 00		      CPX	#0
   7211  a885		       d0 07		      BNE	loc_A88E
   7212  a887		       c4 18		      CPY	oshwm+1
   7213  a889		       d0 03		      BNE	loc_A88E
   7214  a88b		       4c 5b a6 	      JMP	top_edit_mode_command
   7215  a88e
   7216  a88e				   loc_A88E
   7217  a88e		       86 2b		      STX	byte_2B
   7218  a890		       84 2c		      STY	byte_2C
   7219  a892		       4c 41 aa 	      JMP	loc_AA41
   7220  a895
   7221  a895				   shift_cursor_down_edit_mode_command
   7222  a895		       a9 00		      LDA	#0
   7223  a897		       85 2b		      STA	byte_2B
   7224  a899		       85 2c		      STA	byte_2C
   7225  a89b		       20 69 ba 	      JSR	sub_BA69
   7226  a89e		       ca		      DEX
   7227  a89f		       20 45 a0 	      JSR	get_line_ptr	; gets pointer to line visible on screen.
   7228  a8a2							;
   7229  a8a2							; Entry:
   7230  a8a2							; X = screen line number * 2 + 1
   7231  a8a2							;
   7232  a8a2							; Exit:
   7233  a8a2							; (byte_2B) points to BASIC line
   7234  a8a2							; X decremented
   7235  a8a2		       20 39 a0 	      JSR	save_line_number	; saves line number from program.
   7236  a8a5							;
   7237  a8a5							; Entry:
   7238  a8a5							; (byte_2b) points to current line
   7239  a8a5							;
   7240  a8a5							; Exit:
   7241  a8a5							; current_line_no_lsb, current_line_no_msb = the line number
   7242  a8a5		       4c a8 9d 	      JMP	loc_9DA8
   7243  a8a8
   7244  a8a8
   7245  a8a8
   7246  a8a8				   position_edit_mode_cursor
   7247  a8a8
   7248  a8a8		       a4 11		      LDY	unk_11
   7249  a8aa		       a6 10		      LDX	cursor_offset	; offset of cursor in detokenized buffer
   7250  a8ac		       d0 01		      BNE	loc_A8AF
   7251  a8ae		       88		      DEY
   7252  a8af
   7253  a8af				   loc_A8AF
   7254  a8af		       ca		      DEX
   7255  a8b0		       20 4e 8f 	      JSR	get_line_dimensions	; work out dimensions of line.
   7256  a8b3							;
   7257  a8b3							; Entry:
   7258  a8b3							; X=line length
   7259  a8b3							; Y=starting Y
   7260  a8b3							;
   7261  a8b3							; Exit:
   7262  a8b3							; X=line length	MOD screen width
   7263  a8b3							; Y=ending Y
   7264  a8b3		       8a		      TXA
   7265  a8b4		       18		      CLC
   7266  a8b5		       69 06		      ADC	#6
   7267  a8b7		       aa		      TAX
   7268  a8b8		       98		      TYA
   7269  a8b9		       18		      CLC
   7270  a8ba		       65 3b		      ADC	byte_3B
   7271  a8bc		       a8		      TAY
   7272  a8bd		       4c 01 8f 	      JMP	gotoxy
   7273  a8c0							; End of function position_edit_mode_cursor
   7274  a8c0
   7275  a8c0
   7276  a8c0
   7277  a8c0
   7278  a8c0				   sub_A8C0
   7279  a8c0
   7280  a8c0		       ad b3 06 	      LDA	byte_6B3
   7281  a8c3		       d0 01		      BNE	loc_A8C6
   7282  a8c5		       60		      RTS
   7283  a8c6
   7284  a8c6				   loc_A8C6
   7285  a8c6		       a9 00		      LDA	#0
   7286  a8c8		       8d a8 06 	      STA	byte_6A8
   7287  a8cb		       48		      PHA
   7288  a8cc
   7289  a8cc				   loc_A8CC
   7290  a8cc		       20 e6 ab 	      JSR	rstrip_and_cr_terminate_detokenized_line
   7291  a8cf		       18		      CLC
   7292  a8d0		       8a		      TXA
   7293  a8d1		       69 04		      ADC	#4
   7294  a8d3		       8d 03 05 	      STA	unk_503
   7295  a8d6		       a9 0d		      LDA	#$D
   7296  a8d8		       8d 00 05 	      STA	unk_500
   7297  a8db		       a5 4a		      LDA	current_line_no_lsb
   7298  a8dd		       8d 01 05 	      STA	unk_501
   7299  a8e0		       a5 4b		      LDA	current_line_no_msb
   7300  a8e2		       8d 02 05 	      STA	unk_502
   7301  a8e5		       a9 01		      LDA	#1
   7302  a8e7		       85 0c		      STA	byte_C
   7303  a8e9		       a9 04		      LDA	#4
   7304  a8eb		       85 0d		      STA	byte_D
   7305  a8ed		       a9 04		      LDA	#4
   7306  a8ef		       85 0e		      STA	byte_E
   7307  a8f1		       a9 05		      LDA	#5
   7308  a8f3		       85 0f		      STA	byte_F
   7309  a8f5		       a2 00		      LDX	#0
   7310  a8f7		       a0 fc		      LDY	#$FC
   7311  a8f9		       20 a1 8e 	      JSR	memmove	; move (maybe overlapping) memory regions.
   7312  a8fc							;
   7313  a8fc							; Entry:
   7314  a8fc							; (byte_C) points to src
   7315  a8fc							; (byte_E) points to dest
   7316  a8fc							; X is MSB of size
   7317  a8fc							; Y is LSB of size
   7318  a8fc		       4c 05 a9 	      JMP	loc_A905
   7319  a8ff
   7320  a8ff				   loc_A8FF
   7321  a8ff		       a9 00		      LDA	#0
   7322  a901		       8d a8 06 	      STA	byte_6A8
   7323  a904		       48		      PHA
   7324  a905
   7325  a905				   loc_A905
   7326  a905		       a9 00		      LDA	#0
   7327  a907		       85 2b		      STA	byte_2B
   7328  a909		       a9 05		      LDA	#5
   7329  a90b		       85 2c		      STA	byte_2C
   7330  a90d		       20 36 9c 	      JSR	detokenize_line	; detokenize line and store result.
   7331  a910							;
   7332  a910							; Entry:
   7333  a910							; (byte_2B) points to line
   7334  a910							;
   7335  a910							; Exit:
   7336  a910							; $400 = line length
   7337  a910							; $401... = line text
   7338  a910							; unk_6A8 incremented if line too long
   7339  a910		       ad a8 06 	      LDA	byte_6A8
   7340  a913		       f0 13		      BEQ	loc_A928
   7341  a915		       ad a7 06 	      LDA	byte_6A7
   7342  a918		       d0 05		      BNE	loc_A91F
   7343  a91a		       a9 25		      LDA	#$25	; '%'	    ; "Updates would make line too long"
   7344  a91c		       4c 9d 85 	      JMP	loc_859D
   7345  a91f
   7346  a91f				   loc_A91F
   7347  a91f		       68		      PLA
   7348  a920		       d0 07		      BNE	loc_A929
   7349  a922		       a9 01		      LDA	#1
   7350  a924		       48		      PHA
   7351  a925		       4c cc a8 	      JMP	loc_A8CC
   7352  a928
   7353  a928				   loc_A928
   7354  a928		       68		      PLA
   7355  a929
   7356  a929				   loc_A929
   7357  a929		       a5 4a		      LDA	current_line_no_lsb
   7358  a92b		       85 2b		      STA	byte_2B
   7359  a92d		       a5 4b		      LDA	current_line_no_msb
   7360  a92f		       85 2c		      STA	byte_2C
   7361  a931		       20 8f 9e 	      JSR	find_line_by_number	; finds a line, given a line number
   7362  a934							;
   7363  a934							; Entry:
   7364  a934							; byte_2B: line	number MSB
   7365  a934							; byte_2C: line	number LSB
   7366  a934							;
   7367  a934							; Exit:
   7368  a934							; (byte_2B) points to most suitable line
   7369  a934		       a0 01		      LDY	#1
   7370  a936		       b1 2b		      LDA	($2B),Y
   7371  a938		       c5 4a		      CMP	current_line_no_lsb
   7372  a93a		       d0 07		      BNE	loc_A943
   7373  a93c		       c8		      INY
   7374  a93d		       b1 2b		      LDA	($2B),Y
   7375  a93f		       c5 4b		      CMP	current_line_no_msb
   7376  a941		       f0 04		      BEQ	loc_A947
   7377  a943
   7378  a943				   loc_A943
   7379  a943		       a2 ff		      LDX	#-1
   7380  a945		       86 2c		      STX	byte_2C
   7381  a947
   7382  a947				   loc_A947
   7383  a947		       a6 2c		      LDX	byte_2C
   7384  a949		       e8		      INX
   7385  a94a		       86 25		      STX	byte_25
   7386  a94c		       ad 03 05 	      LDA	unk_503
   7387  a94f		       e0 00		      CPX	#0
   7388  a951		       f0 05		      BEQ	loc_A958
   7389  a953		       38		      SEC
   7390  a954		       a0 03		      LDY	#3
   7391  a956		       f1 2b		      SBC	($2B),Y
   7392  a958
   7393  a958				   loc_A958
   7394  a958		       85 27		      STA	byte_27
   7395  a95a		       a9 00		      LDA	#0
   7396  a95c		       e9 00		      SBC	#0
   7397  a95e		       85 28		      STA	byte_28
   7398  a960		       20 1f 83 	      JSR	find_program
   7399  a963		       20 f2 9f 	      JSR	sub_9FF2
   7400  a966		       a6 4b		      LDX	current_line_no_msb
   7401  a968		       a4 4a		      LDY	current_line_no_lsb
   7402  a96a		       e8		      INX
   7403  a96b		       d0 01		      BNE	loc_A96E
   7404  a96d		       c8		      INY
   7405  a96e
   7406  a96e				   loc_A96E
   7407  a96e		       86 2c		      STX	byte_2C
   7408  a970		       84 2b		      STY	byte_2B
   7409  a972		       20 8f 9e 	      JSR	find_line_by_number	; finds a line, given a line number
   7410  a975							;
   7411  a975							; Entry:
   7412  a975							; byte_2B: line	number MSB
   7413  a975							; byte_2C: line	number LSB
   7414  a975							;
   7415  a975							; Exit:
   7416  a975							; (byte_2B) points to most suitable line
   7417  a975		       a5 2c		      LDA	byte_2C
   7418  a977		       85 0d		      STA	byte_D
   7419  a979		       a5 2b		      LDA	byte_2B
   7420  a97b		       85 0c		      STA	byte_C
   7421  a97d		       18		      CLC
   7422  a97e		       65 27		      ADC	byte_27
   7423  a980		       85 0e		      STA	byte_E
   7424  a982		       a5 2c		      LDA	byte_2C
   7425  a984		       65 28		      ADC	byte_28
   7426  a986		       85 0f		      STA	byte_F
   7427  a988		       38		      SEC
   7428  a989		       a5 12		      LDA	TOP
   7429  a98b		       e5 0c		      SBC	byte_C
   7430  a98d		       a8		      TAY
   7431  a98e		       a5 13		      LDA	TOP+1
   7432  a990		       e5 0d		      SBC	byte_D
   7433  a992		       aa		      TAX
   7434  a993		       20 a1 8e 	      JSR	memmove	; move (maybe overlapping) memory regions.
   7435  a996							;
   7436  a996							; Entry:
   7437  a996							; (byte_C) points to src
   7438  a996							; (byte_E) points to dest
   7439  a996							; X is MSB of size
   7440  a996							; Y is LSB of size
   7441  a996		       a9 00		      LDA	#0
   7442  a998		       85 0c		      STA	byte_C
   7443  a99a		       a9 05		      LDA	#5
   7444  a99c		       85 0d		      STA	byte_D
   7445  a99e		       a0 04		      LDY	#4
   7446  a9a0		       a6 25		      LDX	byte_25
   7447  a9a2		       d0 02		      BNE	loc_A9A6
   7448  a9a4		       a0 00		      LDY	#0
   7449  a9a6
   7450  a9a6				   loc_A9A6
   7451  a9a6		       b9 2b 00 	      LDA	$2B,Y
   7452  a9a9		       85 0e		      STA	byte_E
   7453  a9ab		       b9 2c 00 	      LDA	$2C,Y
   7454  a9ae		       85 0f		      STA	byte_F
   7455  a9b0		       ad b7 06 	      LDA	editor_mode_id	; 1=command mode, 2=edit mode
   7456  a9b3		       c9 01		      CMP	#1
   7457  a9b5		       f0 3c		      BEQ	loc_A9F3
   7458  a9b7		       a6 2d		      LDX	byte_2D
   7459  a9b9		       a5 3b		      LDA	byte_3B
   7460  a9bb		       0a		      ASL
   7461  a9bc		       a8		      TAY
   7462  a9bd
   7463  a9bd				   loc_A9BD
   7464  a9bd		       a5 0e		      LDA	byte_E
   7465  a9bf		       85 2b		      STA	byte_2B
   7466  a9c1		       99 c0 06 	      STA	$6C0,Y
   7467  a9c4		       c8		      INY
   7468  a9c5		       a5 0f		      LDA	byte_F
   7469  a9c7		       85 2c		      STA	byte_2C
   7470  a9c9		       99 c0 06 	      STA	$6C0,Y
   7471  a9cc		       c8		      INY
   7472  a9cd		       ca		      DEX
   7473  a9ce		       d0 ed		      BNE	loc_A9BD
   7474  a9d0
   7475  a9d0				   loc_A9D0
   7476  a9d0		       98		      TYA
   7477  a9d1		       4a		      LSR
   7478  a9d2		       cd bf 06 	      CMP	screen_height
   7479  a9d5		       f0 02		      BEQ	loc_A9D9
   7480  a9d7		       b0 1a		      BCS	loc_A9F3
   7481  a9d9
   7482  a9d9				   loc_A9D9
   7483  a9d9		       b9 c1 06 	      LDA	$6C1,Y
   7484  a9dc		       f0 15		      BEQ	loc_A9F3
   7485  a9de		       18		      CLC
   7486  a9df		       b9 c0 06 	      LDA	$6C0,Y
   7487  a9e2		       65 27		      ADC	byte_27
   7488  a9e4		       99 c0 06 	      STA	$6C0,Y
   7489  a9e7		       c8		      INY
   7490  a9e8		       b9 c0 06 	      LDA	$6C0,Y
   7491  a9eb		       65 28		      ADC	byte_28
   7492  a9ed		       99 c0 06 	      STA	$6C0,Y
   7493  a9f0		       c8		      INY
   7494  a9f1		       d0 dd		      BNE	loc_A9D0
   7495  a9f3
   7496  a9f3				   loc_A9F3
   7497  a9f3
   7498  a9f3		       a2 00		      LDX	#0
   7499  a9f5		       ac 03 05 	      LDY	unk_503
   7500  a9f8		       20 a1 8e 	      JSR	memmove	; move (maybe overlapping) memory regions.
   7501  a9fb							;
   7502  a9fb							; Entry:
   7503  a9fb							; (byte_C) points to src
   7504  a9fb							; (byte_E) points to dest
   7505  a9fb							; X is MSB of size
   7506  a9fb							; Y is LSB of size
   7507  a9fb		       ad a8 06 	      LDA	byte_6A8
   7508  a9fe		       f0 05		      BEQ	locret_AA05
   7509  aa00		       a9 24		      LDA	#$24	; '$'
   7510  aa02		       4c 9d 85 	      JMP	loc_859D
   7511  aa05
   7512  aa05				   locret_AA05
   7513  aa05		       60		      RTS
   7514  aa06							; End of function sub_A8C0
   7515  aa06
   7516  aa06
   7517  aa06
   7518  aa06
   7519  aa06				   sub_AA06
   7520  aa06		       ad b3 06 	      LDA	byte_6B3
   7521  aa09		       48		      PHA
   7522  aa0a		       20 c0 a8 	      JSR	sub_A8C0
   7523  aa0d		       68		      PLA
   7524  aa0e		       d0 07		      BNE	sub_AA17
   7525  aa10		       20 c3 9e 	      JSR	get_line_height	; get height of	current	line
   7526  aa13							;
   7527  aa13							; Entry:
   7528  aa13							; ?byte_400 = line length
   7529  aa13							;
   7530  aa13							; Exit:
   7531  aa13							; X = line height
   7532  aa13		       e4 2d		      CPX	byte_2D
   7533  aa15		       f0 29		      BEQ	locret_AA40
   7534  aa17							; End of function sub_AA06
   7535  aa17
   7536  aa17
   7537  aa17
   7538  aa17
   7539  aa17				   sub_AA17
   7540  aa17		       a5 08		      LDA	unk_8
   7541  aa19		       48		      PHA
   7542  aa1a		       a5 09		      LDA	unk_9
   7543  aa1c		       48		      PHA
   7544  aa1d		       20 69 a0 	      JSR	sub_A069
   7545  aa20		       68		      PLA
   7546  aa21		       aa		      TAX
   7547  aa22		       68		      PLA
   7548  aa23		       e4 09		      CPX	unk_9
   7549  aa25		       d0 07		      BNE	loc_AA2E
   7550  aa27		       c5 08		      CMP	unk_8
   7551  aa29		       d0 03		      BNE	loc_AA2E
   7552  aa2b		       4c 00 9f 	      JMP	sub_9F00
   7553  aa2e
   7554  aa2e				   loc_AA2E
   7555  aa2e		       a5 3b		      LDA	byte_3B
   7556  aa30		       48		      PHA
   7557  aa31		       a5 4a		      LDA	current_line_no_lsb
   7558  aa33		       85 2b		      STA	byte_2B
   7559  aa35		       a5 4b		      LDA	current_line_no_msb
   7560  aa37		       85 2c		      STA	byte_2C
   7561  aa39		       38		      SEC
   7562  aa3a		       20 ea 9d 	      JSR	sub_9DEA
   7563  aa3d		       68		      PLA
   7564  aa3e		       85 3b		      STA	byte_3B
   7565  aa40
   7566  aa40				   locret_AA40
   7567  aa40		       60		      RTS
   7568  aa41							; End of function sub_AA17
   7569  aa41
   7570  aa41
   7571  aa41				   loc_AA41
   7572  aa41		       20 47 aa 	      JSR	sub_AA47
   7573  aa44		       4c a8 9d 	      JMP	loc_9DA8
   7574  aa47
   7575  aa47
   7576  aa47
   7577  aa47				   sub_AA47
   7578  aa47		       a9 ff		      LDA	#$FF
   7579  aa49		       85 2e		      STA	unk_2E
   7580  aa4b
   7581  aa4b				   loc_AA4B
   7582  aa4b		       20 08 9c 	      JSR	detokenize_one_line
   7583  aa4e		       20 c3 9e 	      JSR	get_line_height	; get height of	current	line
   7584  aa51							;
   7585  aa51							; Entry:
   7586  aa51							; ?byte_400 = line length
   7587  aa51							;
   7588  aa51							; Exit:
   7589  aa51							; X = line height
   7590  aa51		       8a		      TXA		; A = line height
   7591  aa52		       18		      CLC
   7592  aa53		       65 2e		      ADC	unk_2E	; Add to current coordinate
   7593  aa55		       cd bf 06 	      CMP	screen_height	; Reached height of screen?
   7594  aa58		       f0 02		      BEQ	loc_AA5C	; taken	if reached screen height exactly
   7595  aa5a		       b0 15		      BCS	loc_AA71	; taken	if gone	past screen height
   7596  aa5c
   7597  aa5c				   loc_AA5C
   7598  aa5c		       85 2e		      STA	unk_2E	; store	coordinate
   7599  aa5e		       20 39 a0 	      JSR	save_line_number	; saves line number from program.
   7600  aa61							;
   7601  aa61							; Entry:
   7602  aa61							; (byte_2b) points to current line
   7603  aa61							;
   7604  aa61							; Exit:
   7605  aa61							; current_line_no_lsb, current_line_no_msb = the line number
   7606  aa61		       a5 4a		      LDA	current_line_no_lsb
   7607  aa63		       85 2b		      STA	byte_2B
   7608  aa65		       a5 4b		      LDA	current_line_no_msb
   7609  aa67		       85 2c		      STA	byte_2C
   7610  aa69		       20 8f 9e 	      JSR	find_line_by_number	; finds a line, given a line number
   7611  aa6c							;
   7612  aa6c							; Entry:
   7613  aa6c							; byte_2B: line	number MSB
   7614  aa6c							; byte_2C: line	number LSB
   7615  aa6c							;
   7616  aa6c							; Exit:
   7617  aa6c							; (byte_2B) points to most suitable line
   7618  aa6c		       20 77 aa 	      JSR	sub_AA77	; swap byte_2B with unk_2F, swap byte_2C with unk_30
   7619  aa6f		       d0 da		      BNE	loc_AA4B
   7620  aa71
   7621  aa71				   loc_AA71
   7622  aa71		       20 77 aa 	      JSR	sub_AA77	; swap byte_2B with unk_2F, swap byte_2C with unk_30
   7623  aa74		       4c 39 a0 	      JMP	save_line_number	; saves line number from program.
   7624  aa77							; End of function sub_AA47		;
   7625  aa77							; Entry:
   7626  aa77							; (byte_2b) points to current line
   7627  aa77							;
   7628  aa77							; Exit:
   7629  aa77							; current_line_no_lsb, current_line_no_msb = the line number
   7630  aa77
   7631  aa77
   7632  aa77							; swap byte_2B with unk_2F, swap byte_2C with unk_30
   7633  aa77
   7634  aa77				   sub_AA77
   7635  aa77
   7636  aa77		       a6 2b		      LDX	byte_2B
   7637  aa79		       a4 2f		      LDY	unk_2F
   7638  aa7b		       86 2f		      STX	unk_2F
   7639  aa7d		       84 2b		      STY	byte_2B
   7640  aa7f		       a6 2c		      LDX	byte_2C
   7641  aa81		       a4 30		      LDY	unk_30
   7642  aa83		       86 30		      STX	unk_30
   7643  aa85		       84 2c		      STY	byte_2C
   7644  aa87		       60		      RTS
   7645  aa88							; End of function sub_AA77
   7646  aa88
   7647  aa88
   7648  aa88				   delete_key_command
   7649  aa88		       a5 11		      LDA	unk_11
   7650  aa8a		       d0 0b		      BNE	loc_AA97
   7651  aa8c		       a6 10		      LDX	cursor_offset	; offset of cursor in detokenized buffer
   7652  aa8e		       ca		      DEX
   7653  aa8f		       f0 3b		      BEQ	locret_AACC
   7654  aa91		       ca		      DEX
   7655  aa92		       ec 00 04 	      CPX	byte_400
   7656  aa95		       90 03		      BCC	loc_AA9A
   7657  aa97
   7658  aa97				   loc_AA97
   7659  aa97		       4c 59 a7 	      JMP	cursor_left_edit_mode_command
   7660  aa9a
   7661  aa9a				   loc_AA9A
   7662  aa9a		       a2 ff		      LDX	#-1
   7663  aa9c		       86 0c		      STX	byte_C
   7664  aa9e		       ca		      DEX
   7665  aa9f		       86 0e		      STX	byte_E
   7666  aaa1		       a9 01		      LDA	#1
   7667  aaa3		       20 b2 9f 	      JSR	sub_9FB2
   7668  aaa6
   7669  aaa6				   loc_AAA6
   7670  aaa6		       ad 00 04 	      LDA	byte_400
   7671  aaa9		       48		      PHA
   7672  aaaa		       ce 00 04 	      DEC	byte_400
   7673  aaad		       ac 00 04 	      LDY	byte_400
   7674  aab0		       a9 20		      LDA	#$20	; ' '
   7675  aab2		       99 01 04 	      STA	$401,Y
   7676  aab5		       c6 10		      DEC	cursor_offset	; offset of cursor in detokenized buffer
   7677  aab7
   7678  aab7				   loc_AAB7
   7679  aab7		       a9 01		      LDA	#1
   7680  aab9		       8d b3 06 	      STA	byte_6B3
   7681  aabc		       68		      PLA
   7682  aabd		       aa		      TAX
   7683  aabe		       a0 00		      LDY	#0
   7684  aac0		       a5 10		      LDA	cursor_offset	; offset of cursor in detokenized buffer
   7685  aac2		       20 b1 a0 	      JSR	sub_A0B1
   7686  aac5		       4c a8 a8 	      JMP	position_edit_mode_cursor
   7687  aac8
   7688  aac8				   loc_AAC8
   7689  aac8
   7690  aac8		       a5 11		      LDA	unk_11
   7691  aaca		       f0 01		      BEQ	loc_AACD
   7692  aacc
   7693  aacc				   locret_AACC
   7694  aacc		       60		      RTS
   7695  aacd
   7696  aacd				   loc_AACD
   7697  aacd		       a5 10		      LDA	cursor_offset	; offset of cursor in detokenized buffer
   7698  aacf		       cd 00 04 	      CMP	byte_400
   7699  aad2		       f0 04		      BEQ	loc_AAD8
   7700  aad4		       b0 f6		      BCS	locret_AACC
   7701  aad6		       90 04		      BCC	loc_AADC
   7702  aad8
   7703  aad8				   loc_AAD8
   7704  aad8		       e6 10		      INC	cursor_offset	; offset of cursor in detokenized buffer
   7705  aada		       d0 ca		      BNE	loc_AAA6
   7706  aadc
   7707  aadc				   loc_AADC
   7708  aadc		       a2 00		      LDX	#0
   7709  aade		       86 0c		      STX	byte_C
   7710  aae0		       8a		      TXA
   7711  aae1		       ca		      DEX
   7712  aae2		       86 0e		      STX	byte_E
   7713  aae4		       20 b2 9f 	      JSR	sub_9FB2
   7714  aae7		       e6 10		      INC	cursor_offset	; offset of cursor in detokenized buffer
   7715  aae9		       d0 bb		      BNE	loc_AAA6
   7716  aaeb
   7717  aaeb				   delete_to_end_of_line_edit_mode_command
   7718  aaeb		       a5 11		      LDA	unk_11
   7719  aaed		       d0 dd		      BNE	locret_AACC
   7720  aaef		       a5 10		      LDA	cursor_offset	; offset of cursor in detokenized buffer
   7721  aaf1		       cd 00 04 	      CMP	byte_400
   7722  aaf4		       f0 d2		      BEQ	loc_AAC8
   7723  aaf6		       b0 d4		      BCS	locret_AACC
   7724  aaf8		       18		      CLC
   7725  aaf9		       a9 01		      LDA	#1
   7726  aafb		       65 10		      ADC	cursor_offset	; offset of cursor in detokenized buffer
   7727  aafd		       85 0c		      STA	byte_C
   7728  aaff		       c6 0c		      DEC	byte_C
   7729  ab01		       a9 04		      LDA	#4
   7730  ab03		       85 0d		      STA	byte_D
   7731  ab05		       38		      SEC
   7732  ab06		       ad 00 04 	      LDA	byte_400
   7733  ab09		       48		      PHA
   7734  ab0a		       e5 10		      SBC	cursor_offset	; offset of cursor in detokenized buffer
   7735  ab0c		       a8		      TAY
   7736  ab0d		       c8		      INY
   7737  ab0e		       a2 00		      LDX	#0
   7738  ab10		       a9 20		      LDA	#$20	; ' '
   7739  ab12		       20 6c 8e 	      JSR	memset	; Set memory to	value.
   7740  ab15							;
   7741  ab15							; ($C) points to memory	to clear.
   7742  ab15							; X holds number of pages to clear.
   7743  ab15							; Y holds number of bytes to clear in Xth page.
   7744  ab15							; A holds value	to write.
   7745  ab15		       a6 10		      LDX	cursor_offset	; offset of cursor in detokenized buffer
   7746  ab17		       ca		      DEX
   7747  ab18		       8e 00 04 	      STX	byte_400
   7748  ab1b		       4c b7 aa 	      JMP	loc_AAB7
   7749  ab1e
   7750  ab1e
   7751  ab1e
   7752  ab1e				   sub_AB1E
   7753  ab1e		       a5 09		      LDA	unk_9
   7754  ab20		       d0 0b		      BNE	locret_AB2D
   7755  ab22		       a5 08		      LDA	unk_8
   7756  ab24		       c5 10		      CMP	cursor_offset	; offset of cursor in detokenized buffer
   7757  ab26		       f0 14		      BEQ	loc_AB3C
   7758  ab28		       cd 00 04 	      CMP	byte_400
   7759  ab2b		       f0 01		      BEQ	loc_AB2E
   7760  ab2d
   7761  ab2d				   locret_AB2D
   7762  ab2d		       60		      RTS
   7763  ab2e
   7764  ab2e				   loc_AB2E
   7765  ab2e		       a5 3c		      LDA	is_insert_mode	; 0=overtype 1=insert
   7766  ab30		       f0 fb		      BEQ	locret_AB2D
   7767  ab32		       ae 00 04 	      LDX	byte_400
   7768  ab35		       bd 00 04 	      LDA	$400,X
   7769  ab38		       c9 20		      CMP	#$20	; ' '
   7770  ab3a		       f0 f1		      BEQ	locret_AB2D
   7771  ab3c
   7772  ab3c				   loc_AB3C
   7773  ab3c		       a9 04		      LDA	#4
   7774  ab3e		       85 0d		      STA	byte_D
   7775  ab40		       a9 07		      LDA	#7
   7776  ab42		       85 0f		      STA	byte_F
   7777  ab44		       20 db ab 	      JSR	sub_ABDB
   7778  ab47		       a5 08		      LDA	unk_8
   7779  ab49		       48		      PHA
   7780  ab4a		       a5 4a		      LDA	current_line_no_lsb
   7781  ab4c		       48		      PHA
   7782  ab4d		       a5 4b		      LDA	current_line_no_msb
   7783  ab4f		       48		      PHA
   7784  ab50		       ad bf 06 	      LDA	screen_height
   7785  ab53		       0a		      ASL
   7786  ab54		       aa		      TAX
   7787  ab55		       bd c0 06 	      LDA	$6C0,X
   7788  ab58		       c5 2b		      CMP	byte_2B
   7789  ab5a		       d0 0e		      BNE	loc_AB6A
   7790  ab5c		       bd c1 06 	      LDA	$6C1,X
   7791  ab5f		       c5 2c		      CMP	byte_2C
   7792  ab61		       d0 07		      BNE	loc_AB6A
   7793  ab63		       a9 01		      LDA	#1
   7794  ab65		       85 37		      STA	unk_37
   7795  ab67		       20 bd b8 	      JSR	sub_B8BD
   7796  ab6a
   7797  ab6a				   loc_AB6A
   7798  ab6a		       18		      CLC
   7799  ab6b		       a5 3b		      LDA	byte_3B
   7800  ab6d		       48		      PHA
   7801  ab6e		       65 2d		      ADC	byte_2D
   7802  ab70		       48		      PHA
   7803  ab71		       a8		      TAY
   7804  ab72		       a2 00		      LDX	#0
   7805  ab74		       20 01 8f 	      JSR	gotoxy
   7806  ab77		       a9 06		      LDA	#6
   7807  ab79		       a2 bb		      LDX	#$BB	; #<six_spaces_string
   7808  ab7b		       a0 89		      LDY	#$89	; #>six_spaces_string
   7809  ab7d		       20 0e 8f 	      JSR	print_n_chars
   7810  ab80		       18		      CLC
   7811  ab81		       a5 08		      LDA	unk_8
   7812  ab83		       6d b6 06 	      ADC	code_area_width
   7813  ab86		       aa		      TAX
   7814  ab87		       a9 00		      LDA	#0
   7815  ab89		       69 00		      ADC	#0
   7816  ab8b		       a8		      TAY
   7817  ab8c		       18		      CLC
   7818  ab8d		       a5 08		      LDA	unk_8
   7819  ab8f		       69 01		      ADC	#1
   7820  ab91		       20 b1 a0 	      JSR	sub_A0B1
   7821  ab94		       68		      PLA
   7822  ab95		       cd bf 06 	      CMP	screen_height
   7823  ab98		       f0 16		      BEQ	loc_ABB0
   7824  ab9a		       85 3b		      STA	byte_3B
   7825  ab9c		       e6 3b		      INC	byte_3B
   7826  ab9e		       a4 4a		      LDY	current_line_no_lsb
   7827  aba0		       a6 4b		      LDX	current_line_no_msb
   7828  aba2		       e8		      INX
   7829  aba3		       d0 03		      BNE	loc_ABA8
   7830  aba5		       c8		      INY
   7831  aba6		       30 08		      BMI	loc_ABB0
   7832  aba8
   7833  aba8				   loc_ABA8
   7834  aba8		       86 2c		      STX	byte_2C
   7835  abaa		       84 2b		      STY	byte_2B
   7836  abac		       38		      SEC
   7837  abad		       20 ea 9d 	      JSR	sub_9DEA
   7838  abb0
   7839  abb0				   loc_ABB0
   7840  abb0		       68		      PLA
   7841  abb1		       85 3b		      STA	byte_3B
   7842  abb3		       0a		      ASL
   7843  abb4		       aa		      TAX
   7844  abb5		       e8		      INX
   7845  abb6		       20 45 a0 	      JSR	get_line_ptr	; gets pointer to line visible on screen.
   7846  abb9							;
   7847  abb9							; Entry:
   7848  abb9							; X = screen line number * 2 + 1
   7849  abb9							;
   7850  abb9							; Exit:
   7851  abb9							; (byte_2B) points to BASIC line
   7852  abb9							; X decremented
   7853  abb9		       68		      PLA
   7854  abba		       85 4b		      STA	current_line_no_msb
   7855  abbc		       68		      PLA
   7856  abbd		       85 4a		      STA	current_line_no_lsb
   7857  abbf		       18		      CLC
   7858  abc0		       68		      PLA
   7859  abc1		       6d b6 06 	      ADC	code_area_width
   7860  abc4		       85 08		      STA	unk_8
   7861  abc6		       aa		      TAX
   7862  abc7		       a9 00		      LDA	#0
   7863  abc9		       69 00		      ADC	#0
   7864  abcb		       85 09		      STA	unk_9
   7865  abcd		       a8		      TAY
   7866  abce		       20 4e 8f 	      JSR	get_line_dimensions	; work out dimensions of line.
   7867  abd1							;
   7868  abd1							; Entry:
   7869  abd1							; X=line length
   7870  abd1							; Y=starting Y
   7871  abd1							;
   7872  abd1							; Exit:
   7873  abd1							; X=line length	MOD screen width
   7874  abd1							; Y=ending Y
   7875  abd1		       84 2d		      STY	byte_2D
   7876  abd3		       a9 07		      LDA	#7
   7877  abd5		       85 0d		      STA	byte_D
   7878  abd7		       a9 04		      LDA	#4
   7879  abd9		       85 0f		      STA	byte_F
   7880  abdb							; End of function sub_AB1E
   7881  abdb
   7882  abdb
   7883  abdb
   7884  abdb
   7885  abdb				   sub_ABDB
   7886  abdb		       a0 00		      LDY	#0
   7887  abdd		       84 0c		      STY	byte_C
   7888  abdf		       84 0e		      STY	byte_E
   7889  abe1		       a2 01		      LDX	#1
   7890  abe3		       4c a1 8e 	      JMP	memmove	; move (maybe overlapping) memory regions.
   7891  abe6							; End of function sub_ABDB		;
   7892  abe6							; Entry:
   7893  abe6							; (byte_C) points to src
   7894  abe6							; (byte_E) points to dest
   7895  abe6							; X is MSB of size
   7896  abe6							; Y is LSB of size
   7897  abe6
   7898  abe6
   7899  abe6
   7900  abe6				   rstrip_and_cr_terminate_detokenized_line
   7901  abe6		       ae 00 04 	      LDX	byte_400	; check	line length
   7902  abe9		       f0 0a		      BEQ	at_end	; taken	if line	empty
   7903  abeb
   7904  abeb				   find_last_non_space_loop
   7905  abeb		       bd 00 04 	      LDA	$400,X
   7906  abee		       c9 20		      CMP	#$20	; ' '
   7907  abf0		       d0 03		      BNE	at_end
   7908  abf2		       ca		      DEX
   7909  abf3		       d0 f6		      BNE	find_last_non_space_loop
   7910  abf5
   7911  abf5				   at_end
   7912  abf5
   7913  abf5		       a9 0d		      LDA	#$D	; CR
   7914  abf7		       9d 01 04 	      STA	$401,X	; store	at end of text
   7915  abfa		       20 ac b0 	      JSR	sub_B0AC
   7916  abfd		       a2 ff		      LDX	#$FF
   7917  abff
   7918  abff				   find_cr
   7919  abff		       e8		      INX
   7920  ac00		       bd 01 04 	      LDA	$401,X
   7921  ac03		       c9 0d		      CMP	#$D
   7922  ac05		       d0 f8		      BNE	find_cr
   7923  ac07		       60		      RTS
   7924  ac08							; End of function rstrip_and_cr_terminate_detokenized_line
   7925  ac08
   7926  ac08
   7927  ac08				   loc_AC08
   7928  ac08		       20 ab 9b 	      JSR	make_cursor_invisible
   7929  ac0b		       a5 3b		      LDA	byte_3B
   7930  ac0d		       48		      PHA
   7931  ac0e		       a5 4a		      LDA	current_line_no_lsb
   7932  ac10		       48		      PHA
   7933  ac11		       a5 4b		      LDA	current_line_no_msb
   7934  ac13		       48		      PHA
   7935  ac14		       a2 ff		      LDX	#-1
   7936  ac16		       86 3b		      STX	byte_3B
   7937  ac18		       e8		      INX
   7938  ac19		       86 2b		      STX	byte_2B
   7939  ac1b		       86 2c		      STX	byte_2C
   7940  ac1d
   7941  ac1d				   loc_AC1D
   7942  ac1d		       e6 3b		      INC	byte_3B
   7943  ac1f		       a5 3b		      LDA	byte_3B
   7944  ac21		       cd bf 06 	      CMP	screen_height
   7945  ac24		       f0 02		      BEQ	loc_AC28
   7946  ac26		       b0 35		      BCS	loc_AC5D
   7947  ac28
   7948  ac28				   loc_AC28
   7949  ac28		       0a		      ASL
   7950  ac29		       aa		      TAX
   7951  ac2a		       bd c0 06 	      LDA	$6C0,X
   7952  ac2d		       c5 2b		      CMP	byte_2B
   7953  ac2f		       d0 07		      BNE	loc_AC38
   7954  ac31		       bd c1 06 	      LDA	$6C1,X
   7955  ac34		       c5 2c		      CMP	byte_2C
   7956  ac36		       f0 e5		      BEQ	loc_AC1D
   7957  ac38
   7958  ac38				   loc_AC38
   7959  ac38		       bd c0 06 	      LDA	$6C0,X
   7960  ac3b		       85 2b		      STA	byte_2B
   7961  ac3d		       bc c1 06 	      LDY	$6C1,X
   7962  ac40		       84 2c		      STY	byte_2C
   7963  ac42		       f0 19		      BEQ	loc_AC5D
   7964  ac44		       c8		      INY
   7965  ac45		       d0 0d		      BNE	loc_AC54
   7966  ac47		       68		      PLA
   7967  ac48		       aa		      TAX
   7968  ac49		       85 4b		      STA	current_line_no_msb
   7969  ac4b		       68		      PLA
   7970  ac4c		       85 4a		      STA	current_line_no_lsb
   7971  ac4e		       48		      PHA
   7972  ac4f		       8a		      TXA
   7973  ac50		       48		      PHA
   7974  ac51		       4c 57 ac 	      JMP	loc_AC57
   7975  ac54
   7976  ac54				   loc_AC54
   7977  ac54		       20 39 a0 	      JSR	save_line_number	; saves line number from program.
   7978  ac57							;
   7979  ac57							; Entry:
   7980  ac57							; (byte_2b) points to current line
   7981  ac57							;
   7982  ac57							; Exit:
   7983  ac57							; current_line_no_lsb, current_line_no_msb = the line number
   7984  ac57
   7985  ac57				   loc_AC57
   7986  ac57		       20 6d a1 	      JSR	redraw_line_number
   7987  ac5a		       4c 1d ac 	      JMP	loc_AC1D
   7988  ac5d
   7989  ac5d				   loc_AC5D
   7990  ac5d		       68		      PLA
   7991  ac5e		       85 4b		      STA	current_line_no_msb
   7992  ac60		       68		      PLA
   7993  ac61		       85 4a		      STA	current_line_no_lsb
   7994  ac63		       68		      PLA
   7995  ac64		       85 3b		      STA	byte_3B
   7996  ac66		       0a		      ASL
   7997  ac67		       aa		      TAX
   7998  ac68		       e8		      INX
   7999  ac69		       20 45 a0 	      JSR	get_line_ptr	; gets pointer to line visible on screen.
   8000  ac6c							;
   8001  ac6c							; Entry:
   8002  ac6c							; X = screen line number * 2 + 1
   8003  ac6c							;
   8004  ac6c							; Exit:
   8005  ac6c							; (byte_2B) points to BASIC line
   8006  ac6c							; X decremented
   8007  ac6c		       4c a8 a8 	      JMP	position_edit_mode_cursor
   8008  ac6f
   8009  ac6f
   8010  ac6f
   8011  ac6f				   execute_edit_mode_command
   8012  ac6f		       a9 20		      LDA	#$20	; ' '
   8013  ac71		       c5 40		      CMP	byte_40	; slot ID 0 empty?
   8014  ac73		       d0 09		      BNE	loc_AC7E	; taken	if slot	not empty
   8015  ac75		       c5 46		      CMP	byte_46	; slot id 6 empty?
   8016  ac77		       f0 04		      BEQ	locret_AC7D	; taken	if slot	empty
   8017  ac79		       a9 06		      LDA	#6	; "Missing line	command"
   8018  ac7b		       d0 4c		      BNE	execute_edit_mode_command_error
   8019  ac7d
   8020  ac7d				   locret_AC7D
   8021  ac7d		       60		      RTS
   8022  ac7e
   8023  ac7e				   loc_AC7E
   8024  ac7e		       8d b3 06 	      STA	byte_6B3	; ?byte_6B3=$20
   8025  ac81		       20 c0 a8 	      JSR	sub_A8C0
   8026  ac84		       a5 40		      LDA	byte_40
   8027  ac86		       c9 60		      CMP	#$60	; '`'
   8028  ac88		       b0 1d		      BCS	loc_ACA7
   8029  ac8a		       a5 43		      LDA	byte_43
   8030  ac8c		       c9 20		      CMP	#$20	; ' '
   8031  ac8e		       f0 04		      BEQ	loc_AC94
   8032  ac90		       a9 1a		      LDA	#$1A
   8033  ac92		       d0 35		      BNE	execute_edit_mode_command_error
   8034  ac94
   8035  ac94				   loc_AC94
   8036  ac94		       a5 41		      LDA	byte_41
   8037  ac96		       85 44		      STA	byte_44
   8038  ac98		       a5 42		      LDA	byte_42
   8039  ac9a		       85 45		      STA	byte_45
   8040  ac9c		       a9 20		      LDA	#$20	; ' '
   8041  ac9e
   8042  ac9e				   loc_AC9E
   8043  ac9e		       18		      CLC
   8044  ac9f		       65 40		      ADC	byte_40
   8045  aca1		       8d bd 06 	      STA	current_command_id
   8046  aca4		       4c e7 8f 	      JMP	execute_command	; unk_6BD = command to run
   8047  aca7
   8048  aca7				   loc_ACA7
   8049  aca7		       c5 43		      CMP	byte_43
   8050  aca9		       f0 2c		      BEQ	loc_ACD7
   8051  acab		       a4 43		      LDY	byte_43
   8052  acad		       c0 20		      CPY	#$20	; ' '
   8053  acaf		       d0 16		      BNE	loc_ACC7
   8054  acb1		       c9 64		      CMP	#$64	; 'd'
   8055  acb3		       f0 04		      BEQ	loc_ACB9
   8056  acb5		       a9 1f		      LDA	#$1F	; "Incomplete line command"
   8057  acb7		       d0 10		      BNE	execute_edit_mode_command_error
   8058  acb9
   8059  acb9				   loc_ACB9
   8060  acb9		       a5 46		      LDA	byte_46
   8061  acbb		       c9 54		      CMP	#$54	; 'T'
   8062  acbd		       f0 0d		      BEQ	loc_ACCC
   8063  acbf		       c9 45		      CMP	#$45	; 'E'
   8064  acc1		       f0 09		      BEQ	loc_ACCC
   8065  acc3		       a9 1c		      LDA	#$1C	; "Invalid delete command"
   8066  acc5		       d0 02		      BNE	execute_edit_mode_command_error
   8067  acc7
   8068  acc7				   loc_ACC7
   8069  acc7		       a9 1b		      LDA	#$1B	; "Incompatible	line commands"
   8070  acc9
   8071  acc9				   execute_edit_mode_command_error
   8072  acc9
   8073  acc9		       4c 9d 85 	      JMP	loc_859D
   8074  accc
   8075  accc				   loc_ACCC
   8076  accc
   8077  accc		       20 a1 a2 	      JSR	sub_A2A1
   8078  accf		       86 44		      STX	byte_44
   8079  acd1		       84 45		      STY	byte_45
   8080  acd3		       a9 20		      LDA	#$20	; ' '
   8081  acd5		       85 46		      STA	byte_46
   8082  acd7
   8083  acd7				   loc_ACD7
   8084  acd7		       20 1a ad 	      JSR	sub_AD1A
   8085  acda		       a5 46		      LDA	byte_46
   8086  acdc		       c9 20		      CMP	#$20	; ' '
   8087  acde		       f0 29		      BEQ	loc_AD09
   8088  ace0		       c9 54		      CMP	#$54	; 'T'
   8089  ace2		       f0 25		      BEQ	loc_AD09
   8090  ace4		       c9 45		      CMP	#$45	; 'E'
   8091  ace6		       f0 21		      BEQ	loc_AD09
   8092  ace8		       a4 48		      LDY	byte_48
   8093  acea		       a6 47		      LDX	byte_47
   8094  acec		       c9 42		      CMP	#$42	; 'B'
   8095  acee		       f0 04		      BEQ	loc_ACF4
   8096  acf0		       c8		      INY
   8097  acf1		       d0 01		      BNE	loc_ACF4
   8098  acf3		       e8		      INX
   8099  acf4
   8100  acf4				   loc_ACF4
   8101  acf4
   8102  acf4		       8a		      TXA
   8103  acf5		       48		      PHA
   8104  acf6		       a2 00		      LDX	#0
   8105  acf8		       20 0e ad 	      JSR	sub_AD0E
   8106  acfb		       68		      PLA
   8107  acfc		       90 0b		      BCC	loc_AD09
   8108  acfe		       a2 03		      LDX	#3
   8109  ad00		       20 0e ad 	      JSR	sub_AD0E
   8110  ad03		       b0 04		      BCS	loc_AD09
   8111  ad05		       a9 1d		      LDA	#$1D
   8112  ad07		       d0 c0		      BNE	execute_edit_mode_command_error
   8113  ad09
   8114  ad09				   loc_AD09
   8115  ad09
   8116  ad09		       a9 00		      LDA	#0
   8117  ad0b		       4c 9e ac 	      JMP	loc_AC9E
   8118  ad0e							; End of function execute_edit_mode_command
   8119  ad0e
   8120  ad0e
   8121  ad0e
   8122  ad0e
   8123  ad0e				   sub_AD0E
   8124  ad0e
   8125  ad0e		       d5 41		      CMP	$41,X
   8126  ad10		       f0 01		      BEQ	loc_AD13
   8127  ad12		       60		      RTS
   8128  ad13
   8129  ad13				   loc_AD13
   8130  ad13		       98		      TYA
   8131  ad14		       d5 42		      CMP	$42,X
   8132  ad16		       d0 01		      BNE	locret_AD19
   8133  ad18		       18		      CLC
   8134  ad19
   8135  ad19				   locret_AD19
   8136  ad19		       60		      RTS
   8137  ad1a							; End of function sub_AD0E
   8138  ad1a
   8139  ad1a
   8140  ad1a
   8141  ad1a
   8142  ad1a				   sub_AD1A
   8143  ad1a
   8144  ad1a		       a6 41		      LDX	byte_41
   8145  ad1c		       e4 44		      CPX	byte_44
   8146  ad1e		       90 18		      BCC	locret_AD38
   8147  ad20		       f0 02		      BEQ	loc_AD24
   8148  ad22		       b0 06		      BCS	loc_AD2A
   8149  ad24
   8150  ad24				   loc_AD24
   8151  ad24		       a4 42		      LDY	byte_42
   8152  ad26		       c4 45		      CPY	byte_45
   8153  ad28		       90 0e		      BCC	locret_AD38
   8154  ad2a
   8155  ad2a				   loc_AD2A
   8156  ad2a		       a4 44		      LDY	byte_44
   8157  ad2c		       86 44		      STX	byte_44
   8158  ad2e		       84 41		      STY	byte_41
   8159  ad30		       a6 42		      LDX	byte_42
   8160  ad32		       a4 45		      LDY	byte_45
   8161  ad34		       86 45		      STX	byte_45
   8162  ad36		       84 42		      STY	byte_42
   8163  ad38
   8164  ad38				   locret_AD38
   8165  ad38		       60		      RTS
   8166  ad39							; End of function sub_AD1A
   8167  ad39
   8168  ad39
   8169  ad39				   loc_AD39
   8170  ad39		       a5 46		      LDA	byte_46
   8171  ad3b		       c9 20		      CMP	#$20	; ' '
   8172  ad3d		       d0 05		      BNE	loc_AD44
   8173  ad3f		       a9 1e		      LDA	#$1E
   8174  ad41		       4c 9d 85 	      JMP	loc_859D
   8175  ad44
   8176  ad44				   loc_AD44
   8177  ad44		       a5 46		      LDA	byte_46
   8178  ad46		       48		      PHA
   8179  ad47		       a5 47		      LDA	byte_47
   8180  ad49		       48		      PHA
   8181  ad4a		       a5 48		      LDA	byte_48
   8182  ad4c		       48		      PHA
   8183  ad4d		       20 78 ae 	      JSR	sub_AE78
   8184  ad50		       ad c0 06 	      LDA	byte_6C0
   8185  ad53		       85 39		      STA	byte_39
   8186  ad55		       ad c1 06 	      LDA	byte_6C1
   8187  ad58		       85 3a		      STA	byte_3A
   8188  ad5a		       ad bd 06 	      LDA	current_command_id
   8189  ad5d		       c9 6d		      CMP	#$6D	; 'm'
   8190  ad5f		       d0 13		      BNE	loc_AD74
   8191  ad61		       a0 01		      LDY	#1
   8192  ad63		       b1 39		      LDA	($39),Y
   8193  ad65		       c5 41		      CMP	byte_41
   8194  ad67		       f0 04		      BEQ	loc_AD6D
   8195  ad69		       b0 1c		      BCS	loc_AD87
   8196  ad6b		       90 07		      BCC	loc_AD74
   8197  ad6d
   8198  ad6d				   loc_AD6D
   8199  ad6d		       c8		      INY
   8200  ad6e		       b1 39		      LDA	($39),Y
   8201  ad70		       c5 42		      CMP	byte_42
   8202  ad72		       b0 13		      BCS	loc_AD87
   8203  ad74
   8204  ad74				   loc_AD74
   8205  ad74		       a0 01		      LDY	#1
   8206  ad76		       b1 39		      LDA	($39),Y
   8207  ad78		       c5 47		      CMP	byte_47
   8208  ad7a		       d0 0b		      BNE	loc_AD87
   8209  ad7c		       c8		      INY
   8210  ad7d		       b1 39		      LDA	($39),Y
   8211  ad7f		       c5 48		      CMP	byte_48
   8212  ad81		       d0 04		      BNE	loc_AD87
   8213  ad83		       a5 46		      LDA	byte_46
   8214  ad85		       c9 42		      CMP	#$42	; 'B'
   8215  ad87
   8216  ad87				   loc_AD87
   8217  ad87		       08		      PHP
   8218  ad88		       20 1f 83 	      JSR	find_program
   8219  ad8b		       a2 03		      LDX	#3
   8220  ad8d		       20 93 ae 	      JSR	sub_AE93
   8221  ad90		       a0 03		      LDY	#3
   8222  ad92		       b1 2b		      LDA	($2B),Y
   8223  ad94		       a2 02		      LDX	#2
   8224  ad96		       20 9e ae 	      JSR	sub_AE9E
   8225  ad99		       a2 00		      LDX	#0
   8226  ad9b		       20 93 ae 	      JSR	sub_AE93
   8227  ad9e		       a9 00		      LDA	#0
   8228  ada0		       aa		      TAX
   8229  ada1		       20 9e ae 	      JSR	sub_AE9E
   8230  ada4		       38		      SEC
   8231  ada5		       a5 37		      LDA	unk_37
   8232  ada7		       e5 35		      SBC	byte_35
   8233  ada9		       85 27		      STA	byte_27
   8234  adab		       a5 38		      LDA	byte_38
   8235  adad		       e5 36		      SBC	byte_36
   8236  adaf		       85 28		      STA	byte_28
   8237  adb1		       68		      PLA
   8238  adb2		       a8		      TAY
   8239  adb3		       68		      PLA
   8240  adb4		       85 48		      STA	byte_48
   8241  adb6		       68		      PLA
   8242  adb7		       85 47		      STA	byte_47
   8243  adb9		       68		      PLA
   8244  adba		       85 46		      STA	byte_46
   8245  adbc		       98		      TYA
   8246  adbd		       48		      PHA
   8247  adbe		       20 f2 9f 	      JSR	sub_9FF2
   8248  adc1		       85 34		      STA	unk_34
   8249  adc3		       86 33		      STX	unk_33
   8250  adc5		       20 78 ae 	      JSR	sub_AE78
   8251  adc8		       a2 06		      LDX	#6
   8252  adca		       20 93 ae 	      JSR	sub_AE93
   8253  adcd		       a5 46		      LDA	byte_46
   8254  adcf		       c9 42		      CMP	#$42	; 'B'
   8255  add1		       d0 07		      BNE	loc_ADDA
   8256  add3		       20 aa ae 	      JSR	sub_AEAA
   8257  add6		       a9 00		      LDA	#0
   8258  add8		       f0 09		      BEQ	loc_ADE3
   8259  adda
   8260  adda				   loc_ADDA
   8261  adda		       85 32		      STA	unk_32
   8262  addc		       20 39 a0 	      JSR	save_line_number	; saves line number from program.
   8263  addf							;
   8264  addf							; Entry:
   8265  addf							; (byte_2b) points to current line
   8266  addf							;
   8267  addf							; Exit:
   8268  addf							; current_line_no_lsb, current_line_no_msb = the line number
   8269  addf		       a0 03		      LDY	#3
   8270  ade1		       b1 2b		      LDA	($2B),Y
   8271  ade3
   8272  ade3				   loc_ADE3
   8273  ade3		       a2 04		      LDX	#4
   8274  ade5		       20 9e ae 	      JSR	sub_AE9E
   8275  ade8		       a5 3a		      LDA	byte_3A
   8276  adea		       c5 36		      CMP	byte_36
   8277  adec		       f0 04		      BEQ	loc_ADF2
   8278  adee		       b0 1d		      BCS	loc_AE0D
   8279  adf0		       90 08		      BCC	loc_ADFA
   8280  adf2
   8281  adf2				   loc_ADF2
   8282  adf2		       a5 39		      LDA	byte_39
   8283  adf4		       c5 35		      CMP	byte_35
   8284  adf6		       f0 02		      BEQ	loc_ADFA
   8285  adf8		       b0 13		      BCS	loc_AE0D
   8286  adfa
   8287  adfa				   loc_ADFA
   8288  adfa		       a2 02		      LDX	#2
   8289  adfc
   8290  adfc				   loc_ADFC
   8291  adfc		       18		      CLC
   8292  adfd		       a5 27		      LDA	byte_27
   8293  adff		       75 35		      ADC	$35,X
   8294  ae01		       95 35		      STA	$35,X
   8295  ae03		       a5 28		      LDA	byte_28
   8296  ae05		       75 36		      ADC	$36,X
   8297  ae07		       95 36		      STA	$36,X
   8298  ae09		       ca		      DEX
   8299  ae0a		       ca		      DEX
   8300  ae0b		       10 ef		      BPL	loc_ADFC
   8301  ae0d
   8302  ae0d				   loc_AE0D
   8303  ae0d		       18		      CLC
   8304  ae0e		       a5 39		      LDA	byte_39
   8305  ae10		       85 0c		      STA	byte_C
   8306  ae12		       65 27		      ADC	byte_27
   8307  ae14		       85 0e		      STA	byte_E
   8308  ae16		       a5 3a		      LDA	byte_3A
   8309  ae18		       85 0d		      STA	byte_D
   8310  ae1a		       65 28		      ADC	byte_28
   8311  ae1c		       85 0f		      STA	byte_F
   8312  ae1e		       38		      SEC
   8313  ae1f		       a5 12		      LDA	TOP
   8314  ae21		       e5 39		      SBC	byte_39
   8315  ae23		       a8		      TAY
   8316  ae24		       a5 13		      LDA	TOP+1
   8317  ae26		       e5 3a		      SBC	byte_3A
   8318  ae28		       aa		      TAX
   8319  ae29		       20 a1 8e 	      JSR	memmove	; move (maybe overlapping) memory regions.
   8320  ae2c							;
   8321  ae2c							; Entry:
   8322  ae2c							; (byte_C) points to src
   8323  ae2c							; (byte_E) points to dest
   8324  ae2c							; X is MSB of size
   8325  ae2c							; Y is LSB of size
   8326  ae2c		       a5 35		      LDA	byte_35
   8327  ae2e		       85 0c		      STA	byte_C
   8328  ae30		       a5 36		      LDA	byte_36
   8329  ae32		       85 0d		      STA	byte_D
   8330  ae34		       a5 39		      LDA	byte_39
   8331  ae36		       85 0e		      STA	byte_E
   8332  ae38		       a5 3a		      LDA	byte_3A
   8333  ae3a		       85 0f		      STA	byte_F
   8334  ae3c		       a6 28		      LDX	byte_28
   8335  ae3e		       a4 27		      LDY	byte_27
   8336  ae40		       20 a1 8e 	      JSR	memmove	; move (maybe overlapping) memory regions.
   8337  ae43							;
   8338  ae43							; Entry:
   8339  ae43							; (byte_C) points to src
   8340  ae43							; (byte_E) points to dest
   8341  ae43							; X is MSB of size
   8342  ae43							; Y is LSB of size
   8343  ae43		       ad bd 06 	      LDA	current_command_id
   8344  ae46		       c9 6d		      CMP	#$6D	; 'm'
   8345  ae48		       d0 1e		      BNE	loc_AE68
   8346  ae4a		       a5 37		      LDA	unk_37
   8347  ae4c		       85 0c		      STA	byte_C
   8348  ae4e		       a5 38		      LDA	byte_38
   8349  ae50		       85 0d		      STA	byte_D
   8350  ae52		       a5 35		      LDA	byte_35
   8351  ae54		       85 0e		      STA	byte_E
   8352  ae56		       a5 36		      LDA	byte_36
   8353  ae58		       85 0f		      STA	byte_F
   8354  ae5a		       38		      SEC
   8355  ae5b		       a5 33		      LDA	unk_33
   8356  ae5d		       e5 37		      SBC	unk_37
   8357  ae5f		       a8		      TAY
   8358  ae60		       a5 34		      LDA	unk_34
   8359  ae62		       e5 38		      SBC	byte_38
   8360  ae64		       aa		      TAX
   8361  ae65		       20 a1 8e 	      JSR	memmove	; move (maybe overlapping) memory regions.
   8362  ae68							;
   8363  ae68							; Entry:
   8364  ae68							; (byte_C) points to src
   8365  ae68							; (byte_E) points to dest
   8366  ae68							; X is MSB of size
   8367  ae68							; Y is LSB of size
   8368  ae68
   8369  ae68				   loc_AE68
   8370  ae68		       20 e4 a1 	      JSR	clear_line_commands
   8371  ae6b		       20 92 84 	      JSR	sub_8492
   8372  ae6e		       a5 32		      LDA	unk_32
   8373  ae70		       d0 03		      BNE	loc_AE75
   8374  ae72		       20 14 83 	      JSR	sub_8314
   8375  ae75
   8376  ae75				   loc_AE75
   8377  ae75		       4c 48 af 	      JMP	loc_AF48
   8378  ae78
   8379  ae78
   8380  ae78
   8381  ae78				   sub_AE78
   8382  ae78		       a2 42		      LDX	#$42	; 'B'
   8383  ae7a		       a5 46		      LDA	byte_46
   8384  ae7c		       c9 54		      CMP	#$54	; 'T'
   8385  ae7e		       f0 06		      BEQ	loc_AE86
   8386  ae80		       c9 45		      CMP	#$45	; 'E'
   8387  ae82		       d0 0e		      BNE	locret_AE92
   8388  ae84		       a2 41		      LDX	#$41	; 'A'
   8389  ae86
   8390  ae86				   loc_AE86
   8391  ae86		       8a		      TXA
   8392  ae87		       48		      PHA
   8393  ae88		       20 a1 a2 	      JSR	sub_A2A1
   8394  ae8b		       86 47		      STX	byte_47
   8395  ae8d		       84 48		      STY	byte_48
   8396  ae8f		       68		      PLA
   8397  ae90		       85 46		      STA	byte_46
   8398  ae92
   8399  ae92				   locret_AE92
   8400  ae92		       60		      RTS
   8401  ae93							; End of function sub_AE78
   8402  ae93
   8403  ae93
   8404  ae93
   8405  ae93
   8406  ae93				   sub_AE93
   8407  ae93		       b4 41		      LDY	$41,X
   8408  ae95		       84 2b		      STY	byte_2B
   8409  ae97		       b4 42		      LDY	$42,X
   8410  ae99		       84 2c		      STY	byte_2C
   8411  ae9b		       4c 8f 9e 	      JMP	find_line_by_number	; finds a line, given a line number
   8412  ae9e							; End of function sub_AE93		;
   8413  ae9e							; Entry:
   8414  ae9e							; byte_2B: line	number MSB
   8415  ae9e							; byte_2C: line	number LSB
   8416  ae9e							;
   8417  ae9e							; Exit:
   8418  ae9e							; (byte_2B) points to most suitable line
   8419  ae9e
   8420  ae9e
   8421  ae9e
   8422  ae9e				   sub_AE9E
   8423  ae9e		       18		      CLC
   8424  ae9f		       65 2b		      ADC	byte_2B
   8425  aea1		       95 35		      STA	$35,X
   8426  aea3		       a9 00		      LDA	#0
   8427  aea5		       65 2c		      ADC	byte_2C
   8428  aea7		       95 36		      STA	$36,X
   8429  aea9
   8430  aea9				   locret_AEA9
   8431  aea9		       60		      RTS
   8432  aeaa							; End of function sub_AE9E
   8433  aeaa
   8434  aeaa
   8435  aeaa
   8436  aeaa
   8437  aeaa				   sub_AEAA
   8438  aeaa		       a5 30		      LDA	unk_30
   8439  aeac		       85 32		      STA	unk_32
   8440  aeae		       f0 f9		      BEQ	locret_AEA9
   8441  aeb0		       20 77 aa 	      JSR	sub_AA77	; swap byte_2B with unk_2F, swap byte_2C with unk_30
   8442  aeb3		       20 39 a0 	      JSR	save_line_number	; saves line number from program.
   8443  aeb6							;
   8444  aeb6							; Entry:
   8445  aeb6							; (byte_2b) points to current line
   8446  aeb6							;
   8447  aeb6							; Exit:
   8448  aeb6							; current_line_no_lsb, current_line_no_msb = the line number
   8449  aeb6		       4c 77 aa 	      JMP	sub_AA77	; swap byte_2B with unk_2F, swap byte_2C with unk_30
   8450  aeb9							; End of function sub_AEAA
   8451  aeb9
   8452  aeb9
   8453  aeb9				   loc_AEB9
   8454  aeb9		       a5 46		      LDA	byte_46
   8455  aebb		       c9 20		      CMP	#$20	; ' '
   8456  aebd		       f0 05		      BEQ	loc_AEC4
   8457  aebf		       a9 1c		      LDA	#$1C
   8458  aec1		       4c 9d 85 	      JMP	loc_859D
   8459  aec4
   8460  aec4				   loc_AEC4
   8461  aec4		       a5 4d		      LDA	unk_4D
   8462  aec6		       c5 41		      CMP	byte_41
   8463  aec8		       90 19		      BCC	loc_AEE3
   8464  aeca		       a5 4e		      LDA	unk_4E
   8465  aecc		       c5 42		      CMP	byte_42
   8466  aece		       90 13		      BCC	loc_AEE3
   8467  aed0		       a5 4d		      LDA	unk_4D
   8468  aed2		       c5 44		      CMP	byte_44
   8469  aed4		       90 0a		      BCC	loc_AEE0
   8470  aed6		       d0 0b		      BNE	loc_AEE3
   8471  aed8		       a5 4e		      LDA	unk_4E
   8472  aeda		       c5 45		      CMP	byte_45
   8473  aedc		       f0 02		      BEQ	loc_AEE0
   8474  aede		       b0 03		      BCS	loc_AEE3
   8475  aee0
   8476  aee0				   loc_AEE0
   8477  aee0		       20 58 b3 	      JSR	sub_B358
   8478  aee3
   8479  aee3				   loc_AEE3
   8480  aee3		       ad c0 06 	      LDA	byte_6C0
   8481  aee6		       85 39		      STA	byte_39
   8482  aee8		       ad c1 06 	      LDA	byte_6C1
   8483  aeeb		       85 3a		      STA	byte_3A
   8484  aeed		       a0 01		      LDY	#1
   8485  aeef		       b1 39		      LDA	($39),Y
   8486  aef1		       c5 41		      CMP	byte_41
   8487  aef3		       f0 03		      BEQ	loc_AEF8
   8488  aef5		       4c fd ae 	      JMP	loc_AEFD
   8489  aef8
   8490  aef8				   loc_AEF8
   8491  aef8		       c8		      INY
   8492  aef9		       b1 39		      LDA	($39),Y
   8493  aefb		       c5 42		      CMP	byte_42
   8494  aefd
   8495  aefd				   loc_AEFD
   8496  aefd		       08		      PHP
   8497  aefe		       20 1f 83 	      JSR	find_program
   8498  af01		       a2 03		      LDX	#3
   8499  af03		       20 93 ae 	      JSR	sub_AE93
   8500  af06		       a0 03		      LDY	#3
   8501  af08		       b1 2b		      LDA	($2B),Y
   8502  af0a		       a2 02		      LDX	#2
   8503  af0c		       20 9e ae 	      JSR	sub_AE9E
   8504  af0f		       a2 00		      LDX	#0
   8505  af11		       20 93 ae 	      JSR	sub_AE93
   8506  af14		       20 aa ae 	      JSR	sub_AEAA
   8507  af17		       a5 37		      LDA	unk_37
   8508  af19		       85 0c		      STA	byte_C
   8509  af1b		       a5 38		      LDA	byte_38
   8510  af1d		       85 0d		      STA	byte_D
   8511  af1f		       a5 2b		      LDA	byte_2B
   8512  af21		       85 0e		      STA	byte_E
   8513  af23		       a5 2c		      LDA	byte_2C
   8514  af25		       85 0f		      STA	byte_F
   8515  af27		       38		      SEC
   8516  af28		       a5 12		      LDA	TOP
   8517  af2a		       e5 37		      SBC	unk_37
   8518  af2c		       a8		      TAY
   8519  af2d		       a5 13		      LDA	TOP+1
   8520  af2f		       e5 38		      SBC	byte_38
   8521  af31		       aa		      TAX
   8522  af32		       20 a1 8e 	      JSR	memmove	; move (maybe overlapping) memory regions.
   8523  af35							;
   8524  af35							; Entry:
   8525  af35							; (byte_C) points to src
   8526  af35							; (byte_E) points to dest
   8527  af35							; X is MSB of size
   8528  af35							; Y is LSB of size
   8529  af35		       20 e9 9f 	      JSR	is_program_empty	; sets	C if no	program
   8530  af38		       90 03		      BCC	loc_AF3D
   8531  af3a		       4c a8 9d 	      JMP	loc_9DA8
   8532  af3d
   8533  af3d				   loc_AF3D
   8534  af3d		       20 e4 a1 	      JSR	clear_line_commands
   8535  af40		       a5 32		      LDA	unk_32
   8536  af42		       d0 04		      BNE	loc_AF48
   8537  af44		       68		      PLA
   8538  af45		       4c 5b a6 	      JMP	top_edit_mode_command
   8539  af48
   8540  af48				   loc_AF48
   8541  af48		       28		      PLP
   8542  af49		       90 03		      BCC	loc_AF4E
   8543  af4b		       4c a8 9d 	      JMP	loc_9DA8
   8544  af4e
   8545  af4e				   loc_AF4E
   8546  af4e		       4c 7a 96 	      JMP	loc_967A
   8547  af51
   8548  af51				   return_key_command
   8549  af51		       a9 00		      LDA	#0
   8550  af53		       48		      PHA
   8551  af54
   8552  af54				   loc_AF54
   8553  af54		       a5 3b		      LDA	byte_3B
   8554  af56		       0a		      ASL
   8555  af57		       aa		      TAX
   8556  af58		       e8		      INX
   8557  af59		       20 45 a0 	      JSR	get_line_ptr	; gets pointer to line visible on screen.
   8558  af5c							;
   8559  af5c							; Entry:
   8560  af5c							; X = screen line number * 2 + 1
   8561  af5c							;
   8562  af5c							; Exit:
   8563  af5c							; (byte_2B) points to BASIC line
   8564  af5c							; X decremented
   8565  af5c
   8566  af5c				   loc_AF5C
   8567  af5c		       20 52 92 	      JSR	advance_2b_to_next_line
   8568  af5f		       a0 02		      LDY	#2
   8569  af61		       b1 2b		      LDA	($2B),Y
   8570  af63		       85 38		      STA	byte_38
   8571  af65		       88		      DEY
   8572  af66		       b1 2b		      LDA	($2B),Y
   8573  af68		       85 37		      STA	unk_37
   8574  af6a		       10 04		      BPL	loc_AF70
   8575  af6c		       a9 0a		      LDA	#$A
   8576  af6e		       d0 02		      BNE	loc_AF72
   8577  af70
   8578  af70				   loc_AF70
   8579  af70		       a9 01		      LDA	#1
   8580  af72
   8581  af72				   loc_AF72
   8582  af72		       a8		      TAY
   8583  af73		       18		      CLC
   8584  af74		       65 4b		      ADC	current_line_no_msb
   8585  af76		       85 3a		      STA	byte_3A
   8586  af78		       a9 00		      LDA	#0
   8587  af7a		       65 4a		      ADC	current_line_no_lsb
   8588  af7c		       85 39		      STA	byte_39
   8589  af7e		       10 0c		      BPL	loc_AF8C
   8590  af80		       88		      DEY
   8591  af81		       d0 ed		      BNE	loc_AF70
   8592  af83
   8593  af83				   loc_AF83
   8594  af83		       20 92 84 	      JSR	sub_8492
   8595  af86		       68		      PLA
   8596  af87		       a9 01		      LDA	#1
   8597  af89		       48		      PHA
   8598  af8a		       d0 c8		      BNE	loc_AF54
   8599  af8c
   8600  af8c				   loc_AF8C
   8601  af8c		       a6 39		      LDX	byte_39
   8602  af8e		       a4 3a		      LDY	byte_3A
   8603  af90		       e4 37		      CPX	unk_37
   8604  af92		       d0 06		      BNE	loc_AF9A
   8605  af94		       c4 38		      CPY	byte_38
   8606  af96		       d0 02		      BNE	loc_AF9A
   8607  af98		       f0 e9		      BEQ	loc_AF83
   8608  af9a
   8609  af9a				   loc_AF9A
   8610  af9a		       68		      PLA
   8611  af9b		       85 36		      STA	byte_36
   8612  af9d		       8a		      TXA
   8613  af9e		       48		      PHA
   8614  af9f		       98		      TYA
   8615  afa0		       48		      PHA
   8616  afa1		       a5 4a		      LDA	current_line_no_lsb
   8617  afa3		       48		      PHA
   8618  afa4		       a5 4b		      LDA	current_line_no_msb
   8619  afa6		       48		      PHA
   8620  afa7		       a5 36		      LDA	byte_36
   8621  afa9		       48		      PHA
   8622  afaa		       86 4a		      STX	current_line_no_lsb
   8623  afac		       84 4b		      STY	current_line_no_msb
   8624  afae		       20 c3 9e 	      JSR	get_line_height	; get height of	current	line
   8625  afb1							;
   8626  afb1							; Entry:
   8627  afb1							; ?byte_400 = line length
   8628  afb1							;
   8629  afb1							; Exit:
   8630  afb1							; X = line height
   8631  afb1		       a9 01		      LDA	#1
   8632  afb3		       8d 00 04 	      STA	byte_400
   8633  afb6		       a9 20		      LDA	#$20	; ' '
   8634  afb8		       8d 01 04 	      STA	unk_401
   8635  afbb
   8636  afbb				   loc_AFBB
   8637  afbb		       86 36		      STX	byte_36
   8638  afbd		       ad b3 06 	      LDA	byte_6B3
   8639  afc0		       48		      PHA
   8640  afc1		       a9 01		      LDA	#1
   8641  afc3		       8d b3 06 	      STA	byte_6B3
   8642  afc6		       a9 ff		      LDA	#-1
   8643  afc8		       85 2c		      STA	byte_2C
   8644  afca		       a9 01		      LDA	#1
   8645  afcc		       8d b7 06 	      STA	editor_mode_id	; 1=command mode, 2=edit mode
   8646  afcf		       20 c0 a8 	      JSR	sub_A8C0
   8647  afd2		       a9 02		      LDA	#2
   8648  afd4		       8d b7 06 	      STA	editor_mode_id	; 1=command mode, 2=edit mode
   8649  afd7		       68		      PLA
   8650  afd8		       8d b3 06 	      STA	byte_6B3
   8651  afdb		       68		      PLA
   8652  afdc		       f0 0b		      BEQ	loc_AFE9
   8653  afde		       c9 01		      CMP	#1
   8654  afe0		       f0 59		      BEQ	loc_B03B
   8655  afe2		       c9 03		      CMP	#3
   8656  afe4		       d0 35		      BNE	loc_B01B
   8657  afe6		       4c 7f a6 	      JMP	end_edit_mode_command
   8658  afe9
   8659  afe9				   loc_AFE9
   8660  afe9		       20 c3 9e 	      JSR	get_line_height	; get height of	current	line
   8661  afec							;
   8662  afec							; Entry:
   8663  afec							; ?byte_400 = line length
   8664  afec							;
   8665  afec							; Exit:
   8666  afec							; X = line height
   8667  afec		       8a		      TXA
   8668  afed		       18		      CLC
   8669  afee		       65 3b		      ADC	byte_3B
   8670  aff0		       65 36		      ADC	byte_36
   8671  aff2		       38		      SEC
   8672  aff3		       e9 01		      SBC	#1
   8673  aff5		       cd bf 06 	      CMP	screen_height
   8674  aff8		       f0 2b		      BEQ	loc_B025
   8675  affa		       90 29		      BCC	loc_B025
   8676  affc		       68		      PLA
   8677  affd		       85 2c		      STA	byte_2C
   8678  afff		       68		      PLA
   8679  b000		       85 2b		      STA	byte_2B
   8680  b002		       68		      PLA
   8681  b003		       68		      PLA
   8682  b004		       20 8f 9e 	      JSR	find_line_by_number	; finds a line, given a line number
   8683  b007							;
   8684  b007							; Entry:
   8685  b007							; byte_2B: line	number MSB
   8686  b007							; byte_2C: line	number LSB
   8687  b007							;
   8688  b007							; Exit:
   8689  b007							; (byte_2B) points to most suitable line
   8690  b007		       20 39 a0 	      JSR	save_line_number	; saves line number from program.
   8691  b00a							;
   8692  b00a							; Entry:
   8693  b00a							; (byte_2b) points to current line
   8694  b00a							;
   8695  b00a							; Exit:
   8696  b00a							; current_line_no_lsb, current_line_no_msb = the line number
   8697  b00a		       20 08 9c 	      JSR	detokenize_one_line
   8698  b00d
   8699  b00d				   loc_B00D
   8700  b00d		       a5 3d		      LDA	scroll_status	; 1=scroll, 0=noscroll
   8701  b00f		       48		      PHA
   8702  b010		       a9 01		      LDA	#1
   8703  b012		       85 3d		      STA	scroll_status	; 1=scroll, 0=noscroll
   8704  b014		       20 b7 a7 	      JSR	ctrl_cursor_right_edit_mode_command
   8705  b017		       68		      PLA
   8706  b018		       85 3d		      STA	scroll_status	; 1=scroll, 0=noscroll
   8707  b01a		       60		      RTS
   8708  b01b
   8709  b01b				   loc_B01B
   8710  b01b		       20 0e a0 	      JSR	cls_and_reset_6c0_to_6ff
   8711  b01e		       a9 00		      LDA	#0
   8712  b020		       85 3b		      STA	byte_3B
   8713  b022		       18		      CLC
   8714  b023		       90 01		      BCC	loc_B026
   8715  b025
   8716  b025				   loc_B025
   8717  b025		       38		      SEC
   8718  b026
   8719  b026				   loc_B026
   8720  b026		       68		      PLA
   8721  b027		       85 2c		      STA	byte_2C
   8722  b029		       68		      PLA
   8723  b02a		       85 2b		      STA	byte_2B
   8724  b02c		       20 ea 9d 	      JSR	sub_9DEA
   8725  b02f		       68		      PLA
   8726  b030		       85 4b		      STA	current_line_no_msb
   8727  b032		       68		      PLA
   8728  b033		       85 4a		      STA	current_line_no_lsb
   8729  b035		       20 d8 9f 	      JSR	sub_9FD8
   8730  b038		       4c d8 9a 	      JMP	edit_mode_loop
   8731  b03b
   8732  b03b				   loc_B03B
   8733  b03b		       68		      PLA
   8734  b03c		       68		      PLA
   8735  b03d		       68		      PLA
   8736  b03e		       aa		      TAX
   8737  b03f		       85 4b		      STA	current_line_no_msb
   8738  b041		       68		      PLA
   8739  b042		       85 4a		      STA	current_line_no_lsb
   8740  b044		       48		      PHA
   8741  b045		       8a		      TXA
   8742  b046		       48		      PHA
   8743  b047		       20 98 96 	      JSR	sub_9698
   8744  b04a		       b0 10		      BCS	loc_B05C
   8745  b04c
   8746  b04c				   loc_B04C
   8747  b04c		       20 06 97 	      JSR	sub_9706
   8748  b04f		       38		      SEC
   8749  b050		       20 ea 9d 	      JSR	sub_9DEA
   8750  b053		       68		      PLA
   8751  b054		       85 4b		      STA	current_line_no_msb
   8752  b056		       68		      PLA
   8753  b057		       85 4a		      STA	current_line_no_lsb
   8754  b059		       4c d8 9f 	      JMP	sub_9FD8
   8755  b05c
   8756  b05c				   loc_B05C
   8757  b05c		       20 47 aa 	      JSR	sub_AA47
   8758  b05f		       a5 2b		      LDA	byte_2B
   8759  b061		       8d c0 06 	      STA	byte_6C0
   8760  b064		       a5 2c		      LDA	byte_2C
   8761  b066		       8d c1 06 	      STA	byte_6C1
   8762  b069		       4c 4c b0 	      JMP	loc_B04C
   8763  b06c
   8764  b06c				   it_cmd
   8765  b06c		       20 a3 b0 	      JSR	sub_B0A3
   8766  b06f		       a0 01		      LDY	#1
   8767  b071		       b1 17		      LDA	($17),Y
   8768  b073		       d0 0a		      BNE	loc_B07F
   8769  b075		       c8		      INY
   8770  b076		       b1 17		      LDA	($17),Y
   8771  b078		       c9 02		      CMP	#2
   8772  b07a		       b0 03		      BCS	loc_B07F
   8773  b07c		       20 92 84 	      JSR	sub_8492
   8774  b07f
   8775  b07f				   loc_B07F
   8776  b07f		       a9 02		      LDA	#2
   8777  b081		       48		      PHA
   8778  b082		       a2 00		      LDX	#0
   8779  b084		       a0 01		      LDY	#1
   8780  b086		       86 4a		      STX	current_line_no_lsb
   8781  b088		       84 4b		      STY	current_line_no_msb
   8782  b08a		       4c 9a af 	      JMP	loc_AF9A
   8783  b08d
   8784  b08d				   ie_cmd
   8785  b08d		       20 a3 b0 	      JSR	sub_B0A3
   8786  b090		       a9 03		      LDA	#3
   8787  b092		       48		      PHA
   8788  b093		       a9 ff		      LDA	#-1
   8789  b095		       85 2b		      STA	byte_2B
   8790  b097		       20 8f 9e 	      JSR	find_line_by_number	; finds a line, given a line number
   8791  b09a							;
   8792  b09a							; Entry:
   8793  b09a							; byte_2B: line	number MSB
   8794  b09a							; byte_2C: line	number LSB
   8795  b09a							;
   8796  b09a							; Exit:
   8797  b09a							; (byte_2B) points to most suitable line
   8798  b09a		       20 77 aa 	      JSR	sub_AA77	; swap byte_2B with unk_2F, swap byte_2C with unk_30
   8799  b09d		       20 39 a0 	      JSR	save_line_number	; saves line number from program.
   8800  b0a0							;
   8801  b0a0							; Entry:
   8802  b0a0							; (byte_2b) points to current line
   8803  b0a0							;
   8804  b0a0							; Exit:
   8805  b0a0							; current_line_no_lsb, current_line_no_msb = the line number
   8806  b0a0		       4c 5c af 	      JMP	loc_AF5C
   8807  b0a3
   8808  b0a3
   8809  b0a3
   8810  b0a3				   sub_B0A3
   8811  b0a3		       20 e9 9f 	      JSR	is_program_empty	; sets	C if no	program
   8812  b0a6		       b0 01		      BCS	loc_B0A9
   8813  b0a8		       60		      RTS
   8814  b0a9
   8815  b0a9				   loc_B0A9
   8816  b0a9		       4c a8 9d 	      JMP	loc_9DA8
   8817  b0ac							; End of function sub_B0A3
   8818  b0ac
   8819  b0ac
   8820  b0ac
   8821  b0ac
   8822  b0ac				   sub_B0AC
   8823  b0ac		       ba		      TSX
   8824  b0ad		       8e a9 06 	      STX	old_stack_ptr
   8825  b0b0		       a9 01		      LDA	#1
   8826  b0b2		       85 27		      STA	byte_27
   8827  b0b4		       a9 04		      LDA	#4
   8828  b0b6		       85 28		      STA	byte_28
   8829  b0b8		       4c 96 b1 	      JMP	sub_B196
   8830  b0bb							; End of function sub_B0AC
   8831  b0bb
   8832  b0bb
   8833  b0bb
   8834  b0bb
   8835  b0bb				   sub_B0BB
   8836  b0bb
   8837  b0bb		       48		      PHA
   8838  b0bc		       18		      CLC
   8839  b0bd		       98		      TYA
   8840  b0be		       65 27		      ADC	byte_27
   8841  b0c0		       85 25		      STA	byte_25
   8842  b0c2		       a0 00		      LDY	#0
   8843  b0c4		       98		      TYA
   8844  b0c5		       65 28		      ADC	byte_28
   8845  b0c7		       85 26		      STA	byte_26
   8846  b0c9		       68		      PLA
   8847  b0ca		       91 27		      STA	($27),Y
   8848  b0cc
   8849  b0cc				   loc_B0CC
   8850  b0cc		       c8		      INY
   8851  b0cd		       b1 25		      LDA	($25),Y
   8852  b0cf		       91 27		      STA	($27),Y
   8853  b0d1		       c9 0d		      CMP	#$D
   8854  b0d3		       d0 f7		      BNE	loc_B0CC
   8855  b0d5		       60		      RTS
   8856  b0d6							; End of function sub_B0BB
   8857  b0d6
   8858  b0d6
   8859  b0d6
   8860  b0d6
   8861  b0d6				   sub_B0D6
   8862  b0d6		       29 0f		      AND	#$F
   8863  b0d8		       85 21		      STA	byte_21
   8864  b0da		       84 22		      STY	byte_22
   8865  b0dc
   8866  b0dc				   loc_B0DC
   8867  b0dc		       c8		      INY
   8868  b0dd		       b1 27		      LDA	($27),Y
   8869  b0df		       c9 3a		      CMP	#$3A	; ':'
   8870  b0e1		       b0 36		      BCS	loc_B119
   8871  b0e3		       c9 30		      CMP	#$30	; '0'
   8872  b0e5		       90 32		      BCC	loc_B119
   8873  b0e7		       29 0f		      AND	#$F
   8874  b0e9		       48		      PHA
   8875  b0ea		       a6 22		      LDX	byte_22
   8876  b0ec		       a5 21		      LDA	byte_21
   8877  b0ee		       0a		      ASL
   8878  b0ef		       26 22		      ROL	byte_22
   8879  b0f1		       30 21		      BMI	loc_B114
   8880  b0f3		       0a		      ASL
   8881  b0f4		       26 22		      ROL	byte_22
   8882  b0f6		       30 1c		      BMI	loc_B114
   8883  b0f8		       65 21		      ADC	byte_21
   8884  b0fa		       85 21		      STA	byte_21
   8885  b0fc		       8a		      TXA
   8886  b0fd		       65 22		      ADC	byte_22
   8887  b0ff		       06 21		      ASL	byte_21
   8888  b101		       2a		      ROL
   8889  b102		       30 10		      BMI	loc_B114
   8890  b104		       b0 0e		      BCS	loc_B114
   8891  b106		       85 22		      STA	byte_22
   8892  b108		       68		      PLA
   8893  b109		       65 21		      ADC	byte_21
   8894  b10b		       85 21		      STA	byte_21
   8895  b10d		       90 cd		      BCC	loc_B0DC
   8896  b10f		       e6 22		      INC	byte_22
   8897  b111		       10 c9		      BPL	loc_B0DC
   8898  b113		       48		      PHA
   8899  b114
   8900  b114				   loc_B114
   8901  b114		       68		      PLA
   8902  b115		       a0 00		      LDY	#0
   8903  b117		       38		      SEC
   8904  b118		       60		      RTS
   8905  b119
   8906  b119				   loc_B119
   8907  b119		       20 d8 b2 	      JSR	ensure_4_bytes_spare
   8908  b11c		       88		      DEY
   8909  b11d		       a9 8d		      LDA	#-$73	;	''
   8910  b11f		       20 bb b0 	      JSR	sub_B0BB
   8911  b122		       a5 27		      LDA	byte_27
   8912  b124		       69 02		      ADC	#2
   8913  b126		       85 25		      STA	byte_25
   8914  b128		       a5 28		      LDA	byte_28
   8915  b12a		       69 00		      ADC	#0
   8916  b12c		       85 26		      STA	byte_26
   8917  b12e
   8918  b12e				   loc_B12E
   8919  b12e		       b1 27		      LDA	($27),Y
   8920  b130		       91 25		      STA	($25),Y
   8921  b132		       88		      DEY
   8922  b133		       d0 f9		      BNE	loc_B12E
   8923  b135		       a0 03		      LDY	#3
   8924  b137		       a5 22		      LDA	byte_22
   8925  b139		       09 40		      ORA	#$40	; '@'
   8926  b13b		       91 27		      STA	($27),Y
   8927  b13d		       88		      DEY
   8928  b13e		       a5 21		      LDA	byte_21
   8929  b140		       29 3f		      AND	#$3F	; '?'
   8930  b142		       09 40		      ORA	#$40	; '@'
   8931  b144		       91 27		      STA	($27),Y
   8932  b146		       88		      DEY
   8933  b147		       a5 21		      LDA	byte_21
   8934  b149		       29 c0		      AND	#-$40	;	'À'
   8935  b14b		       85 21		      STA	byte_21
   8936  b14d		       a5 22		      LDA	byte_22
   8937  b14f		       29 c0		      AND	#-$40	;	'À'
   8938  b151		       4a		      LSR
   8939  b152		       4a		      LSR
   8940  b153		       05 21		      ORA	byte_21
   8941  b155		       4a		      LSR
   8942  b156		       4a		      LSR
   8943  b157		       49 54		      EOR	#$54	; 'T'
   8944  b159		       91 27		      STA	($27),Y
   8945  b15b		       20 86 b1 	      JSR	increment_27
   8946  b15e		       20 86 b1 	      JSR	increment_27
   8947  b161		       20 86 b1 	      JSR	increment_27
   8948  b164		       a0 00		      LDY	#0
   8949  b166
   8950  b166				   clc_then_rts
   8951  b166		       18		      CLC
   8952  b167		       60		      RTS
   8953  b168							; End of function sub_B0D6
   8954  b168
   8955  b168
   8956  b168
   8957  b168							; sets C if A is a valid symbol	char (A-Z, a-z,	0-9, _,	œ)
   8958  b168
   8959  b168				   issymchar
   8960  b168		       c9 7b		      CMP	#$7B	; '{'
   8961  b16a		       b0 fa		      BCS	clc_then_rts	; branch taken if >'z'
   8962  b16c		       c9 5f		      CMP	#$5F	; '_'
   8963  b16e		       b0 0e		      BCS	locret_B17E	; branch taken if >='_' (0x5F='_', 0x60='œ', 0x61='A', ...)
   8964  b170		       c9 5b		      CMP	#$5B	; '['
   8965  b172		       b0 f2		      BCS	clc_then_rts	; branch taken if >'Z'
   8966  b174		       c9 41		      CMP	#$41	; 'A'
   8967  b176		       b0 06		      BCS	locret_B17E	; branch taken if >='A'
   8968  b178							; End of function issymchar
   8969  b178
   8970  b178
   8971  b178
   8972  b178							; sets C if A is a digit char
   8973  b178
   8974  b178				   isdigit
   8975  b178		       c9 3a		      CMP	#$3A	; ':'	    ; >'9'?
   8976  b17a		       b0 ea		      BCS	clc_then_rts	; branch taken if >'9'
   8977  b17c		       c9 30		      CMP	#$30	; '0'
   8978  b17e
   8979  b17e				   locret_B17E
   8980  b17e		       60		      RTS
   8981  b17f							; End of function isdigit
   8982  b17f
   8983  b17f
   8984  b17f
   8985  b17f							; sets C if A is a number char (0-9 or '.')
   8986  b17f
   8987  b17f				   isnumchar
   8988  b17f		       c9 2e		      CMP	#$2E	; '.'
   8989  b181		       d0 f5		      BNE	isdigit	; sets C if A is a digit char
   8990  b183		       60		      RTS
   8991  b184							; End of function isnumchar
   8992  b184
   8993  b184		       b1		      dc.b	$B1	; ±
   8994  b185		       27		      dc.b	$27	; '
   8995  b186
   8996  b186
   8997  b186
   8998  b186				   increment_27
   8999  b186		       20 d2 b2 	      JSR	ensure_1_byte_spare
   9000  b189		       e6 27		      INC	byte_27
   9001  b18b		       d0 f1		      BNE	locret_B17E
   9002  b18d		       e6 28		      INC	byte_28
   9003  b18f		       60		      RTS
   9004  b190							; End of function increment_27
   9005  b190
   9006  b190
   9007  b190
   9008  b190
   9009  b190				   fetch_next_byte
   9010  b190		       20 86 b1 	      JSR	increment_27
   9011  b193		       b1 27		      LDA	($27),Y
   9012  b195		       60		      RTS
   9013  b196							; End of function fetch_next_byte
   9014  b196
   9015  b196
   9016  b196
   9017  b196
   9018  b196				   sub_B196
   9019  b196		       a0 00		      LDY	#0
   9020  b198		       84 23		      STY	byte_23
   9021  b19a		       84 24		      STY	byte_24
   9022  b19c
   9023  b19c				   sub_B196_scan_line
   9024  b19c		       b1 27		      LDA	(byte_27),Y
   9025  b19e		       c9 0d		      CMP	#$D
   9026  b1a0		       f0 dc		      BEQ	locret_B17E
   9027  b1a2		       c9 20		      CMP	#$20	; ' '
   9028  b1a4		       d0 05		      BNE	check_for_hex
   9029  b1a6
   9030  b1a6				   skip_byte
   9031  b1a6		       20 86 b1 	      JSR	increment_27
   9032  b1a9		       d0 f1		      BNE	sub_B196_scan_line
   9033  b1ab
   9034  b1ab				   check_for_hex
   9035  b1ab		       c9 26		      CMP	#$26	; '&'
   9036  b1ad		       d0 12		      BNE	check_for_string
   9037  b1af
   9038  b1af				   check_hex_value
   9039  b1af		       20 90 b1 	      JSR	fetch_next_byte
   9040  b1b2		       20 78 b1 	      JSR	isdigit	; sets C if A is a digit char
   9041  b1b5		       b0 f8		      BCS	check_hex_value
   9042  b1b7		       c9 41		      CMP	#$41	; 'A'
   9043  b1b9		       90 e1		      BCC	sub_B196_scan_line
   9044  b1bb		       c9 47		      CMP	#$47	; 'G'
   9045  b1bd		       90 f0		      BCC	check_hex_value
   9046  b1bf		       b0 db		      BCS	sub_B196_scan_line
   9047  b1c1
   9048  b1c1				   check_for_string
   9049  b1c1		       c9 22		      CMP	#$22	; '"'
   9050  b1c3		       d0 0c		      BNE	check_for_colon
   9051  b1c5
   9052  b1c5				   loc_B1C5
   9053  b1c5		       20 90 b1 	      JSR	fetch_next_byte
   9054  b1c8		       c9 22		      CMP	#$22	; '"'
   9055  b1ca		       f0 da		      BEQ	skip_byte
   9056  b1cc		       c9 0d		      CMP	#$D
   9057  b1ce		       d0 f5		      BNE	loc_B1C5
   9058  b1d0		       60		      RTS
   9059  b1d1
   9060  b1d1				   check_for_colon
   9061  b1d1		       c9 3a		      CMP	#$3A	; ':'
   9062  b1d3		       d0 06		      BNE	check_for_comma
   9063  b1d5		       84 23		      STY	byte_23
   9064  b1d7		       84 24		      STY	byte_24
   9065  b1d9		       f0 cb		      BEQ	skip_byte
   9066  b1db
   9067  b1db				   check_for_comma
   9068  b1db		       c9 2c		      CMP	#$2C	; ','
   9069  b1dd		       f0 c7		      BEQ	skip_byte
   9070  b1df		       c9 2a		      CMP	#$2A	; '*'
   9071  b1e1		       d0 05		      BNE	check_for_dot
   9072  b1e3		       a5 23		      LDA	byte_23
   9073  b1e5		       d0 41		      BNE	loc_B228
   9074  b1e7		       60		      RTS
   9075  b1e8
   9076  b1e8				   check_for_dot
   9077  b1e8		       c9 2e		      CMP	#$2E	; '.'
   9078  b1ea		       f0 0e		      BEQ	got_dot
   9079  b1ec		       20 78 b1 	      JSR	isdigit	; sets C if A is a digit char
   9080  b1ef		       90 33		      BCC	loc_B224
   9081  b1f1		       a6 24		      LDX	byte_24
   9082  b1f3		       f0 05		      BEQ	got_dot
   9083  b1f5		       20 d6 b0 	      JSR	sub_B0D6
   9084  b1f8		       90 34		      BCC	loc_B22E
   9085  b1fa
   9086  b1fa				   got_dot
   9087  b1fa		       b1 27		      LDA	($27),Y
   9088  b1fc		       20 7f b1 	      JSR	isnumchar	; sets C if A is a number char (0-9 or '.')
   9089  b1ff		       90 06		      BCC	loc_B207
   9090  b201		       20 86 b1 	      JSR	increment_27
   9091  b204		       4c fa b1 	      JMP	got_dot
   9092  b207
   9093  b207				   loc_B207
   9094  b207		       a2 ff		      LDX	#-1
   9095  b209		       86 23		      STX	byte_23
   9096  b20b		       84 24		      STY	byte_24
   9097  b20d		       4c 9c b1 	      JMP	sub_B196_scan_line
   9098  b210
   9099  b210				   loc_B210
   9100  b210		       20 68 b1 	      JSR	issymchar	; sets C if A is a valid symbol	char (A-Z, a-z,	0-9, _,	œ)
   9101  b213		       90 13		      BCC	loc_B228
   9102  b215
   9103  b215				   loc_B215
   9104  b215		       a0 00		      LDY	#0
   9105  b217
   9106  b217				   loc_B217
   9107  b217		       b1 27		      LDA	(byte_27),Y
   9108  b219		       20 68 b1 	      JSR	issymchar	; sets C if A is a valid symbol	char (A-Z, a-z,	0-9, _,	œ)
   9109  b21c		       90 e9		      BCC	loc_B207
   9110  b21e		       20 86 b1 	      JSR	increment_27
   9111  b221		       4c 17 b2 	      JMP	loc_B217
   9112  b224
   9113  b224				   loc_B224
   9114  b224		       c9 41		      CMP	#$41	; 'A'
   9115  b226		       b0 09		      BCS	loc_B231
   9116  b228
   9117  b228				   loc_B228
   9118  b228		       a2 ff		      LDX	#-1
   9119  b22a		       86 23		      STX	byte_23
   9120  b22c		       84 24		      STY	byte_24
   9121  b22e
   9122  b22e				   loc_B22E
   9123  b22e		       4c a6 b1 	      JMP	skip_byte
   9124  b231
   9125  b231				   loc_B231
   9126  b231		       c9 58		      CMP	#'X
   9127  b233		       b0 db		      BCS	loc_B210	; skip out if >=X, since no tokens start with X, Y or Z
   9128  b235		       a2 ce		      LDX	#$CE	; #<tokens_table
   9129  b237		       86 25		      STX	byte_25
   9130  b239		       a2 a2		      LDX	#$A2	; #>tokens_table
   9131  b23b		       86 26		      STX	byte_26
   9132  b23d
   9133  b23d				   loc_B23D
   9134  b23d		       d1 25		      CMP	(byte_25),Y	; compare to char in table
   9135  b23f		       90 d6		      BCC	loc_B217	; taken	if char	in table is less
   9136  b241		       d0 0f		      BNE	find_token_byte	; taken	if char	is different
   9137  b243
   9138  b243				   loc_B243
   9139  b243		       c8		      INY		; next char
   9140  b244		       b1 25		      LDA	(byte_25),Y	; get next char	from table
   9141  b246		       30 34		      BMI	loc_B27C	; taken	if token value found
   9142  b248		       d1 27		      CMP	(byte_27),Y	; compare to byte in program
   9143  b24a		       f0 f7		      BEQ	loc_B243	; taken	if chars equal
   9144  b24c		       b1 27		      LDA	(byte_27),Y	; get byte from	program
   9145  b24e		       c9 2e		      CMP	#'.	; is it an abbreviation?
   9146  b250		       f0 0b		      BEQ	loc_B25D	; taken	if abbreviated
   9147  b252
   9148  b252				   find_token_byte
   9149  b252		       c8		      INY
   9150  b253		       b1 25		      LDA	(byte_25),Y
   9151  b255		       10 fb		      BPL	find_token_byte
   9152  b257		       c9 fe		      CMP	#$FE	; reached WIDTH	in the table?
   9153  b259		       d0 0f		      BNE	loc_B26A	; taken	if not WIDTH
   9154  b25b		       b0 b8		      BCS	loc_B215	; taken	if WIDTH or OSCLI (???)
   9155  b25d
   9156  b25d				   loc_B25D
   9157  b25d		       c8		      INY
   9158  b25e
   9159  b25e				   loc_B25E
   9160  b25e		       b1 25		      LDA	($25),Y
   9161  b260		       30 1a		      BMI	loc_B27C
   9162  b262		       e6 25		      INC	byte_25
   9163  b264		       d0 f8		      BNE	loc_B25E
   9164  b266		       e6 26		      INC	byte_26
   9165  b268		       d0 f4		      BNE	loc_B25E
   9166  b26a
   9167  b26a				   loc_B26A
   9168  b26a		       38		      SEC
   9169  b26b		       c8		      INY
   9170  b26c		       98		      TYA
   9171  b26d		       65 25		      ADC	byte_25
   9172  b26f		       85 25		      STA	byte_25
   9173  b271		       90 02		      BCC	loc_B275
   9174  b273		       e6 26		      INC	byte_26
   9175  b275
   9176  b275				   loc_B275
   9177  b275		       a0 00		      LDY	#0
   9178  b277		       b1 27		      LDA	($27),Y
   9179  b279		       4c 3d b2 	      JMP	loc_B23D
   9180  b27c
   9181  b27c				   loc_B27C
   9182  b27c		       aa		      TAX
   9183  b27d		       c8		      INY
   9184  b27e		       b1 25		      LDA	($25),Y
   9185  b280		       85 21		      STA	byte_21
   9186  b282		       88		      DEY
   9187  b283		       4a		      LSR
   9188  b284		       90 07		      BCC	loc_B28D
   9189  b286		       b1 27		      LDA	($27),Y
   9190  b288		       20 68 b1 	      JSR	issymchar	; sets C if A is a valid symbol	char (A-Z, a-z,	0-9, _,	œ)
   9191  b28b		       b0 88		      BCS	loc_B215
   9192  b28d
   9193  b28d				   loc_B28D
   9194  b28d		       8a		      TXA
   9195  b28e		       24 21		      BIT	byte_21
   9196  b290		       50 07		      BVC	loc_B299
   9197  b292		       a6 23		      LDX	byte_23
   9198  b294		       d0 03		      BNE	loc_B299
   9199  b296		       18		      CLC
   9200  b297		       69 40		      ADC	#$40	; '@'
   9201  b299
   9202  b299				   loc_B299
   9203  b299		       88		      DEY
   9204  b29a		       20 bb b0 	      JSR	sub_B0BB
   9205  b29d		       a0 00		      LDY	#0
   9206  b29f		       a2 ff		      LDX	#-1
   9207  b2a1		       a5 21		      LDA	byte_21
   9208  b2a3		       4a		      LSR
   9209  b2a4		       4a		      LSR
   9210  b2a5		       90 04		      BCC	loc_B2AB
   9211  b2a7		       86 23		      STX	byte_23
   9212  b2a9		       84 24		      STY	byte_24
   9213  b2ab
   9214  b2ab				   loc_B2AB
   9215  b2ab		       4a		      LSR
   9216  b2ac		       90 04		      BCC	loc_B2B2
   9217  b2ae		       84 23		      STY	byte_23
   9218  b2b0		       84 24		      STY	byte_24
   9219  b2b2
   9220  b2b2				   loc_B2B2
   9221  b2b2		       4a		      LSR
   9222  b2b3		       90 11		      BCC	loc_B2C6
   9223  b2b5		       48		      PHA
   9224  b2b6		       c8		      INY
   9225  b2b7
   9226  b2b7				   loc_B2B7
   9227  b2b7		       b1 27		      LDA	($27),Y
   9228  b2b9		       20 68 b1 	      JSR	issymchar	; sets C if A is a valid symbol	char (A-Z, a-z,	0-9, _,	œ)
   9229  b2bc		       90 06		      BCC	loc_B2C4
   9230  b2be		       20 86 b1 	      JSR	increment_27
   9231  b2c1		       4c b7 b2 	      JMP	loc_B2B7
   9232  b2c4
   9233  b2c4				   loc_B2C4
   9234  b2c4		       88		      DEY
   9235  b2c5		       68		      PLA
   9236  b2c6
   9237  b2c6				   loc_B2C6
   9238  b2c6		       4a		      LSR
   9239  b2c7		       90 02		      BCC	loc_B2CB
   9240  b2c9		       86 24		      STX	byte_24
   9241  b2cb
   9242  b2cb				   loc_B2CB
   9243  b2cb		       4a		      LSR
   9244  b2cc		       b0 03		      BCS	locret_B2D1
   9245  b2ce		       4c a6 b1 	      JMP	skip_byte
   9246  b2d1
   9247  b2d1				   locret_B2D1
   9248  b2d1		       60		      RTS
   9249  b2d2							; End of function sub_B196
   9250  b2d2
   9251  b2d2
   9252  b2d2
   9253  b2d2
   9254  b2d2				   ensure_1_byte_spare
   9255  b2d2		       08		      PHP
   9256  b2d3		       48		      PHA
   9257  b2d4		       a9 01		      LDA	#1
   9258  b2d6		       d0 04		      BNE	loc_B2DC	; JMP, in effect
   9259  b2d8							; End of function ensure_1_byte_spare
   9260  b2d8
   9261  b2d8
   9262  b2d8
   9263  b2d8
   9264  b2d8				   ensure_4_bytes_spare
   9265  b2d8		       08		      PHP
   9266  b2d9		       48		      PHA
   9267  b2da		       a9 04		      LDA	#4
   9268  b2dc
   9269  b2dc				   loc_B2DC
   9270  b2dc		       18		      CLC
   9271  b2dd		       65 27		      ADC	byte_27
   9272  b2df		       b0 09		      BCS	longjmp
   9273  b2e1		       c9 fc		      CMP	#$FC
   9274  b2e3		       f0 02		      BEQ	loc_B2E7
   9275  b2e5		       b0 03		      BCS	longjmp
   9276  b2e7
   9277  b2e7				   loc_B2E7
   9278  b2e7		       68		      PLA
   9279  b2e8		       28		      PLP
   9280  b2e9		       60		      RTS
   9281  b2ea
   9282  b2ea				   longjmp
   9283  b2ea
   9284  b2ea		       a0 00		      LDY	#0
   9285  b2ec		       a9 0d		      LDA	#$D
   9286  b2ee		       91 27		      STA	($27),Y
   9287  b2f0		       8d a8 06 	      STA	byte_6A8
   9288  b2f3		       ae a9 06 	      LDX	old_stack_ptr
   9289  b2f6		       9a		      TXS
   9290  b2f7		       60		      RTS
   9291  b2f8							; End of function ensure_4_bytes_spare
   9292  b2f8
   9293  b2f8
   9294  b2f8
   9295  b2f8
   9296  b2f8				   mode_command
   9297  b2f8		       a5 14		      LDA	screen_mode
   9298  b2fa		       48		      PHA
   9299  b2fb		       a4 3f		      LDY	byte_3F
   9300  b2fd		       f0 05		      BEQ	loc_B304
   9301  b2ff
   9302  b2ff				   loc_B2FF
   9303  b2ff
   9304  b2ff		       a9 0d		      LDA	#$D	; "Only	modes 0,1,3,4,6,7 are valid"
   9305  b301		       4c 9d 85 	      JMP	loc_859D
   9306  b304
   9307  b304				   loc_B304
   9308  b304		       a4 3e		      LDY	byte_3E
   9309  b306		       c0 02		      CPY	#2
   9310  b308		       f0 f5		      BEQ	loc_B2FF	; "bad mode" for MODE 2
   9311  b30a		       c0 05		      CPY	#5
   9312  b30c		       f0 f1		      BEQ	loc_B2FF	; "bad mode" for MODE 5
   9313  b30e		       c0 08		      CPY	#8
   9314  b310		       b0 ed		      BCS	loc_B2FF	; "bad MODE" for MODE >=8
   9315  b312		       84 14		      STY	screen_mode
   9316  b314		       20 af 81 	      JSR	validate_mode
   9317  b317		       20 1f 83 	      JSR	find_program
   9318  b31a		       68		      PLA
   9319  b31b		       a6 15		      LDX	byte_15
   9320  b31d		       f0 0a		      BEQ	locret_B329
   9321  b31f		       85 14		      STA	screen_mode
   9322  b321		       20 91 90 	      JSR	clear_5B1_to_600
   9323  b324		       a9 0e		      LDA	#$E	; "No room for this mode"
   9324  b326		       4c 9d 85 	      JMP	loc_859D
   9325  b329
   9326  b329				   locret_B329
   9327  b329		       60		      RTS
   9328  b32a							; End of function mode_command
   9329  b32a
   9330  b32a
   9331  b32a				   mode_edit_mode_command
   9332  b32a		       a4 14		      LDY	screen_mode
   9333  b32c
   9334  b32c				   loc_B32C
   9335  b32c		       88		      DEY
   9336  b32d		       c0 02		      CPY	#2
   9337  b32f		       f0 fb		      BEQ	loc_B32C
   9338  b331		       c0 05		      CPY	#5
   9339  b333		       f0 f7		      BEQ	loc_B32C
   9340  b335		       c0 ff		      CPY	#-1
   9341  b337		       d0 02		      BNE	loc_B33B
   9342  b339		       a0 07		      LDY	#7
   9343  b33b
   9344  b33b				   loc_B33B
   9345  b33b		       84 14		      STY	screen_mode
   9346  b33d		       20 af 81 	      JSR	validate_mode
   9347  b340		       20 1f 83 	      JSR	find_program
   9348  b343		       a5 15		      LDA	byte_15
   9349  b345		       f0 03		      BEQ	loc_B34A
   9350  b347		       4c 4d 81 	      JMP	loc_814D
   9351  b34a
   9352  b34a				   loc_B34A
   9353  b34a		       20 2d 9d 	      JSR	loc_9D2D
   9354  b34d		       20 e9 9f 	      JSR	is_program_empty	; sets	C if no	program
   9355  b350		       b0 03		      BCS	loc_B355
   9356  b352		       4c 7a 96 	      JMP	loc_967A
   9357  b355
   9358  b355				   loc_B355
   9359  b355		       4c a8 9d 	      JMP	loc_9DA8
   9360  b358
   9361  b358
   9362  b358
   9363  b358				   sub_B358
   9364  b358
   9365  b358		       a9 ff		      LDA	#$FF
   9366  b35a		       85 4d		      STA	unk_4D
   9367  b35c		       60		      RTS
   9368  b35d							; End of function sub_B358
   9369  b35d
   9370  b35d
   9371  b35d
   9372  b35d
   9373  b35d				   mark_edit_mode_command
   9374  b35d
   9375  b35d		       a5 4a		      LDA	current_line_no_lsb
   9376  b35f		       85 4d		      STA	unk_4D
   9377  b361		       a5 4b		      LDA	current_line_no_msb
   9378  b363		       85 4e		      STA	unk_4E
   9379  b365		       4c 08 ac 	      JMP	loc_AC08
   9380  b368							; End of function mark_edit_mode_command
   9381  b368
   9382  b368
   9383  b368
   9384  b368
   9385  b368				   goto_edit_mode_command
   9386  b368
   9387  b368		       20 7b b3 	      JSR	sub_B37B
   9388  b36b		       f0 03		      BEQ	loc_B370
   9389  b36d		       4c 69 9f 	      JMP	beep
   9390  b370
   9391  b370				   loc_B370
   9392  b370
   9393  b370		       a5 4d		      LDA	unk_4D
   9394  b372		       85 4a		      STA	current_line_no_lsb
   9395  b374		       a5 4e		      LDA	unk_4E
   9396  b376		       85 4b		      STA	current_line_no_msb
   9397  b378		       4c a8 9d 	      JMP	loc_9DA8
   9398  b37b							; End of function goto_edit_mode_command
   9399  b37b
   9400  b37b
   9401  b37b
   9402  b37b
   9403  b37b				   sub_B37B
   9404  b37b
   9405  b37b		       a5 4d		      LDA	unk_4D
   9406  b37d		       c9 ff		      CMP	#-1
   9407  b37f		       d0 03		      BNE	loc_B384
   9408  b381		       a9 01		      LDA	#1
   9409  b383		       60		      RTS
   9410  b384
   9411  b384				   loc_B384
   9412  b384		       85 2b		      STA	byte_2B
   9413  b386		       a5 4e		      LDA	unk_4E
   9414  b388		       85 2c		      STA	byte_2C
   9415  b38a		       20 8f 9e 	      JSR	find_line_by_number	; finds a line, given a line number
   9416  b38d							;
   9417  b38d							; Entry:
   9418  b38d							; byte_2B: line	number MSB
   9419  b38d							; byte_2C: line	number LSB
   9420  b38d							;
   9421  b38d							; Exit:
   9422  b38d							; (byte_2B) points to most suitable line
   9423  b38d		       a0 01		      LDY	#1
   9424  b38f		       b1 2b		      LDA	($2B),Y
   9425  b391		       c5 4d		      CMP	unk_4D
   9426  b393		       d0 05		      BNE	locret_B39A
   9427  b395		       c8		      INY
   9428  b396		       b1 2b		      LDA	($2B),Y
   9429  b398		       c5 4e		      CMP	unk_4E
   9430  b39a
   9431  b39a				   locret_B39A
   9432  b39a		       60		      RTS
   9433  b39b							; End of function sub_B37B
   9434  b39b
   9435  b39b
   9436  b39b				   goto_command
   9437  b39b		       20 7b b3 	      JSR	sub_B37B
   9438  b39e		       d0 06		      BNE	loc_B3A6
   9439  b3a0		       20 28 9d 	      JSR	enter_edit_mode
   9440  b3a3		       4c 70 b3 	      JMP	loc_B370
   9441  b3a6
   9442  b3a6				   loc_B3A6
   9443  b3a6		       a9 22		      LDA	#$22	; '"'
   9444  b3a8		       4c 9d 85 	      JMP	loc_859D
   9445  b3ab
   9446  b3ab				   number_command
   9447  b3ab		       a5 4a		      LDA	current_line_no_lsb
   9448  b3ad		       48		      PHA
   9449  b3ae		       a5 4b		      LDA	current_line_no_msb
   9450  b3b0		       48		      PHA
   9451  b3b1		       a9 00		      LDA	#0
   9452  b3b3		       85 1e		      STA	unk_1E
   9453  b3b5		       85 2b		      STA	byte_2B
   9454  b3b7		       a5 18		      LDA	oshwm+1
   9455  b3b9		       85 2c		      STA	byte_2C
   9456  b3bb
   9457  b3bb				   loc_B3BB
   9458  b3bb		       a0 01		      LDY	#1
   9459  b3bd		       b1 2b		      LDA	($2B),Y
   9460  b3bf		       10 1a		      BPL	loc_B3DB
   9461  b3c1		       68		      PLA
   9462  b3c2		       85 4b		      STA	current_line_no_msb
   9463  b3c4		       68		      PLA
   9464  b3c5		       85 4a		      STA	current_line_no_lsb
   9465  b3c7		       a5 1e		      LDA	unk_1E
   9466  b3c9		       29 01		      AND	#1
   9467  b3cb		       f0 05		      BEQ	loc_B3D2
   9468  b3cd		       a9 10		      LDA	#$10
   9469  b3cf
   9470  b3cf				   loc_B3CF
   9471  b3cf		       4c 9d 85 	      JMP	loc_859D
   9472  b3d2
   9473  b3d2				   loc_B3D2
   9474  b3d2		       a5 1e		      LDA	unk_1E
   9475  b3d4		       d0 04		      BNE	locret_B3DA
   9476  b3d6		       a9 0f		      LDA	#$F
   9477  b3d8		       d0 f5		      BNE	loc_B3CF
   9478  b3da
   9479  b3da				   locret_B3DA
   9480  b3da		       60		      RTS
   9481  b3db
   9482  b3db				   loc_B3DB
   9483  b3db		       20 39 a0 	      JSR	save_line_number	; saves line number from program.
   9484  b3de							;
   9485  b3de							; Entry:
   9486  b3de							; (byte_2b) points to current line
   9487  b3de							;
   9488  b3de							; Exit:
   9489  b3de							; current_line_no_lsb, current_line_no_msb = the line number
   9490  b3de		       a5 2b		      LDA	byte_2B
   9491  b3e0		       85 0c		      STA	byte_C
   9492  b3e2		       a5 2c		      LDA	byte_2C
   9493  b3e4		       85 0d		      STA	byte_D
   9494  b3e6		       a9 00		      LDA	#0
   9495  b3e8		       85 0e		      STA	byte_E
   9496  b3ea		       a9 05		      LDA	#5
   9497  b3ec		       85 0f		      STA	byte_F
   9498  b3ee		       a2 00		      LDX	#0
   9499  b3f0		       a0 03		      LDY	#3
   9500  b3f2		       b1 2b		      LDA	($2B),Y
   9501  b3f4		       a8		      TAY
   9502  b3f5		       c8		      INY
   9503  b3f6		       d0 01		      BNE	loc_B3F9
   9504  b3f8		       e8		      INX
   9505  b3f9
   9506  b3f9				   loc_B3F9
   9507  b3f9		       20 a1 8e 	      JSR	memmove	; move (maybe overlapping) memory regions.
   9508  b3fc							;
   9509  b3fc							; Entry:
   9510  b3fc							; (byte_C) points to src
   9511  b3fc							; (byte_E) points to dest
   9512  b3fc							; X is MSB of size
   9513  b3fc							; Y is LSB of size
   9514  b3fc		       a2 00		      LDX	#0
   9515  b3fe		       86 11		      STX	unk_11
   9516  b400		       86 37		      STX	unk_37
   9517  b402		       86 36		      STX	byte_36
   9518  b404		       8e b3 06 	      STX	byte_6B3
   9519  b407		       e8		      INX
   9520  b408		       86 10		      STX	cursor_offset	; offset of cursor in detokenized buffer
   9521  b40a		       a9 04		      LDA	#4
   9522  b40c		       85 1f		      STA	unk_1F
   9523  b40e		       a9 05		      LDA	#5
   9524  b410		       85 20		      STA	byte_20
   9525  b412
   9526  b412				   loc_B412
   9527  b412		       38		      SEC
   9528  b413		       ad 03 05 	      LDA	unk_503
   9529  b416		       e9 04		      SBC	#4
   9530  b418		       c5 10		      CMP	cursor_offset	; offset of cursor in detokenized buffer
   9531  b41a		       90 5a		      BCC	loc_B476
   9532  b41c		       a0 00		      LDY	#0
   9533  b41e		       b1 1f		      LDA	($1F),Y
   9534  b420		       c9 20		      CMP	#$20	; ' '
   9535  b422		       f0 3d		      BEQ	loc_B461
   9536  b424		       c9 22		      CMP	#$22	; '"'
   9537  b426		       d0 08		      BNE	loc_B430
   9538  b428		       85 36		      STA	byte_36
   9539  b42a		       a5 37		      LDA	unk_37
   9540  b42c		       49 01		      EOR	#1
   9541  b42e		       85 37		      STA	unk_37
   9542  b430
   9543  b430				   loc_B430
   9544  b430		       a5 37		      LDA	unk_37
   9545  b432		       d0 2d		      BNE	loc_B461
   9546  b434		       b1 1f		      LDA	($1F),Y
   9547  b436		       c9 f4		      CMP	#-$C	; 'ô'
   9548  b438		       f0 3c		      BEQ	loc_B476
   9549  b43a		       c9 dc		      CMP	#-$24	;	'Ü'
   9550  b43c		       f0 38		      BEQ	loc_B476
   9551  b43e		       c9 2a		      CMP	#$2A	; '*'
   9552  b440		       d0 04		      BNE	loc_B446
   9553  b442		       a6 36		      LDX	byte_36
   9554  b444		       f0 30		      BEQ	loc_B476
   9555  b446
   9556  b446				   loc_B446
   9557  b446		       c9 3a		      CMP	#$3A	; ':'
   9558  b448		       d0 04		      BNE	loc_B44E
   9559  b44a		       84 36		      STY	byte_36
   9560  b44c		       f0 13		      BEQ	loc_B461
   9561  b44e
   9562  b44e				   loc_B44E
   9563  b44e		       a2 01		      LDX	#1
   9564  b450		       86 36		      STX	byte_36
   9565  b452		       c9 8d		      CMP	#-$73	;	''
   9566  b454		       d0 04		      BNE	loc_B45A
   9567  b456		       a2 04		      LDX	#4
   9568  b458		       d0 09		      BNE	loc_B463
   9569  b45a
   9570  b45a				   loc_B45A
   9571  b45a		       c9 40		      CMP	#$40	; '@'
   9572  b45c		       d0 03		      BNE	loc_B461
   9573  b45e		       4c b7 b4 	      JMP	loc_B4B7
   9574  b461
   9575  b461				   loc_B461
   9576  b461		       a2 01		      LDX	#1
   9577  b463
   9578  b463				   loc_B463
   9579  b463		       18		      CLC
   9580  b464		       8a		      TXA
   9581  b465		       65 1f		      ADC	unk_1F
   9582  b467		       85 1f		      STA	unk_1F
   9583  b469		       90 02		      BCC	loc_B46D
   9584  b46b		       e6 20		      INC	byte_20
   9585  b46d
   9586  b46d				   loc_B46D
   9587  b46d		       18		      CLC
   9588  b46e		       8a		      TXA
   9589  b46f		       65 10		      ADC	cursor_offset	; offset of cursor in detokenized buffer
   9590  b471		       85 10		      STA	cursor_offset	; offset of cursor in detokenized buffer
   9591  b473		       4c 12 b4 	      JMP	loc_B412
   9592  b476
   9593  b476				   loc_B476
   9594  b476		       ad b3 06 	      LDA	byte_6B3
   9595  b479		       f0 03		      BEQ	loc_B47E
   9596  b47b		       20 a7 b4 	      JSR	sub_B4A7
   9597  b47e
   9598  b47e				   loc_B47E
   9599  b47e		       20 52 92 	      JSR	advance_2b_to_next_line
   9600  b481		       4c bb b3 	      JMP	loc_B3BB
   9601  b484
   9602  b484
   9603  b484
   9604  b484				   sub_B484
   9605  b484		       c9 30		      CMP	#'0
   9606  b486		       90 14		      BCC	loc_B49C
   9607  b488		       c9 3a		      CMP	#':
   9608  b48a		       90 12		      BCC	loc_B49E
   9609  b48c		       c9 41		      CMP	#'A
   9610  b48e		       90 0c		      BCC	loc_B49C
   9611  b490		       c9 5b		      CMP	#'[
   9612  b492		       90 0a		      BCC	loc_B49E
   9613  b494		       c9 5f		      CMP	#'_
   9614  b496		       90 04		      BCC	loc_B49C
   9615  b498		       c9 7b		      CMP	#'{
   9616  b49a		       90 02		      BCC	loc_B49E
   9617  b49c
   9618  b49c				   loc_B49C
   9619  b49c		       18		      CLC
   9620  b49d		       60		      RTS
   9621  b49e
   9622  b49e				   loc_B49E
   9623  b49e		       38		      SEC
   9624  b49f		       60		      RTS
   9625  b4a0							; End of function sub_B484
   9626  b4a0
   9627  b4a0
   9628  b4a0
   9629  b4a0
   9630  b4a0				   sub_B4A0
   9631  b4a0		       a0 01		      LDY	#1
   9632  b4a2		       b1 0c		      LDA	($C),Y
   9633  b4a4		       4c 84 b4 	      JMP	sub_B484
   9634  b4a7							; End of function sub_B4A0
   9635  b4a7
   9636  b4a7
   9637  b4a7
   9638  b4a7
   9639  b4a7				   sub_B4A7
   9640  b4a7		       a5 2b		      LDA	byte_2B
   9641  b4a9		       48		      PHA
   9642  b4aa		       a5 2c		      LDA	byte_2C
   9643  b4ac		       48		      PHA
   9644  b4ad		       20 ff a8 	      JSR	loc_A8FF
   9645  b4b0		       68		      PLA
   9646  b4b1		       85 2c		      STA	byte_2C
   9647  b4b3		       68		      PLA
   9648  b4b4		       85 2b		      STA	byte_2B
   9649  b4b6		       60		      RTS
   9650  b4b7							; End of function sub_B4A7
   9651  b4b7
   9652  b4b7
   9653  b4b7				   loc_B4B7
   9654  b4b7		       a5 1f		      LDA	unk_1F
   9655  b4b9		       85 0c		      STA	byte_C
   9656  b4bb		       a5 20		      LDA	byte_20
   9657  b4bd		       85 0d		      STA	byte_D
   9658  b4bf		       20 a0 b4 	      JSR	sub_B4A0
   9659  b4c2		       b0 03		      BCS	loc_B4C7
   9660  b4c4
   9661  b4c4				   loc_B4C4
   9662  b4c4		       4c 61 b4 	      JMP	loc_B461
   9663  b4c7
   9664  b4c7				   loc_B4C7
   9665  b4c7		       a9 00		      LDA	#0
   9666  b4c9		       85 33		      STA	unk_33
   9667  b4cb		       a5 18		      LDA	oshwm+1
   9668  b4cd		       85 34		      STA	unk_34
   9669  b4cf
   9670  b4cf				   loc_B4CF
   9671  b4cf		       a0 01		      LDY	#1
   9672  b4d1		       b1 33		      LDA	($33),Y
   9673  b4d3		       10 08		      BPL	loc_B4DD
   9674  b4d5		       a5 1e		      LDA	unk_1E
   9675  b4d7		       09 01		      ORA	#1
   9676  b4d9		       85 1e		      STA	unk_1E
   9677  b4db		       d0 e7		      BNE	loc_B4C4
   9678  b4dd
   9679  b4dd				   loc_B4DD
   9680  b4dd		       a5 33		      LDA	unk_33
   9681  b4df		       48		      PHA
   9682  b4e0		       a5 34		      LDA	unk_34
   9683  b4e2		       48		      PHA
   9684  b4e3		       a0 04		      LDY	#4
   9685  b4e5
   9686  b4e5				   loc_B4E5
   9687  b4e5		       b1 33		      LDA	($33),Y
   9688  b4e7		       c9 20		      CMP	#$20	; ' '
   9689  b4e9		       d0 04		      BNE	loc_B4EF
   9690  b4eb		       c8		      INY
   9691  b4ec		       4c e5 b4 	      JMP	loc_B4E5
   9692  b4ef
   9693  b4ef				   loc_B4EF
   9694  b4ef		       c9 f4		      CMP	#-$C	; 'ô'
   9695  b4f1		       d0 3c		      BNE	loc_B52F
   9696  b4f3		       c8		      INY
   9697  b4f4
   9698  b4f4				   loc_B4F4
   9699  b4f4		       b1 33		      LDA	($33),Y
   9700  b4f6		       c9 20		      CMP	#$20	; ' '
   9701  b4f8		       d0 04		      BNE	loc_B4FE
   9702  b4fa		       c8		      INY
   9703  b4fb		       4c f4 b4 	      JMP	loc_B4F4
   9704  b4fe
   9705  b4fe				   loc_B4FE
   9706  b4fe		       18		      CLC
   9707  b4ff		       98		      TYA
   9708  b500		       65 33		      ADC	unk_33
   9709  b502		       85 33		      STA	unk_33
   9710  b504		       90 02		      BCC	loc_B508
   9711  b506		       e6 34		      INC	unk_34
   9712  b508
   9713  b508				   loc_B508
   9714  b508		       a0 00		      LDY	#0
   9715  b50a		       b1 33		      LDA	($33),Y
   9716  b50c		       c9 40		      CMP	#$40	; '@'
   9717  b50e		       f0 02		      BEQ	loc_B512
   9718  b510		       d0 1d		      BNE	loc_B52F
   9719  b512
   9720  b512				   loc_B512
   9721  b512		       c8		      INY
   9722  b513
   9723  b513				   loc_B513
   9724  b513		       b1 33		      LDA	($33),Y
   9725  b515		       d1 1f		      CMP	($1F),Y
   9726  b517		       d0 08		      BNE	loc_B521
   9727  b519		       20 84 b4 	      JSR	sub_B484
   9728  b51c		       90 14		      BCC	loc_B532
   9729  b51e		       c8		      INY
   9730  b51f		       d0 f2		      BNE	loc_B513
   9731  b521
   9732  b521				   loc_B521
   9733  b521		       20 84 b4 	      JSR	sub_B484
   9734  b524		       b0 09		      BCS	loc_B52F
   9735  b526		       b1 1f		      LDA	($1F),Y
   9736  b528		       20 84 b4 	      JSR	sub_B484
   9737  b52b		       b0 02		      BCS	loc_B52F
   9738  b52d		       90 03		      BCC	loc_B532
   9739  b52f
   9740  b52f				   loc_B52F
   9741  b52f		       18		      CLC
   9742  b530		       90 01		      BCC	loc_B533
   9743  b532
   9744  b532				   loc_B532
   9745  b532		       38		      SEC
   9746  b533
   9747  b533				   loc_B533
   9748  b533		       68		      PLA
   9749  b534		       85 34		      STA	unk_34
   9750  b536		       68		      PLA
   9751  b537		       85 33		      STA	unk_33
   9752  b539		       b0 03		      BCS	loc_B53E
   9753  b53b		       4c a3 b5 	      JMP	loc_B5A3
   9754  b53e
   9755  b53e				   loc_B53E
   9756  b53e		       84 35		      STY	byte_35
   9757  b540		       ad 03 05 	      LDA	unk_503
   9758  b543		       38		      SEC
   9759  b544		       e5 35		      SBC	byte_35
   9760  b546		       18		      CLC
   9761  b547		       69 04		      ADC	#4
   9762  b549		       b0 53		      BCS	loc_B59E
   9763  b54b		       8d 03 05 	      STA	unk_503
   9764  b54e		       18		      CLC
   9765  b54f		       a5 1f		      LDA	unk_1F
   9766  b551		       65 35		      ADC	byte_35
   9767  b553		       85 0c		      STA	byte_C
   9768  b555		       a5 20		      LDA	byte_20
   9769  b557		       85 0d		      STA	byte_D
   9770  b559		       85 0f		      STA	byte_F
   9771  b55b		       18		      CLC
   9772  b55c		       a5 1f		      LDA	unk_1F
   9773  b55e		       69 04		      ADC	#4
   9774  b560		       85 0e		      STA	byte_E
   9775  b562		       38		      SEC
   9776  b563		       ad 03 05 	      LDA	unk_503
   9777  b566		       e5 10		      SBC	cursor_offset	; offset of cursor in detokenized buffer
   9778  b568		       38		      SEC
   9779  b569		       e9 06		      SBC	#6
   9780  b56b		       a8		      TAY
   9781  b56c		       a2 00		      LDX	#0
   9782  b56e		       20 a1 8e 	      JSR	memmove	; move (maybe overlapping) memory regions.
   9783  b571							;
   9784  b571							; Entry:
   9785  b571							; (byte_C) points to src
   9786  b571							; (byte_E) points to dest
   9787  b571							; X is MSB of size
   9788  b571							; Y is LSB of size
   9789  b571		       a0 01		      LDY	#1
   9790  b573		       b1 33		      LDA	($33),Y
   9791  b575		       aa		      TAX
   9792  b576		       c8		      INY
   9793  b577		       b1 33		      LDA	($33),Y
   9794  b579		       a8		      TAY
   9795  b57a		       20 d8 85 	      JSR	sub_85D8
   9796  b57d		       48		      PHA
   9797  b57e		       98		      TYA
   9798  b57f		       a0 03		      LDY	#3
   9799  b581		       91 1f		      STA	($1F),Y
   9800  b583		       88		      DEY
   9801  b584		       8a		      TXA
   9802  b585		       91 1f		      STA	($1F),Y
   9803  b587		       88		      DEY
   9804  b588		       68		      PLA
   9805  b589		       91 1f		      STA	($1F),Y
   9806  b58b		       88		      DEY
   9807  b58c		       a9 8d		      LDA	#-$73	;	''
   9808  b58e		       91 1f		      STA	($1F),Y
   9809  b590		       8d b3 06 	      STA	byte_6B3
   9810  b593		       a5 1e		      LDA	unk_1E
   9811  b595		       09 02		      ORA	#2
   9812  b597		       85 1e		      STA	unk_1E
   9813  b599		       a2 04		      LDX	#4
   9814  b59b		       4c 63 b4 	      JMP	loc_B463
   9815  b59e
   9816  b59e				   loc_B59E
   9817  b59e		       a9 11		      LDA	#$11
   9818  b5a0		       4c 9d 85 	      JMP	loc_859D
   9819  b5a3
   9820  b5a3				   loc_B5A3
   9821  b5a3		       a0 03		      LDY	#3
   9822  b5a5		       18		      CLC
   9823  b5a6		       b1 33		      LDA	($33),Y
   9824  b5a8		       65 33		      ADC	unk_33
   9825  b5aa		       85 33		      STA	unk_33
   9826  b5ac		       90 02		      BCC	loc_B5B0
   9827  b5ae		       e6 34		      INC	unk_34
   9828  b5b0
   9829  b5b0				   loc_B5B0
   9830  b5b0		       4c cf b4 	      JMP	loc_B4CF
   9831  b5b3
   9832  b5b3				   label_command
   9833  b5b3		       a5 4a		      LDA	current_line_no_lsb
   9834  b5b5		       48		      PHA
   9835  b5b6		       a5 4b		      LDA	current_line_no_msb
   9836  b5b8		       48		      PHA
   9837  b5b9		       a9 00		      LDA	#0
   9838  b5bb		       85 1e		      STA	unk_1E
   9839  b5bd		       85 2b		      STA	byte_2B
   9840  b5bf		       a5 18		      LDA	oshwm+1
   9841  b5c1		       85 2c		      STA	byte_2C
   9842  b5c3
   9843  b5c3				   loc_B5C3
   9844  b5c3		       a0 01		      LDY	#1
   9845  b5c5		       b1 2b		      LDA	($2B),Y
   9846  b5c7		       30 23		      BMI	loc_B5EC
   9847  b5c9		       20 39 a0 	      JSR	save_line_number	; saves line number from program.
   9848  b5cc							;
   9849  b5cc							; Entry:
   9850  b5cc							; (byte_2b) points to current line
   9851  b5cc							;
   9852  b5cc							; Exit:
   9853  b5cc							; current_line_no_lsb, current_line_no_msb = the line number
   9854  b5cc		       a9 00		      LDA	#0
   9855  b5ce		       8d b3 06 	      STA	byte_6B3
   9856  b5d1		       4c 5a b6 	      JMP	loc_B65A
   9857  b5d4
   9858  b5d4				   loc_B5D4
   9859  b5d4		       ad b3 06 	      LDA	byte_6B3
   9860  b5d7		       f0 03		      BEQ	loc_B5DC
   9861  b5d9		       20 a7 b4 	      JSR	sub_B4A7
   9862  b5dc
   9863  b5dc				   loc_B5DC
   9864  b5dc		       a0 03		      LDY	#3
   9865  b5de		       18		      CLC
   9866  b5df		       b1 2b		      LDA	($2B),Y
   9867  b5e1		       65 2b		      ADC	byte_2B
   9868  b5e3		       85 2b		      STA	byte_2B
   9869  b5e5		       90 02		      BCC	loc_B5E9
   9870  b5e7		       e6 2c		      INC	byte_2C
   9871  b5e9
   9872  b5e9				   loc_B5E9
   9873  b5e9		       4c c3 b5 	      JMP	loc_B5C3
   9874  b5ec
   9875  b5ec				   loc_B5EC
   9876  b5ec		       68		      PLA
   9877  b5ed		       85 4b		      STA	current_line_no_msb
   9878  b5ef		       68		      PLA
   9879  b5f0		       85 4a		      STA	current_line_no_lsb
   9880  b5f2		       a5 1e		      LDA	unk_1E
   9881  b5f4		       d0 05		      BNE	locret_B5FB
   9882  b5f6		       a9 13		      LDA	#$13
   9883  b5f8		       4c 9d 85 	      JMP	loc_859D
   9884  b5fb
   9885  b5fb				   locret_B5FB
   9886  b5fb		       60		      RTS
   9887  b5fc
   9888  b5fc				   label_edit_mode_command
   9889  b5fc		       a9 13		      LDA	#$13
   9890  b5fe		       48		      PHA
   9891  b5ff		       a9 b3		      LDA	#-$4D	;	'³'
   9892  b601		       8d b1 06 	      STA	unk_6B1
   9893  b604		       a9 b5		      LDA	#-$4B	;	'µ'
   9894  b606		       8d b2 06 	      STA	unk_6B2
   9895  b609		       d0 0d		      BNE	loc_B618
   9896  b60b
   9897  b60b				   number_edit_mode_command
   9898  b60b		       a9 0f		      LDA	#$F
   9899  b60d		       48		      PHA
   9900  b60e		       a9 ab		      LDA	#-$55	;	'«'
   9901  b610		       8d b1 06 	      STA	unk_6B1
   9902  b613		       a9 b3		      LDA	#-$4D	;	'³'
   9903  b615		       8d b2 06 	      STA	unk_6B2
   9904  b618
   9905  b618				   loc_B618
   9906  b618		       20 e9 9f 	      JSR	is_program_empty	; sets	C if no	program
   9907  b61b		       68		      PLA
   9908  b61c		       90 03		      BCC	loc_B621
   9909  b61e		       4c 9d 85 	      JMP	loc_859D
   9910  b621
   9911  b621				   loc_B621
   9912  b621		       ad c0 06 	      LDA	byte_6C0
   9913  b624		       85 39		      STA	byte_39
   9914  b626		       ad c1 06 	      LDA	byte_6C1
   9915  b629		       85 3a		      STA	byte_3A
   9916  b62b		       a0 01		      LDY	#1
   9917  b62d		       b1 39		      LDA	($39),Y
   9918  b62f		       48		      PHA
   9919  b630		       c8		      INY
   9920  b631		       b1 39		      LDA	($39),Y
   9921  b633		       48		      PHA
   9922  b634		       a9 01		      LDA	#1
   9923  b636		       8d b7 06 	      STA	editor_mode_id	; 1=command mode, 2=edit mode
   9924  b639		       20 ab 9b 	      JSR	make_cursor_invisible
   9925  b63c		       20 b0 06 	      JSR	unk_6B0
   9926  b63f		       a9 02		      LDA	#2
   9927  b641		       8d b7 06 	      STA	editor_mode_id	; 1=command mode, 2=edit mode
   9928  b644		       68		      PLA
   9929  b645		       85 2c		      STA	byte_2C
   9930  b647		       68		      PLA
   9931  b648		       85 2b		      STA	byte_2B
   9932  b64a		       20 8f 9e 	      JSR	find_line_by_number	; finds a line, given a line number
   9933  b64d							;
   9934  b64d							; Entry:
   9935  b64d							; byte_2B: line	number MSB
   9936  b64d							; byte_2C: line	number LSB
   9937  b64d							;
   9938  b64d							; Exit:
   9939  b64d							; (byte_2B) points to most suitable line
   9940  b64d		       a5 2b		      LDA	byte_2B
   9941  b64f		       8d c0 06 	      STA	byte_6C0
   9942  b652		       a5 2c		      LDA	byte_2C
   9943  b654		       8d c1 06 	      STA	byte_6C1
   9944  b657		       4c 7a 96 	      JMP	loc_967A
   9945  b65a
   9946  b65a				   loc_B65A
   9947  b65a		       a5 2b		      LDA	byte_2B
   9948  b65c		       85 0c		      STA	byte_C
   9949  b65e		       a5 2c		      LDA	byte_2C
   9950  b660		       85 0d		      STA	byte_D
   9951  b662		       a9 00		      LDA	#0
   9952  b664		       85 0e		      STA	byte_E
   9953  b666		       a9 05		      LDA	#5
   9954  b668		       85 0f		      STA	byte_F
   9955  b66a		       a2 00		      LDX	#0
   9956  b66c		       a0 03		      LDY	#3
   9957  b66e		       b1 2b		      LDA	($2B),Y
   9958  b670		       a8		      TAY
   9959  b671		       c8		      INY
   9960  b672		       d0 01		      BNE	loc_B675
   9961  b674		       e8		      INX
   9962  b675
   9963  b675				   loc_B675
   9964  b675		       20 a1 8e 	      JSR	memmove	; move (maybe overlapping) memory regions.
   9965  b678							;
   9966  b678							; Entry:
   9967  b678							; (byte_C) points to src
   9968  b678							; (byte_E) points to dest
   9969  b678							; X is MSB of size
   9970  b678							; Y is LSB of size
   9971  b678		       a0 00		      LDY	#0
   9972  b67a		       84 37		      STY	unk_37
   9973  b67c		       84 11		      STY	unk_11
   9974  b67e		       c8		      INY
   9975  b67f		       84 10		      STY	cursor_offset	; offset of cursor in detokenized buffer
   9976  b681		       a9 04		      LDA	#4
   9977  b683		       85 1f		      STA	unk_1F
   9978  b685		       a9 05		      LDA	#5
   9979  b687		       85 20		      STA	byte_20
   9980  b689
   9981  b689				   loc_B689
   9982  b689		       38		      SEC
   9983  b68a		       ad 03 05 	      LDA	unk_503
   9984  b68d		       e9 07		      SBC	#7
   9985  b68f		       90 04		      BCC	loc_B695
   9986  b691		       c5 10		      CMP	cursor_offset	; offset of cursor in detokenized buffer
   9987  b693		       b0 03		      BCS	loc_B698
   9988  b695
   9989  b695				   loc_B695
   9990  b695		       4c d4 b5 	      JMP	loc_B5D4
   9991  b698
   9992  b698				   loc_B698
   9993  b698		       a0 00		      LDY	#0
   9994  b69a		       b1 1f		      LDA	($1F),Y
   9995  b69c		       c9 22		      CMP	#$22	; '"'
   9996  b69e		       d0 06		      BNE	loc_B6A6
   9997  b6a0		       a5 37		      LDA	unk_37
   9998  b6a2		       49 01		      EOR	#1
   9999  b6a4		       85 37		      STA	unk_37
  10000  b6a6
  10001  b6a6				   loc_B6A6
  10002  b6a6		       a6 37		      LDX	unk_37
  10003  b6a8		       f0 03		      BEQ	loc_B6AD
  10004  b6aa
  10005  b6aa				   loc_B6AA
  10006  b6aa		       4c 8c b7 	      JMP	loc_B78C
  10007  b6ad
  10008  b6ad				   loc_B6AD
  10009  b6ad		       b1 1f		      LDA	($1F),Y
  10010  b6af		       c9 8d		      CMP	#-$73	;	''
  10011  b6b1		       d0 f7		      BNE	loc_B6AA
  10012  b6b3		       a5 1f		      LDA	unk_1F
  10013  b6b5		       85 27		      STA	byte_27
  10014  b6b7		       a5 20		      LDA	byte_20
  10015  b6b9		       85 28		      STA	byte_28
  10016  b6bb		       a0 00		      LDY	#0
  10017  b6bd		       20 12 9d 	      JSR	decode_line_number	; decode line number	from program.
  10018  b6c0							;
  10019  b6c0							; Entry:
  10020  b6c0							; (unk_27),Y points to 8D token
  10021  b6c0							;
  10022  b6c0							; Exit:
  10023  b6c0							; unk_21.w is line number.
  10024  b6c0		       a5 2b		      LDA	byte_2B
  10025  b6c2		       48		      PHA
  10026  b6c3		       a5 2c		      LDA	byte_2C
  10027  b6c5		       48		      PHA
  10028  b6c6		       a5 21		      LDA	byte_21
  10029  b6c8		       85 2b		      STA	byte_2B
  10030  b6ca		       a5 22		      LDA	byte_22
  10031  b6cc		       85 2c		      STA	byte_2C
  10032  b6ce		       20 8f 9e 	      JSR	find_line_by_number	; finds a line, given a line number
  10033  b6d1							;
  10034  b6d1							; Entry:
  10035  b6d1							; byte_2B: line	number MSB
  10036  b6d1							; byte_2C: line	number LSB
  10037  b6d1							;
  10038  b6d1							; Exit:
  10039  b6d1							; (byte_2B) points to most suitable line
  10040  b6d1		       4c df b6 	      JMP	loc_B6DF
  10041  b6d4
  10042  b6d4				   loc_B6D4
  10043  b6d4		       68		      PLA
  10044  b6d5		       85 2c		      STA	byte_2C
  10045  b6d7		       68		      PLA
  10046  b6d8		       85 2b		      STA	byte_2B
  10047  b6da
  10048  b6da				   loc_B6DA
  10049  b6da		       a2 04		      LDX	#4
  10050  b6dc		       4c 8e b7 	      JMP	loc_B78E
  10051  b6df
  10052  b6df				   loc_B6DF
  10053  b6df		       a0 01		      LDY	#1
  10054  b6e1		       b1 2b		      LDA	($2B),Y
  10055  b6e3		       c5 21		      CMP	byte_21
  10056  b6e5		       d0 ed		      BNE	loc_B6D4
  10057  b6e7		       c8		      INY
  10058  b6e8		       b1 2b		      LDA	($2B),Y
  10059  b6ea		       c5 22		      CMP	byte_22
  10060  b6ec		       d0 e6		      BNE	loc_B6D4
  10061  b6ee		       20 77 aa 	      JSR	sub_AA77	; swap byte_2B with unk_2F, swap byte_2C with unk_30
  10062  b6f1		       68		      PLA
  10063  b6f2		       85 2c		      STA	byte_2C
  10064  b6f4		       68		      PLA
  10065  b6f5		       85 2b		      STA	byte_2B
  10066  b6f7		       a0 04		      LDY	#4
  10067  b6f9
  10068  b6f9				   loc_B6F9
  10069  b6f9		       b1 2f		      LDA	($2F),Y
  10070  b6fb		       c9 20		      CMP	#$20	; ' '
  10071  b6fd		       d0 04		      BNE	loc_B703
  10072  b6ff		       c8		      INY
  10073  b700		       4c f9 b6 	      JMP	loc_B6F9
  10074  b703
  10075  b703				   loc_B703
  10076  b703		       c9 f4		      CMP	#-$C	; 'ô'
  10077  b705		       d0 d3		      BNE	loc_B6DA
  10078  b707		       c8		      INY
  10079  b708
  10080  b708				   loc_B708
  10081  b708		       b1 2f		      LDA	($2F),Y
  10082  b70a		       c9 20		      CMP	#$20	; ' '
  10083  b70c		       d0 04		      BNE	loc_B712
  10084  b70e		       c8		      INY
  10085  b70f		       4c 08 b7 	      JMP	loc_B708
  10086  b712
  10087  b712				   loc_B712
  10088  b712		       c9 40		      CMP	#$40	; '@'
  10089  b714		       d0 c4		      BNE	loc_B6DA
  10090  b716		       a2 01		      LDX	#1
  10091  b718		       18		      CLC
  10092  b719		       98		      TYA
  10093  b71a		       a0 00		      LDY	#0
  10094  b71c		       65 2f		      ADC	unk_2F
  10095  b71e		       85 2f		      STA	unk_2F
  10096  b720		       90 02		      BCC	loc_B724
  10097  b722		       e6 30		      INC	unk_30
  10098  b724
  10099  b724				   loc_B724
  10100  b724		       c8		      INY
  10101  b725		       b1 2f		      LDA	($2F),Y
  10102  b727		       20 84 b4 	      JSR	sub_B484
  10103  b72a		       90 03		      BCC	loc_B72F
  10104  b72c		       e8		      INX
  10105  b72d		       d0 f5		      BNE	loc_B724
  10106  b72f
  10107  b72f				   loc_B72F
  10108  b72f		       e0 01		      CPX	#1
  10109  b731		       f0 a7		      BEQ	loc_B6DA
  10110  b733		       86 36		      STX	byte_36
  10111  b735		       38		      SEC
  10112  b736		       ad 03 05 	      LDA	unk_503
  10113  b739		       e9 04		      SBC	#4
  10114  b73b		       18		      CLC
  10115  b73c		       65 36		      ADC	byte_36
  10116  b73e		       90 05		      BCC	loc_B745
  10117  b740		       a9 12		      LDA	#$12
  10118  b742		       4c 9d 85 	      JMP	loc_859D
  10119  b745
  10120  b745				   loc_B745
  10121  b745		       8d 03 05 	      STA	unk_503
  10122  b748		       18		      CLC
  10123  b749		       a5 1f		      LDA	unk_1F
  10124  b74b		       69 04		      ADC	#4
  10125  b74d		       85 0c		      STA	byte_C
  10126  b74f		       a5 20		      LDA	byte_20
  10127  b751		       85 0d		      STA	byte_D
  10128  b753		       85 0f		      STA	byte_F
  10129  b755		       18		      CLC
  10130  b756		       a5 1f		      LDA	unk_1F
  10131  b758		       65 36		      ADC	byte_36
  10132  b75a		       85 0e		      STA	byte_E
  10133  b75c		       38		      SEC
  10134  b75d		       ad 03 05 	      LDA	unk_503
  10135  b760		       e5 36		      SBC	byte_36
  10136  b762		       e5 10		      SBC	cursor_offset	; offset of cursor in detokenized buffer
  10137  b764		       e9 02		      SBC	#2
  10138  b766		       a8		      TAY
  10139  b767		       a2 00		      LDX	#0
  10140  b769		       20 a1 8e 	      JSR	memmove	; move (maybe overlapping) memory regions.
  10141  b76c							;
  10142  b76c							; Entry:
  10143  b76c							; (byte_C) points to src
  10144  b76c							; (byte_E) points to dest
  10145  b76c							; X is MSB of size
  10146  b76c							; Y is LSB of size
  10147  b76c		       a5 2f		      LDA	unk_2F
  10148  b76e		       85 0c		      STA	byte_C
  10149  b770		       a5 30		      LDA	unk_30
  10150  b772		       85 0d		      STA	byte_D
  10151  b774		       a5 1f		      LDA	unk_1F
  10152  b776		       85 0e		      STA	byte_E
  10153  b778		       a5 20		      LDA	byte_20
  10154  b77a		       85 0f		      STA	byte_F
  10155  b77c		       a4 36		      LDY	byte_36
  10156  b77e		       a2 00		      LDX	#0
  10157  b780		       20 a1 8e 	      JSR	memmove	; move (maybe overlapping) memory regions.
  10158  b783							;
  10159  b783							; Entry:
  10160  b783							; (byte_C) points to src
  10161  b783							; (byte_E) points to dest
  10162  b783							; X is MSB of size
  10163  b783							; Y is LSB of size
  10164  b783		       a6 36		      LDX	byte_36
  10165  b785		       8e b3 06 	      STX	byte_6B3
  10166  b788		       86 1e		      STX	unk_1E
  10167  b78a		       d0 02		      BNE	loc_B78E
  10168  b78c
  10169  b78c				   loc_B78C
  10170  b78c		       a2 01		      LDX	#1
  10171  b78e
  10172  b78e				   loc_B78E
  10173  b78e		       8a		      TXA
  10174  b78f		       18		      CLC
  10175  b790		       65 10		      ADC	cursor_offset	; offset of cursor in detokenized buffer
  10176  b792		       85 10		      STA	cursor_offset	; offset of cursor in detokenized buffer
  10177  b794		       8a		      TXA
  10178  b795		       18		      CLC
  10179  b796		       65 1f		      ADC	unk_1F
  10180  b798		       85 1f		      STA	unk_1F
  10181  b79a		       90 02		      BCC	loc_B79E
  10182  b79c		       e6 20		      INC	byte_20
  10183  b79e
  10184  b79e				   loc_B79E
  10185  b79e		       4c 89 b6 	      JMP	loc_B689
  10186  b7a1
  10187  b7a1
  10188  b7a1
  10189  b7a1				   sub_B7A1
  10190  b7a1
  10191  b7a1		       20 51 a0 	      JSR	is_line_empty	; determines whether current line is empty.
  10192  b7a4							;
  10193  b7a4							; Entry:
  10194  b7a4							; detokenized line at $400...
  10195  b7a4							;
  10196  b7a4							; Exit:
  10197  b7a4							; C set	if line	empty.
  10198  b7a4		       90 05		      BCC	loc_B7AB
  10199  b7a6		       a5 3d		      LDA	scroll_status	; 1=scroll, 0=noscroll
  10200  b7a8		       d0 0d		      BNE	loc_B7B7
  10201  b7aa		       60		      RTS
  10202  b7ab
  10203  b7ab				   loc_B7AB
  10204  b7ab		       a5 3d		      LDA	scroll_status	; 1=scroll, 0=noscroll
  10205  b7ad		       d0 03		      BNE	loc_B7B2
  10206  b7af		       4c 9a b8 	      JMP	loc_B89A
  10207  b7b2
  10208  b7b2				   loc_B7B2
  10209  b7b2		       20 e9 9f 	      JSR	is_program_empty	; sets	C if no	program
  10210  b7b5		       90 03		      BCC	loc_B7BA
  10211  b7b7
  10212  b7b7				   loc_B7B7
  10213  b7b7		       4c d8 9a 	      JMP	edit_mode_loop
  10214  b7ba
  10215  b7ba				   loc_B7BA
  10216  b7ba		       20 77 aa 	      JSR	sub_AA77	; swap byte_2B with unk_2F, swap byte_2C with unk_30
  10217  b7bd		       a9 00		      LDA	#0
  10218  b7bf		       85 2b		      STA	byte_2B
  10219  b7c1		       85 2c		      STA	byte_2C
  10220  b7c3		       85 36		      STA	byte_36
  10221  b7c5		       20 69 ba 	      JSR	sub_BA69
  10222  b7c8		       8a		      TXA
  10223  b7c9		       20 77 aa 	      JSR	sub_AA77	; swap byte_2B with unk_2F, swap byte_2C with unk_30
  10224  b7cc		       aa		      TAX
  10225  b7cd		       bd bf 06 	      LDA	$6BF,X
  10226  b7d0		       c5 2c		      CMP	byte_2C
  10227  b7d2		       d0 09		      BNE	loc_B7DD
  10228  b7d4		       bd be 06 	      LDA	$6BE,X
  10229  b7d7		       c5 2b		      CMP	byte_2B
  10230  b7d9		       d0 02		      BNE	loc_B7DD
  10231  b7db		       e6 36		      INC	byte_36
  10232  b7dd
  10233  b7dd				   loc_B7DD
  10234  b7dd		       a0 03		      LDY	#3
  10235  b7df		       18		      CLC
  10236  b7e0		       a5 2b		      LDA	byte_2B
  10237  b7e2		       71 2b		      ADC	($2B),Y
  10238  b7e4		       85 0c		      STA	byte_C
  10239  b7e6		       a5 2c		      LDA	byte_2C
  10240  b7e8		       69 00		      ADC	#0
  10241  b7ea		       85 0d		      STA	byte_D
  10242  b7ec		       a0 01		      LDY	#1
  10243  b7ee		       b1 0c		      LDA	($C),Y
  10244  b7f0		       30 c5		      BMI	loc_B7B7
  10245  b7f2		       a5 2d		      LDA	byte_2D
  10246  b7f4		       85 34		      STA	unk_34
  10247  b7f6		       20 c0 a8 	      JSR	sub_A8C0
  10248  b7f9		       20 c3 9e 	      JSR	get_line_height	; get height of	current	line
  10249  b7fc							;
  10250  b7fc							; Entry:
  10251  b7fc							; ?byte_400 = line length
  10252  b7fc							;
  10253  b7fc							; Exit:
  10254  b7fc							; X = line height
  10255  b7fc		       86 37		      STX	unk_37
  10256  b7fe		       86 35		      STX	byte_35
  10257  b800		       a5 2b		      LDA	byte_2B
  10258  b802		       48		      PHA
  10259  b803		       a5 2c		      LDA	byte_2C
  10260  b805		       48		      PHA
  10261  b806		       20 52 92 	      JSR	advance_2b_to_next_line
  10262  b809		       20 39 a0 	      JSR	save_line_number	; saves line number from program.
  10263  b80c							;
  10264  b80c							; Entry:
  10265  b80c							; (byte_2b) points to current line
  10266  b80c							;
  10267  b80c							; Exit:
  10268  b80c							; current_line_no_lsb, current_line_no_msb = the line number
  10269  b80c		       20 08 9c 	      JSR	detokenize_one_line
  10270  b80f		       20 1e a0 	      JSR	sub_A01E
  10271  b812		       18		      CLC
  10272  b813		       a5 2d		      LDA	byte_2D
  10273  b815		       65 37		      ADC	unk_37
  10274  b817		       65 3b		      ADC	byte_3B
  10275  b819		       38		      SEC
  10276  b81a		       e9 01		      SBC	#1
  10277  b81c		       38		      SEC
  10278  b81d		       ed bf 06 	      SBC	screen_height
  10279  b820		       85 37		      STA	unk_37
  10280  b822		       f0 02		      BEQ	loc_B826
  10281  b824		       10 03		      BPL	loc_B829
  10282  b826
  10283  b826				   loc_B826
  10284  b826		       4c 2c b8 	      JMP	loc_B82C
  10285  b829
  10286  b829				   loc_B829
  10287  b829		       20 bd b8 	      JSR	sub_B8BD
  10288  b82c
  10289  b82c				   loc_B82C
  10290  b82c		       a5 37		      LDA	unk_37
  10291  b82e		       f0 02		      BEQ	loc_B832
  10292  b830		       10 2b		      BPL	loc_B85D
  10293  b832
  10294  b832				   loc_B832
  10295  b832		       a5 36		      LDA	byte_36
  10296  b834		       d0 27		      BNE	loc_B85D
  10297  b836		       ad b3 06 	      LDA	byte_6B3
  10298  b839		       f0 17		      BEQ	loc_B852
  10299  b83b		       68		      PLA
  10300  b83c		       85 2c		      STA	byte_2C
  10301  b83e		       68		      PLA
  10302  b83f		       85 2b		      STA	byte_2B
  10303  b841		       20 39 a0 	      JSR	save_line_number	; saves line number from program.
  10304  b844							;
  10305  b844							; Entry:
  10306  b844							; (byte_2b) points to current line
  10307  b844							;
  10308  b844							; Exit:
  10309  b844							; current_line_no_lsb, current_line_no_msb = the line number
  10310  b844		       20 08 9c 	      JSR	detokenize_one_line
  10311  b847		       a6 34		      LDX	unk_34
  10312  b849		       20 21 a0 	      JSR	loc_A021
  10313  b84c		       20 17 aa 	      JSR	sub_AA17
  10314  b84f		       4c 9d b8 	      JMP	loc_B89D
  10315  b852
  10316  b852				   loc_B852
  10317  b852		       a5 35		      LDA	byte_35
  10318  b854		       c5 34		      CMP	unk_34
  10319  b856		       d0 28		      BNE	loc_B880
  10320  b858
  10321  b858				   loc_B858
  10322  b858		       68		      PLA
  10323  b859		       68		      PLA
  10324  b85a		       4c 9d b8 	      JMP	loc_B89D
  10325  b85d
  10326  b85d				   loc_B85D
  10327  b85d		       ad b3 06 	      LDA	byte_6B3
  10328  b860		       f0 1e		      BEQ	loc_B880
  10329  b862		       68		      PLA
  10330  b863		       85 2c		      STA	byte_2C
  10331  b865		       68		      PLA
  10332  b866		       85 2b		      STA	byte_2B
  10333  b868		       20 39 a0 	      JSR	save_line_number	; saves line number from program.
  10334  b86b							;
  10335  b86b							; Entry:
  10336  b86b							; (byte_2b) points to current line
  10337  b86b							;
  10338  b86b							; Exit:
  10339  b86b							; current_line_no_lsb, current_line_no_msb = the line number
  10340  b86b		       a5 4a		      LDA	current_line_no_lsb
  10341  b86d		       85 2b		      STA	byte_2B
  10342  b86f		       a5 4b		      LDA	current_line_no_msb
  10343  b871		       85 2c		      STA	byte_2C
  10344  b873		       a5 3b		      LDA	byte_3B
  10345  b875		       48		      PHA
  10346  b876		       38		      SEC
  10347  b877		       20 ea 9d 	      JSR	sub_9DEA
  10348  b87a		       68		      PLA
  10349  b87b		       85 3b		      STA	byte_3B
  10350  b87d		       4c 9d b8 	      JMP	loc_B89D
  10351  b880
  10352  b880				   loc_B880
  10353  b880		       18		      CLC
  10354  b881		       a5 3b		      LDA	byte_3B
  10355  b883		       48		      PHA
  10356  b884		       65 35		      ADC	byte_35
  10357  b886		       85 3b		      STA	byte_3B
  10358  b888		       a5 4a		      LDA	current_line_no_lsb
  10359  b88a		       85 2b		      STA	byte_2B
  10360  b88c		       a5 4b		      LDA	current_line_no_msb
  10361  b88e		       85 2c		      STA	byte_2C
  10362  b890		       38		      SEC
  10363  b891		       20 ea 9d 	      JSR	sub_9DEA
  10364  b894		       68		      PLA
  10365  b895		       85 3b		      STA	byte_3B
  10366  b897		       4c 58 b8 	      JMP	loc_B858
  10367  b89a
  10368  b89a				   loc_B89A
  10369  b89a		       20 06 aa 	      JSR	sub_AA06
  10370  b89d
  10371  b89d				   loc_B89D
  10372  b89d		       a5 3b		      LDA	byte_3B
  10373  b89f		       0a		      ASL
  10374  b8a0		       aa		      TAX
  10375  b8a1		       e8		      INX
  10376  b8a2		       bc c0 06 	      LDY	$6C0,X
  10377  b8a5		       d0 07		      BNE	loc_B8AE
  10378  b8a7		       88		      DEY
  10379  b8a8		       84 4a		      STY	current_line_no_lsb
  10380  b8aa		       84 4b		      STY	current_line_no_msb
  10381  b8ac		       d0 0c		      BNE	loc_B8BA
  10382  b8ae
  10383  b8ae				   loc_B8AE
  10384  b8ae		       20 45 a0 	      JSR	get_line_ptr	; gets pointer to line visible on screen.
  10385  b8b1							;
  10386  b8b1							; Entry:
  10387  b8b1							; X = screen line number * 2 + 1
  10388  b8b1							;
  10389  b8b1							; Exit:
  10390  b8b1							; (byte_2B) points to BASIC line
  10391  b8b1							; X decremented
  10392  b8b1		       20 39 a0 	      JSR	save_line_number	; saves line number from program.
  10393  b8b4							;
  10394  b8b4							; Entry:
  10395  b8b4							; (byte_2b) points to current line
  10396  b8b4							;
  10397  b8b4							; Exit:
  10398  b8b4							; current_line_no_lsb, current_line_no_msb = the line number
  10399  b8b4		       e6 4b		      INC	current_line_no_msb
  10400  b8b6		       d0 02		      BNE	loc_B8BA
  10401  b8b8		       e6 4a		      INC	current_line_no_lsb
  10402  b8ba
  10403  b8ba				   loc_B8BA
  10404  b8ba
  10405  b8ba		       4c 69 a0 	      JMP	sub_A069
  10406  b8bd							; End of function sub_B7A1
  10407  b8bd
  10408  b8bd
  10409  b8bd
  10410  b8bd
  10411  b8bd				   sub_B8BD
  10412  b8bd		       38		      SEC
  10413  b8be		       a5 37		      LDA	unk_37
  10414  b8c0		       e9 01		      SBC	#1
  10415  b8c2		       0a		      ASL
  10416  b8c3		       aa		      TAX
  10417  b8c4		       a8		      TAY
  10418  b8c5
  10419  b8c5				   loc_B8C5
  10420  b8c5		       c8		      INY
  10421  b8c6		       c8		      INY
  10422  b8c7		       bd c0 06 	      LDA	$6C0,X
  10423  b8ca		       d9 c0 06 	      CMP	$6C0,Y
  10424  b8cd		       d0 0c		      BNE	loc_B8DB
  10425  b8cf		       bd c1 06 	      LDA	$6C1,X
  10426  b8d2		       d9 c1 06 	      CMP	$6C1,Y
  10427  b8d5		       d0 04		      BNE	loc_B8DB
  10428  b8d7		       e6 37		      INC	unk_37
  10429  b8d9		       d0 ea		      BNE	loc_B8C5
  10430  b8db
  10431  b8db				   loc_B8DB
  10432  b8db		       18		      CLC
  10433  b8dc		       98		      TYA
  10434  b8dd		       69 c0		      ADC	#-$40	;	'À'
  10435  b8df		       85 0c		      STA	byte_C
  10436  b8e1		       a9 06		      LDA	#6
  10437  b8e3		       85 0f		      STA	byte_F
  10438  b8e5		       69 00		      ADC	#0
  10439  b8e7		       85 0d		      STA	byte_D
  10440  b8e9		       a9 c0		      LDA	#-$40	;	'À'
  10441  b8eb		       85 0e		      STA	byte_E
  10442  b8ed		       18		      CLC
  10443  b8ee		       ad bf 06 	      LDA	screen_height
  10444  b8f1		       69 01		      ADC	#1
  10445  b8f3		       38		      SEC
  10446  b8f4		       e5 37		      SBC	unk_37
  10447  b8f6		       0a		      ASL
  10448  b8f7		       a8		      TAY
  10449  b8f8		       a2 00		      LDX	#0
  10450  b8fa		       20 a1 8e 	      JSR	memmove	; move (maybe overlapping) memory regions.
  10451  b8fd							;
  10452  b8fd							; Entry:
  10453  b8fd							; (byte_C) points to src
  10454  b8fd							; (byte_E) points to dest
  10455  b8fd							; X is MSB of size
  10456  b8fd							; Y is LSB of size
  10457  b8fd		       20 ab 9b 	      JSR	make_cursor_invisible
  10458  b900		       a2 00		      LDX	#0
  10459  b902		       ac bf 06 	      LDY	screen_height
  10460  b905		       8c ab 06 	      STY	byte_6AB
  10461  b908		       20 01 8f 	      JSR	gotoxy
  10462  b90b		       a9 13		      LDA	#$13
  10463  b90d		       20 f4 ff 	      JSR	OSBYTE
  10464  b910		       a4 37		      LDY	unk_37
  10465  b912		       a9 0a		      LDA	#$A
  10466  b914
  10467  b914				   loc_B914
  10468  b914		       20 ee ff 	      JSR	OSWRCH
  10469  b917		       88		      DEY
  10470  b918		       d0 fa		      BNE	loc_B914
  10471  b91a		       38		      SEC
  10472  b91b		       a5 3b		      LDA	byte_3B
  10473  b91d		       e5 37		      SBC	unk_37
  10474  b91f		       85 3b		      STA	byte_3B
  10475  b921		       60		      RTS
  10476  b922							; End of function sub_B8BD
  10477  b922
  10478  b922
  10479  b922				   join_statements_edit_mode_command
  10480  b922		       20 e9 9f 	      JSR	is_program_empty	; sets	C if no	program
  10481  b925		       90 03		      BCC	loc_B92A
  10482  b927
  10483  b927				   loc_B927
  10484  b927		       4c 69 9f 	      JMP	beep
  10485  b92a
  10486  b92a				   loc_B92A
  10487  b92a		       a0 03		      LDY	#3
  10488  b92c							; set (byte_C) to point at next line
  10489  b92c		       18		      CLC
  10490  b92d		       b1 2b		      LDA	(byte_2B),Y
  10491  b92f		       65 2b		      ADC	byte_2B
  10492  b931		       85 0c		      STA	byte_C
  10493  b933		       a5 2c		      LDA	byte_2C
  10494  b935		       69 00		      ADC	#0
  10495  b937		       85 0d		      STA	byte_D
  10496  b939		       a0 01		      LDY	#1
  10497  b93b		       b1 0c		      LDA	(byte_C),Y
  10498  b93d		       30 e8		      BMI	loc_B927	; branch taken if next line is end of program
  10499  b93f		       20 c0 a8 	      JSR	sub_A8C0
  10500  b942		       a5 2b		      LDA	byte_2B
  10501  b944		       48		      PHA
  10502  b945		       a5 2c		      LDA	byte_2C
  10503  b947		       48		      PHA
  10504  b948		       20 52 92 	      JSR	advance_2b_to_next_line
  10505  b94b		       20 39 a0 	      JSR	save_line_number	; saves line number from program.
  10506  b94e							;
  10507  b94e							; Entry:
  10508  b94e							; (byte_2b) points to current line
  10509  b94e							;
  10510  b94e							; Exit:
  10511  b94e							; current_line_no_lsb, current_line_no_msb = the line number
  10512  b94e		       20 08 9c 	      JSR	detokenize_one_line
  10513  b951		       20 56 ba 	      JSR	rstrip_detokenized_line
  10514  b954		       ad 00 04 	      LDA	byte_400
  10515  b957		       8d 00 07 	      STA	unk_700
  10516  b95a		       f0 2b		      BEQ	loc_B987
  10517  b95c		       a9 01		      LDA	#1
  10518  b95e		       85 0c		      STA	byte_C
  10519  b960		       a9 04		      LDA	#4
  10520  b962		       85 0d		      STA	byte_D
  10521  b964		       a0 00		      LDY	#0
  10522  b966
  10523  b966				   loc_B966
  10524  b966		       b1 0c		      LDA	($C),Y
  10525  b968		       c9 20		      CMP	#$20	; ' '
  10526  b96a		       d0 0b		      BNE	loc_B977
  10527  b96c		       ce 00 07 	      DEC	unk_700
  10528  b96f		       e6 0c		      INC	byte_C
  10529  b971		       d0 02		      BNE	loc_B975
  10530  b973		       e6 0d		      INC	byte_D
  10531  b975
  10532  b975				   loc_B975
  10533  b975		       d0 ef		      BNE	loc_B966
  10534  b977
  10535  b977				   loc_B977
  10536  b977		       a9 01		      LDA	#1
  10537  b979		       85 0e		      STA	byte_E
  10538  b97b		       a9 07		      LDA	#7
  10539  b97d		       85 0f		      STA	byte_F
  10540  b97f		       a2 00		      LDX	#0
  10541  b981		       ac 00 07 	      LDY	unk_700
  10542  b984		       20 a1 8e 	      JSR	memmove	; move (maybe overlapping) memory regions.
  10543  b987							;
  10544  b987							; Entry:
  10545  b987							; (byte_C) points to src
  10546  b987							; (byte_E) points to dest
  10547  b987							; X is MSB of size
  10548  b987							; Y is LSB of size
  10549  b987
  10550  b987				   loc_B987
  10551  b987		       68		      PLA
  10552  b988		       85 2c		      STA	byte_2C
  10553  b98a		       68		      PLA
  10554  b98b		       85 2b		      STA	byte_2B
  10555  b98d		       20 39 a0 	      JSR	save_line_number	; saves line number from program.
  10556  b990							;
  10557  b990							; Entry:
  10558  b990							; (byte_2b) points to current line
  10559  b990							;
  10560  b990							; Exit:
  10561  b990							; current_line_no_lsb, current_line_no_msb = the line number
  10562  b990		       20 08 9c 	      JSR	detokenize_one_line
  10563  b993		       20 56 ba 	      JSR	rstrip_detokenized_line
  10564  b996		       ad 00 07 	      LDA	unk_700
  10565  b999		       f0 4a		      BEQ	loc_B9E5
  10566  b99b		       18		      CLC
  10567  b99c		       6d 00 04 	      ADC	byte_400
  10568  b99f		       b0 0c		      BCS	loc_B9AD
  10569  b9a1		       85 37		      STA	unk_37
  10570  b9a3		       ae 00 04 	      LDX	byte_400
  10571  b9a6		       f0 1c		      BEQ	loc_B9C4
  10572  b9a8		       18		      CLC
  10573  b9a9		       69 01		      ADC	#1
  10574  b9ab		       90 05		      BCC	loc_B9B2
  10575  b9ad
  10576  b9ad				   loc_B9AD
  10577  b9ad		       a9 14		      LDA	#$14
  10578  b9af		       4c 9d 85 	      JMP	loc_859D
  10579  b9b2
  10580  b9b2				   loc_B9B2
  10581  b9b2		       c9 fc		      CMP	#-4	; 'ü'
  10582  b9b4		       b0 f7		      BCS	loc_B9AD
  10583  b9b6		       85 37		      STA	unk_37
  10584  b9b8		       a9 3a		      LDA	#$3A	; ':'
  10585  b9ba		       ac 00 04 	      LDY	byte_400
  10586  b9bd		       99 01 04 	      STA	$401,Y
  10587  b9c0		       c8		      INY
  10588  b9c1		       8c 00 04 	      STY	byte_400
  10589  b9c4
  10590  b9c4				   loc_B9C4
  10591  b9c4		       18		      CLC
  10592  b9c5		       ad 00 04 	      LDA	byte_400
  10593  b9c8		       69 01		      ADC	#1
  10594  b9ca		       85 0e		      STA	byte_E
  10595  b9cc		       a9 04		      LDA	#4
  10596  b9ce		       85 0f		      STA	byte_F
  10597  b9d0		       a9 01		      LDA	#1
  10598  b9d2		       85 0c		      STA	byte_C
  10599  b9d4		       a9 07		      LDA	#7
  10600  b9d6		       85 0d		      STA	byte_D
  10601  b9d8		       a2 00		      LDX	#0
  10602  b9da		       ac 00 07 	      LDY	unk_700
  10603  b9dd		       20 a1 8e 	      JSR	memmove	; move (maybe overlapping) memory regions.
  10604  b9e0							;
  10605  b9e0							; Entry:
  10606  b9e0							; (byte_C) points to src
  10607  b9e0							; (byte_E) points to dest
  10608  b9e0							; X is MSB of size
  10609  b9e0							; Y is LSB of size
  10610  b9e0		       a5 37		      LDA	unk_37
  10611  b9e2		       8d 00 04 	      STA	byte_400
  10612  b9e5
  10613  b9e5				   loc_B9E5
  10614  b9e5		       a9 00		      LDA	#0
  10615  b9e7		       8d a7 06 	      STA	byte_6A7
  10616  b9ea		       a9 01		      LDA	#1
  10617  b9ec		       8d b3 06 	      STA	byte_6B3
  10618  b9ef		       20 c0 a8 	      JSR	sub_A8C0
  10619  b9f2		       a9 01		      LDA	#1
  10620  b9f4		       8d a7 06 	      STA	byte_6A7
  10621  b9f7		       20 1f 83 	      JSR	find_program
  10622  b9fa		       20 52 92 	      JSR	advance_2b_to_next_line
  10623  b9fd		       a5 2b		      LDA	byte_2B
  10624  b9ff		       85 0e		      STA	byte_E
  10625  ba01		       a5 2c		      LDA	byte_2C
  10626  ba03		       85 0f		      STA	byte_F
  10627  ba05		       20 52 92 	      JSR	advance_2b_to_next_line
  10628  ba08		       a5 2b		      LDA	byte_2B
  10629  ba0a		       85 0c		      STA	byte_C
  10630  ba0c		       a5 2c		      LDA	byte_2C
  10631  ba0e		       85 0d		      STA	byte_D
  10632  ba10		       38		      SEC
  10633  ba11		       a5 12		      LDA	TOP
  10634  ba13		       e5 0c		      SBC	byte_C
  10635  ba15		       a8		      TAY
  10636  ba16		       a5 13		      LDA	TOP+1
  10637  ba18		       e5 0d		      SBC	byte_D
  10638  ba1a		       aa		      TAX
  10639  ba1b		       20 a1 8e 	      JSR	memmove	; move (maybe overlapping) memory regions.
  10640  ba1e							;
  10641  ba1e							; Entry:
  10642  ba1e							; (byte_C) points to src
  10643  ba1e							; (byte_E) points to dest
  10644  ba1e							; X is MSB of size
  10645  ba1e							; Y is LSB of size
  10646  ba1e		       20 1e a0 	      JSR	sub_A01E
  10647  ba21		       18		      CLC
  10648  ba22		       a5 3b		      LDA	byte_3B
  10649  ba24		       65 2d		      ADC	byte_2D
  10650  ba26		       38		      SEC
  10651  ba27		       e9 01		      SBC	#1
  10652  ba29		       cd bf 06 	      CMP	screen_height
  10653  ba2c		       f0 19		      BEQ	loc_BA47
  10654  ba2e		       90 17		      BCC	loc_BA47
  10655  ba30		       a5 4a		      LDA	current_line_no_lsb
  10656  ba32		       85 2b		      STA	byte_2B
  10657  ba34		       a5 4b		      LDA	current_line_no_msb
  10658  ba36		       85 2c		      STA	byte_2C
  10659  ba38		       20 8f 9e 	      JSR	find_line_by_number	; finds a line, given a line number
  10660  ba3b							;
  10661  ba3b							; Entry:
  10662  ba3b							; byte_2B: line	number MSB
  10663  ba3b							; byte_2C: line	number LSB
  10664  ba3b							;
  10665  ba3b							; Exit:
  10666  ba3b							; (byte_2B) points to most suitable line
  10667  ba3b		       20 77 aa 	      JSR	sub_AA77	; swap byte_2B with unk_2F, swap byte_2C with unk_30
  10668  ba3e		       20 39 a0 	      JSR	save_line_number	; saves line number from program.
  10669  ba41							;
  10670  ba41							; Entry:
  10671  ba41							; (byte_2b) points to current line
  10672  ba41							;
  10673  ba41							; Exit:
  10674  ba41							; current_line_no_lsb, current_line_no_msb = the line number
  10675  ba41		       20 69 a0 	      JSR	sub_A069
  10676  ba44		       4c 0d b0 	      JMP	loc_B00D
  10677  ba47
  10678  ba47				   loc_BA47
  10679  ba47		       a5 4a		      LDA	current_line_no_lsb
  10680  ba49		       48		      PHA
  10681  ba4a		       a5 4b		      LDA	current_line_no_msb
  10682  ba4c		       48		      PHA
  10683  ba4d		       a5 4a		      LDA	current_line_no_lsb
  10684  ba4f		       48		      PHA
  10685  ba50		       a5 4b		      LDA	current_line_no_msb
  10686  ba52		       48		      PHA
  10687  ba53		       4c 25 b0 	      JMP	loc_B025
  10688  ba56
  10689  ba56
  10690  ba56
  10691  ba56				   rstrip_detokenized_line
  10692  ba56		       ac 00 04 	      LDY	byte_400
  10693  ba59		       f0 0a		      BEQ	loc_BA65
  10694  ba5b
  10695  ba5b				   loc_BA5B
  10696  ba5b		       b9 00 04 	      LDA	$400,Y
  10697  ba5e		       c9 20		      CMP	#$20	; ' '
  10698  ba60		       d0 03		      BNE	loc_BA65
  10699  ba62		       88		      DEY
  10700  ba63		       d0 f6		      BNE	loc_BA5B
  10701  ba65
  10702  ba65				   loc_BA65
  10703  ba65
  10704  ba65		       8c 00 04 	      STY	byte_400
  10705  ba68		       60		      RTS
  10706  ba69							; End of function rstrip_detokenized_line
  10707  ba69
  10708  ba69
  10709  ba69
  10710  ba69
  10711  ba69				   sub_BA69
  10712  ba69
  10713  ba69		       ad bf 06 	      LDA	screen_height
  10714  ba6c		       0a		      ASL
  10715  ba6d		       85 3a		      STA	byte_3A
  10716  ba6f		       a2 00		      LDX	#0
  10717  ba71
  10718  ba71				   loc_BA71
  10719  ba71		       bd c0 06 	      LDA	$6C0,X
  10720  ba74		       c5 2b		      CMP	byte_2B
  10721  ba76		       d0 0a		      BNE	loc_BA82
  10722  ba78		       e8		      INX
  10723  ba79		       bd c0 06 	      LDA	$6C0,X
  10724  ba7c		       c5 2c		      CMP	byte_2C
  10725  ba7e		       d0 03		      BNE	loc_BA83
  10726  ba80		       ca		      DEX
  10727  ba81		       60		      RTS
  10728  ba82
  10729  ba82				   loc_BA82
  10730  ba82		       e8		      INX
  10731  ba83
  10732  ba83				   loc_BA83
  10733  ba83		       e8		      INX
  10734  ba84		       e4 3a		      CPX	byte_3A
  10735  ba86		       f0 e9		      BEQ	loc_BA71
  10736  ba88		       90 e7		      BCC	loc_BA71
  10737  ba8a		       60		      RTS
  10738  ba8b							; End of function sub_BA69
  10739  ba8b
  10740  ba8b
  10741  ba8b
  10742  ba8b
  10743  ba8b				   back_command
  10744  ba8b		       a2 00		      LDX	#0	; load colour index (0=background)
  10745  ba8d
  10746  ba8d				   set_colour_from_command_line
  10747  ba8d		       ac be 06 	      LDY	byte_6BE
  10748  ba90		       88		      DEY
  10749  ba91		       f0 05		      BEQ	loc_BA98
  10750  ba93
  10751  ba93				   back_command_error
  10752  ba93		       a9 15		      LDA	#$15
  10753  ba95		       4c 9d 85 	      JMP	loc_859D
  10754  ba98
  10755  ba98				   loc_BA98
  10756  ba98		       b1 3e		      LDA	($3E),Y	; get char from	command	line
  10757  ba9a		       29 df		      AND	#$DF	; toupper
  10758  ba9c
  10759  ba9c				   find_colour_loop
  10760  ba9c		       d9 d9 89 	      CMP	colour_chars,Y	; matched colour char?
  10761  ba9f		       f0 07		      BEQ	got_colour	; taken	if colour found
  10762  baa1		       c8		      INY		; next colour char
  10763  baa2		       c0 08		      CPY	#8	; last colour?
  10764  baa4		       d0 f6		      BNE	find_colour_loop	; taken if last colour	not yet	reached
  10765  baa6		       f0 eb		      BEQ	back_command_error	; taken	if last	colour reached
  10766  baa8
  10767  baa8				   got_colour
  10768  baa8		       94 0a		      STY	$A,X
  10769  baaa		       60		      RTS
  10770  baab							; End of function back_command
  10771  baab
  10772  baab
  10773  baab
  10774  baab
  10775  baab				   fore_command
  10776  baab		       a2 01		      LDX	#1	; load colour index (1=foreground)
  10777  baad		       d0 de		      BNE	set_colour_from_command_line	; JMP, in effect
  10778  baaf							; End of function fore_command		; set appropriate colour
  10779  baaf
  10780  baaf
  10781  baaf
  10782  baaf
  10783  baaf				   insert_command
  10784  baaf		       a9 01		      LDA	#1
  10785  bab1
  10786  bab1				   loc_BAB1
  10787  bab1		       85 3c		      STA	is_insert_mode	; 0=overtype 1=insert
  10788  bab3		       60		      RTS
  10789  bab4							; End of function insert_command
  10790  bab4
  10791  bab4
  10792  bab4
  10793  bab4
  10794  bab4				   overtype_command
  10795  bab4		       a9 00		      LDA	#0
  10796  bab6		       f0 f9		      BEQ	loc_BAB1
  10797  bab8							; End of function overtype_command
  10798  bab8
  10799  bab8
  10800  bab8
  10801  bab8
  10802  bab8				   help_command
  10803  bab8		       a9 b9		      LDA	#$B9	; #<command_table
  10804  baba		       85 33		      STA	unk_33
  10805  babc		       a9 8b		      LDA	#$8B	; #>command_table
  10806  babe		       85 34		      STA	unk_34
  10807  bac0							; Help, 2nd column
  10808  bac0		       a9 02		      LDA	#2	; #<aIe
  10809  bac2		       85 35		      STA	byte_35
  10810  bac4		       a9 8c		      LDA	#$8C	; #>aIe
  10811  bac6		       85 36		      STA	byte_36
  10812  bac8							; Help, 3rd column
  10813  bac8		       a9 4c		      LDA	#$4C	; #<aOld
  10814  baca		       85 37		      STA	unk_37
  10815  bacc		       a9 8c		      LDA	#$8C	; #>aOld
  10816  bace		       85 38		      STA	byte_38
  10817  bad0		       20 e7 ff 	      JSR	OSNEWL
  10818  bad3		       a9 01		      LDA	#1
  10819  bad5		       85 39		      STA	byte_39
  10820  bad7
  10821  bad7				   loc_BAD7
  10822  bad7		       a5 39		      LDA	byte_39
  10823  bad9		       cd 95 8c 	      CMP	byte_8C95	; ?8c95	= 10
  10824  badc		       f0 02		      BEQ	loc_BAE0
  10825  bade		       b0 13		      BCS	print_help_footer
  10826  bae0
  10827  bae0				   loc_BAE0
  10828  bae0		       a2 00		      LDX	#0
  10829  bae2		       20 fc ba 	      JSR	print_help_column_row	;	print 1st column
  10830  bae5		       a2 02		      LDX	#2
  10831  bae7		       20 fc ba 	      JSR	print_help_column_row	;	print 2nd column
  10832  baea		       a2 04		      LDX	#4
  10833  baec		       20 fc ba 	      JSR	print_help_column_row	;	print 3rd column
  10834  baef		       e6 39		      INC	byte_39	; next row
  10835  baf1		       d0 e4		      BNE	loc_BAD7	; JMP, in effect
  10836  baf3
  10837  baf3				   print_help_footer
  10838  baf3		       a2 09		      LDX	#9	; #<aNWherePIsAProgramSS1S2AreStri
  10839  baf5		       a0 8a		      LDY	#$8A	; #>aNWherePIsAProgramSS1S2AreStri
  10840  baf7		       a9 83		      LDA	#$83
  10841  baf9		       4c 0e 8f 	      JMP	print_n_chars	; Print	"Where:	p is a program;" (etc.)
  10842  bafc							; End of function help_command
  10843  bafc
  10844  bafc
  10845  bafc
  10846  bafc
  10847  bafc				   print_help_column_row
  10848  bafc
  10849  bafc		       86 32		      STX	unk_32	; save column ID
  10850  bafe		       e0 04		      CPX	#4	; is this the 3rd column?
  10851  bb00		       d0 0f		      BNE	x_not_4
  10852  bb02		       a5 39		      LDA	byte_39	; get (1-based)	row index in A
  10853  bb04		       cd 96 8c 	      CMP	byte_8C96	; ?8C96	= 9
  10854  bb07							; Reached the penultimate row in the 3rd column?
  10855  bb07		       f0 08		      BEQ	x_not_4	; taken	if at penultimate row
  10856  bb09		       90 06		      BCC	x_not_4	; taken	if before penultimate row
  10857  bb0b		       cd 95 8c 	      CMP	byte_8C95
  10858  bb0e		       d0 7f		      BNE	newline
  10859  bb10		       60		      RTS
  10860  bb11
  10861  bb11				   x_not_4
  10862  bb11
  10863  bb11		       a1 33		      LDA	($33,X)	; get byte from	command	table for appropriate column
  10864  bb13		       f0 08		      BEQ	end_of_command	; taken	if reached end of command string
  10865  bb15		       20 ee ff 	      JSR	OSWRCH	; print	character
  10866  bb18		       20 92 bb 	      JSR	inc_help_column_X_ptr	;	next character
  10867  bb1b		       d0 df		      BNE	print_help_column_row	;	JMP, in	effect
  10868  bb1d
  10869  bb1d				   end_of_command
  10870  bb1d		       a9 20		      LDA	#$20	; ' '
  10871  bb1f		       20 ee ff 	      JSR	OSWRCH	; print	a space
  10872  bb22		       20 92 bb 	      JSR	inc_help_column_X_ptr	;	next byte
  10873  bb25		       a1 33		      LDA	($33,X)	; get args ID
  10874  bb27		       a8		      TAY		; Y = args ID
  10875  bb28		       29 20		      AND	#$20	; ' '	    ; bit 5 status
  10876  bb2a		       f0 04		      BEQ	loc_BB30	; taken	if bit 5 reset
  10877  bb2c		       a9 63		      LDA	#'c
  10878  bb2e		       d0 29		      BNE	print_single_char_arg	;	JMP, in	effect
  10879  bb30							; print	'c'
  10880  bb30
  10881  bb30				   loc_BB30
  10882  bb30		       98		      TYA		; A = args ID
  10883  bb31		       29 10		      AND	#$10	; bit 4	status
  10884  bb33		       f0 0c		      BEQ	loc_BB41	; taken	if bit 4 reset
  10885  bb35		       a2 8c		      LDX	#$8C	; #<aS1S2
  10886  bb37		       a0 8a		      LDY	#$8A	; #>aS1S2
  10887  bb39		       a9 05		      LDA	#5
  10888  bb3b		       20 0e 8f 	      JSR	print_n_chars	; print	"s1 s2"
  10889  bb3e		       4c 71 bb 	      JMP	loc_BB71
  10890  bb41
  10891  bb41				   loc_BB41
  10892  bb41		       98		      TYA		; A = args ID
  10893  bb42		       29 40		      AND	#$40	; '@'	    ; bit 6 status
  10894  bb44		       f0 0c		      BEQ	loc_BB52	; taken	if bit 6 reset
  10895  bb46		       a2 91		      LDX	#$91	; #<aN1N2
  10896  bb48		       a0 8a		      LDY	#$8A	; #>aN1N2
  10897  bb4a		       a9 05		      LDA	#5
  10898  bb4c		       20 0e 8f 	      JSR	print_n_chars	; print	"n1 n2"
  10899  bb4f		       4c 71 bb 	      JMP	loc_BB71
  10900  bb52
  10901  bb52				   loc_BB52
  10902  bb52		       98		      TYA
  10903  bb53		       29 08		      AND	#8	; bit 3	status
  10904  bb55		       f0 08		      BEQ	loc_BB5F	; taken	if bit 3 reset
  10905  bb57		       a9 70		      LDA	#'p
  10906  bb59
  10907  bb59				   print_single_char_arg
  10908  bb59
  10909  bb59		       20 ee ff 	      JSR	OSWRCH
  10910  bb5c		       4c 71 bb 	      JMP	loc_BB71
  10911  bb5f
  10912  bb5f				   loc_BB5F
  10913  bb5f		       98		      TYA		; A = args ID
  10914  bb60		       29 02		      AND	#2	; bit 1	status
  10915  bb62		       f0 04		      BEQ	loc_BB68	; taken	if bit 1 reset
  10916  bb64		       a9 6e		      LDA	#$6E	; 'n'
  10917  bb66		       d0 f1		      BNE	print_single_char_arg	;	JMP, in	effect
  10918  bb68							; print	'n'
  10919  bb68
  10920  bb68				   loc_BB68
  10921  bb68		       98		      TYA		; A = args ID
  10922  bb69		       29 05		      AND	#5	; bits 2 and 0 status
  10923  bb6b		       f0 04		      BEQ	loc_BB71	; taken	if both	bits 2 and 0 reset
  10924  bb6d		       a9 73		      LDA	#$73	; 's'
  10925  bb6f		       d0 e8		      BNE	print_single_char_arg	;	JMP, in	effect
  10926  bb71							; print	's'
  10927  bb71
  10928  bb71				   loc_BB71
  10929  bb71
  10930  bb71		       a6 32		      LDX	unk_32	; get column ID
  10931  bb73		       20 92 bb 	      JSR	inc_help_column_X_ptr	;	skip args ID
  10932  bb76		       20 92 bb 	      JSR	inc_help_column_X_ptr	;	skip command ID
  10933  bb79		       a9 86		      LDA	#134	; Read text cursor position (AUG p158)
  10934  bb7b		       20 f4 ff 	      JSR	OSBYTE
  10935  bb7e		       e0 0f		      CPX	#15
  10936  bb80		       b0 05		      BCS	loc_BB87	; taken	if past	column 15
  10937  bb82		       a2 0f		      LDX	#15	; advance to column 15
  10938  bb84
  10939  bb84				   do_gotoxy
  10940  bb84		       4c 01 8f 	      JMP	gotoxy
  10941  bb87
  10942  bb87				   loc_BB87
  10943  bb87		       e0 19		      CPX	#25
  10944  bb89		       b0 04		      BCS	newline	; taken	if past	column 25
  10945  bb8b		       a2 19		      LDX	#25	; advance to column 25
  10946  bb8d		       d0 f5		      BNE	do_gotoxy	; JMP, in effect
  10947  bb8f
  10948  bb8f				   newline
  10949  bb8f
  10950  bb8f		       4c e7 ff 	      JMP	OSNEWL
  10951  bb92							; End of function print_help_column_row
  10952  bb92
  10953  bb92
  10954  bb92
  10955  bb92
  10956  bb92				   inc_help_column_X_ptr
  10957  bb92
  10958  bb92		       f6 33		      INC	$33,X
  10959  bb94		       d0 02		      BNE	locret_BB98
  10960  bb96		       f6 34		      INC	$34,X
  10961  bb98
  10962  bb98				   locret_BB98
  10963  bb98		       60		      RTS		; Z always clear at this point
  10964  bb99							; End of function inc_help_column_X_ptr
  10965  bb99
  10966  bb99
  10967  bb99				   loc_BB99
  10968  bb99		       a5 3f		      LDA	byte_3F
  10969  bb9b		       85 2b		      STA	byte_2B
  10970  bb9d		       a5 3e		      LDA	byte_3E
  10971  bb9f		       85 2c		      STA	byte_2C
  10972  bba1		       20 8f 9e 	      JSR	find_line_by_number	; finds a line, given a line number
  10973  bba4							;
  10974  bba4							; Entry:
  10975  bba4							; byte_2B: line	number MSB
  10976  bba4							; byte_2C: line	number LSB
  10977  bba4							;
  10978  bba4							; Exit:
  10979  bba4							; (byte_2B) points to most suitable line
  10980  bba4		       a0 01		      LDY	#1
  10981  bba6		       b1 2b		      LDA	($2B),Y
  10982  bba8		       30 06		      BMI	loc_BBB0
  10983  bbaa		       20 39 a0 	      JSR	save_line_number	; saves line number from program.
  10984  bbad							;
  10985  bbad							; Entry:
  10986  bbad							; (byte_2b) points to current line
  10987  bbad							;
  10988  bbad							; Exit:
  10989  bbad							; current_line_no_lsb, current_line_no_msb = the line number
  10990  bbad		       4c a8 9d 	      JMP	loc_9DA8
  10991  bbb0
  10992  bbb0				   loc_BBB0
  10993  bbb0		       4c 7f a6 	      JMP	end_edit_mode_command
  10994  bbb3
  10995  bbb3
  10996  bbb3
  10997  bbb3				   info_command
  10998  bbb3		       20 e7 ff 	      JSR	OSNEWL
  10999  bbb6		       a5 3d		      LDA	scroll_status	; 1=scroll, 0=noscroll
  11000  bbb8		       d0 06		      BNE	print_scroll_on	; #<aScrollOn
  11001  bbba		       a2 c8		      LDX	#$C8	; #<aScrollOff
  11002  bbbc		       a0 8a		      LDY	#$8A	; #>aScrollOff
  11003  bbbe		       d0 04		      BNE	print_scroll_status
  11004  bbc0
  11005  bbc0				   print_scroll_on
  11006  bbc0		       a2 be		      LDX	#$BE	; #<aScrollOn
  11007  bbc2		       a0 8a		      LDY	#$8A	; #>aScrollOn
  11008  bbc4
  11009  bbc4				   print_scroll_status
  11010  bbc4		       a9 0a		      LDA	#$A
  11011  bbc6		       20 0e 8f 	      JSR	print_n_chars
  11012  bbc9		       20 e7 ff 	      JSR	OSNEWL
  11013  bbcc		       a5 3c		      LDA	is_insert_mode	; 0=overtype 1=insert
  11014  bbce		       d0 06		      BNE	print_insert_mode	; #<aInsertMode
  11015  bbd0		       a2 a3		      LDX	#$A3	; #<aOvertypeMode
  11016  bbd2		       a0 8a		      LDY	#$8A	; #>aOvertypeMode
  11017  bbd4		       d0 04		      BNE	print_insert_status
  11018  bbd6
  11019  bbd6				   print_insert_mode
  11020  bbd6		       a2 96		      LDX	#$96	; #<aInsertMode
  11021  bbd8		       a0 8a		      LDY	#$8A	; #>aInsertMode
  11022  bbda
  11023  bbda				   print_insert_status
  11024  bbda		       a9 0d		      LDA	#$D
  11025  bbdc		       20 0e 8f 	      JSR	print_n_chars
  11026  bbdf		       20 e7 ff 	      JSR	OSNEWL
  11027  bbe2		       a9 87		      LDA	#$87	; get MODE in Y
  11028  bbe4		       20 f4 ff 	      JSR	OSBYTE	; get MODE in Y
  11029  bbe7		       c0 07		      CPY	#7	; MODE 7?
  11030  bbe9		       d0 1d		      BNE	print_colours
  11031  bbeb		       c4 14		      CPY	screen_mode
  11032  bbed		       d0 19		      BNE	print_colours
  11033  bbef		       a5 0a		      LDA	background_colour
  11034  bbf1		       48		      PHA
  11035  bbf2		       a5 0b		      LDA	foreground_colour
  11036  bbf4		       48		      PHA
  11037  bbf5		       a9 07		      LDA	#7
  11038  bbf7		       85 0b		      STA	foreground_colour	; foreground is white
  11039  bbf9		       a9 00		      LDA	#0
  11040  bbfb		       85 0a		      STA	background_colour	; background is black
  11041  bbfd		       20 9c bd 	      JSR	print_colour_scheme
  11042  bc00		       68		      PLA
  11043  bc01		       85 0b		      STA	foreground_colour
  11044  bc03		       68		      PLA
  11045  bc04		       85 0a		      STA	background_colour
  11046  bc06		       10 03		      BPL	loc_BC0B
  11047  bc08
  11048  bc08				   print_colours
  11049  bc08
  11050  bc08		       20 9c bd 	      JSR	print_colour_scheme
  11051  bc0b
  11052  bc0b				   loc_BC0B
  11053  bc0b		       20 e7 ff 	      JSR	OSNEWL
  11054  bc0e		       20 e7 ff 	      JSR	OSNEWL
  11055  bc11		       a2 b0		      LDX	#$B0	; #<aProgramName
  11056  bc13		       a0 8a		      LDY	#$8A	; #>aProgramName
  11057  bc15		       a9 0e		      LDA	#$E
  11058  bc17		       20 0e 8f 	      JSR	print_n_chars
  11059  bc1a		       a9 02		      LDA	#2
  11060  bc1c		       8d b7 06 	      STA	editor_mode_id	; 1=command mode, 2=edit mode
  11061  bc1f		       a2 52		      LDX	#$52
  11062  bc21		       a0 00		      LDY	#0
  11063  bc23		       a9 0f		      LDA	#$F
  11064  bc25		       20 0e 8f 	      JSR	print_n_chars
  11065  bc28		       20 e7 ff 	      JSR	OSNEWL
  11066  bc2b		       a2 41		      LDX	#$41	; #<aLastSearch
  11067  bc2d		       a0 8b		      LDY	#$8B	; #>aLastSearch
  11068  bc2f		       a5 62		      LDA	byte_62
  11069  bc31		       d0 04		      BNE	loc_BC37
  11070  bc33		       a9 12		      LDA	#$12
  11071  bc35		       d0 0b		      BNE	loc_BC42
  11072  bc37
  11073  bc37				   loc_BC37
  11074  bc37		       a9 0e		      LDA	#$E
  11075  bc39		       20 0e 8f 	      JSR	print_n_chars
  11076  bc3c		       a2 43		      LDX	#$43
  11077  bc3e		       a0 06		      LDY	#6
  11078  bc40		       a5 62		      LDA	byte_62
  11079  bc42
  11080  bc42				   loc_BC42
  11081  bc42		       20 0e 8f 	      JSR	print_n_chars
  11082  bc45		       a9 01		      LDA	#1
  11083  bc47		       8d b7 06 	      STA	editor_mode_id	; 1=command mode, 2=edit mode
  11084  bc4a		       20 e7 ff 	      JSR	OSNEWL
  11085  bc4d		       20 e7 ff 	      JSR	OSNEWL
  11086  bc50		       a2 33		      LDX	#$33
  11087  bc52		       a0 8b		      LDY	#$8B
  11088  bc54		       a9 0e		      LDA	#$E
  11089  bc56		       20 0e 8f 	      JSR	print_n_chars
  11090  bc59		       a6 61		      LDX	unk_61
  11091  bc5b		       a0 00		      LDY	#0
  11092  bc5d		       20 96 bd 	      JSR	sub_BD96
  11093  bc60		       20 83 bd 	      JSR	sub_BD83
  11094  bc63		       a2 0c		      LDX	#$C
  11095  bc65		       a0 8b		      LDY	#-$75	;	'‹'
  11096  bc67		       a9 0d		      LDA	#$D
  11097  bc69		       20 0e 8f 	      JSR	print_n_chars
  11098  bc6c		       a5 16		      LDA	unk_16
  11099  bc6e		       d0 24		      BNE	loc_BC94
  11100  bc70		       a2 00		      LDX	#0
  11101  bc72		       86 38		      STX	byte_38
  11102  bc74		       86 39		      STX	byte_39
  11103  bc76		       86 2b		      STX	byte_2B
  11104  bc78		       a5 18		      LDA	oshwm+1
  11105  bc7a		       85 2c		      STA	byte_2C
  11106  bc7c
  11107  bc7c				   loc_BC7C
  11108  bc7c		       a0 01		      LDY	#1
  11109  bc7e		       b1 2b		      LDA	($2B),Y
  11110  bc80		       30 0b		      BMI	loc_BC8D
  11111  bc82		       20 52 92 	      JSR	advance_2b_to_next_line
  11112  bc85		       e6 38		      INC	byte_38
  11113  bc87		       d0 02		      BNE	loc_BC8B
  11114  bc89		       e6 39		      INC	byte_39
  11115  bc8b
  11116  bc8b				   loc_BC8B
  11117  bc8b		       d0 ef		      BNE	loc_BC7C
  11118  bc8d
  11119  bc8d				   loc_BC8D
  11120  bc8d		       a6 38		      LDX	byte_38
  11121  bc8f		       a4 39		      LDY	byte_39
  11122  bc91		       20 96 bd 	      JSR	sub_BD96
  11123  bc94
  11124  bc94				   loc_BC94
  11125  bc94		       20 e7 ff 	      JSR	OSNEWL
  11126  bc97		       a5 16		      LDA	unk_16
  11127  bc99		       f0 01		      BEQ	loc_BC9C
  11128  bc9b		       60		      RTS
  11129  bc9c
  11130  bc9c				   loc_BC9C
  11131  bc9c		       20 e9 9f 	      JSR	is_program_empty	; sets	C if no	program
  11132  bc9f		       90 03		      BCC	loc_BCA4
  11133  bca1		       4c 22 bd 	      JMP	loc_BD22
  11134  bca4
  11135  bca4				   loc_BCA4
  11136  bca4		       a2 d2		      LDX	#$D2
  11137  bca6		       a0 8a		      LDY	#$8A
  11138  bca8		       a9 0e		      LDA	#$E
  11139  bcaa		       20 0e 8f 	      JSR	print_n_chars
  11140  bcad		       20 8d bd 	      JSR	sub_BD8D
  11141  bcb0		       20 83 bd 	      JSR	sub_BD83
  11142  bcb3		       a2 e0		      LDX	#-$20	;	'à'
  11143  bcb5		       a0 8a		      LDY	#-$76	;	'Š'
  11144  bcb7		       a9 0d		      LDA	#$D
  11145  bcb9		       20 0e 8f 	      JSR	print_n_chars
  11146  bcbc		       a9 ff		      LDA	#-1
  11147  bcbe		       85 2b		      STA	byte_2B
  11148  bcc0		       20 8f 9e 	      JSR	find_line_by_number	; finds a line, given a line number
  11149  bcc3							;
  11150  bcc3							; Entry:
  11151  bcc3							; byte_2B: line	number MSB
  11152  bcc3							; byte_2C: line	number LSB
  11153  bcc3							;
  11154  bcc3							; Exit:
  11155  bcc3							; (byte_2B) points to most suitable line
  11156  bcc3		       a0 02		      LDY	#2
  11157  bcc5		       b1 2f		      LDA	($2F),Y
  11158  bcc7		       aa		      TAX
  11159  bcc8		       88		      DEY
  11160  bcc9		       b1 2f		      LDA	($2F),Y
  11161  bccb		       a8		      TAY
  11162  bccc		       20 96 bd 	      JSR	sub_BD96
  11163  bccf		       20 e7 ff 	      JSR	OSNEWL
  11164  bcd2		       a2 ed		      LDX	#$ED
  11165  bcd4		       a0 8a		      LDY	#$8A
  11166  bcd6		       a9 0e		      LDA	#$E
  11167  bcd8		       20 0e 8f 	      JSR	print_n_chars
  11168  bcdb		       a6 4b		      LDX	current_line_no_msb
  11169  bcdd		       a4 4a		      LDY	current_line_no_lsb
  11170  bcdf		       20 96 bd 	      JSR	sub_BD96
  11171  bce2		       20 83 bd 	      JSR	sub_BD83
  11172  bce5		       20 7b b3 	      JSR	sub_B37B
  11173  bce8		       08		      PHP
  11174  bce9		       a2 fb		      LDX	#$FB
  11175  bceb		       a0 8a		      LDY	#$8A
  11176  bced		       28		      PLP
  11177  bcee		       d0 0f		      BNE	loc_BCFF
  11178  bcf0		       a9 0d		      LDA	#$D
  11179  bcf2		       20 0e 8f 	      JSR	print_n_chars
  11180  bcf5		       a6 4e		      LDX	unk_4E
  11181  bcf7		       a4 4d		      LDY	unk_4D
  11182  bcf9		       20 96 bd 	      JSR	sub_BD96
  11183  bcfc		       4c 04 bd 	      JMP	loc_BD04
  11184  bcff
  11185  bcff				   loc_BCFF
  11186  bcff		       a9 11		      LDA	#$11
  11187  bd01		       20 0e 8f 	      JSR	print_n_chars
  11188  bd04
  11189  bd04				   loc_BD04
  11190  bd04		       20 e7 ff 	      JSR	OSNEWL
  11191  bd07		       20 e7 ff 	      JSR	OSNEWL
  11192  bd0a		       a2 19		      LDX	#$19
  11193  bd0c		       a0 8b		      LDY	#$8B
  11194  bd0e		       a5 40		      LDA	byte_40
  11195  bd10		       c9 20		      CMP	#$20	; ' '
  11196  bd12		       d0 11		      BNE	loc_BD25
  11197  bd14		       a5 46		      LDA	byte_46
  11198  bd16		       c9 20		      CMP	#$20	; ' '
  11199  bd18		       d0 0b		      BNE	loc_BD25
  11200  bd1a		       a9 16		      LDA	#$16
  11201  bd1c		       20 0e 8f 	      JSR	print_n_chars
  11202  bd1f
  11203  bd1f				   loc_BD1F
  11204  bd1f		       20 e7 ff 	      JSR	OSNEWL
  11205  bd22
  11206  bd22				   loc_BD22
  11207  bd22		       4c e7 ff 	      JMP	OSNEWL
  11208  bd25
  11209  bd25				   loc_BD25
  11210  bd25
  11211  bd25		       a9 12		      LDA	#$12
  11212  bd27		       20 0e 8f 	      JSR	print_n_chars
  11213  bd2a		       20 e7 ff 	      JSR	OSNEWL
  11214  bd2d		       a5 40		      LDA	byte_40
  11215  bd2f		       c9 20		      CMP	#$20	; ' '
  11216  bd31		       f0 13		      BEQ	loc_BD46
  11217  bd33		       a5 43		      LDA	byte_43
  11218  bd35		       c9 20		      CMP	#$20	; ' '
  11219  bd37		       f0 0d		      BEQ	loc_BD46
  11220  bd39		       20 1a ad 	      JSR	sub_AD1A
  11221  bd3c		       90 08		      BCC	loc_BD46
  11222  bd3e		       a6 40		      LDX	byte_40
  11223  bd40		       a4 43		      LDY	byte_43
  11224  bd42		       86 43		      STX	byte_43
  11225  bd44		       84 40		      STY	byte_40
  11226  bd46
  11227  bd46				   loc_BD46
  11228  bd46
  11229  bd46		       a9 00		      LDA	#0
  11230  bd48		       85 39		      STA	byte_39
  11231  bd4a
  11232  bd4a				   loc_BD4A
  11233  bd4a		       a6 39		      LDX	byte_39
  11234  bd4c		       e0 07		      CPX	#7
  11235  bd4e		       b0 cf		      BCS	loc_BD1F
  11236  bd50		       b5 40		      LDA	$40,X
  11237  bd52		       c9 20		      CMP	#$20	; ' '
  11238  bd54		       f0 25		      BEQ	loc_BD7B
  11239  bd56		       c9 60		      CMP	#$60	; '`'
  11240  bd58		       90 06		      BCC	loc_BD60
  11241  bd5a		       38		      SEC
  11242  bd5b		       e9 20		      SBC	#$20	; ' '
  11243  bd5d		       20 ee ff 	      JSR	OSWRCH
  11244  bd60
  11245  bd60				   loc_BD60
  11246  bd60		       20 ee ff 	      JSR	OSWRCH
  11247  bd63		       a9 20		      LDA	#$20	; ' '
  11248  bd65		       20 ee ff 	      JSR	OSWRCH
  11249  bd68		       b5 41		      LDA	$41,X
  11250  bd6a		       a8		      TAY
  11251  bd6b		       b5 42		      LDA	$42,X
  11252  bd6d		       aa		      TAX
  11253  bd6e		       20 96 bd 	      JSR	sub_BD96
  11254  bd71		       a2 03		      LDX	#3
  11255  bd73		       a9 20		      LDA	#$20	; ' '
  11256  bd75
  11257  bd75				   loc_BD75
  11258  bd75		       20 ee ff 	      JSR	OSWRCH
  11259  bd78		       ca		      DEX
  11260  bd79		       d0 fa		      BNE	loc_BD75
  11261  bd7b
  11262  bd7b				   loc_BD7B
  11263  bd7b		       e6 39		      INC	byte_39
  11264  bd7d		       e6 39		      INC	byte_39
  11265  bd7f		       e6 39		      INC	byte_39
  11266  bd81		       d0 c7		      BNE	loc_BD4A
  11267  bd83							; End of function info_command
  11268  bd83
  11269  bd83
  11270  bd83
  11271  bd83
  11272  bd83				   sub_BD83
  11273  bd83
  11274  bd83		       a9 86		      LDA	#-$7A	;	'†'
  11275  bd85		       20 f4 ff 	      JSR	OSBYTE
  11276  bd88		       a2 15		      LDX	#$15
  11277  bd8a		       4c 01 8f 	      JMP	gotoxy
  11278  bd8d							; End of function sub_BD83
  11279  bd8d
  11280  bd8d
  11281  bd8d
  11282  bd8d
  11283  bd8d				   sub_BD8D
  11284  bd8d		       a0 02		      LDY	#2	; offset of line number	MSB
  11285  bd8f		       b1 17		      LDA	($17),Y	; get line number MSB
  11286  bd91		       aa		      TAX
  11287  bd92		       88		      DEY		; offset of line number	LSB
  11288  bd93		       b1 17		      LDA	($17),Y	; get line number LSB
  11289  bd95		       a8		      TAY
  11290  bd96							; End of function sub_BD8D
  11291  bd96
  11292  bd96
  11293  bd96
  11294  bd96
  11295  bd96				   sub_BD96
  11296  bd96
  11297  bd96		       20 b6 8d 	      JSR	itoa	; Gets string representation of	16-bit number.
  11298  bd99							;
  11299  bd99							; Entry:
  11300  bd99							; Y,X =	value
  11301  bd99							;
  11302  bd99							; Exit:
  11303  bd99							; unk_0	holds digit count
  11304  bd99							; unk_1... filled with string
  11305  bd99		       4c 97 8e 	      JMP	print_number	; print	number.
  11306  bd9c							; End of function sub_BD96		;
  11307  bd9c							; Suitable for use with	the result of itoa.
  11308  bd9c							;
  11309  bd9c							; Entry:
  11310  bd9c							; unk_0	= digit	count
  11311  bd9c							; unk_1... = digits
  11312  bd9c
  11313  bd9c
  11314  bd9c
  11315  bd9c				   print_colour_scheme
  11316  bd9c
  11317  bd9c		       a5 0b		      LDA	foreground_colour	; get	foreground colour
  11318  bd9e		       18		      CLC		; capitalize
  11319  bd9f		       20 ae bd 	      JSR	print_colour_name
  11320  bda2		       a2 2f		      LDX	#$2F	; #<aOn
  11321  bda4		       a0 8b		      LDY	#$8B	; #>aOn
  11322  bda6		       a9 04		      LDA	#4
  11323  bda8		       20 0e 8f 	      JSR	print_n_chars	; print	" on "
  11324  bdab		       a5 0a		      LDA	background_colour
  11325  bdad		       38		      SEC		; don't capitalize
  11326  bdae
  11327  bdae				   print_colour_name
  11328  bdae		       08		      PHP
  11329  bdaf		       85 3a		      STA	byte_3A
  11330  bdb1		       a2 ff		      LDX	#$FF	; index	of current colour name
  11331  bdb3		       a0 00		      LDY	#0	; offset into table
  11332  bdb5
  11333  bdb5				   loc_BDB5
  11334  bdb5		       b9 e1 89 	      LDA	colour_names_table,Y	; get next	byte
  11335  bdb8		       10 05		      BPL	next_byte	; if +ve, still	current	name
  11336  bdba		       e8		      INX		; just found new colour	name, so inc X
  11337  bdbb		       e4 3a		      CPX	byte_3A	; is it	the one?
  11338  bdbd		       f0 03		      BEQ	print_name	; print	if so.
  11339  bdbf
  11340  bdbf				   next_byte
  11341  bdbf		       c8		      INY
  11342  bdc0		       d0 f3		      BNE	loc_BDB5
  11343  bdc2
  11344  bdc2				   print_name
  11345  bdc2		       29 7f		      AND	#$7F	; make printable
  11346  bdc4		       28		      PLP
  11347  bdc5		       90 02		      BCC	print_chars	; capitalize?
  11348  bdc7		       09 20		      ORA	#$20	; ' '	    ; toupper
  11349  bdc9
  11350  bdc9				   print_chars
  11351  bdc9
  11352  bdc9		       20 ee ff 	      JSR	OSWRCH
  11353  bdcc		       c8		      INY
  11354  bdcd		       b9 e1 89 	      LDA	colour_names_table,Y
  11355  bdd0		       10 f7		      BPL	print_chars
  11356  bdd2		       60		      RTS
  11357  bdd3							; End of function print_colour_scheme
  11358  bdd3
  11359  bdd3
  11360  bdd3
  11361  bdd3
  11362  bdd3				   sub_BDD3
  11363  bdd3
  11364  bdd3		       a5 3e		      LDA	byte_3E
  11365  bdd5		       48		      PHA
  11366  bdd6		       a5 3f		      LDA	byte_3F
  11367  bdd8		       48		      PHA
  11368  bdd9		       ad ba 06 	      LDA	unk_6BA
  11369  bddc		       85 3e		      STA	byte_3E
  11370  bdde		       ad bb 06 	      LDA	unk_6BB
  11371  bde1		       85 3f		      STA	byte_3F
  11372  bde3		       18		      CLC
  11373  bde4		       a5 10		      LDA	cursor_offset	; offset of cursor in detokenized buffer
  11374  bde6		       6d be 06 	      ADC	byte_6BE
  11375  bde9		       b0 0a		      BCS	loc_BDF5
  11376  bdeb		       38		      SEC
  11377  bdec		       e9 01		      SBC	#1
  11378  bdee		       cd 00 04 	      CMP	byte_400
  11379  bdf1		       f0 16		      BEQ	loc_BE09
  11380  bdf3		       90 14		      BCC	loc_BE09
  11381  bdf5
  11382  bdf5				   loc_BDF5
  11383  bdf5		       18		      CLC
  11384  bdf6		       a5 10		      LDA	cursor_offset	; offset of cursor in detokenized buffer
  11385  bdf8		       6d bc 06 	      ADC	unk_6BC
  11386  bdfb		       b0 26		      BCS	loc_BE23
  11387  bdfd		       38		      SEC
  11388  bdfe		       e9 01		      SBC	#1
  11389  be00		       c9 fc		      CMP	#-4	; 'ü'
  11390  be02		       b0 1f		      BCS	loc_BE23
  11391  be04		       8d 00 04 	      STA	byte_400
  11392  be07		       90 4e		      BCC	loc_BE57
  11393  be09
  11394  be09				   loc_BE09
  11395  be09		       38		      SEC
  11396  be0a		       ad bc 06 	      LDA	unk_6BC
  11397  be0d		       ed be 06 	      SBC	byte_6BE
  11398  be10		       8d ae 06 	      STA	unk_6AE
  11399  be13		       18		      CLC
  11400  be14		       6d 00 04 	      ADC	byte_400
  11401  be17		       48		      PHA
  11402  be18		       ac ae 06 	      LDY	unk_6AE
  11403  be1b		       30 0e		      BMI	loc_BE2B
  11404  be1d		       b0 04		      BCS	loc_BE23
  11405  be1f		       c9 fc		      CMP	#-4	; 'ü'
  11406  be21		       90 08		      BCC	loc_BE2B
  11407  be23
  11408  be23				   loc_BE23
  11409  be23		       20 39 a0 	      JSR	save_line_number	; saves line number from program.
  11410  be26							;
  11411  be26							; Entry:
  11412  be26							; (byte_2b) points to current line
  11413  be26							;
  11414  be26							; Exit:
  11415  be26							; current_line_no_lsb, current_line_no_msb = the line number
  11416  be26		       a9 25		      LDA	#$25	; '%'
  11417  be28		       4c 9d 85 	      JMP	loc_859D
  11418  be2b
  11419  be2b				   loc_BE2B
  11420  be2b		       18		      CLC
  11421  be2c		       a9 00		      LDA	#0
  11422  be2e		       65 10		      ADC	cursor_offset	; offset of cursor in detokenized buffer
  11423  be30		       6d be 06 	      ADC	byte_6BE
  11424  be33		       85 0c		      STA	byte_C
  11425  be35		       6d ae 06 	      ADC	unk_6AE
  11426  be38		       85 0e		      STA	byte_E
  11427  be3a		       a9 04		      LDA	#4
  11428  be3c		       85 0d		      STA	byte_D
  11429  be3e		       85 0f		      STA	byte_F
  11430  be40		       a2 00		      LDX	#0
  11431  be42		       18		      CLC
  11432  be43		       ad 00 04 	      LDA	byte_400
  11433  be46		       69 01		      ADC	#1
  11434  be48		       38		      SEC
  11435  be49		       e5 10		      SBC	cursor_offset	; offset of cursor in detokenized buffer
  11436  be4b		       38		      SEC
  11437  be4c		       ed be 06 	      SBC	byte_6BE
  11438  be4f		       a8		      TAY
  11439  be50		       20 a1 8e 	      JSR	memmove	; move (maybe overlapping) memory regions.
  11440  be53							;
  11441  be53							; Entry:
  11442  be53							; (byte_C) points to src
  11443  be53							; (byte_E) points to dest
  11444  be53							; X is MSB of size
  11445  be53							; Y is LSB of size
  11446  be53		       68		      PLA
  11447  be54		       8d 00 04 	      STA	byte_400
  11448  be57
  11449  be57				   loc_BE57
  11450  be57		       a5 3e		      LDA	byte_3E
  11451  be59		       85 0c		      STA	byte_C
  11452  be5b		       a5 3f		      LDA	byte_3F
  11453  be5d		       85 0d		      STA	byte_D
  11454  be5f		       18		      CLC
  11455  be60		       a9 00		      LDA	#0
  11456  be62		       65 10		      ADC	cursor_offset	; offset of cursor in detokenized buffer
  11457  be64		       85 0e		      STA	byte_E
  11458  be66		       a9 04		      LDA	#4
  11459  be68		       85 0f		      STA	byte_F
  11460  be6a		       a2 00		      LDX	#0
  11461  be6c		       ac bc 06 	      LDY	unk_6BC
  11462  be6f		       18		      CLC
  11463  be70		       98		      TYA
  11464  be71		       65 10		      ADC	cursor_offset	; offset of cursor in detokenized buffer
  11465  be73		       85 10		      STA	cursor_offset	; offset of cursor in detokenized buffer
  11466  be75		       8d b3 06 	      STA	byte_6B3
  11467  be78		       20 a1 8e 	      JSR	memmove	; move (maybe overlapping) memory regions.
  11468  be7b							;
  11469  be7b							; Entry:
  11470  be7b							; (byte_C) points to src
  11471  be7b							; (byte_E) points to dest
  11472  be7b							; X is MSB of size
  11473  be7b							; Y is LSB of size
  11474  be7b		       68		      PLA
  11475  be7c		       85 3f		      STA	byte_3F
  11476  be7e		       68		      PLA
  11477  be7f		       85 3e		      STA	byte_3E
  11478  be81		       60		      RTS
  11479  be82							; End of function sub_BDD3
  11480  be82
  11481  be82
  11482  be82
  11483  be82
  11484  be82				   sub_BE82
  11485  be82
  11486  be82		       20 f6 9b 	      JSR	kbflush
  11487  be85		       a5 3c		      LDA	is_insert_mode	; 0=overtype 1=insert
  11488  be87		       48		      PHA
  11489  be88		       a9 01		      LDA	#1
  11490  be8a		       85 3c		      STA	is_insert_mode	; 0=overtype 1=insert
  11491  be8c		       20 c6 9b 	      JSR	reset_cursor_shape
  11492  be8f		       68		      PLA
  11493  be90		       85 3c		      STA	is_insert_mode	; 0=overtype 1=insert
  11494  be92		       20 26 95 	      JSR	getch
  11495  be95		       4c ab 9b 	      JMP	make_cursor_invisible
  11496  be98							; End of function sub_BE82
  11497  be98
  11498  be98
  11499  be98
  11500  be98
  11501  be98				   sub_BE98
  11502  be98		       20 51 a0 	      JSR	is_line_empty	; determines whether current line is empty.
  11503  be9b							;
  11504  be9b							; Entry:
  11505  be9b							; detokenized line at $400...
  11506  be9b							;
  11507  be9b							; Exit:
  11508  be9b							; C set	if line	empty.
  11509  be9b		       90 05		      BCC	loc_BEA2
  11510  be9d		       a5 3d		      LDA	scroll_status	; 1=scroll, 0=noscroll
  11511  be9f		       d0 11		      BNE	loc_BEB2
  11512  bea1		       60		      RTS
  11513  bea2
  11514  bea2				   loc_BEA2
  11515  bea2		       a5 3d		      LDA	scroll_status	; 1=scroll, 0=noscroll
  11516  bea4		       d0 03		      BNE	loc_BEA9
  11517  bea6
  11518  bea6				   loc_BEA6
  11519  bea6		       4c bb bf 	      JMP	loc_BFBB
  11520  bea9
  11521  bea9				   loc_BEA9
  11522  bea9		       a5 3b		      LDA	byte_3B
  11523  beab		       d0 f9		      BNE	loc_BEA6
  11524  bead		       20 e9 9f 	      JSR	is_program_empty	; sets	C if no	program
  11525  beb0		       90 03		      BCC	loc_BEB5
  11526  beb2
  11527  beb2				   loc_BEB2
  11528  beb2		       4c d8 9a 	      JMP	edit_mode_loop
  11529  beb5
  11530  beb5				   loc_BEB5
  11531  beb5		       20 dc bf 	      JSR	find_current_line_by_number	; finds current line by number.
  11532  beb8							;
  11533  beb8							; Entry:
  11534  beb8							; current_line_no_lsb,
  11535  beb8							; current_line_no_msb =	line number to search for
  11536  beb8							;
  11537  beb8							; Exit:
  11538  beb8							; (byte_2B) points to line found
  11539  beb8		       a5 30		      LDA	unk_30
  11540  beba		       f0 f6		      BEQ	loc_BEB2
  11541  bebc		       20 ab 9b 	      JSR	make_cursor_invisible
  11542  bebf		       a5 2d		      LDA	byte_2D
  11543  bec1		       85 35		      STA	byte_35
  11544  bec3		       20 c0 a8 	      JSR	sub_A8C0
  11545  bec6		       20 c3 9e 	      JSR	get_line_height	; get height of	current	line
  11546  bec9							;
  11547  bec9							; Entry:
  11548  bec9							; ?byte_400 = line length
  11549  bec9							;
  11550  bec9							; Exit:
  11551  bec9							; X = line height
  11552  bec9		       8a		      TXA
  11553  beca		       38		      SEC
  11554  becb		       e5 35		      SBC	byte_35
  11555  becd		       85 35		      STA	byte_35
  11556  becf		       a5 08		      LDA	unk_8
  11557  bed1		       48		      PHA
  11558  bed2		       a5 09		      LDA	unk_9
  11559  bed4		       48		      PHA
  11560  bed5		       20 dc bf 	      JSR	find_current_line_by_number	; finds current line by number.
  11561  bed8							;
  11562  bed8							; Entry:
  11563  bed8							; current_line_no_lsb,
  11564  bed8							; current_line_no_msb =	line number to search for
  11565  bed8							;
  11566  bed8							; Exit:
  11567  bed8							; (byte_2B) points to line found
  11568  bed8		       20 77 aa 	      JSR	sub_AA77	; swap byte_2B with unk_2F, swap byte_2C with unk_30
  11569  bedb		       20 39 a0 	      JSR	save_line_number	; saves line number from program.
  11570  bede							;
  11571  bede							; Entry:
  11572  bede							; (byte_2b) points to current line
  11573  bede							;
  11574  bede							; Exit:
  11575  bede							; current_line_no_lsb, current_line_no_msb = the line number
  11576  bede		       20 08 9c 	      JSR	detokenize_one_line
  11577  bee1		       20 1e a0 	      JSR	sub_A01E
  11578  bee4		       a2 00		      LDX	#0
  11579  bee6		       a0 00		      LDY	#0
  11580  bee8		       20 01 8f 	      JSR	gotoxy
  11581  beeb		       a9 13		      LDA	#19
  11582  beed		       8d ab 06 	      STA	byte_6AB
  11583  bef0		       20 f4 ff 	      JSR	OSBYTE
  11584  bef3		       a4 2d		      LDY	byte_2D
  11585  bef5		       a9 0b		      LDA	#11
  11586  bef7
  11587  bef7				   loc_BEF7
  11588  bef7		       20 ee ff 	      JSR	OSWRCH
  11589  befa		       88		      DEY
  11590  befb		       d0 fa		      BNE	loc_BEF7
  11591  befd		       a5 35		      LDA	byte_35
  11592  beff		       f0 03		      BEQ	loc_BF04
  11593  bf01		       4c 5b bf 	      JMP	loc_BF5B
  11594  bf04
  11595  bf04				   loc_BF04
  11596  bf04		       38		      SEC
  11597  bf05		       ad bf 06 	      LDA	screen_height
  11598  bf08		       e5 2d		      SBC	byte_2D
  11599  bf0a		       85 36		      STA	byte_36
  11600  bf0c		       e6 36		      INC	byte_36
  11601  bf0e
  11602  bf0e				   loc_BF0E
  11603  bf0e		       a5 36		      LDA	byte_36
  11604  bf10		       0a		      ASL
  11605  bf11		       aa		      TAX
  11606  bf12		       a8		      TAY
  11607  bf13		       e8		      INX
  11608  bf14		       bd c0 06 	      LDA	$6C0,X
  11609  bf17		       f0 42		      BEQ	loc_BF5B
  11610  bf19		       88		      DEY
  11611  bf1a		       d9 c0 06 	      CMP	$6C0,Y
  11612  bf1d		       d0 30		      BNE	loc_BF4F
  11613  bf1f		       ca		      DEX
  11614  bf20		       88		      DEY
  11615  bf21		       bd c0 06 	      LDA	$6C0,X
  11616  bf24		       d9 c0 06 	      CMP	$6C0,Y
  11617  bf27		       d0 26		      BNE	loc_BF4F
  11618  bf29		       a9 00		      LDA	#0
  11619  bf2b		       9d c0 06 	      STA	$6C0,X
  11620  bf2e		       9d c1 06 	      STA	$6C1,X
  11621  bf31		       c6 36		      DEC	byte_36
  11622  bf33		       18		      CLC
  11623  bf34		       a5 36		      LDA	byte_36
  11624  bf36		       65 2d		      ADC	byte_2D
  11625  bf38		       a8		      TAY
  11626  bf39		       a2 00		      LDX	#0
  11627  bf3b		       20 01 8f 	      JSR	gotoxy
  11628  bf3e		       18		      CLC
  11629  bf3f		       ad b6 06 	      LDA	code_area_width
  11630  bf42		       69 06		      ADC	#6
  11631  bf44		       a8		      TAY
  11632  bf45		       a9 20		      LDA	#$20	; ' '
  11633  bf47
  11634  bf47				   loc_BF47
  11635  bf47		       20 ee ff 	      JSR	OSWRCH
  11636  bf4a		       88		      DEY
  11637  bf4b		       d0 fa		      BNE	loc_BF47
  11638  bf4d		       f0 bf		      BEQ	loc_BF0E
  11639  bf4f
  11640  bf4f				   loc_BF4F
  11641  bf4f		       a5 36		      LDA	byte_36
  11642  bf51		       0a		      ASL
  11643  bf52		       aa		      TAX
  11644  bf53		       a9 00		      LDA	#0
  11645  bf55		       9d c0 06 	      STA	$6C0,X
  11646  bf58		       9d c1 06 	      STA	$6C1,X
  11647  bf5b
  11648  bf5b				   loc_BF5B
  11649  bf5b		       a5 2d		      LDA	byte_2D
  11650  bf5d		       0a		      ASL
  11651  bf5e		       85 0e		      STA	byte_E
  11652  bf60		       a9 06		      LDA	#6
  11653  bf62		       85 0d		      STA	byte_D
  11654  bf64		       85 0f		      STA	byte_F
  11655  bf66		       a9 c0		      LDA	#-$40	;	'À'
  11656  bf68		       85 0c		      STA	byte_C
  11657  bf6a		       18		      CLC
  11658  bf6b		       65 0e		      ADC	byte_E
  11659  bf6d		       85 0e		      STA	byte_E
  11660  bf6f		       90 02		      BCC	loc_BF73
  11661  bf71		       e6 0f		      INC	byte_F
  11662  bf73
  11663  bf73				   loc_BF73
  11664  bf73		       18		      CLC
  11665  bf74		       ad bf 06 	      LDA	screen_height
  11666  bf77		       69 01		      ADC	#1
  11667  bf79		       38		      SEC
  11668  bf7a		       e5 2d		      SBC	byte_2D
  11669  bf7c		       0a		      ASL
  11670  bf7d		       a8		      TAY
  11671  bf7e		       a2 00		      LDX	#0
  11672  bf80		       20 a1 8e 	      JSR	memmove	; move (maybe overlapping) memory regions.
  11673  bf83							;
  11674  bf83							; Entry:
  11675  bf83							; (byte_C) points to src
  11676  bf83							; (byte_E) points to dest
  11677  bf83							; X is MSB of size
  11678  bf83							; Y is LSB of size
  11679  bf83		       a5 2b		      LDA	byte_2B
  11680  bf85		       8d c0 06 	      STA	byte_6C0
  11681  bf88		       a5 2c		      LDA	byte_2C
  11682  bf8a		       8d c1 06 	      STA	byte_6C1
  11683  bf8d		       20 00 9f 	      JSR	sub_9F00
  11684  bf90		       20 52 92 	      JSR	advance_2b_to_next_line
  11685  bf93		       a5 2d		      LDA	byte_2D
  11686  bf95		       85 3b		      STA	byte_3B
  11687  bf97		       0a		      ASL
  11688  bf98		       aa		      TAX
  11689  bf99		       a5 2b		      LDA	byte_2B
  11690  bf9b		       9d c0 06 	      STA	$6C0,X
  11691  bf9e		       a5 2c		      LDA	byte_2C
  11692  bfa0		       9d c1 06 	      STA	$6C1,X
  11693  bfa3		       20 39 a0 	      JSR	save_line_number	; saves line number from program.
  11694  bfa6							;
  11695  bfa6							; Entry:
  11696  bfa6							; (byte_2b) points to current line
  11697  bfa6							;
  11698  bfa6							; Exit:
  11699  bfa6							; current_line_no_lsb, current_line_no_msb = the line number
  11700  bfa6		       68		      PLA
  11701  bfa7		       85 09		      STA	unk_9
  11702  bfa9		       68		      PLA
  11703  bfaa		       85 08		      STA	unk_8
  11704  bfac		       ad b3 06 	      LDA	byte_6B3
  11705  bfaf		       d0 04		      BNE	loc_BFB5
  11706  bfb1		       a5 35		      LDA	byte_35
  11707  bfb3		       f0 09		      BEQ	loc_BFBE
  11708  bfb5
  11709  bfb5				   loc_BFB5
  11710  bfb5		       20 17 aa 	      JSR	sub_AA17
  11711  bfb8		       4c be bf 	      JMP	loc_BFBE
  11712  bfbb
  11713  bfbb				   loc_BFBB
  11714  bfbb		       20 06 aa 	      JSR	sub_AA06
  11715  bfbe
  11716  bfbe				   loc_BFBE
  11717  bfbe
  11718  bfbe		       a5 3b		      LDA	byte_3B
  11719  bfc0		       0a		      ASL
  11720  bfc1		       aa		      TAX
  11721  bfc2		       d0 07		      BNE	loc_BFCB
  11722  bfc4		       85 2b		      STA	byte_2B
  11723  bfc6		       85 2c		      STA	byte_2C
  11724  bfc8		       20 69 ba 	      JSR	sub_BA69
  11725  bfcb
  11726  bfcb				   loc_BFCB
  11727  bfcb		       ca		      DEX
  11728  bfcc		       20 45 a0 	      JSR	get_line_ptr	; gets pointer to line visible on screen.
  11729  bfcf							;
  11730  bfcf							; Entry:
  11731  bfcf							; X = screen line number * 2 + 1
  11732  bfcf							;
  11733  bfcf							; Exit:
  11734  bfcf							; (byte_2B) points to BASIC line
  11735  bfcf							; X decremented
  11736  bfcf		       20 69 ba 	      JSR	sub_BA69
  11737  bfd2		       8a		      TXA
  11738  bfd3		       4a		      LSR
  11739  bfd4		       85 3b		      STA	byte_3B
  11740  bfd6		       20 39 a0 	      JSR	save_line_number	; saves line number from program.
  11741  bfd9							;
  11742  bfd9							; Entry:
  11743  bfd9							; (byte_2b) points to current line
  11744  bfd9							;
  11745  bfd9							; Exit:
  11746  bfd9							; current_line_no_lsb, current_line_no_msb = the line number
  11747  bfd9		       4c 69 a0 	      JMP	sub_A069
  11748  bfdc							; End of function sub_BE98
  11749  bfdc
  11750  bfdc
  11751  bfdc
  11752  bfdc							; finds	current	line by	number.
  11753  bfdc							;
  11754  bfdc							; Entry:
  11755  bfdc							; current_line_no_lsb,
  11756  bfdc							; current_line_no_msb =	line number to search for
  11757  bfdc							;
  11758  bfdc							; Exit:
  11759  bfdc							; (byte_2B) points to line found
  11760  bfdc
  11761  bfdc				   find_current_line_by_number
  11762  bfdc		       a5 4a		      LDA	current_line_no_lsb
  11763  bfde		       85 2b		      STA	byte_2B
  11764  bfe0		       a5 4b		      LDA	current_line_no_msb
  11765  bfe2		       85 2c		      STA	byte_2C
  11766  bfe4		       4c 8f 9e 	      JMP	find_line_by_number	; finds a line, given a line number
  11767  bfe7							; End of function find_current_line_by_number ;
  11768  bfe7							; Entry:
  11769  bfe7							; byte_2B: line	number MSB
  11770  bfe7							; byte_2C: line	number LSB
  11771  bfe7							;
  11772  bfe7							; Exit:
  11773  bfe7							; (byte_2B) points to most suitable line
  11774  bfe7		       00		      dc.b	0	;
  11775  bfe8		       00		      dc.b	0	;
  11776  bfe9		       00		      dc.b	0	;
  11777  bfea		       00		      dc.b	0	;
  11778  bfeb		       00		      dc.b	0	;
  11779  bfec		       00		      dc.b	0	;
  11780  bfed		       00		      dc.b	0	;
  11781  bfee		       00		      dc.b	0	;
  11782  bfef		       00		      dc.b	0	;
  11783  bff0		       00		      dc.b	0	;
  11784  bff1		       00		      dc.b	0	;
  11785  bff2		       00		      dc.b	0	;
  11786  bff3		       00		      dc.b	0	;
  11787  bff4		       00		      dc.b	0	;
  11788  bff5		       00		      dc.b	0	;
  11789  bff6		       00		      dc.b	0	;
  11790  bff7		       00		      dc.b	0	;
  11791  bff8		       00		      dc.b	0	;
  11792  bff9		       00		      dc.b	0	;
  11793  bffa		       00		      dc.b	0	;
  11794  bffb		       00		      dc.b	0	;
  11795  bffc		       00		      dc.b	0	;
  11796  bffd		       00		      dc.b	0	;
  11797  bffe		       00		      dc.b	0	;
  11798  bfff		       00		      dc.b	0	;
  11799  c000							; end of 'seg002'
------- FILE basiced.s65
